<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BlockShell – PowerShell Lite</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
  <script src="https://unpkg.com/blockly/blockly.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <link rel="stylesheet" href="blockshell.css">
</head>
<body>
  <div id="blockshell-container">
    <header>
      <div class="header-main">
        <h1>BlockShell – PowerShell Lite</h1>
        <div class="subtitle">Visual PowerShell Script Builder</div>
      </div>
      
      <div class="header-controls">
        <div class="module-selector">
          <select id="module-select">
            <option value="powershell-core">PowerShell Core</option>
            <option value="active-directory" selected>Active Directory</option>
            <option value="exchange" disabled>Exchange (Coming Soon)</option>
            <option value="azure" disabled>Azure (Coming Soon)</option>
          </select>
          <div class="search-wrapper">
            <div class="search-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
              </svg>
            </div>
            <input type="text" id="block-search" placeholder="Search commands (e.g., 'create user', 'get group')..." autocomplete="off">
            <div id="search-results" class="search-results"></div>
          </div>
        </div>
      </div>
    </header>

    <div id="workspace-area">
      <div id="toolbar">
        <div class="toolbar-left">
          <button id="btn-generate" class="btn-primary">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="9 10 4 15 9 20"></polyline>
              <path d="M20 4v7a4 4 0 0 1-4 4H4"></path>
            </svg>
            Generate Script
          </button>
          <button id="btn-save" class="btn-secondary">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
              <polyline points="17 21 17 13 7 13 7 21"></polyline>
              <polyline points="7 3 7 8 15 8"></polyline>
            </svg>
            Save Script
          </button>
          <button id="btn-examples" class="btn-secondary">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
            Examples
          </button>
        </div>
        
        <div class="toolbar-right">
          <button id="btn-clear" class="btn-danger">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 6h18"></path>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
            Clear Workspace
          </button>
        </div>
      </div>
      
      <div id="blocklyDiv"></div>
      
      <div class="zoom-controls">
        <button class="zoom-btn" id="zoom-in" title="Zoom in">+</button>
        <button class="zoom-btn" id="zoom-out" title="Zoom out">−</button>
      </div>
    </div>
  </div>

  <!-- Modal for generated code -->
  <div id="code-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Generated PowerShell Script</h3>
        <button class="close-btn">&times;</button>
      </div>
      <div class="modal-body">
        <div class="code-block">
          <pre><code id="generated-code" class="language-powershell"></code></pre>
        </div>
      </div>
      <div class="modal-footer">
        <button id="btn-copy" class="btn-primary">Copy to Clipboard</button>
        <button id="btn-download" class="btn-secondary">Download Script</button>
      </div>
    </div>
  </div>

  <!-- Notifications -->
  <div id="notification" class="notification"></div>

  <!-- Blockly Toolbox XML -->
  <xml id="toolbox" style="display: none">
    <category name="User Management" colour="180">
      <block type="create_ad_user"></block>
      <block type="get_ad_user"></block>
      <block type="remove_ad_user"></block>
      <block type="set_user_properties"></block>
      <block type="move_ad_user"></block>
      <block type="rename_ad_user"></block>
      <block type="create_user_from_template"></block>
    </category>
    <category name="Group Management" colour="210">
      <block type="create_ad_group"></block>
      <block type="add_user_to_group"></block>
      <block type="remove_user_from_group"></block>
      <block type="copy_ad_group_members"></block>
      <block type="get_group_members"></block>
      <block type="nested_group_membership"></block>
    </category>
    <category name="Organization" colour="160">
      <block type="create_ou"></block>
      <block type="search_ad_objects"></block>
      <block type="get_inactive_computers"></block>
    </category>
    <category name="Security" colour="230">
      <block type="set_user_password"></block>
      <block type="force_password_change"></block>
      <block type="unlock_ad_account"></block>
      <block type="enable_ad_account"></block>
      <block type="disable_ad_account"></block>
      <block type="export_group_membership"></block>
      <block type="check_password_expiry"></block>
      <block type="check_locked_accounts"></block>
      <block type="reset_account_lockout"></block>
    </category>
    <category name="Reports" colour="130">
      <block type="generate_user_report"></block>
    </category>
    <category name="System Commands" colour="100">
      <block type="get_process"></block>
      <block type="get_service"></block>
      <block type="stop_service"></block>
      <block type="start_service"></block>
      <block type="restart_service"></block>
      <block type="get_childitem"></block>
      <block type="create_file"></block>
      <block type="remove_item"></block>
    </category>
  </xml>

  <script src="blockshell-core.js"></script>
  <script src="modules/powershell-core.js"></script>
  <script src="modules/active-directory.js"></script>
  
  <script>
    // Initialize the application when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      BlockShell.init();
    });
  </script>
</body>
</html>