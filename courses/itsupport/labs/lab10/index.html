<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lab 10: Enable Virtualization Technology</title>
  <style>
    :root {
      --primary-color: #2e51bb;
      --success-color: #10b981;
      --bios-blue: #0066cc;
      --bios-text: #ffffff;
    }
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: #f0f0f0;
      min-height: 100vh;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0;
    }
    .lab-container {
      width: 100%;
      max-width: 1200px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,.1);
      overflow: hidden;
    }
    .lab-header {
      background: var(--primary-color);
      color: #fff;
      padding: 16px;
      text-align: center;
    }
    .lab-title {
      font-size: 24px;
      font-weight: 600;
      margin: 0;
    }
    .task-panel {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      padding: 16px;
      margin: 16px;
    }
    .task-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--primary-color);
      margin-bottom: 8px;
    }
    .workspace {
      display: flex;
      gap: 16px;
      padding: 16px;
    }
    .main-area {
      flex: 1;
    }
    .sidebar {
      width: 280px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .bios-screen {
      width: 800px;
      height: 500px;
      background: var(--bios-blue);
      color: var(--bios-text);
      padding: 20px;
      display: flex;
      flex-direction: column;
      font-family: 'Courier New', monospace;
      border: 3px solid #333;
      margin: 0 auto;
    }
    .bios-header {
      border-bottom: 2px solid #fff;
      padding-bottom: 8px;
      margin-bottom: 12px;
      text-align: center;
    }
    .bios-title {
      font-size: 18px;
      color: #ff0;
      font-weight: bold;
    }
    .bios-content {
      flex: 1;
      display: flex;
      gap: 16px;
    }
    .bios-menu {
      width: 200px;
    }
    .menu-item {
      padding: 8px;
      border-radius: 4px;
      margin-bottom: 8px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.2);
      cursor: pointer;
      user-select: none;
    }
    .menu-item.active {
      background: #fff;
      color: #003a99;
      border-color: #fff;
      font-weight: bold;
    }
    .menu-item.has-submenu:after {
      content: " â–º";
      float: right;
      font-size: 12px;
    }
    .bios-info {
      flex: 1;
      background: rgba(255,255,255,.06);
      border-radius: 6px;
      border: 1px solid rgba(255,255,255,.25);
      padding: 12px;
    }
    .info-title {
      color: #ff0;
      font-weight: bold;
      margin-bottom: 8px;
    }
    .settings-section {
      background: rgba(0,0,0,.25);
      border: 1px solid rgba(255,255,255,.35);
      border-radius: 6px;
      padding: 10px;
    }
    .setting {
      padding: 8px;
      margin: 4px 0;
      border-radius: 4px;
      background: rgba(255,255,255,.1);
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      user-select: none;
    }
    .setting .name {
      font-weight: 600;
    }
    .setting .value {
      opacity: .95;
    }
    .setting.selected {
      background: #fff;
      color: #003a99;
    }
    .setting.submenu:after {
      content: " â–º";
      font-size: 12px;
    }
    
    .system-info {
      line-height: 1.6;
    }
    .info-row {
      display: flex;
      margin-bottom: 4px;
    }
    .info-label {
      width: 200px;
    }
    
    .bios-controls {
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px solid rgba(255,255,255,.3);
    }
    .controls-row {
      display: flex;
      gap: 8px;
      justify-content: center;
      margin-bottom: 8px;
    }
    .key-button {
      padding: 6px 12px;
      background: #444;
      border: 1px solid #666;
      border-radius: 4px;
      color: #fff;
      cursor: pointer;
      user-select: none;
      font-size: 12px;
    }
    .key-button.special {
      background: #0b61d6;
      border-color: #0b61d6;
      font-weight: bold;
    }
    .key-button.enter {
      background: #0a7e2a;
      border-color: #0a7e2a;
      font-weight: bold;
    }
    .key-button.esc {
      background: #b91c1c;
      border-color: #b91c1c;
      font-weight: bold;
    }
    .key-button:hover {
      opacity: .8;
    }
    .key-button.pressed {
      outline: 2px solid #fff;
    }
    .instructions {
      text-align: center;
      font-size: 12px;
      opacity: .9;
      margin-top: 8px;
    }
    
    .panel {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 12px;
    }
    .status-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    .status-item {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px;
      margin-bottom: 4px;
      font-size: 13px;
    }
    .status-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      border: 2px solid #ccc;
    }
    .status-indicator.complete {
      background: var(--success-color);
      border-color: var(--success-color);
    }
    .hint {
      font-size: 13px;
      color: #8b5a00;
      background: #fff8e1;
      border: 1px solid #ffc107;
      border-radius: 4px;
      padding: 8px;
    }
    .hidden {
      display: none;
    }
    
    .lab-controls {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .lab-button {
      background: var(--primary-color);
      color: #fff;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      font-size: 13px;
      cursor: pointer;
      width: 100%;
      transition: background-color 0.2s ease;
    }
    .lab-button:hover {
      background: #1e40a0;
    }
    .lab-button.secondary {
      background: #6c757d;
      color: #fff;
    }
    .lab-button.secondary:hover {
      background: #5a6268;
    }
    
    /* Save and Exit Dialog Styles */
    .save-exit-dialog {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--bios-blue);
      border: 2px solid #fff;
      border-radius: 6px;
      padding: 20px;
      width: 400px;
      z-index: 10;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
    }
    .save-exit-title {
      color: #ff0;
      font-weight: bold;
      margin-bottom: 12px;
      text-align: center;
    }
    .save-exit-content {
      background: rgba(0,0,0,0.25);
      border: 1px solid rgba(255,255,255,0.35);
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 16px;
    }
    .save-exit-options {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .save-exit-option {
      padding: 8px;
      border-radius: 4px;
      background: rgba(255,255,255,.1);
      cursor: pointer;
      user-select: none;
    }
    .save-exit-option.selected {
      background: #fff;
      color: #003a99;
      font-weight: bold;
    }
    .save-exit-controls {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 16px;
    }
    .overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 5;
    }
  </style>
</head>
<body>
<div class="lab-container">
  <div class="lab-header">
    <div class="lab-title">Lab 10: Enable Virtualization Technology</div>
  </div>
  <div class="task-panel">
    <div class="task-title">ðŸ”§ Task</div>
    Navigate through BIOS menus to <strong>Advanced â†’ CPU Configuration â†’ Advanced CPU Settings</strong> and enable <strong>Virtualization Technology</strong>. Press <strong>F10</strong> to save and exit.
  </div>
  <div class="workspace">
    <div class="main-area">
      <div class="bios-screen" id="biosScreen">
        <div class="bios-header">
          <div class="bios-title">ACME BIOS Setup Utility</div>
        </div>
        <div class="bios-content">
          <div class="bios-menu" id="mainMenu">
            <div class="menu-item" data-screen="main">Main</div>
            <div class="menu-item" data-screen="advanced">Advanced</div>
            <div class="menu-item" data-screen="security">Security</div>
            <div class="menu-item" data-screen="boot">Boot</div>
            <div class="menu-item" data-screen="exit">Exit</div>
          </div>
          <div class="bios-info" id="biosContent">
            <!-- Dynamic content -->
          </div>
        </div>
        <div class="bios-controls">
          <div class="controls-row">
            <div class="key-button esc" id="escKey">Esc</div>
            <div class="key-button special" id="f10Key">F10</div>
            <div class="key-button enter" id="enterKey">Enter</div>
            <div class="key-button" id="upKey">â†‘</div>
            <div class="key-button" id="downKey">â†“</div>
          </div>
          <div class="instructions">â†‘â†“ Navigate | Enter Select | Esc Back | F10 Save & Exit | Click menus/items to select</div>
        </div>
      </div>
    </div>
    <div class="sidebar">
      <div class="panel">
        <div class="status-title">Lab Progress</div>
        <div class="status-item">
          <div class="status-indicator" id="navMainDot"></div>
          Navigate to Advanced
        </div>
        <div class="status-item">
          <div class="status-indicator" id="navCpuDot"></div>
          Go to CPU Configuration
        </div>
        <div class="status-item">
          <div class="status-indicator" id="navVirtDot"></div>
          Find Virtualization Setting
        </div>
        <div class="status-item">
          <div class="status-indicator" id="virtDot"></div>
          Enable Virtualization
        </div>
        <div class="status-item">
          <div class="status-indicator" id="saveDot"></div>
          Save with F10
        </div>
      </div>
      <div class="panel hint hidden" id="hintPanel">
        Use arrow keys or click to navigate through BIOS menus.
      </div>
      <div class="panel hidden" id="donePanel">
        <b>ðŸŽ‰ Completed!</b> Virtualization enabled for VM support.
      </div>
      <div class="panel">
        <div class="lab-controls">
          <button class="lab-button secondary" id="resetLab" type="button">ðŸ”„ Reset Lab</button>
          <button class="lab-button" id="closeLab" type="button">Close Lab</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Save and Exit Dialog -->
<div class="overlay hidden" id="saveExitOverlay"></div>
<div class="save-exit-dialog hidden" id="saveExitDialog">
  <div class="save-exit-title">Save configuration and exit setup?</div>
  <div class="save-exit-content">
    <p>Changes have been made to the BIOS settings.</p>
    <p>Select an option below:</p>
  </div>
  <div class="save-exit-options" id="saveExitOptions">
    <div class="save-exit-option" data-action="save">Save Changes and Exit</div>
    <div class="save-exit-option" data-action="discard">Discard Changes and Exit</div>
    <div class="save-exit-option" data-action="cancel">Cancel</div>
  </div>
  <div class="save-exit-controls">
    <div class="key-button enter" id="dialogEnter">Enter</div>
    <div class="key-button esc" id="dialogEsc">Esc</div>
  </div>
</div>

<script>
class VirtualizationLab {
  constructor() {
    this.currentScreen = 'main';
    this.menuStack = [];
    this.currentSelection = 0;
    this.virtualizationEnabled = false;
    this.saved = false;
    this.saveExitSelection = 0;
    this.showingSaveExitDialog = false;
    
    // BIOS screens configuration
    this.screens = {
      main: {
        title: 'System Information',
        type: 'info',
        content: `
          <div class="system-info">
            <div class="info-row"><span class="info-label">BIOS Version:</span><span>ACME P1.20</span></div>
            <div class="info-row"><span class="info-label">BIOS Date:</span><span>08/15/2023</span></div>
            <div class="info-row"><span class="info-label">Processor Type:</span><span>Intel Core i7-12700K</span></div>
            <div class="info-row"><span class="info-label">Processor Speed:</span><span>3.60 GHz</span></div>
            <div class="info-row"><span class="info-label">System Memory:</span><span>16384 MB</span></div>
            <div class="info-row"><span class="info-label">Memory Speed:</span><span>3200 MHz</span></div>
          </div>
        `,
        items: []
      },
      advanced: {
        title: 'Advanced Settings',
        type: 'menu',
        items: [
          { name: 'CPU Configuration', type: 'submenu', target: 'cpuConfig' },
          { name: 'Chipset Configuration', type: 'submenu', target: 'chipset' },
          { name: 'Storage Configuration', type: 'submenu', target: 'storage' },
          { name: 'USB Configuration', type: 'submenu', target: 'usb' }
        ]
      },
      cpuConfig: {
        title: 'CPU Configuration',
        type: 'menu',
        items: [
          { name: 'CPU Power Management', type: 'submenu', target: 'cpuPower' },
          { name: 'Advanced CPU Settings', type: 'submenu', target: 'advancedCpu' },
          { name: 'CPU C-States Control', type: 'submenu', target: 'cstates' }
        ]
      },
      advancedCpu: {
        title: 'Advanced CPU Settings',
        type: 'settings',
        items: [
          { name: 'Hyper-Threading', value: 'Enabled', key: 'hyperthreading' },
          { name: 'CPU C-States', value: 'Auto', key: 'cstates' },
          { name: 'Virtualization Technology', value: 'Disabled', key: 'virtualization' },
          { name: 'Execute Disable Bit', value: 'Enabled', key: 'executeBit' },
          { name: 'Turbo Boost', value: 'Enabled', key: 'turbo' }
        ]
      },
      security: {
        title: 'Security Settings',
        type: 'menu',
        items: [
          { name: 'Administrator Password', type: 'submenu', target: 'adminPass' },
          { name: 'Secure Boot', type: 'submenu', target: 'secureBoot' }
        ]
      },
      boot: {
        title: 'Boot Configuration',
        type: 'settings',
        items: [
          { name: 'Boot Mode', value: 'UEFI', key: 'bootMode' },
          { name: 'Fast Boot', value: 'Enabled', key: 'fastBoot' }
        ]
      },
      exit: {
        title: 'Exit Options',
        type: 'menu',
        items: [
          { name: 'Save Changes and Exit', type: 'action', target: 'saveExit' },
          { name: 'Discard Changes and Exit', type: 'action', target: 'discardExit' }
        ]
      }
    };

    this.initialize();
  }

  initialize() {
    this.bindStaticEvents();
    this.renderScreen('main');
    this.updateProgress();
  }

  bindStaticEvents() {
    // Control button events
    document.getElementById('upKey').addEventListener('click', () => this.moveUp());
    document.getElementById('downKey').addEventListener('click', () => this.moveDown());
    document.getElementById('enterKey').addEventListener('click', () => this.pressEnter());
    document.getElementById('escKey').addEventListener('click', () => this.pressEscape());
    document.getElementById('f10Key').addEventListener('click', () => this.pressF10());

    // Lab control buttons
    document.getElementById('resetLab').addEventListener('click', () => this.reset());
    document.getElementById('closeLab').addEventListener('click', () => {
      if (confirm("Are you sure you want to close the lab?")) {
        // In most browsers window.close() only works for windows opened via script.
        // Provide graceful fallback.
        this.showHint('You can close this tab/window to exit the lab.');
        window.close();
      }
    });

    // Save/Exit dialog events
    document.getElementById('dialogEnter').addEventListener('click', () => this.handleSaveExitSelection());
    document.getElementById('dialogEsc').addEventListener('click', () => this.hideSaveExitDialog());
    
    // Save/Exit dialog option clicks
    document.getElementById('saveExitOptions').addEventListener('click', (e) => {
      const option = e.target.closest('.save-exit-option');
      if (!option) return;
      this.saveExitSelection = parseInt(option.dataset.index);
      this.handleSaveExitSelection();
    });

    // Keyboard events
    document.addEventListener('keydown', (e) => this.handleKeyPress(e));

    // Left menu click navigation (event delegation)
    document.getElementById('mainMenu').addEventListener('click', (e) => {
      const item = e.target.closest('.menu-item');
      if (!item) return;
      const targetScreen = item.dataset.screen;
      if (!targetScreen || !this.screens[targetScreen]) return;
      this.flashMenuItem(item);
      // If moving between top-level tabs, clear stack so Esc returns to Main cleanly
      if (['main','advanced','security','boot','exit'].includes(targetScreen)) {
        this.menuStack = [];
      }
      this.currentSelection = 0;
      this.renderScreen(targetScreen);
      this.updateProgress();
    });
  }

  // After each render we must bind dynamic events inside the biosContent
  bindDynamicEvents() {
    const screen = this.screens[this.currentScreen];
    if (!screen || !screen.items) return;

    // Bind click for each row to select it and perform action
    const rows = document.querySelectorAll('#biosContent .setting');
    rows.forEach((row, index) => {
      row.addEventListener('click', () => {
        this.currentSelection = index;
        this.renderScreen(); // re-render to show highlight
        // Perform default click action
        if (screen.type === 'menu') {
          const item = screen.items[index];
          if (item.type === 'submenu') {
            this.menuStack.push({screen: this.currentScreen, selection: index});
            this.currentSelection = 0;
            this.renderScreen(item.target);
          } else if (item.type === 'action' && item.target === 'saveExit') {
            this.showSaveExitDialog();
          }
        } else if (screen.type === 'settings') {
          const item = screen.items[index];
          if (this.currentScreen === 'advancedCpu' && item.key === 'virtualization') {
            this.toggleVirtualization();
          } else {
            this.showHint('This setting is read-only for the lab.');
          }
        }
        this.updateProgress();
      });
      // Optional: double click mirrors click (already handled)
      row.addEventListener('dblclick', () => {
        rows[index].click();
      });
    });
  }

  handleKeyPress(e) {
    if (this.showingSaveExitDialog) {
      switch(e.key) {
        case 'ArrowUp': e.preventDefault(); this.moveSaveExitSelection(-1); break;
        case 'ArrowDown': e.preventDefault(); this.moveSaveExitSelection(1); break;
        case 'Enter': e.preventDefault(); this.handleSaveExitSelection(); break;
        case 'Escape': e.preventDefault(); this.hideSaveExitDialog(); break;
      }
    } else {
      switch(e.key) {
        case 'ArrowUp': e.preventDefault(); this.moveUp(); break;
        case 'ArrowDown': e.preventDefault(); this.moveDown(); break;
        case 'Enter': e.preventDefault(); this.pressEnter(); break;
        case 'Escape': e.preventDefault(); this.pressEscape(); break;
        case 'F10': e.preventDefault(); this.pressF10(); break;
      }
    }
  }

  moveUp() {
    this.flashButton('upKey');
    const screen = this.screens[this.currentScreen];
    if (screen.items && screen.items.length > 0) {
      this.currentSelection = this.currentSelection > 0 ? this.currentSelection - 1 : screen.items.length - 1;
      this.renderScreen();
    } else {
      // When on top-level "tabs" without items (like Main), move focus across left menu
      this.moveLeftMenu(-1);
    }
  }

  moveDown() {
    this.flashButton('downKey');
    const screen = this.screens[this.currentScreen];
    if (screen.items && screen.items.length > 0) {
      this.currentSelection = this.currentSelection < screen.items.length - 1 ? this.currentSelection + 1 : 0;
      this.renderScreen();
    } else {
      this.moveLeftMenu(1);
    }
  }

  moveLeftMenu(direction) {
    const menuItems = [...document.querySelectorAll('#mainMenu .menu-item')];
    let idx = menuItems.findIndex(mi => mi.classList.contains('active'));
    if (idx === -1) idx = 0;
    idx = (idx + direction + menuItems.length) % menuItems.length;
    const targetScreen = menuItems[idx].dataset.screen;
    this.renderScreen(targetScreen);
    this.updateProgress();
  }

  pressEnter() {
    this.flashButton('enterKey');
    const screen = this.screens[this.currentScreen];
    
    if (!screen.items || !screen.items[this.currentSelection]) return;

    const item = screen.items[this.currentSelection];

    if (item.type === 'submenu') {
      this.menuStack.push({screen: this.currentScreen, selection: this.currentSelection});
      this.currentSelection = 0;
      this.renderScreen(item.target);
    } else if (this.currentScreen === 'advancedCpu' && item.key === 'virtualization') {
      this.toggleVirtualization();
    } else if (item.type === 'action' && item.target === 'saveExit') {
      this.showSaveExitDialog();
    }
    
    this.updateProgress();
  }

  pressEscape() {
    this.flashButton('escKey');
    if (this.menuStack.length > 0) {
      const previousState = this.menuStack.pop();
      this.currentScreen = previousState.screen;
      this.currentSelection = previousState.selection;
      this.renderScreen();
    } else {
      // If no stack, go back to Main from any top-level tab
      if (this.currentScreen !== 'main') {
        this.renderScreen('main');
      }
    }
    this.updateProgress();
  }

  pressF10() {
    this.flashButton('f10Key');
    this.showSaveExitDialog();
  }

  showSaveExitDialog() {
    this.showingSaveExitDialog = true;
    this.saveExitSelection = 0; // Default to "Save Changes and Exit"
    
    document.getElementById('saveExitOverlay').classList.remove('hidden');
    document.getElementById('saveExitDialog').classList.remove('hidden');
    
    // Update the dialog options
    this.updateSaveExitDialog();
  }

  hideSaveExitDialog() {
    this.showingSaveExitDialog = false;
    document.getElementById('saveExitOverlay').classList.add('hidden');
    document.getElementById('saveExitDialog').classList.add('hidden');
  }

  moveSaveExitSelection(direction) {
    const options = document.querySelectorAll('.save-exit-option');
    this.saveExitSelection = (this.saveExitSelection + direction + options.length) % options.length;
    this.updateSaveExitDialog();
  }

  updateSaveExitDialog() {
    const options = document.querySelectorAll('.save-exit-option');
    options.forEach((option, index) => {
      option.classList.toggle('selected', index === this.saveExitSelection);
      option.dataset.index = index;
    });
  }

  handleSaveExitSelection() {
    const options = [
      { action: 'save', text: 'Save Changes and Exit' },
      { action: 'discard', text: 'Discard Changes and Exit' },
      { action: 'cancel', text: 'Cancel' }
    ];
    
    const selectedOption = options[this.saveExitSelection];
    
    switch(selectedOption.action) {
      case 'save':
        if (!this.virtualizationEnabled) {
          this.showHint('Enable Virtualization Technology before saving.');
          this.hideSaveExitDialog();
          return;
        }
        this.saved = true;
        document.getElementById('saveDot').classList.add('complete');
        document.getElementById('donePanel').classList.remove('hidden');
        this.showHint('Changes saved. System will restart.');
        this.hideSaveExitDialog();
        break;
        
      case 'discard':
        this.showHint('Changes discarded. System will restart.');
        this.hideSaveExitDialog();
        break;
        
      case 'cancel':
        this.hideSaveExitDialog();
        break;
    }
  }

  toggleVirtualization() {
    const screen = this.screens['advancedCpu'];
    const item = screen.items.find(item => item.key === 'virtualization');
    
    this.virtualizationEnabled = !this.virtualizationEnabled;
    item.value = this.virtualizationEnabled ? 'Enabled' : 'Disabled';
    
    if (this.virtualizationEnabled) {
      document.getElementById('virtDot').classList.add('complete');
      this.showHint('Virtualization Technology enabled. Press F10 to save.');
    } else {
      document.getElementById('virtDot').classList.remove('complete');
      this.showHint('Virtualization Technology disabled.');
    }
    
    this.renderScreen();
    this.updateProgress();
  }

  renderScreen(screenName = this.currentScreen) {
    this.currentScreen = screenName;
    const screen = this.screens[this.currentScreen];
    const contentEl = document.getElementById('biosContent');
    
    // Update main menu highlights
    document.querySelectorAll('.menu-item').forEach(item => {
      const isActive = item.dataset.screen === this.currentScreen;
      item.classList.toggle('active', isActive);
      item.classList.toggle('has-submenu', 
        this.screens[item.dataset.screen]?.items?.some(i => i.type === 'submenu')
      );
    });

    // Build screen content
    let contentHTML = `<div class="info-title">${screen.title}</div>`;
    
    if (screen.type === 'info') {
      contentHTML += screen.content;
    } else if (screen.type === 'menu' || screen.type === 'settings') {
      contentHTML += `<div class="settings-section">`;
      screen.items.forEach((item, index) => {
        const isSelected = index === this.currentSelection;
        const itemClass = screen.type === 'menu' ? 'setting submenu' : 'setting';
        const selectedClass = isSelected ? 'selected' : '';
        
        contentHTML += `
          <div class="${itemClass} ${selectedClass}" data-index="${index}">
            <span class="name">${item.name}</span>
            <span class="value">${item.value || ''}</span>
          </div>
        `;
      });
      contentHTML += `</div>`;
    }

    contentEl.innerHTML = contentHTML;

    // Re-bind dynamic events for the freshly rendered content
    this.bindDynamicEvents();
  }

  updateProgress() {
    const navMainDot = document.getElementById('navMainDot');
    const navCpuDot = document.getElementById('navCpuDot');
    const navVirtDot = document.getElementById('navVirtDot');
    const virtDot = document.getElementById('virtDot');

    // Update progress based on navigation
    navMainDot.classList.toggle('complete', 
      this.currentScreen === 'advanced' || 
      this.menuStack.some(item => item.screen === 'advanced') ||
      this.currentScreen === 'cpuConfig' ||
      this.currentScreen === 'advancedCpu'
    );

    navCpuDot.classList.toggle('complete',
      this.currentScreen === 'cpuConfig' ||
      this.currentScreen === 'advancedCpu' ||
      this.menuStack.some(item => item.screen === 'cpuConfig')
    );

    navVirtDot.classList.toggle('complete',
      this.currentScreen === 'advancedCpu'
    );

    virtDot.classList.toggle('complete', this.virtualizationEnabled);
  }

  flashButton(buttonId) {
    const button = document.getElementById(buttonId);
    button.classList.add('pressed');
    setTimeout(() => button.classList.remove('pressed'), 150);
  }

  flashMenuItem(el) {
    el.classList.add('pressed');
    setTimeout(() => el.classList.remove('pressed'), 150);
  }

  showHint(message) {
    const hintPanel = document.getElementById('hintPanel');
    hintPanel.innerHTML = message;
    hintPanel.classList.remove('hidden');
    clearTimeout(this.hintTimeout);
    this.hintTimeout = setTimeout(() => {
      hintPanel.classList.add('hidden');
    }, 3000);
  }

  reset() {
    this.currentScreen = 'main';
    this.menuStack = [];
    this.currentSelection = 0;
    this.virtualizationEnabled = false;
    this.saved = false;
    this.hideSaveExitDialog();
    
    // Reset virtualization setting
    this.screens.advancedCpu.items.find(item => item.key === 'virtualization').value = 'Disabled';
    
    // Reset progress indicators
    document.querySelectorAll('.status-indicator').forEach(indicator => {
      indicator.classList.remove('complete');
    });
    
    document.getElementById('donePanel').classList.add('hidden');
    document.getElementById('hintPanel').classList.add('hidden');
    
    this.renderScreen();
    this.updateProgress();
    this.showHint('Lab has been reset. Start from the beginning.');
  }
}

// Initialize the lab when page loads
document.addEventListener('DOMContentLoaded', () => {
  new VirtualizationLab();
});
</script>
</body>
</html>