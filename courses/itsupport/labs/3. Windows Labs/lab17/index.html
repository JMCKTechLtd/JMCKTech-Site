<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab 17: Windows Service Management - Print Spooler</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0078d4 0%, #106ebe 100%);
            color: #ffffff;
            height: 100vh;
            overflow: hidden;
        }

        #desktop {
            position: absolute;
            inset: 0 0 48px 0;
            padding: 20px;
        }

        /* Desktop Icons */
        .desktop-icon {
            width: 80px;
            height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s ease;
            user-select: none;
            padding: 8px 4px;
            position: absolute;
        }

        .desktop-icon:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .desktop-icon img {
            width: 48px;
            height: 48px;
            margin-bottom: 8px;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        .desktop-icon .label {
            font-size: 12px;
            text-align: center;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
            line-height: 1.2;
            max-width: 76px;
            word-wrap: break-word;
        }

        /* Windows */
        .window {
            position: absolute;
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            display: none;
            flex-direction: column;
            overflow: hidden;
            backdrop-filter: blur(20px);
            min-width: 400px;
            min-height: 300px;
        }

        .window.active {
            display: flex;
            z-index: 100;
        }

        .window-header {
            background: linear-gradient(to bottom, #f9f9f9, #eaeaea);
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: move;
            border-bottom: 1px solid #d0d0d0;
            user-select: none;
        }

        .window-title {
            font-weight: 600;
            font-size: 14px;
            color: #000;
            flex: 1;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .window-title-icon {
            width: 16px;
            height: 16px;
        }

        .window-controls {
            display: flex;
            gap: 8px;
        }

        .window-control {
            width: 28px;
            height: 28px;
            border-radius: 4px;
            display: grid;
            place-items: center;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: background-color 0.1s ease;
            color: #000;
        }

        .window-control:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .window-control.close:hover {
            background: #e81123;
            color: white;
        }

        .window-body {
            padding: 20px;
            overflow: auto;
            background: #ffffff;
            flex: 1;
            color: #000;
        }

        /* Taskbar */
        .taskbar {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 48px;
            background: rgba(30, 30, 30, 0.9);
            backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            padding: 0 12px;
            z-index: 1000;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            gap: 8px;
        }

        .start-button {
            color: white;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 6px;
            transition: all 0.2s ease;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            cursor: pointer;
        }

        .start-button:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .windows-logo {
            width: 20px;
            height: 20px;
        }

        .taskbar-icons {
            display: flex;
            gap: 2px;
            margin-left: 8px;
        }

        .taskbar-icon {
            cursor: pointer;
            padding: 8px 12px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
            color: #fff;
            border-radius: 6px;
            transition: background-color 0.2s ease;
            font-size: 14px;
        }

        .taskbar-icon:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .taskbar-icon.active {
            background: rgba(255, 255, 255, 0.15);
            border-bottom: 2px solid #0078d4;
        }

        .system-tray {
            display: flex;
            align-items: center;
            color: white;
            font-size: 13px;
            margin-left: auto;
            gap: 4px;
        }

        .tray-icon {
            padding: 6px 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .tray-icon:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .tray-time {
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            font-variant-numeric: tabular-nums;
            min-width: 90px;
            text-align: center;
        }

        .tray-time:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Start Menu */
        .start-menu {
            position: absolute;
            bottom: 52px;
            left: 12px;
            width: 480px;
            height: 540px;
            background: rgba(42, 42, 42, 0.98);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(40px);
            display: none;
            overflow: hidden;
            z-index: 2000;
        }

        .start-menu-header {
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-weight: 600;
            font-size: 18px;
        }

        .start-menu-body {
            display: grid;
            grid-template-columns: 1fr 1fr;
            height: calc(100% - 80px);
        }

        .start-menu-pinned {
            padding: 20px;
            background: rgba(255, 255, 255, 0.02);
            border-right: 1px solid rgba(255, 255, 255, 0.08);
        }

        .start-menu-recommended {
            padding: 20px;
        }

        .app-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .app-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s ease;
            font-size: 14px;
        }

        .app-item:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .app-item .icon {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            background: #0078d4;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        /* Computer Management Styles */
        .management-layout {
            display: grid;
            grid-template-columns: 240px 1fr;
            height: 100%;
            gap: 0;
        }

        .tree-pane {
            background: #f8f8f8;
            border-right: 1px solid #e0e0e0;
            padding: 12px;
            overflow-y: auto;
        }

        .content-pane {
            padding: 20px;
            overflow-y: auto;
        }

        .tree-item {
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: #333;
            transition: background-color 0.1s ease;
        }

        .tree-item:hover {
            background: #e8f4fd;
        }

        .tree-item.active {
            background: #d7eafd;
            color: #106ebe;
            font-weight: 600;
        }

        .tree-item.has-children::before {
            content: '‚ñ∂';
            font-size: 10px;
            transition: transform 0.2s;
            width: 12px;
            text-align: center;
        }

        .tree-item.has-children.expanded::before {
            transform: rotate(90deg);
        }

        .tree-children {
            padding-left: 20px;
            display: none;
        }

        .tree-item.expanded + .tree-children {
            display: block;
        }

        /* Services Table */
        .services-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .services-table th {
            background: #f5f5f5;
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            color: #333;
            border-bottom: 1px solid #e0e0e0;
        }

        .services-table td {
            padding: 12px 16px;
            border-bottom: 1px solid #f0f0f0;
        }

        .services-table tr:last-child td {
            border-bottom: none;
        }

        .services-table tr:hover {
            background: #f8f8f8;
        }

        .services-table tr.selected {
            background: #e3f2fd;
        }

        /* Service Status Colors */
        .status.running { color: #107c10; font-weight: 600; }
        .status.stopped { color: #d83b01; font-weight: 600; }
        .status.starting { color: #107c10; opacity: 0.7; }
        .status.stopping { color: #d83b01; opacity: 0.7; }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e0e0e0;
        }

        .btn {
            padding: 8px 16px;
            border: 1px solid #ccc;
            background: #f8f8f8;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.1s ease;
        }

        .btn:hover {
            background: #e8e8e8;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn.primary {
            background: #0078d4;
            color: white;
            border-color: #106ebe;
        }

        .btn.primary:hover {
            background: #106ebe;
        }

        /* Print Queue */
        .print-queue {
            margin-top: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .print-queue-header {
            background: #f5f5f5;
            padding: 12px 16px;
            font-weight: 600;
            border-bottom: 1px solid #e0e0e0;
        }

        .print-jobs {
            background: white;
        }

        .print-job {
            padding: 12px 16px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .print-job:last-child {
            border-bottom: none;
        }

        .print-job-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .print-job-status.queued { background: #0078d4; }
        .print-job-status.printing { background: #107c10; }
        .print-job-status.error { background: #d83b01; }
        .print-job-status.paused { background: #ffb900; }

        /* Context Menu - FIXED POSITIONING */
        .context-menu {
            position: fixed;
            background: rgba(42, 42, 42, 0.98);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            display: none;
            z-index: 3000;
            min-width: 200px;
            padding: 6px;
        }

        .context-menu-item {
            padding: 10px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: background-color 0.1s ease;
        }

        .context-menu-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .context-menu-separator {
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: 4px 0;
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            background: #323232;
            color: white;
            padding: 12px 20px;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: none;
            z-index: 4000;
            font-size: 14px;
        }

        /* Calendar Popup */
        .calendar-popup {
            position: absolute;
            bottom: 52px;
            right: 12px;
            width: 300px;
            background: rgba(42, 42, 42, 0.98);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            display: none;
            z-index: 2000;
            padding: 16px;
        }

        .calendar-header {
            text-align: center;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .calendar-time {
            font-size: 28px;
            font-weight: 300;
            text-align: center;
            margin-bottom: 8px;
        }

        .calendar-date {
            text-align: center;
            opacity: 0.8;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            font-size: 12px;
        }

        .calendar-day {
            text-align: center;
            padding: 8px 4px;
            border-radius: 4px;
            cursor: pointer;
        }

        .calendar-day:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .calendar-day.today {
            background: #0078d4;
            color: white;
        }

        .calendar-day.other-month {
            opacity: 0.3;
        }

        .calendar-weekday {
            text-align: center;
            padding: 4px;
            opacity: 0.7;
            font-size: 11px;
            text-transform: uppercase;
        }
    </style>
</head>
<body>
    <!-- Desktop -->
    <div id="desktop">
        <!-- Desktop Icons -->
        <div class="desktop-icon" id="thisPcIcon" style="left: 20px; top: 20px;">
            <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHZpZXdCb3g9IjAgMCA0OCA0OCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQ4IiBoZWlnaHQ9IjQ4IiByeD0iNCIgZmlsbD0idXJsKCNwYWludDBfbGluZWFyXzQ1XzY1XzEpIi8+CjxwYXRoIGQ9Ik0xOSAyMEMxOSAxOS40NDc3IDE5LjQ0NzcgMTkgMjAgMTlIMjhDMjguNTUyMyAxOSAyOSAxOS40NDc3IDI5IDIwVjI4QzI5IDI4LjU1MjMgMjguNTUyMyAyOSAyOCAyOUgyMEMxOS40NDc3IDI5IDE5IDI4LjU1MjMgMTkgMjhWMjBaIiBmaWxsPSJ3aGl0ZSIvPgo8ZGVmcz4KPGxpbmVhckdyYWRpZW50IGlkPSJwYWludDBfbGluZWFyXzQ1XzY1XzEiIHgxPSIyNCIgeTE9IjAiIHgyPSIyNCIgeTI9IjQ4IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+CjxzdG9wIHN0b3AtY29sb3I9IiMwMDc4RDQiLz4KPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjMTA2RUJFIi8+CjwvbGluZWFyR3JhZGllbnQ+CjwvZGVmcz4KPC9zdmc+" alt="This PC">
            <div class="label">This PC</div>
        </div>

        <div class="desktop-icon" id="printersIcon" data-window="printersWindow" style="left: 120px; top: 20px;">
            <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHZpZXdCb3g9IjAgMCA0OCA0OCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQ4IiBoZWlnaHQ9IjQ4IiByeD0iNCIgZmlsbD0idXJsKCNwYWludDBfbGluZWFyXzQ1XzY1XzEpIi8+CjxwYXRoIGQ9Ik0xNCAxNkMzNCAxNiAzNCAxNiAzNCAxNkMzNCAxNiAzNCAzMiAzNCAzMkgyNkMzNCAzMiAzMiAzNiAzMiAzNkgyNkMyNiAzNiAyNiAzMiAxOCAzMkgxNEMxNCAzMiAxNCAxNiAxNCAxNloiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik0xOCAyNkgyNkMxOCAyNiAyMCAyMiAyMCAyMkMxOCAyMiAxOCAyNiAxOCAyNloiIGZpbGw9IndoaXRlIi8+CjxkZWZzPgo8bGluZWFyR3JhZGllbnQgaWQ9InBhaW50MF9saW5lYXJfNDVfNjVfMSIgeDE9IjI0IiB5MT0iMCIgeDI9IjI0IiB5Mj0iNDgiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVzNlIj4KPHN0b3Agc3RvcC1jb2xvcj0iIzAwNzhENCIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiMxMDZFQkUiLz4KPC9saW5lYXJHcmFkaWVudD4KPC9kZWZzPgo8L3N2Zz4=" alt="Printers">
            <div class="label">Printers & Scanners</div>
        </div>

        <!-- Instructions Window -->
        <div class="window active" id="instructionsWindow" style="width: 500px; height: 400px; left: 100px; top: 80px;">
            <div class="window-header">
                <div class="window-title">
                    <span class="window-title-icon">üìã</span>
                    Lab Instructions - Print Spooler Management
                </div>
                <div class="window-controls">
                    <div class="window-control" data-action="minimize">‚àí</div>
                    <div class="window-control" data-action="maximize">‚¨ú</div>
                    <div class="window-control close" data-action="close">‚úï</div>
                </div>
            </div>
            <div class="window-body">
                <h3>Learning Objectives:</h3>
                <ul style="margin: 12px 0 20px 20px;">
                    <li>Understand Windows Service architecture</li>
                    <li>Learn to manage service states (Start, Stop, Restart)</li>
                    <li>Configure service properties and dependencies</li>
                    <li>Troubleshoot print spooler issues</li>
                </ul>

                <h3>Lab Steps:</h3>
                <ol style="margin: 12px 0 20px 20px;">
                    <li><strong>Right-click</strong> on <strong>This PC</strong> and select <strong>Manage</strong> (or search for Computer Management from the Start Menu)</li>
                    <li>In Computer Management, navigate to <strong>Services and Applications</strong> and expand it</li>
                    <li>Select <strong>Services</strong> from the expanded list</li>
                    <li>Locate and select the <strong>Print Spooler</strong> service</li>
                    <li>Use the action buttons to manage the service state</li>
                    <li>Observe the impact on the print queue</li>
                </ol>

                <div class="action-buttons">
                    <button class="btn primary" id="startLab">Start Lab</button>
                    <button class="btn" id="resetLab">Reset Lab</button>
                </div>
            </div>
        </div>

        <!-- Computer Management Window -->
        <div class="window" id="compMgmt" style="width: 800px; height: 600px; left: 200px; top: 60px;">
            <div class="window-header">
                <div class="window-title">
                    <span class="window-title-icon">‚öôÔ∏è</span>
                    Computer Management
                </div>
                <div class="window-controls">
                    <div class="window-control" data-action="minimize">‚àí</div>
                    <div class="window-control" data-action="maximize">‚¨ú</div>
                    <div class="window-control close" data-action="close">‚úï</div>
                </div>
            </div>
            <div class="window-body">
                <div class="management-layout">
                    <div class="tree-pane">
                        <div class="tree-item has-children">
                            System Tools
                        </div>
                        <div class="tree-children">
                            <div class="tree-item">Task Scheduler</div>
                            <div class="tree-item">Event Viewer</div>
                            <div class="tree-item">Performance Monitor</div>
                            <div class="tree-item has-children">
                                Services and Applications
                            </div>
                            <div class="tree-children">
                                <!-- Services will appear here when expanded -->
                            </div>
                        </div>
                        <div class="tree-item has-children">
                            Storage
                        </div>
                        <div class="tree-children">
                            <div class="tree-item">Disk Management</div>
                        </div>
                    </div>
                    <div class="content-pane">
                        <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666; font-size: 14px;">
                            Select an item in the tree to view its contents.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Printers Window -->
        <div class="window" id="printersWindow" style="width: 500px; height: 400px; left: 150px; top: 120px;">
            <div class="window-header">
                <div class="window-title">
                    <span class="window-title-icon">üñ®Ô∏è</span>
                    Printers & Scanners
                </div>
                <div class="window-controls">
                    <div class="window-control" data-action="minimize">‚àí</div>
                    <div class="window-control" data-action="maximize">‚¨ú</div>
                    <div class="window-control close" data-action="close">‚úï</div>
                </div>
            </div>
            <div class="window-body">
                <p style="margin-bottom: 16px;">Installed printers:</p>
                
                <div style="display: flex; align-items: center; gap: 12px; padding: 12px; border: 1px solid #e0e0e0; border-radius: 4px; margin-bottom: 8px;">
                    <div style="width: 32px; height: 32px; background: #0078d4; border-radius: 4px; display: grid; place-items: center; color: white;">üñ®Ô∏è</div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600;">Microsoft Print to PDF</div>
                        <div style="font-size: 12px; color: #666;">Ready</div>
                    </div>
                    <button class="btn" style="font-size: 12px;">Manage</button>
                </div>

                <div style="display: flex; align-items: center; gap: 12px; padding: 12px; border: 1px solid #e0e0e0; border-radius: 4px; margin-bottom: 8px;">
                    <div style="width: 32px; height: 32px; background: #107c10; border-radius: 4px; display: grid; place-items: center; color: white;">üñ®Ô∏è</div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600;">HP LaserJet P2035</div>
                        <div style="font-size: 12px; color: #666;" id="printerStatus">Ready</div>
                    </div>
                    <button class="btn" style="font-size: 12px;">Manage</button>
                </div>

                <div style="margin-top: 20px; padding: 12px; background: #f8f8f8; border-radius: 4px; font-size: 13px;">
                    <strong>Note:</strong> Printers require the Print Spooler service to be running. 
                    If the service is stopped, printing functionality will be unavailable.
                </div>
            </div>
        </div>
    </div>

    <!-- Taskbar -->
    <div class="taskbar">
        <button class="start-button" id="startButton">
            <svg class="windows-logo" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                <rect x="1" y="1" width="8" height="8" fill="#00BCF2"/>
                <rect x="11" y="1" width="8" height="8" fill="#00BCF2"/>
                <rect x="1" y="11" width="8" height="8" fill="#00BCF2"/>
                <rect x="11" y="11" width="8" height="8" fill="#00BCF2"/>
            </svg>
            Start
        </button>

        <div class="taskbar-icons">
            <div class="taskbar-icon active" data-window="instructionsWindow" title="Lab Instructions">üìã</div>
            <div class="taskbar-icon" data-window="compMgmt" title="Computer Management">‚öôÔ∏è</div>
            <div class="taskbar-icon" data-window="printersWindow" title="Printers & Scanners">üñ®Ô∏è</div>
        </div>

        <div class="system-tray">
            <div class="tray-icon" title="Network">üåê</div>
            <div class="tray-icon" title="Volume">üîä</div>
            <div class="tray-time" id="trayTime">14:30</div>
        </div>
    </div>

    <!-- Start Menu -->
    <div class="start-menu" id="startMenu">
        <div class="start-menu-header">Windows Lab Environment</div>
        <div class="start-menu-body">
            <div class="start-menu-pinned">
                <div class="app-list">
                    <div class="app-item" data-app="instructions">
                        <div class="icon">üìã</div>
                        <span>Lab Instructions</span>
                    </div>
                    <div class="app-item" data-app="compMgmt">
                        <div class="icon">‚öôÔ∏è</div>
                        <span>Computer Management</span>
                    </div>
                    <div class="app-item" data-app="printers">
                        <div class="icon">üñ®Ô∏è</div>
                        <span>Printers & Scanners</span>
                    </div>
                </div>
            </div>
            <div class="start-menu-recommended">
                <div style="font-size: 12px; opacity: 0.7; margin-bottom: 12px;">Recommended</div>
                <div class="app-list">
                    <div class="app-item">
                        <div class="icon">üìÅ</div>
                        <span>File Explorer</span>
                    </div>
                    <div class="app-item">
                        <div class="icon">üåê</div>
                        <span>Microsoft Edge</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Context Menu -->
    <div class="context-menu" id="contextMenu">
        <div class="context-menu-item" data-action="open">Open</div>
        <div class="context-menu-item" data-action="manage">Manage</div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" data-action="pinToStart">Pin to Start</div>
        <div class="context-menu-item" data-action="createShortcut">Create shortcut</div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" data-action="properties">Properties</div>
    </div>

    <!-- Calendar Popup -->
    <div class="calendar-popup" id="calendarPopup">
        <div class="calendar-time" id="calendarTime">14:30</div>
        <div class="calendar-date" id="calendarDate">Wednesday, October 25, 2023</div>
        <div class="calendar-grid" id="calendarGrid">
            <!-- Calendar will be populated by JavaScript -->
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <script>
        // Main JavaScript for the Windows Lab Environment
        document.addEventListener('DOMContentLoaded', function() {
            // Element references
            const desktop = document.getElementById('desktop');
            const taskbarIcons = document.querySelectorAll('.taskbar-icon');
            const windows = document.querySelectorAll('.window');
            const startButton = document.getElementById('startButton');
            const startMenu = document.getElementById('startMenu');
            const trayTime = document.getElementById('trayTime');
            const contextMenu = document.getElementById('contextMenu');
            const calendarPopup = document.getElementById('calendarPopup');
            const toast = document.getElementById('toast');
            const thisPcIcon = document.getElementById('thisPcIcon');

            // Window dragging state
            let dragState = {
                isDragging: false,
                currentWindow: null,
                offsetX: 0,
                offsetY: 0
            };

            // Service management state
            let services = {
                'spooler': { status: 'running', startup: 'automatic' },
                'rpc': { status: 'running', startup: 'automatic' },
                'http': { status: 'running', startup: 'automatic' },
                'wuauserv': { status: 'running', startup: 'automatic' },
                'bits': { status: 'stopped', startup: 'manual' }
            };

            let printJobs = [
                { name: 'Document1.docx - Microsoft Word', status: 'queued' },
                { name: 'Report.pdf - Adobe Acrobat', status: 'printing' }
            ];

            // Track if services view is loaded
            let servicesViewLoaded = false;

            // Initialize the lab
            function initLab() {
                updateSystemTime();
                setupEventListeners();
                setupServiceControls();
                updatePrintQueue();
                setupWindowDragging();
                setupTreeNavigation();
                
                // Update time every minute
                setInterval(updateSystemTime, 60000);
            }

            // Setup tree navigation in Computer Management
            function setupTreeNavigation() {
                document.querySelectorAll('.tree-item.has-children').forEach(item => {
                    item.addEventListener('click', function(e) {
                        e.stopPropagation();
                        this.classList.toggle('expanded');
                        
                        // If expanding Services and Applications, load the services view
                        if (this.textContent.includes('Services and Applications') && this.classList.contains('expanded')) {
                            loadServicesView();
                        }
                    });
                });
            }

            // Load the services view when Services and Applications is expanded
            function loadServicesView() {
                if (servicesViewLoaded) return;
                
                const servicesAppsChildren = document.querySelectorAll('.tree-item.has-children');
                let targetChildren = null;
                
                servicesAppsChildren.forEach(item => {
                    if (item.textContent.includes('Services and Applications')) {
                        targetChildren = item.nextElementSibling;
                    }
                });
                
                if (!targetChildren) return;
                
                targetChildren.innerHTML = `
                    <div class="tree-item">WMI Control</div>
                    <div class="tree-item has-children">Services</div>
                    <div class="tree-children">
                        <div class="tree-item" data-action="view-services">Services (Local)</div>
                    </div>
                `;
                
                // Add event listener to the Services item
                const servicesItem = targetChildren.querySelector('.tree-item.has-children');
                servicesItem.addEventListener('click', function(e) {
                    e.stopPropagation();
                    this.classList.toggle('expanded');
                });
                
                // Add event listener to the Services (Local) item
                const servicesLocalItem = targetChildren.querySelector('.tree-item[data-action="view-services"]');
                servicesLocalItem.addEventListener('click', function(e) {
                    e.stopPropagation();
                    // Remove active class from all tree items
                    document.querySelectorAll('.tree-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    
                    // Add active class to this item
                    this.classList.add('active');
                    
                    // Load the services content
                    loadServicesContent();
                });
                
                servicesViewLoaded = true;
            }

            // Load the services content pane
            function loadServicesContent() {
                const contentPane = document.querySelector('#compMgmt .content-pane');
                contentPane.innerHTML = `
                    <div class="action-buttons">
                        <button class="btn" id="startService" disabled>Start</button>
                        <button class="btn" id="stopService" disabled>Stop</button>
                        <button class="btn" id="restartService" disabled>Restart</button>
                        <button class="btn" id="pauseService" disabled>Pause</button>
                        <button class="btn" id="refreshServices">Refresh</button>
                    </div>

                    <table class="services-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Description</th>
                                <th>Status</th>
                                <th>Startup Type</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr data-service="spooler">
                                <td>Print Spooler</td>
                                <td>This service spools print jobs and handles interaction with the printer</td>
                                <td class="status running">Running</td>
                                <td>Automatic</td>
                            </tr>
                            <tr data-service="rpc">
                                <td>Remote Procedure Call (RPC)</td>
                                <td>Manages RPC communication between processes</td>
                                <td class="status running">Running</td>
                                <td>Automatic</td>
                            </tr>
                            <tr data-service="http">
                                <td>HTTP Service</td>
                                <td>HTTP support for Windows services</td>
                                <td class="status running">Running</td>
                                <td>Automatic</td>
                            </tr>
                            <tr data-service="wuauserv">
                                <td>Windows Update</td>
                                <td>Enables detection, download, and installation of updates</td>
                                <td class="status running">Running</td>
                                <td>Automatic (Delayed Start)</td>
                            </tr>
                            <tr data-service="bits">
                                <td>Background Intelligent Transfer</td>
                                <td>Transfers files in the background using idle network bandwidth</td>
                                <td class="status stopped">Stopped</td>
                                <td>Manual</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="print-queue">
                        <div class="print-queue-header">
                            Print Queue (Simulated)
                        </div>
                        <div class="print-jobs" id="printJobs">
                            <div class="print-job">
                                <div class="print-job-status queued"></div>
                                <span>Document1.docx - Microsoft Word</span>
                                <span style="margin-left: auto; font-size: 12px; color: #666;">Queued</span>
                            </div>
                            <div class="print-job">
                                <div class="print-job-status printing"></div>
                                <span>Report.pdf - Adobe Acrobat</span>
                                <span style="margin-left: auto; font-size: 12px; color: #666;">Printing...</span>
                            </div>
                        </div>
                    </div>
                `;
                
                // Re-setup service controls for the newly loaded content
                setupServiceControls();
                
                // Re-setup service table selection
                document.querySelectorAll('.services-table tbody tr').forEach(row => {
                    row.addEventListener('click', selectService);
                });
                
                // Update print queue
                updatePrintQueue();
            }

            // Setup window dragging
            function setupWindowDragging() {
                document.querySelectorAll('.window-header').forEach(header => {
                    header.addEventListener('mousedown', startDragging);
                });

                document.addEventListener('mousemove', handleDragging);
                document.addEventListener('mouseup', stopDragging);
            }

            function startDragging(e) {
                if (e.target.closest('.window-control')) return;
                
                const window = e.target.closest('.window');
                if (!window) return;
                
                dragState.isDragging = true;
                dragState.currentWindow = window;
                
                const rect = window.getBoundingClientRect();
                dragState.offsetX = e.clientX - rect.left;
                dragState.offsetY = e.clientY - rect.top;
                
                // Bring window to front
                windows.forEach(w => w.style.zIndex = '100');
                window.style.zIndex = '101';
                
                e.preventDefault();
            }

            function handleDragging(e) {
                if (!dragState.isDragging || !dragState.currentWindow) return;
                
                const x = e.clientX - dragState.offsetX;
                const y = e.clientY - dragState.offsetY;
                
                dragState.currentWindow.style.left = x + 'px';
                dragState.currentWindow.style.top = y + 'px';
            }

            function stopDragging() {
                dragState.isDragging = false;
                dragState.currentWindow = null;
            }

            // Update system time display
            function updateSystemTime() {
                const now = new Date();
                const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                const dateString = now.toLocaleDateString([], { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                
                trayTime.textContent = timeString;
                
                if (calendarPopup.style.display === 'block') {
                    document.getElementById('calendarTime').textContent = timeString;
                    document.getElementById('calendarDate').textContent = dateString;
                    renderCalendar();
                }
            }

            // Setup event listeners
            function setupEventListeners() {
                // Start menu
                startButton.addEventListener('click', toggleStartMenu);
                
                // Desktop icons - remove double-click for This PC, keep right-click
                document.querySelectorAll('.desktop-icon').forEach(icon => {
                    if (icon.id === 'thisPcIcon') {
                        // Only allow right-click for This PC
                        icon.addEventListener('contextmenu', showContextMenu);
                    } else {
                        // Other icons can still be double-clicked
                        icon.addEventListener('dblclick', openWindowFromIcon);
                        icon.addEventListener('contextmenu', showContextMenu);
                    }
                });
                
                // Taskbar icons
                taskbarIcons.forEach(icon => {
                    icon.addEventListener('click', toggleWindowFromTaskbar);
                });
                
                // Window controls
                document.querySelectorAll('.window-control').forEach(control => {
                    control.addEventListener('click', handleWindowControl);
                });
                
                // Start menu apps
                document.querySelectorAll('.app-item').forEach(item => {
                    item.addEventListener('click', openAppFromStartMenu);
                });
                
                // Time click for calendar
                trayTime.addEventListener('click', toggleCalendar);
                
                // Click outside to close menus
                document.addEventListener('click', closeAllMenus);
                
                // Prevent context menu on desktop
                desktop.addEventListener('contextmenu', e => {
                    if (e.target.id === 'desktop') {
                        e.preventDefault();
                        closeAllMenus();
                    }
                });
                
                // Context menu actions - FIXED: Simple event delegation
                contextMenu.addEventListener('click', function(e) {
                    if (e.target.classList.contains('context-menu-item')) {
                        const action = e.target.getAttribute('data-action');
                        
                        switch(action) {
                            case 'manage':
                                openWindow('compMgmt');
                                break;
                            case 'open':
                                showToast('Opening This PC...');
                                break;
                            case 'properties':
                                showToast('Properties dialog would open here.');
                                break;
                            default:
                                break;
                        }
                        
                        contextMenu.style.display = 'none';
                    }
                });
                
                // Lab controls
                document.getElementById('startLab').addEventListener('click', startLab);
                document.getElementById('resetLab').addEventListener('click', resetLab);
            }

            // Start menu functions
            function toggleStartMenu(e) {
                e.stopPropagation();
                const isVisible = startMenu.style.display === 'block';
                closeAllMenus();
                if (!isVisible) {
                    startMenu.style.display = 'block';
                }
            }

            // Window management
            function openWindowFromIcon(e) {
                const windowId = this.getAttribute('data-window');
                openWindow(windowId);
            }

            function openWindow(windowId) {
                // Close other windows
                windows.forEach(window => {
                    window.classList.remove('active');
                    window.style.display = 'none';
                });
                
                // Open requested window
                const targetWindow = document.getElementById(windowId);
                if (targetWindow) {
                    targetWindow.style.display = 'flex';
                    targetWindow.classList.add('active');
                    
                    // Update taskbar
                    updateTaskbarIcon(windowId, true);
                }
                
                closeAllMenus();
            }

            function toggleWindowFromTaskbar(e) {
                const windowId = this.getAttribute('data-window');
                const targetWindow = document.getElementById(windowId);
                
                if (targetWindow.style.display === 'flex') {
                    targetWindow.style.display = 'none';
                    targetWindow.classList.remove('active');
                    this.classList.remove('active');
                } else {
                    openWindow(windowId);
                }
            }

            function handleWindowControl(e) {
                const action = this.getAttribute('data-action');
                const window = this.closest('.window');
                
                switch (action) {
                    case 'minimize':
                        window.style.display = 'none';
                        window.classList.remove('active');
                        updateTaskbarIcon(window.id, false);
                        break;
                    case 'maximize':
                        // Toggle between default and maximized
                        if (window.style.width === '100%') {
                            window.style.width = '';
                            window.style.height = '';
                            window.style.left = '';
                            window.style.top = '';
                        } else {
                            window.style.width = '100%';
                            window.style.height = 'calc(100% - 48px)';
                            window.style.left = '0';
                            window.style.top = '0';
                        }
                        break;
                    case 'close':
                        window.style.display = 'none';
                        window.classList.remove('active');
                        updateTaskbarIcon(window.id, false);
                        break;
                }
            }

            function updateTaskbarIcon(windowId, isActive) {
                const taskbarIcon = document.querySelector(`.taskbar-icon[data-window="${windowId}"]`);
                if (taskbarIcon) {
                    if (isActive) {
                        taskbarIcon.classList.add('active');
                    } else {
                        taskbarIcon.classList.remove('active');
                    }
                }
            }

            // Context menu - FIXED: Simple and reliable
            function showContextMenu(e) {
                e.preventDefault();
                closeAllMenus();
                
                contextMenu.style.display = 'block';
                contextMenu.style.left = e.pageX + 'px';
                contextMenu.style.top = e.pageY + 'px';
            }

            // Calendar
            function toggleCalendar(e) {
                e.stopPropagation();
                const isVisible = calendarPopup.style.display === 'block';
                closeAllMenus();
                if (!isVisible) {
                    calendarPopup.style.display = 'block';
                    updateSystemTime();
                    renderCalendar();
                }
            }

            function renderCalendar() {
                const now = new Date();
                const year = now.getFullYear();
                const month = now.getMonth();
                
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const daysInMonth = lastDay.getDate();
                const startingDay = firstDay.getDay();
                
                const calendarGrid = document.getElementById('calendarGrid');
                
                // Clear existing content except weekdays
                const weekdays = calendarGrid.querySelectorAll('.calendar-weekday');
                calendarGrid.innerHTML = '';
                weekdays.forEach(day => calendarGrid.appendChild(day));
                
                // Add empty cells for days before the first day of the month
                for (let i = 0; i < startingDay; i++) {
                    const emptyDay = document.createElement('div');
                    emptyDay.className = 'calendar-day other-month';
                    emptyDay.textContent = '';
                    calendarGrid.appendChild(emptyDay);
                }
                
                // Add days of the month
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day';
                    dayElement.textContent = day;
                    
                    // Highlight today
                    if (day === now.getDate() && month === now.getMonth() && year === now.getFullYear()) {
                        dayElement.classList.add('today');
                    }
                    
                    calendarGrid.appendChild(dayElement);
                }
            }

            // Close all menus and popups
            function closeAllMenus() {
                startMenu.style.display = 'none';
                contextMenu.style.display = 'none';
                calendarPopup.style.display = 'none';
            }

            // Service management
            function setupServiceControls() {
                // These will be set up when the services content is loaded
                const startBtn = document.getElementById('startService');
                const stopBtn = document.getElementById('stopService');
                const restartBtn = document.getElementById('restartService');
                const pauseBtn = document.getElementById('pauseService');
                const refreshBtn = document.getElementById('refreshServices');
                
                if (startBtn) {
                    startBtn.addEventListener('click', startSelectedService);
                }
                if (stopBtn) {
                    stopBtn.addEventListener('click', stopSelectedService);
                }
                if (restartBtn) {
                    restartBtn.addEventListener('click', restartSelectedService);
                }
                if (pauseBtn) {
                    pauseBtn.addEventListener('click', pauseSelectedService);
                }
                if (refreshBtn) {
                    refreshBtn.addEventListener('click', refreshServices);
                }
            }

            function selectService() {
                // Remove selection from other rows
                document.querySelectorAll('.services-table tbody tr').forEach(row => {
                    row.classList.remove('selected');
                });
                
                // Select this row
                this.classList.add('selected');
                
                // Update button states
                const serviceName = this.getAttribute('data-service');
                const service = services[serviceName];
                updateServiceButtons(service.status, serviceName);
            }

            function updateServiceButtons(status, serviceName) {
                const startBtn = document.getElementById('startService');
                const stopBtn = document.getElementById('stopService');
                const restartBtn = document.getElementById('restartService');
                const pauseBtn = document.getElementById('pauseService');
                
                if (startBtn) startBtn.disabled = status !== 'stopped';
                if (stopBtn) stopBtn.disabled = status !== 'running';
                if (restartBtn) restartBtn.disabled = serviceName !== 'spooler' || status !== 'running';
                if (pauseBtn) pauseBtn.disabled = serviceName !== 'spooler' || status !== 'running';
            }

            function startSelectedService() {
                const selectedRow = document.querySelector('.services-table tbody tr.selected');
                if (!selectedRow) return;
                
                const serviceName = selectedRow.getAttribute('data-service');
                setServiceStatus(serviceName, 'starting');
                
                setTimeout(() => {
                    setServiceStatus(serviceName, 'running');
                    showToast(`The ${getServiceDisplayName(serviceName)} service was started successfully.`);
                    updatePrintQueue();
                }, 1000);
            }

            function stopSelectedService() {
                const selectedRow = document.querySelector('.services-table tbody tr.selected');
                if (!selectedRow) return;
                
                const serviceName = selectedRow.getAttribute('data-service');
                if (serviceName === 'rpc') {
                    showToast('The Remote Procedure Call (RPC) service cannot be stopped.', 'error');
                    return;
                }
                
                setServiceStatus(serviceName, 'stopping');
                
                setTimeout(() => {
                    setServiceStatus(serviceName, 'stopped');
                    showToast(`The ${getServiceDisplayName(serviceName)} service was stopped successfully.`);
                    updatePrintQueue();
                }, 1000);
            }

            function restartSelectedService() {
                const selectedRow = document.querySelector('.services-table tbody tr.selected');
                if (!selectedRow) return;
                
                const serviceName = selectedRow.getAttribute('data-service');
                if (serviceName !== 'spooler') return;
                
                setServiceStatus(serviceName, 'stopping');
                
                setTimeout(() => {
                    setServiceStatus(serviceName, 'starting');
                    
                    setTimeout(() => {
                        setServiceStatus(serviceName, 'running');
                        showToast(`The ${getServiceDisplayName(serviceName)} service was restarted successfully.`);
                        updatePrintQueue();
                    }, 1000);
                }, 1000);
            }

            function pauseSelectedService() {
                const selectedRow = document.querySelector('.services-table tbody tr.selected');
                if (!selectedRow) return;
                
                const serviceName = selectedRow.getAttribute('data-service');
                if (serviceName !== 'spooler') return;
                
                setServiceStatus(serviceName, 'paused');
                showToast(`The ${getServiceDisplayName(serviceName)} service was paused.`);
                updatePrintQueue();
            }

            function refreshServices() {
                showToast('Services list refreshed.');
            }

            function setServiceStatus(serviceName, status) {
                services[serviceName].status = status;
                
                const row = document.querySelector(`.services-table tbody tr[data-service="${serviceName}"]`);
                if (!row) return;
                
                const statusCell = row.querySelector('.status');
                statusCell.textContent = status.charAt(0).toUpperCase() + status.slice(1);
                statusCell.className = 'status ' + status;
                
                // Update printer status if spooler service changed
                if (serviceName === 'spooler') {
                    updatePrinterStatus(status);
                }
            }

            function getServiceDisplayName(serviceName) {
                const names = {
                    'spooler': 'Print Spooler',
                    'rpc': 'Remote Procedure Call (RPC)',
                    'http': 'HTTP Service',
                    'wuauserv': 'Windows Update',
                    'bits': 'Background Intelligent Transfer'
                };
                return names[serviceName] || serviceName;
            }

            function updatePrinterStatus(spoolerStatus) {
                const printerStatus = document.getElementById('printerStatus');
                if (!printerStatus) return;
                
                if (spoolerStatus === 'running') {
                    printerStatus.textContent = 'Ready';
                    printerStatus.style.color = '#107c10';
                } else {
                    printerStatus.textContent = 'Spooler not running';
                    printerStatus.style.color = '#d13438';
                }
            }

            function updatePrintQueue() {
                const printJobsContainer = document.getElementById('printJobs');
                if (!printJobsContainer) return;
                
                const spoolerStatus = services['spooler'].status;
                
                if (spoolerStatus !== 'running') {
                    printJobsContainer.innerHTML = `
                        <div style="padding: 20px; text-align: center; color: #666;">
                            Print queue unavailable - Print Spooler service is not running
                        </div>
                    `;
                    return;
                }
                
                // Update print jobs based on service status
                let jobsHTML = '';
                printJobs.forEach(job => {
                    const statusClass = job.status === 'printing' ? 'printing' : 'queued';
                    const statusText = job.status === 'printing' ? 'Printing...' : 'Queued';
                    jobsHTML += `
                        <div class="print-job">
                            <div class="print-job-status ${statusClass}"></div>
                            <span>${job.name}</span>
                            <span style="margin-left: auto; font-size: 12px; color: #666;">${statusText}</span>
                        </div>
                    `;
                });
                
                printJobsContainer.innerHTML = jobsHTML;
            }

            // Start menu app opening
            function openAppFromStartMenu() {
                const app = this.getAttribute('data-app');
                let windowId;
                
                switch(app) {
                    case 'instructions':
                        windowId = 'instructionsWindow';
                        break;
                    case 'compMgmt':
                        windowId = 'compMgmt';
                        break;
                    case 'printers':
                        windowId = 'printersWindow';
                        break;
                    default:
                        return;
                }
                
                openWindow(windowId);
            }

            // Toast notifications
            function showToast(message, type = 'info') {
                toast.textContent = message;
                toast.className = 'toast ' + type;
                toast.style.display = 'block';
                
                setTimeout(() => {
                    toast.style.display = 'none';
                }, 3000);
            }

            // Lab functions
            function startLab() {
                showToast('Lab started! Right-click on This PC and select Manage to begin.');
                openWindow('compMgmt');
            }

            function resetLab() {
                // Reset service states
                services = {
                    'spooler': { status: 'running', startup: 'automatic' },
                    'rpc': { status: 'running', startup: 'automatic' },
                    'http': { status: 'running', startup: 'automatic' },
                    'wuauserv': { status: 'running', startup: 'automatic' },
                    'bits': { status: 'stopped', startup: 'manual' }
                };
                
                // Reset print jobs
                printJobs = [
                    { name: 'Document1.docx - Microsoft Word', status: 'queued' },
                    { name: 'Report.pdf - Adobe Acrobat', status: 'printing' }
                ];
                
                // Reset services view
                servicesViewLoaded = false;
                
                // Close all windows except instructions
                windows.forEach(window => {
                    if (window.id !== 'instructionsWindow') {
                        window.style.display = 'none';
                        window.classList.remove('active');
                        updateTaskbarIcon(window.id, false);
                    }
                });
                
                // Reset Computer Management tree
                document.querySelectorAll('.tree-item').forEach(item => {
                    item.classList.remove('expanded', 'active');
                });
                
                // Reset Computer Management content
                const contentPane = document.querySelector('#compMgmt .content-pane');
                contentPane.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666; font-size: 14px;">Select an item in the tree to view its contents.</div>';
                
                // Show instructions
                document.getElementById('instructionsWindow').style.display = 'flex';
                document.getElementById('instructionsWindow').classList.add('active');
                updateTaskbarIcon('instructionsWindow', true);
                
                showToast('Lab has been reset to initial state.');
            }

            // Initialize the lab
            initLab();
        });
    </script>
</body>
</html>