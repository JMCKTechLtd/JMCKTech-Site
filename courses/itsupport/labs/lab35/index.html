<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Lab 35: Okta – Reset & Re-Enroll Okta Verify</title>
<style>
  :root{
    --okta-blue:#1662dd;
    --okta-blue-dark:#0e4db1;
    --bg:#f7f9fc;
    --text:#0f172a;
    --muted:#6b7280;
    --card:#ffffff;
    --border:#e5e7eb;
    --success:#16a34a;
    --warning:#f59e0b;
    --danger:#dc2626;
    --shadow:0 10px 30px rgba(2,6,23,.08);
    --radius:16px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: ui-sans-serif, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    color:var(--text);
    background:linear-gradient(180deg,#fff 0%, var(--bg) 100%);
  }
  .container{max-width:1200px;margin:0 auto;padding:16px;display:grid;grid-template-columns:360px 1fr;gap:16px}
  @media (max-width:1024px){.container{grid-template-columns:1fr}}

  .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow)}
  .header{padding:14px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:10px}
  .brand{display:flex;align-items:center;gap:10px}
  .logo{width:28px;height:28px;border-radius:8px;background:var(--okta-blue);display:grid;place-items:center;color:#fff;font-weight:900;letter-spacing:.2px;box-shadow:inset 0 -4px 10px rgba(0,0,0,.15)}
  .title{font-weight:800}
  .tag{margin-left:auto;font-size:12px;color:var(--muted)}

  /* Wizard */
  .wizard{padding:16px}
  .big-progress{height:10px;border-radius:999px;background:#eef2f7;overflow:hidden;margin:8px 0 14px}
  .big-progress>div{height:100%;width:0;background:linear-gradient(90deg,var(--okta-blue),#22c55e);transition:width .3s ease}
  .step-chip{display:inline-block;padding:4px 10px;border-radius:999px;background:#eff6ff;border:1px solid #bfdbfe;color:#1d4ed8;font-weight:700;font-size:12px}
  .inst{margin-top:10px;border:1px solid #cfe2ff;background:linear-gradient(135deg,#eef5ff,#e6f3ff);border-radius:12px;padding:12px}
  .inst h3{margin:0 0 6px 0;font-size:16px}
  .inst p{margin:0 0 8px 0;color:#334155}
  .inst ul{margin:6px 0 0 18px;line-height:1.6}
  .wizard-actions{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
  .btn{user-select:none;cursor:pointer;border:none;border-radius:12px;padding:10px 14px;font-weight:800;background:var(--okta-blue);color:#fff;box-shadow:0 6px 18px rgba(22,98,221,.25)}
  .btn:hover{background:var(--okta-blue-dark)}
  .btn.secondary{background:var(--okta-blue-dark);color:#fff;box-shadow:0 6px 18px rgba(14,77,177,.25)}
  .btn.ghost{background:#fff;border:2px solid var(--okta-blue);color:var(--okta-blue);box-shadow:none}
  .btn.success{background:var(--success)}
  .btn.danger{background:var(--danger)}
  .btn:disabled{opacity:.6;cursor:not-allowed}
  .hint{font-size:12px;color:var(--muted)}
  .checklist{margin-top:12px}
  .checklist li{display:flex;align-items:center;gap:8px;margin:8px 0;color:#334155}
  .check{width:18px;height:18px;border:2px solid #94a3b8;border-radius:6px;display:inline-grid;place-items:center;font-size:14px}
  .check.done{border-color:var(--success);color:#fff;background:var(--success)}

  /* Workspace */
  .workspace{display:grid;grid-template-rows:auto 1fr}
  .tabs{display:flex;gap:6px;padding:6px;background:#fff;border-bottom:1px solid var(--border)}
  .tab{padding:10px 14px;border-radius:10px;border:1px solid var(--border);background:#fff;cursor:pointer;font-weight:700}
  .tab.active{background:#eaf2ff;border-color:#c7dbff;color:#0e4db1}
  .pane{padding:16px}

  /* Admin */
  .row{display:grid;grid-template-columns:1fr 1fr 140px;align-items:center;gap:10px;padding:10px;border:1px solid #e5e7eb;border-radius:12px;background:#f8fafc}
  .grid{display:grid;gap:12px}
  .section{background:#fff;border:1px solid var(--border);border-radius:12px;padding:12px}
  .section h4{margin:0 0 8px 0}
  .input{width:100%;padding:12px;border:1px solid #cbd5e1;border-radius:10px}
  .badge{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid #cbd5e1;background:#f1f5f9;color:#0f172a;font-size:12px}

  /* User portal */
  .login-card{width:min(560px,96%);background:#fff;border:1px solid var(--border);border-radius:14px;box-shadow:var(--shadow);padding:20px;margin:0 auto}
  .field{margin:12px 0}
  .label{font-size:12px;color:#475569;margin-bottom:6px}
  input[type="text"],input[type="password"]{width:100%;padding:12px;border:1px solid #cbd5e1;border-radius:10px;font-size:14px}
  input:focus{border-color:var(--okta-blue);box-shadow:0 0 0 4px rgba(22,98,221,.15)}

  .factor-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-top:10px}
  .factor{border:1px solid #dbeafe;background:linear-gradient(180deg,#ffffff,#f0f7ff);border-radius:12px;padding:14px;display:flex;gap:10px;align-items:flex-start;cursor:pointer;transition:transform .05s ease, box-shadow .2s;}
  .factor:hover{box-shadow:0 10px 30px rgba(29,78,216,.15);transform:translateY(-2px)}
  .factor-icon{width:36px;height:36px;border-radius:10px;background:#e0ecff;display:grid;place-items:center;font-weight:900;color:#1d4ed8}

  .qr-wrap{display:grid;grid-template-columns:220px 1fr;gap:20px;align-items:center;margin-top:10px}
  @media (max-width:720px){.qr-wrap{grid-template-columns:1fr}}
  .qr{width:220px;height:220px;border-radius:12px;border:1px dashed #93c5fd;display:grid;place-items:center;background:#f8fbff}

  .status{margin-top:10px;padding:10px 12px;border-radius:12px;font-size:13px;border:1px solid #cbd5e1;background:#f8fafc;color:#0f172a;display:flex;align-items:center;gap:8px}
  .status.success{border-color:#86efac;background:#f0fdf4}
  .status.warn{border-color:#fde68a;background:#fffbeb}
  .status.error{border-color:#fecaca;background:#fef2f2}

  .note{background:#fff7d6;border:1px solid #fde68a;color:#7a5d00;border-radius:10px;padding:10px 12px;font-size:13px;margin-bottom:10px}

  .toast{position:fixed;right:16px;bottom:16px;background:#0b1220;color:#e5e7eb;border:1px solid #1f2937;padding:12px 14px;border-radius:12px;opacity:0;transform:translateY(10px);box-shadow:0 20px 40px rgba(2,6,23,.5);transition:all .25s ease;z-index:1000;max-width:360px}
  .toast.show{opacity:1;transform:translateY(0)}

  /* Modal */
  .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,.55);display:none;align-items:center;justify-content:center;z-index:1100}
  .modal{width:min(720px,96%);background:#fff;border:1px solid var(--border);border-radius:16px;box-shadow:0 30px 80px rgba(2,6,23,.35)}
  .modal .m-head{padding:14px 16px;border-bottom:1px solid var(--border);font-weight:800}
  .modal .m-body{padding:16px}
  .m-row{display:grid;grid-template-columns:28px 1fr 180px;gap:10px;align-items:center;border:1px solid #e5e7eb;border-radius:12px;padding:10px;background:#fafafa}
  .m-foot{display:flex;justify-content:flex-end;gap:8px;padding:12px 16px;border-top:1px solid var(--border)}
  .muted{color:#64748b;font-size:12px}
  .divider{height:1px;background:#e5e7eb;margin:10px 0}
  .pill{display:inline-block;padding:2px 8px;border-radius:999px;background:#eff6ff;border:1px solid #bfdbfe;color:#1d4ed8;font-size:12px}

  /* Floating controls */
  .floating-controls{position:fixed;right:16px;top:16px;display:flex;gap:8px;z-index:1200}
</style>
</head>
<body>
  <!-- Floating Reset / Close (only controls) -->
  <div class="floating-controls" aria-label="Lab controls">
    <button class="btn secondary" id="btnTopReset">Reset Lab</button>
    <button class="btn" id="btnTopClose" title="Close this lab tab">Close Lab</button>
  </div>

  <div class="container">
    <!-- LEFT: Wizard -->
    <aside class="card">
      <div class="header">
        <div class="brand">
          <div class="logo">O</div>
          <div class="title">Okta Verify – Reset & Re-Enroll</div>
        </div>
      </div>

      <div class="wizard">
        <div class="step-chip" id="stepChip">Step 1 of 5</div>
        <div class="big-progress"><div id="bigProgress"></div></div>

        <!-- Step 1 -->
        <div class="inst" id="wStep1">
          <h3>1) Find the user in Okta Admin</h3>
          <p><strong>Your task:</strong> Search for <span class="badge">Amara Patel</span> and open the profile.</p>
          <ul>
            <li>Go to the <strong>Admin</strong> tab (right panel).</li>
            <li>Search <em>apatel</em> or <em>amara</em> → click <strong>Open</strong> on the result.</li>
            <li class="hint"><strong>Hint:</strong> Directory › People search box.</li>
          </ul>
        </div>

        <!-- Step 2 -->
        <div class="inst" id="wStep2" style="display:none">
          <h3>2) Reset the user’s authenticators</h3>
          <p><strong>Your task:</strong> Click <b>Reset Authenticators</b>, select the entries, then <b>Reset Selected Authenticators</b>.</p>
          <ul>
            <li>After success, click <strong>Switch to User Portal</strong>.</li>
            <li class="hint"><strong>Hint:</strong> Tick any <em>Okta Verify</em> items (phone/desktop) before clicking reset.</li>
          </ul>
        </div>

        <!-- Step 3 -->
        <div class="inst" id="wStep3" style="display:none">
          <h3>3) User signs in again (re-enrollment prompt)</h3>
          <p><strong>Use these credentials:</strong></p>
          <ul>
            <li>Username: <span class="badge"><b>amara.patel@blockshell.app</b></span></li>
            <li>Password: <span class="badge"><b>ResetMe!23</b></span></li>
            <li class="hint"><strong>Hint:</strong> Exact casing and punctuation required.</li>
          </ul>
        </div>

        <!-- Step 4 -->
        <div class="inst" id="wStep4" style="display:none">
          <h3>4) Enroll Okta Verify on the new phone</h3>
          <p><strong>Your task:</strong> Choose <b>Okta Verify</b> → <b>Scan QR</b> → <b>Send test push</b> → <b>Approve</b> on phone.</p>
          <ul>
            <li class="hint"><strong>Hint:</strong> Click the <em>Okta Verify</em> tile to see the QR.</li>
          </ul>
        </div>

        <!-- Step 5 -->
        <div class="inst" id="wStep5" style="display:none">
          <h3>5) Confirm access is restored</h3>
          <p>After approval, you’ll see a success message.</p>
          <div class="wizard-actions">
            <button class="btn success" id="btnReview">Review Steps</button>
          </div>
        </div>

        <ul class="checklist" id="checklist">
          <li><span class="check" id="c1"></span> 1) User located</li>
          <li><span class="check" id="c2"></span> 2) Authenticators reset</li>
          <li><span class="check" id="c3"></span> 3) User re-signed & MFA prompted</li>
          <li><span class="check" id="c4"></span> 4) New device enrolled & push approved</li>
          <li><span class="check" id="c5"></span> 5) Access confirmed</li>
        </ul>
      </div>
    </aside>

    <!-- RIGHT: Workspace -->
    <main class="card workspace">
      <div class="tabs">
        <button class="tab active" id="tabAdmin">Admin</button>
        <button class="tab" id="tabUser" disabled>User (after reset)</button>
      </div>

      <!-- ADMIN -->
      <section class="pane" id="panelAdmin">
        <div class="grid">
          <div class="section">
            <h4>Directory › People</h4>
            <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
              <input id="searchInput" class="input" type="text" placeholder="Search users (try: apatel or amara)"/>
              <button class="btn" id="btnSearch">Search</button>
            </div>
            <div id="resultsArea" style="margin-top:10px" class="grid">
              <div class="hint">Enter a query to find the user.</div>
            </div>
          </div>

          <div class="section" id="userSection" style="display:none">
            <h4>User Profile</h4>
            <div class="row">
              <div><strong id="userName">—</strong> <span class="hint" id="userEmail"></span></div>
              <div>Groups: Employees, Sales</div>
              <div style="text-align:right"><span class="badge" id="userStatus">Active</span></div>
            </div>

            <div class="section" style="margin-top:12px">
              <h4>Authenticators</h4>
              <div class="row" style="grid-template-columns:1.3fr 1fr auto">
                <div><span class="badge">Okta Verify</span> • <span id="ovState">Active</span> <span class="hint" id="ovHint">• Device: Pixel 7</span></div>
                <div class="hint">Last used: 3 days ago</div>
                <div style="text-align:right">
                  <button class="btn danger" id="btnOpenResetDialog">Reset Authenticators</button>
                </div>
              </div>
              <div class="status" id="adminStatus" style="margin-top:10px"><strong>Status:</strong> Waiting to reset…</div>
            </div>

            <div style="display:flex;gap:8px;align-items:center;margin-top:10px">
              <button class="btn secondary" id="btnSwitchToUser" disabled>Switch to User Portal</button>
              <span class="hint">Enabled after reset.</span>
            </div>
          </div>
        </div>
      </section>

      <!-- USER -->
      <section class="pane" id="panelUser" style="display:none">
        <div id="screen-login" class="login-card">
          <h2>Sign in</h2>
          <div class="note">Use these credentials: <b>amara.patel@blockshell.app</b> / <b>ResetMe!23</b></div>
          <div class="field">
            <div class="label">Username</div>
            <input id="username" type="text" placeholder="amara.patel@blockshell.app"/>
          </div>
          <div class="field">
            <div class="label">Password</div>
            <input id="password" type="password" placeholder="ResetMe!23"/>
          </div>
          <div style="display:flex;gap:8px;align-items:center;margin-top:12px">
            <button class="btn" id="btnLogin">Sign in</button>
            <span class="hint">You’ll be prompted to set up MFA again.</span>
          </div>
        </div>

        <div id="screen-factor" class="login-card" style="display:none;margin-top:12px">
          <h2>Set up Multi-Factor Authentication</h2>
          <p class="hint">Choose a verification method. Your org recommends <b>Okta Verify</b>.</p>
          <div class="factor-grid">
            <article class="factor" id="factorOkta">
              <div class="factor-icon">OV</div>
              <div>
                <h3>Okta Verify</h3>
                <p>One-tap approvals via push notifications.</p>
              </div>
            </article>
            <article class="factor" aria-disabled="true" style="opacity:.55;pointer-events:none">
              <div class="factor-icon">SMS</div>
              <div><h3>SMS (Disabled)</h3><p>Disabled by policy.</p></div>
            </article>
          </div>
        </div>

        <div id="screen-qr" class="login-card" style="display:none;margin-top:12px">
          <h2>Enroll with Okta Verify</h2>
          <p class="hint">Open Okta Verify on your phone → Add Account → Scan QR.</p>
          <div class="qr-wrap">
            <div class="qr" aria-label="QR code placeholder">
              <svg width="180" height="180" viewBox="0 0 180 180" role="img" aria-label="Simulated QR">
                <rect x="0" y="0" width="180" height="180" fill="#ffffff" stroke="#93c5fd" />
                <rect x="12" y="12" width="48" height="48" fill="#111827"/>
                <rect x="120" y="12" width="48" height="48" fill="#111827"/>
                <rect x="12" y="120" width="48" height="48" fill="#111827"/>
                <rect x="72" y="72" width="36" height="36" fill="#111827"/>
                <rect x="60" y="12" width="24" height="24" fill="#111827"/>
                <rect x="12" y="84" width="24" height="24" fill="#111827"/>
                <rect x="144" y="84" width="24" height="24" fill="#111827"/>
                <rect x="84" y="144" width="24" height="24" fill="#111827"/>
              </svg>
            </div>
            <div>
              <div class="status" id="qrStatus"><strong>Status:</strong> Waiting for phone to scan…</div>
              <div style="margin-top:10px;border:1px solid var(--border);border-radius:14px;padding:12px;background:#0b1220;color:#e5e7eb">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                  <strong>Okta Verify (Phone)</strong><span>12:42</span>
                </div>
                <div style="font-size:13px;color:#cbd5e1">Use your camera to scan the QR code on your computer.</div>
                <div style="display:flex;gap:8px;margin-top:10px">
                  <button class="btn" id="btnScan">Scan QR</button>
                  <button class="btn ghost" id="btnCantScan">Can't scan?</button>
                </div>
                <div class="hint" style="color:#a1a1aa;margin-top:8px">Simulation: Clicking <b>Scan QR</b> enrolls the device.</div>
              </div>
            </div>
          </div>
          <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
            <button class="btn" id="btnSendPush" disabled>Send test push</button>
          </div>
        </div>

        <div id="screen-push" class="login-card" style="display:none;margin-top:12px">
          <h2>Approve sign-in</h2>
          <p class="hint">We’ve sent a test push to your phone. Approve it to finish enrollment.</p>
          <div class="status warn" id="pushStatus"><strong>Waiting:</strong> Approval required on phone…</div>
          <div style="margin-top:10px;border:1px solid var(--border);border-radius:14px;padding:12px;background:#0b1220;color:#e5e7eb">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
              <strong>Okta Verify (Phone)</strong><span>12:44</span>
            </div>
            <div style="display:flex;justify-content:space-between;gap:12px">
              <div>
                <div style="font-size:13px;color:#cbd5e1;margin-bottom:6px">App</div>
                <div>Okta • <span class="badge">blockshell.app</span></div>
              </div>
              <div>
                <div style="font-size:13px;color:#cbd5e1;margin-bottom:6px">Code</div>
                <div class="badge">492 771</div>
              </div>
            </div>
            <div style="display:flex;gap:10px;margin-top:12px">
              <button class="btn success" id="btnApprove">Approve</button>
              <button class="btn ghost" id="btnDeny">Deny</button>
            </div>
            <div class="hint" style="color:#a1a1aa;margin-top:8px">Simulation: Press <b>Approve</b> to continue.</div>
          </div>
        </div>

        <div id="screen-done" class="login-card" style="display:none;margin-top:12px">
          <h2>Re-enrollment complete ✅</h2>
          <div class="status success"><strong>Success:</strong> Okta Verify is now linked to the new phone. Access is restored.</div>
        </div>
      </section>
    </main>
  </div>

  <!-- Reset Authenticators Modal -->
  <div class="modal-backdrop" id="resetModalBackdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-labelledby="modalTitle">
      <div class="m-head" id="modalTitle">Reset Authenticators</div>
      <div class="m-body">
        <div class="muted" style="margin-bottom:8px">Select authenticator(s) to reset. This will require the user to re-enroll.</div>

        <div class="m-row">
          <input type="checkbox" class="m-cb" data-name="Okta Verify — Amara-Pixel7"/>
          <div>
            <div><strong>Okta Verify</strong> <span class="pill">Amara-Pixel7</span></div>
            <div class="muted">Last used 2 minutes ago • Enrolled 8 days ago</div>
          </div>
          <div class="muted" style="text-align:right">Type: Phone</div>
        </div>

        <div class="m-row" style="margin-top:8px">
          <input type="checkbox" class="m-cb" data-name="Okta Verify — WIN-KD83X2L"/>
          <div>
            <div><strong>Okta Verify</strong> <span class="pill">WIN-KD83X2L</span></div>
            <div class="muted">Last used 2 minutes ago • Enrolled 8 days ago</div>
          </div>
          <div class="muted" style="text-align:right">Type: Desktop</div>
        </div>

        <div class="m-row" style="margin-top:8px">
          <input type="checkbox" class="m-cb" data-name="Okta Verify — Amara-iPad"/>
          <div>
            <div><strong>Okta Verify</strong> <span class="pill">Amara-iPad</span></div>
            <div class="muted">Last used 4 days ago • Enrolled 6 days ago</div>
          </div>
          <div class="muted" style="text-align:right">Type: Tablet</div>
        </div>

        <div class="m-row" style="margin-top:8px">
          <input type="checkbox" class="m-cb" data-name="Okta Verify — WIN-C134W94"/>
          <div>
            <div><strong>Okta Verify</strong> <span class="pill">WIN-C134W94</span></div>
            <div class="muted">Last used 4 days ago • Enrolled 6 days ago</div>
          </div>
          <div class="muted" style="text-align:right">Type: Desktop</div>
        </div>

        <div class="divider"></div>
        <label class="muted" style="display:flex;align-items:center;gap:8px">
          <input type="checkbox" id="cbSelectAll"/> Select all
        </label>
      </div>
      <div class="m-foot">
        <button class="btn ghost" id="btnModalCancel">Cancel</button>
        <button class="btn danger" id="btnModalReset" disabled>Reset Selected Authenticators</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

<script>
(function(){
  const $ = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));
  const bigProgress = $('#bigProgress');
  const stepChip = $('#stepChip');
  const steps = [$('#wStep1'),$('#wStep2'),$('#wStep3'),$('#wStep4'),$('#wStep5')];
  const checks = [$('#c1'),$('#c2'),$('#c3'),$('#c4'),$('#c5')];
  const toast = $('#toast');

  // Tabs
  const tabAdmin = $('#tabAdmin'), tabUser = $('#tabUser');
  const panelAdmin = $('#panelAdmin'), panelUser = $('#panelUser');

  // Admin
  const searchInput = $('#searchInput');
  const resultsArea = $('#resultsArea');
  const userSection = $('#userSection');
  const userName = $('#userName');
  const userEmail = $('#userEmail');
  const userStatus = $('#userStatus');
  const ovState = $('#ovState');
  const ovHint = $('#ovHint');
  const adminStatus = $('#adminStatus');
  const btnOpenResetDialog = $('#btnOpenResetDialog');
  const btnSwitchToUser = $('#btnSwitchToUser');

  // Modal
  const resetModalBackdrop = $('#resetModalBackdrop');
  const btnModalCancel = $('#btnModalCancel');
  const btnModalReset = $('#btnModalReset');
  const cbSelectAll = $('#cbSelectAll');

  // User
  const screenLogin = $('#screen-login');
  const screenFactor = $('#screen-factor');
  const screenQR = $('#screen-qr');
  const screenPush = $('#screen-push');
  const screenDone = $('#screen-done');
  const username = $('#username');
  const password = $('#password');
  const btnLogin = $('#btnLogin');
  const btnSendPush = $('#btnSendPush');
  const btnScan = $('#btnScan');
  const btnCantScan = $('#btnCantScan');
  const qrStatus = $('#qrStatus');
  const pushStatus = $('#pushStatus');
  const btnApprove = $('#btnApprove');
  const btnDeny = $('#btnDeny');

  // Top controls
  $('#btnTopReset').onclick = resetAll;
  $('#btnTopClose').onclick = tryCloseWindow;

  // Step 5 single action
  $('#btnReview').onclick = ()=> notify('Review each step in the left panel.');

  // Tabs switching
  tabAdmin.onclick = ()=> setTab('admin');
  tabUser.onclick = ()=> { if(!tabUser.disabled) setTab('user'); };

  // Search
  $('#btnSearch').onclick = ()=>{
    const q = (searchInput.value||'').trim().toLowerCase();
    if(!q){ notify('Type a query, e.g., apatel'); return; }
    const match = (q.includes('apatel') || q.includes('amara'));
    if(match){
      resultsArea.innerHTML = `
        <div class="row">
          <div><strong>Amara Patel</strong> <span class="hint">amara.patel@blockshell.app</span></div>
          <div>Groups: Employees, Sales</div>
          <div style="text-align:right"><button class="btn ghost" id="btnOpen">Open</button></div>
        </div>`;
      notify('User found. Click Open to view profile.');
    } else {
      resultsArea.innerHTML = `<div class="status error"><strong>No results:</strong> Try "apatel".</div>`;
    }
  };

  // Open user profile
  document.addEventListener('click',(e)=>{
    if(e.target && e.target.id==='btnOpen'){
      userSection.style.display='block';
      userName.textContent='Amara Patel';
      userEmail.textContent='(amara.patel@blockshell.app)';
      userStatus.textContent='Active';
      notify('Profile opened. Reset authenticators.');
      complete(1);
      goStep(2);
    }
  });

  // Open reset modal
  btnOpenResetDialog.onclick = ()=>{
    resetModalBackdrop.style.display='flex';
    updateModalButton();
  };
  btnModalCancel.onclick = ()=>{ resetModalBackdrop.style.display='none'; };
  cbSelectAll.onchange = ()=>{
    $$('.m-cb').forEach(cb=> cb.checked = cbSelectAll.checked);
    updateModalButton();
  };
  $$('.m-cb').forEach(cb=> cb.onchange = updateModalButton);

  function updateModalButton(){
    const any = $$('.m-cb').some(cb=>cb.checked);
    btnModalReset.disabled = !any;
  }

  // Confirm reset
  btnModalReset.onclick = ()=>{
    const selected = $$('.m-cb').filter(cb=>cb.checked).map(cb=>cb.dataset.name);
    if(!selected.length) return;
    resetModalBackdrop.style.display='none';
    ovState.textContent='Removed';
    ovHint.textContent='Okta Verify factors reset. User must re-enroll at next sign-in.';
    adminStatus.innerHTML='<strong>Status:</strong> Authenticators reset. Ask user to sign in again.';
    btnSwitchToUser.disabled = false;
    tabUser.disabled = false;
    notify('Selected authenticators reset: ' + selected.join(', '));
    complete(2);
  };

  // Switch to user tab
  btnSwitchToUser.onclick = ()=> setTab('user');

  // Login check
  btnLogin.onclick = ()=>{
    const u = (username.value||'').trim().toLowerCase();
    const p = (password.value||'').trim();
    if(u==='amara.patel@blockshell.app' && p==='ResetMe!23'){
      show(screenFactor); hide(screenLogin, screenQR, screenPush, screenDone);
      notify('Signed in. MFA setup required.');
      complete(3);
      goStep(4);
    } else {
      notify('Invalid credentials — use the visible values above (copy/paste).');
    }
  };

  // Choose Okta Verify
  $('#factorOkta').onclick = ()=>{
    show(screenQR); hide(screenLogin, screenFactor, screenPush, screenDone);
    notify('Okta Verify selected. Scan the QR from the phone panel.');
  };

  // QR flow
  btnScan.onclick = ()=>{
    qrStatus.className='status success';
    qrStatus.innerHTML='<strong>Enrolled:</strong> Device registered with this account.';
    btnSendPush.disabled = false;
    notify('QR scanned — device enrolled. Send test push.');
  };
  btnCantScan.onclick = ()=>{
    qrStatus.className='status';
    qrStatus.innerHTML='<strong>Status:</strong> Try again or use manual code entry.';
    notify('Alternative enrollment methods available.');
  };

  // Send push
  btnSendPush.onclick = ()=>{
    show(screenPush); hide(screenLogin, screenFactor, screenQR, screenDone);
    notify('Test push sent… waiting for phone approval.');
  };

  // Approve/Deny
  btnApprove.onclick = ()=>{
    pushStatus.className='status success';
    pushStatus.innerHTML='<strong>Approved:</strong> Signed in on this device.';
    setTimeout(()=>{
      show(screenDone); hide(screenLogin, screenFactor, screenQR, screenPush);
      complete(4);
      complete(5);
      goStep(5);
      notify('Re-enrollment complete.');
    }, 500);
  };
  btnDeny.onclick = ()=>{
    pushStatus.className='status error';
    pushStatus.innerHTML='<strong>Denied:</strong> Request rejected. Try resending.';
    notify('Request denied on phone.');
  };

  // Keyboard reset
  document.addEventListener('keydown',(e)=>{
    if(e.key==='r' && (e.ctrlKey || e.metaKey)){ e.preventDefault(); resetAll(); notify('Lab reset.'); }
  });

  // Helpers
  function setTab(which){
    if(which==='admin'){
      tabAdmin.classList.add('active'); tabUser.classList.remove('active');
      panelAdmin.style.display='block'; panelUser.style.display='none';
    } else {
      tabUser.classList.add('active'); tabAdmin.classList.remove('active');
      panelUser.style.display='block'; panelAdmin.style.display='none';
    }
  }
  function show(...els){ els.forEach(e=> e && (e.style.display='block')); }
  function hide(...els){ els.forEach(e=> e && (e.style.display='none')); }
  function notify(msg){
    toast.textContent = msg;
    toast.classList.add('show');
    setTimeout(()=>toast.classList.remove('show'), 2000);
  }
  function goStep(n){
    steps.forEach((s,i)=> s.style.display = (i===n-1));
    const pct = [0,20,40,65,85,100][n] || 0;
    bigProgress.style.width = pct+'%';
    stepChip.textContent = `Step ${Math.min(n,5)} of 5`;
  }
  function complete(i){
    const idx = i-1;
    if(checks[idx]){
      checks[idx].classList.add('done');
      checks[idx].innerHTML='&#10003;';
    }
  }

  function resetAll(){
    steps.forEach((s,i)=> s.style.display = (i===0));
    bigProgress.style.width='0%';
    stepChip.textContent='Step 1 of 5';
    checks.forEach(ch=>{ ch.classList.remove('done'); ch.innerHTML=''; });

    // Close modal & clear selections
    resetModalBackdrop.style.display='none';
    cbSelectAll.checked=false;
    $$('.m-cb').forEach(cb=> cb.checked=false);

    // Tabs
    setTab('admin');
    tabUser.disabled = true;

    // Admin defaults
    resultsArea.innerHTML='<div class="hint">Enter a query to find the user.</div>';
    searchInput.value='';
    userSection.style.display='none';
    userName.textContent='—';
    userEmail.textContent='';
    userStatus.textContent='Active';
    ovState.textContent='Active';
    ovHint.textContent='• Device: Pixel 7';
    adminStatus.innerHTML='<strong>Status:</strong> Waiting to reset…';
    btnSwitchToUser.disabled = true;

    // User defaults
    username.value=''; password.value='';
    show(screenLogin); hide(screenFactor, screenQR, screenPush, screenDone);
    qrStatus.className='status'; qrStatus.innerHTML='<strong>Status:</strong> Waiting for phone to scan…';
    btnSendPush.disabled = true;
    pushStatus.className='status warn'; pushStatus.innerHTML='<strong>Waiting:</strong> Approval required on phone…';
  }

  function tryCloseWindow(){
    window.open('','_self'); window.close();
    setTimeout(()=>{
      if(!document.hidden){
        document.body.innerHTML = '<div style="display:grid;place-items:center;height:100vh;font-family:ui-sans-serif"><div class="login-card"><h2>Lab closed</h2><p class="hint">Your browser blocked auto-close. Please close this tab manually.</p><button class="btn" onclick="history.back()">Go Back</button></div></div>';
      }
    },150);
  }

  resetAll();
})();
</script>
</body>
</html>
