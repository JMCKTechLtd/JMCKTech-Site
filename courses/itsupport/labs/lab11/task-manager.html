<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Windows 11 Lab: End Unresponsive Application</title>
<style>
/* ========== WINDOWS 11 23H2 REALISTIC THEME ========== */
:root {
  --win-accent: #0078D4;
  --win-accent-hover: #106EBE;
  --win-danger: #D13438;
  --win-danger-hover: #C42B1C;
  --win-bg: rgba(255, 255, 255, 0.85);
  --win-bg-solid: #FFFFFF;
  --win-border: rgba(255, 255, 255, 0.4);
  --win-shadow: rgba(0, 0, 0, 0.3);
  --win-text: #000000;
  --win-text-secondary: #616161;
  --win-taskbar: rgba(30, 30, 30, 0.92);
  --win-taskbar-border: rgba(255, 255, 255, 0.08);
  --win-start-menu: rgba(42, 42, 48, 0.98);
  --win-context-menu: rgba(36, 36, 40, 0.98);
  --win-hover: rgba(0, 0, 0, 0.04);
  --win-selected: rgba(0, 120, 212, 0.1);
}

/* Reset & Base */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  -webkit-tap-highlight-color: transparent;
  -webkit-user-select: none;
  user-select: none;
  font-synthesis: none;
}

html, body {
  height: 100%;
  overflow: hidden;
  font-family: "Segoe UI Variable Display", "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 13.5px;
  font-weight: 400;
  line-height: 1.4;
}

body {
  background: 
    radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.2) 0%, transparent 50%),
    linear-gradient(135deg, #1A1F35 0%, #2A2F45 100%);
  color: var(--win-text);
  position: relative;
  overflow: hidden;
}

/* Desktop Icons - Windows 11 style */
#desktop {
  position: absolute;
  inset: 0 0 48px 0;
  padding: 20px;
  overflow: hidden;
  pointer-events: none;
}

.desktop-icon {
  position: absolute;
  width: 84px;
  height: 84px;
  color: #FFFFFF;
  text-align: center;
  cursor: pointer;
  user-select: none;
  text-shadow: 0 2px 8px rgba(0, 0, 0, 0.8);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 4px;
  border-radius: 6px;
  padding: 8px 4px;
  pointer-events: auto;
  transition: background-color 0.2s;
}

.desktop-icon:hover {
  background-color: rgba(255, 255, 255, 0.1);
}

.desktop-icon:active {
  background-color: rgba(255, 255, 255, 0.15);
}

.desktop-icon .icon {
  font-size: 40px;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 4px;
}

.desktop-icon .label {
  font-size: 11.5px;
  font-weight: 400;
  padding: 2px 6px;
  border-radius: 4px;
  max-width: 100%;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  background: rgba(0, 0, 0, 0.3);
  backdrop-filter: blur(4px);
}

/* Taskbar - Windows 11 Centered */
.taskbar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 48px;
  background: var(--win-taskbar);
  backdrop-filter: saturate(180%) blur(32px);
  border-top: 1px solid var(--win-taskbar-border);
  display: flex;
  align-items: center;
  z-index: 10000;
  padding: 0 12px;
}

.taskbar-center {
  flex: 1;
  display: flex;
  justify-content: center;
  gap: 6px;
  align-items: center;
  margin: 0 auto;
  max-width: 500px;
}

.start-button {
  width: 44px;
  height: 44px;
  border-radius: 8px;
  background: rgba(255, 255, 255, 0.08);
  display: grid;
  place-items: center;
  cursor: pointer;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  border: none;
  outline: none;
}

.start-button:hover {
  background: rgba(255, 255, 255, 0.16);
}

.start-button:active {
  transform: scale(0.92);
  background: rgba(255, 255, 255, 0.22);
}

.start-button svg {
  width: 24px;
  height: 24px;
  fill: #FFFFFF;
}

.taskbar-icon {
  width: 44px;
  height: 44px;
  border-radius: 8px;
  background: rgba(255, 255, 255, 0.06);
  display: grid;
  place-items: center;
  cursor: pointer;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  font-size: 18px;
  color: #FFFFFF;
  position: relative;
}

.taskbar-icon:hover {
  background: rgba(255, 255, 255, 0.14);
  transform: translateY(-1px);
}

.taskbar-icon.active {
  background: rgba(255, 255, 255, 0.2);
}

/* System Tray */
.system-tray {
  position: absolute;
  right: 12px;
  display: flex;
  align-items: center;
  height: 100%;
  gap: 6px;
}

.tray-group {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 0 10px;
  height: 32px;
  background: rgba(255, 255, 255, 0.08);
  border-radius: 6px;
  border: 1px solid rgba(255, 255, 255, 0.15);
  cursor: pointer;
  transition: all 0.2s;
}

.tray-group:hover {
  background: rgba(255, 255, 255, 0.14);
}

.tray-time {
  display: flex;
  flex-direction: column;
  align-items: center;
  line-height: 1.2;
  color: #FFFFFF;
  font-size: 11px;
  font-weight: 400;
  min-width: 60px;
}

.tray-time #currentTime {
  font-size: 11px;
  font-weight: 500;
}

.tray-time #currentDate {
  font-size: 10px;
  opacity: 0.9;
}

/* Windows - Realistic Mica/Acrylic */
.window, .unresponsive-window {
  position: absolute;
  background: var(--win-bg);
  backdrop-filter: blur(32px) saturate(180%);
  border-radius: 10px;
  box-shadow: 
    0 0 0 1px var(--win-border),
    0 8px 40px var(--win-shadow);
  overflow: hidden;
  display: flex;
  flex-direction: column;
  z-index: 100;
}

.window-header {
  height: 40px;
  background: transparent;
  display: flex;
  align-items: center;
  padding: 0 12px;
  user-select: none;
  cursor: move;
  border-bottom: 1px solid rgba(0, 0, 0, 0.08);
}

.window-title {
  font-weight: 500;
  font-size: 13px;
  flex: 1;
  margin-left: 8px;
  color: var(--win-text);
  display: flex;
  align-items: center;
  gap: 8px;
}

.window-title .app-icon {
  font-size: 16px;
}

.window-controls {
  display: flex;
  gap: 8px;
}

.window-control {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 8px;
  color: rgba(0, 0, 0, 0.7);
  font-weight: 600;
}

.window-control.minimize { background: #FFBD44; }
.window-control.maximize { background: #00CA4E; }
.window-control.close { background: #FF605C; }

.window-control:hover {
  transform: scale(1.15);
}

.window-control.close:hover {
  background: #FF5F57;
  color: #000;
}

.window-body {
  flex: 1;
  overflow: auto;
  background: transparent;
  padding: 16px;
}

/* Unresponsive Window Specific */
.unresponsive-window {
  animation: subtleShake 4s infinite ease-in-out;
}

.unresponsive-window .window-header {
  background: #FFEBEE;
}

.unresponsive-overlay {
  position: absolute;
  inset: 0;
  background: rgba(255, 255, 255, 0.85);
  backdrop-filter: blur(2px);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  color: var(--win-danger);
  font-weight: 600;
  font-size: 13px;
  pointer-events: none;
  z-index: 10;
}

.unresponsive-overlay::before {
  content: "‚è≥";
  font-size: 32px;
  margin-bottom: 12px;
  opacity: 0.8;
}

@keyframes subtleShake {
  0%, 100% { transform: translateX(0) translateY(0); }
  25% { transform: translateX(-0.5px) translateY(0.5px); }
  50% { transform: translateX(0.5px) translateY(-0.5px); }
  75% { transform: translateX(-0.3px) translateY(-0.3px); }
}

/* Start Menu */
.start-menu {
  position: absolute;
  bottom: 56px;
  left: 50%;
  transform: translateX(-50%);
  width: 640px;
  height: 540px;
  background: var(--win-start-menu);
  backdrop-filter: blur(40px) saturate(180%);
  border-radius: 10px;
  box-shadow: 
    0 0 0 1px rgba(255, 255, 255, 0.1),
    0 32px 64px rgba(0, 0, 0, 0.5);
  display: none;
  overflow: hidden;
  z-index: 9999;
}

.start-menu-header {
  height: 52px;
  background: rgba(255, 255, 255, 0.05);
  padding: 0 20px;
  display: flex;
  align-items: center;
  font-weight: 500;
  font-size: 14px;
  color: #FFFFFF;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.start-menu-body {
  display: grid;
  grid-template-columns: 1fr 280px;
  height: calc(100% - 52px);
}

.start-menu-left {
  padding: 20px;
  overflow-y: auto;
}

.pinned-apps {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 12px;
  margin-top: 16px;
}

.pinned-tile {
  width: 72px;
  height: 72px;
  background: rgba(255, 255, 255, 0.08);
  border-radius: 8px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  color: #FFFFFF;
  font-size: 11px;
  transition: all 0.2s;
  cursor: pointer;
  border: 1px solid transparent;
}

.pinned-tile:hover {
  background: rgba(255, 255, 255, 0.16);
  border-color: rgba(255, 255, 255, 0.2);
  transform: translateY(-2px);
}

.pinned-tile:active {
  transform: translateY(0);
}

/* Context Menu (Win+X style) */
.context-menu {
  position: absolute;
  background: var(--win-context-menu);
  backdrop-filter: blur(32px);
  border-radius: 8px;
  box-shadow: 
    0 0 0 1px rgba(255, 255, 255, 0.1),
    0 16px 32px rgba(0, 0, 0, 0.4);
  display: none;
  overflow: hidden;
  z-index: 10001;
  min-width: 220px;
  border: 1px solid rgba(255, 255, 255, 0.12);
}

.context-menu-item {
  padding: 10px 16px;
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 13px;
  color: #FFFFFF;
  cursor: pointer;
  transition: background-color 0.15s;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.context-menu-item:last-child {
  border-bottom: none;
}

.context-menu-item:hover {
  background: rgba(255, 255, 255, 0.1);
}

.context-menu-item .icon {
  font-size: 16px;
  width: 20px;
  text-align: center;
}

/* Task Manager Styles */
.task-manager-tabs {
  display: flex;
  background: #F8F8F8;
  border-bottom: 1px solid #E5E5E5;
  height: 40px;
  padding: 0 8px;
}

.task-manager-tab {
  padding: 0 16px;
  display: flex;
  align-items: center;
  cursor: pointer;
  font-size: 13px;
  color: #616161;
  border-bottom: 2px solid transparent;
  transition: all 0.2s;
}

.task-manager-tab:hover {
  color: var(--win-text);
  background: rgba(0, 0, 0, 0.04);
}

.task-manager-tab.active {
  color: var(--win-accent);
  border-bottom-color: var(--win-accent);
  font-weight: 500;
}

.process-list {
  width: 100%;
  border-collapse: collapse;
  font-size: 12.5px;
}

.process-list thead {
  position: sticky;
  top: 0;
  background: #F8F8F8;
  z-index: 1;
}

.process-list th {
  padding: 12px 16px;
  text-align: left;
  font-weight: 500;
  color: var(--win-text);
  border-bottom: 1px solid #E5E5E5;
  background: #F8F8F8;
}

.process-list tbody tr {
  border-bottom: 1px solid #F0F0F0;
  transition: background-color 0.15s;
}

.process-list tbody tr:hover {
  background: var(--win-hover);
}

.process-list tbody tr.selected {
  background: var(--win-selected);
  color: var(--win-accent);
}

.process-list tbody tr.unresponsive {
  background: rgba(255, 76, 76, 0.05);
  color: var(--win-danger);
  font-weight: 500;
}

.process-list tbody tr.unresponsive:hover {
  background: rgba(255, 76, 76, 0.08);
}

.process-list td {
  padding: 10px 16px;
}

.end-task-btn {
  background: var(--win-danger);
  color: white;
  border: none;
  padding: 10px 24px;
  border-radius: 6px;
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  margin: 16px;
}

.end-task-btn:hover:not(:disabled) {
  background: var(--win-danger-hover);
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(212, 52, 56, 0.3);
}

.end-task-btn:disabled {
  background: #E0E0E0;
  color: #9E9E9E;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

.end-task-btn .icon {
  font-size: 14px;
}

/* Toast Notifications */
#toast {
  position: fixed;
  bottom: 100px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(30, 30, 30, 0.95);
  backdrop-filter: blur(20px);
  color: #FFFFFF;
  padding: 14px 28px;
  border-radius: 8px;
  font-size: 13px;
  font-weight: 500;
  display: none;
  z-index: 100000;
  box-shadow: 
    0 0 0 1px rgba(255, 255, 255, 0.1),
    0 12px 32px rgba(0, 0, 0, 0.4);
  animation: toastSlideUp 0.3s ease-out;
  max-width: 400px;
  text-align: center;
}

@keyframes toastSlideUp {
  from {
    opacity: 0;
    transform: translateX(-50%) translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
}

/* Loading Spinner */
.task-manager-loading {
  position: absolute;
  inset: 0;
  background: rgba(255, 255, 255, 0.9);
  backdrop-filter: blur(4px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10;
}

.loading-spinner {
  width: 48px;
  height: 48px;
  border: 4px solid #F0F0F0;
  border-top: 4px solid var(--win-accent);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Process Termination Animation */
.process-terminating {
  animation: processTerminate 0.6s ease-out forwards;
}

@keyframes processTerminate {
  0% {
    opacity: 1;
    transform: translateX(0);
    background: rgba(255, 76, 76, 0.1);
  }
  100% {
    opacity: 0;
    transform: translateX(-100px);
    height: 0;
    padding: 0;
    border: none;
  }
}

/* Calendar Popover */
.tray-popover {
  position: absolute;
  bottom: 56px;
  right: 12px;
  width: 320px;
  background: var(--win-start-menu);
  backdrop-filter: blur(40px);
  border-radius: 10px;
  box-shadow: 
    0 0 0 1px rgba(255, 255, 255, 0.1),
    0 24px 48px rgba(0, 0, 0, 0.4);
  display: none;
  z-index: 9999;
  overflow: hidden;
}

.pop-header {
  padding: 16px;
  background: rgba(255, 255, 255, 0.05);
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  font-size: 13px;
  font-weight: 500;
  color: #FFFFFF;
}

.pop-body {
  padding: 16px;
}

.big-clock {
  font-size: 42px;
  font-weight: 300;
  color: #FFFFFF;
  margin-bottom: 8px;
  font-variant-numeric: tabular-nums;
}

.small-date {
  font-size: 13px;
  color: rgba(255, 255, 255, 0.8);
  margin-bottom: 20px;
}

.calendar {
  color: #FFFFFF;
}

.cal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.month {
  font-weight: 500;
  font-size: 13px;
}

.prev-month, .next-month {
  width: 28px;
  height: 28px;
  border-radius: 4px;
  display: grid;
  place-items: center;
  cursor: pointer;
  transition: background-color 0.2s;
}

.prev-month:hover, .next-month:hover {
  background: rgba(255, 255, 255, 0.1);
}

.cal-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 4px;
}

.dow {
  text-align: center;
  padding: 8px 0;
  font-size: 11px;
  color: rgba(255, 255, 255, 0.6);
}

.day {
  text-align: center;
  padding: 8px 0;
  border-radius: 4px;
  cursor: default;
  font-size: 12px;
  transition: background-color 0.2s;
}

.day:hover:not(.other):not(.today) {
  background: rgba(255, 255, 255, 0.1);
}

.day.today {
  background: var(--win-accent);
  color: #FFFFFF;
  font-weight: 500;
}

.day.other {
  color: rgba(255, 255, 255, 0.3);
}

/* Buttons */
button {
  background: rgba(0, 120, 212, 0.1);
  border: 1px solid rgba(0, 120, 212, 0.3);
  color: var(--win-accent);
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

button:hover {
  background: rgba(0, 120, 212, 0.15);
  border-color: rgba(0, 120, 212, 0.4);
  transform: translateY(-1px);
}

button:active {
  transform: translateY(0);
}

button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

/* Scrollbars */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: rgba(0, 0, 0, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(0, 0, 0, 0.3);
}

/* Utility Classes */
.hidden {
  display: none !important;
}

/* Focus styles */
:focus-visible {
  outline: 2px solid var(--win-accent);
  outline-offset: 2px;
}

/* Responsive adjustments */
@media (max-width: 1024px) {
  .start-menu {
    width: 90vw;
    left: 50%;
    transform: translateX(-50%);
  }
  
  .window {
    max-width: 90vw;
  }
}
</style>
</head>
<body>

<!-- Desktop Icons -->
<div id="desktop">
  <div class="desktop-icon" style="left: 40px; top: 40px;" data-icon="this-pc">
    <div class="icon">üíª</div>
    <div class="label">This PC</div>
  </div>
  <div class="desktop-icon" style="left: 40px; top: 160px;" data-icon="recycle">
    <div class="icon">üóëÔ∏è</div>
    <div class="label">Recycle Bin</div>
  </div>
  <div class="desktop-icon" style="left: 40px; top: 280px;" data-icon="documents">
    <div class="icon">üìÅ</div>
    <div class="label">Documents</div>
  </div>
  <div class="desktop-icon" style="left: 40px; top: 400px;" data-icon="network">
    <div class="icon">üåê</div>
    <div class="label">Network</div>
  </div>
</div>

<!-- Unresponsive Photos App Window -->
<div class="unresponsive-window" id="photoViewerWindow" style="left: 450px; top: 120px; width: 500px; height: 380px;">
  <div class="window-header">
    <div class="window-title">
      <span class="app-icon">üñºÔ∏è</span>
      Photos ‚Äì beach_vacation.jpg
    </div>
    <div class="window-controls">
      <div class="window-control minimize">‚àí</div>
      <div class="window-control maximize">‚¨ú</div>
      <div class="window-control close">‚úï</div>
    </div>
  </div>
  <div class="window-body" style="display: flex; align-items: center; justify-content: center; background: #F5F5F5;">
    <div style="text-align: center; color: #666;">
      <div style="font-size: 72px; margin-bottom: 16px;">üñºÔ∏è</div>
      <div style="font-size: 16px; margin-bottom: 8px;">Loading image...</div>
      <div style="font-size: 12px; color: #999;">5.2 MB ‚Ä¢ 3840√ó2160 ‚Ä¢ JPEG</div>
    </div>
  </div>
  <div class="unresponsive-overlay">
    <div>Not responding</div>
  </div>
</div>

<!-- Instructions Window -->
<div class="window" id="instructionsWindow" style="left: 80px; top: 80px; width: 520px; height: 420px;">
  <div class="window-header">
    <div class="window-title">
      <span class="app-icon">üìã</span>
      Lab Instructions
    </div>
    <div class="window-controls">
      <div class="window-control minimize">‚àí</div>
      <div class="window-control maximize">‚¨ú</div>
      <div class="window-control close">‚úï</div>
    </div>
  </div>
  <div class="window-body">
    <h2 style="color: var(--win-accent); margin-bottom: 20px; font-weight: 500; font-size: 18px;">End an Unresponsive App</h2>
    
    <div style="margin-bottom: 24px; line-height: 1.6; color: var(--win-text);">
      <p>The Photos app is frozen and not responding. Use Task Manager to terminate the unresponsive process.</p>
    </div>
    
    <div style="background: #FFF3E0; border-left: 4px solid #FF9800; padding: 16px; border-radius: 4px; margin-bottom: 24px;">
      <div style="display: flex; align-items: flex-start; gap: 12px;">
        <div style="font-size: 20px;">üí°</div>
        <div>
          <strong style="display: block; margin-bottom: 4px;">Tip:</strong>
          You can still drag the frozen Photos window around if it's in your way.
        </div>
      </div>
    </div>
    
    <h3 style="margin-bottom: 16px; font-weight: 500; color: var(--win-text);">Steps:</h3>
    <ol style="margin-left: 24px; margin-bottom: 32px; line-height: 1.8;">
      <li><strong>Right-click</strong> the Start button in the taskbar</li>
      <li>Select <strong>Task Manager</strong> from the context menu</li>
      <li>Find <strong>PhotoViewer.exe</strong> (marked as "Not responding")</li>
      <li>Select it and click <strong>End task</strong></li>
    </ol>
    
    <div style="display: flex; gap: 12px;">
      <button id="resetLab">
        <span class="icon">üîÑ</span>
        Reset Lab
      </button>
      <button id="closeBrowser">
        <span class="icon">‚ùå</span>
        Close Lab
      </button>
    </div>
  </div>
</div>

<!-- Task Manager Window -->
<div class="window" id="taskManagerWindow" style="left: 250px; top: 100px; width: 900px; height: 600px; display: none;">
  <div class="window-header">
    <div class="window-title">
      <span class="app-icon">üß∞</span>
      Task Manager
    </div>
    <div class="window-controls">
      <div class="window-control minimize">‚àí</div>
      <div class="window-control maximize">‚¨ú</div>
      <div class="window-control close">‚úï</div>
    </div>
  </div>
  
  <div class="task-manager-tabs">
    <div class="task-manager-tab active">Processes</div>
    <div class="task-manager-tab">Performance</div>
    <div class="task-manager-tab">App history</div>
    <div class="task-manager-tab">Startup</div>
    <div class="task-manager-tab">Users</div>
    <div class="task-manager-tab">Details</div>
    <div class="task-manager-tab">Services</div>
  </div>
  
  <div class="window-body" style="position: relative; padding: 0;">
    <div class="task-manager-loading" id="taskManagerLoading">
      <div class="loading-spinner"></div>
      <div style="margin-top: 16px; color: var(--win-text-secondary); font-size: 13px;">Loading processes...</div>
    </div>
    
    <div style="height: 100%; overflow: auto; padding: 16px;">
      <table class="process-list">
        <thead>
          <tr>
            <th>Name</th>
            <th>Status</th>
            <th>CPU</th>
            <th>Memory</th>
            <th>Disk</th>
            <th>Network</th>
          </tr>
        </thead>
        <tbody id="processTbody">
          <!-- Process rows will be populated here -->
        </tbody>
      </table>
      
      <div style="margin-top: 20px; padding: 0 16px; display: flex; align-items: center; justify-content: space-between;">
        <div>
          <button class="end-task-btn" id="endTaskBtn" disabled>
            <span class="icon">‚ö∞Ô∏è</span>
            End task
          </button>
          <button style="background: transparent; border: 1px solid #E0E0E0; color: var(--win-text);">
            <span class="icon">‚ûï</span>
            New task
          </button>
        </div>
        <div style="color: var(--win-text-secondary); font-size: 12px;">
          <span id="processCount">0</span> processes
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Taskbar -->
<div class="taskbar">
  <div class="taskbar-center">
    <button class="start-button" id="startButton" aria-label="Start">
      <svg viewBox="0 0 24 24">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
      </svg>
    </button>
    
    <div class="taskbar-icon" title="Search">üîç</div>
    <div class="taskbar-icon" title="Widgets">‚óª‚óª</div>
    <div class="taskbar-icon" title="Microsoft Teams">üí¨</div>
    <div class="taskbar-icon" title="File Explorer">üìÅ</div>
    <div class="taskbar-icon active" title="Microsoft Edge">üåê</div>
  </div>
  
  <div class="system-tray">
    <div class="tray-group" id="trayTimeChip">
      <div class="tray-time">
        <div id="currentTime">14:30</div>
        <div id="currentDate">6 Dec</div>
      </div>
    </div>
  </div>
</div>

<!-- Start Menu -->
<div class="start-menu" id="startMenu">
  <div class="start-menu-header">
    <div style="display: flex; align-items: center; gap: 12px;">
      <div style="font-size: 20px;">üë§</div>
      <div>
        <div style="font-weight: 500;">Windows 11 Lab</div>
        <div style="font-size: 11px; opacity: 0.8;">User Account</div>
      </div>
    </div>
  </div>
  <div class="start-menu-body">
    <div class="start-menu-left">
      <div style="color: rgba(255, 255, 255, 0.8); font-size: 12px; margin-bottom: 12px;">Pinned</div>
      <div class="pinned-apps">
        <div class="pinned-tile" data-app="edge">
          <div style="font-size: 24px;">üåê</div>
          <div>Edge</div>
        </div>
        <div class="pinned-tile" data-app="explorer">
          <div style="font-size: 24px;">üìÅ</div>
          <div>Explorer</div>
        </div>
        <div class="pinned-tile" data-app="store">
          <div style="font-size: 24px;">üõí</div>
          <div>Store</div>
        </div>
        <div class="pinned-tile" data-app="settings">
          <div style="font-size: 24px;">‚öôÔ∏è</div>
          <div>Settings</div>
        </div>
        <div class="pinned-tile" data-app="photos">
          <div style="font-size: 24px;">üñºÔ∏è</div>
          <div>Photos</div>
        </div>
        <div class="pinned-tile" data-app="calculator">
          <div style="font-size: 24px;">üßÆ</div>
          <div>Calculator</div>
        </div>
      </div>
      
      <div style="color: rgba(255, 255, 255, 0.8); font-size: 12px; margin: 24px 0 12px;">Recommended</div>
      <div style="display: flex; flex-direction: column; gap: 8px;">
        <div class="context-menu-item">
          <div class="icon">üìã</div>
          <div>Lab Instructions</div>
        </div>
        <div class="context-menu-item">
          <div class="icon">üìÑ</div>
          <div>Documentation.pdf</div>
        </div>
      </div>
    </div>
    
    <div style="background: rgba(255, 255, 255, 0.05); padding: 20px;">
      <div style="margin-bottom: 20px;">
        <div style="color: rgba(255, 255, 255, 0.8); font-size: 12px; margin-bottom: 12px;">Power</div>
        <div class="context-menu-item">
          <div class="icon">‚èª</div>
          <div>Shut down</div>
        </div>
        <div class="context-menu-item">
          <div class="icon">üîÉ</div>
          <div>Restart</div>
        </div>
      </div>
      
      <div>
        <div style="color: rgba(255, 255, 255, 0.8); font-size: 12px; margin-bottom: 12px;">Account</div>
        <div class="context-menu-item">
          <div class="icon">üë§</div>
          <div>Change account settings</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Context Menu -->
<div class="context-menu" id="startContext" style="display: none;">
  <div class="context-menu-item" data-action="apps">
    <div class="icon">üì±</div>
    <div>Apps and Features</div>
  </div>
  <div class="context-menu-item" data-action="mobility">
    <div class="icon">üì±</div>
    <div>Mobility Center</div>
  </div>
  <div class="context-menu-item" data-action="power">
    <div class="icon">‚ö°</div>
    <div>Power Options</div>
  </div>
  <div class="context-menu-item" data-action="event">
    <div class="icon">üìä</div>
    <div>Event Viewer</div>
  </div>
  <div class="context-menu-item" data-action="system">
    <div class="icon">üíª</div>
    <div>System</div>
  </div>
  <div class="context-menu-item" data-action="device">
    <div class="icon">üñ®Ô∏è</div>
    <div>Device Manager</div>
  </div>
  <div class="context-menu-item" data-action="network">
    <div class="icon">üåê</div>
    <div>Network Connections</div>
  </div>
  <div class="context-menu-item" data-action="disk">
    <div class="icon">üíæ</div>
    <div>Disk Management</div>
  </div>
  <div class="context-menu-item" data-action="computer">
    <div class="icon">üñ•Ô∏è</div>
    <div>Computer Management</div>
  </div>
  <div class="context-menu-item" data-action="terminal">
    <div class="icon">üíª</div>
    <div>Windows Terminal</div>
  </div>
  <div class="context-menu-item" data-action="taskmgr" style="background: rgba(0, 120, 212, 0.1);">
    <div class="icon">üß∞</div>
    <div><strong>Task Manager</strong></div>
  </div>
  <div class="context-menu-item" data-action="settings">
    <div class="icon">‚öôÔ∏è</div>
    <div>Settings</div>
  </div>
  <div class="context-menu-item" data-action="search">
    <div class="icon">üîç</div>
    <div>Search</div>
  </div>
  <div class="context-menu-item" data-action="run">
    <div class="icon">üèÉ</div>
    <div>Run</div>
  </div>
  <div class="context-menu-item" data-action="shutdown">
    <div class="icon">‚èª</div>
    <div>Shut down or sign out</div>
  </div>
  <div class="context-menu-item" data-action="desktop">
    <div class="icon">üñ•Ô∏è</div>
    <div>Desktop</div>
  </div>
</div>

<!-- Calendar Popover -->
<div class="tray-popover" id="calendarPopover">
  <div class="pop-header">Date and time</div>
  <div class="pop-body">
    <div class="big-clock" id="bigClock">14:30</div>
    <div class="small-date" id="smallDate">Friday, December 6, 2024</div>
    
    <div class="calendar">
      <div class="cal-header">
        <div class="prev-month" id="prevMonth">‚Äπ</div>
        <div class="month" id="monthLabel">December 2024</div>
        <div class="next-month" id="nextMonth">‚Ä∫</div>
      </div>
      <div class="cal-grid" id="calGrid">
        <div class="dow">Sun</div>
        <div class="dow">Mon</div>
        <div class="dow">Tue</div>
        <div class="dow">Wed</div>
        <div class="dow">Thu</div>
        <div class="dow">Fri</div>
        <div class="dow">Sat</div>
        <!-- Days will be populated by JavaScript -->
      </div>
    </div>
  </div>
</div>

<!-- Toast Notification -->
<div id="toast"></div>

<script>
// ========== GLOBAL STATE & UTILITIES ==========
const $ = (selector, root = document) => root.querySelector(selector);
const $$ = (selector, root = document) => Array.from(root.querySelectorAll(selector));

let dragElement = null;
let dragOffset = { x: 0, y: 0 };
let selectedProcess = null;
let isDragging = false;

// Process data with realistic Windows 11 processes
const processData = [
  { name: 'System', status: 'Running', cpu: '0.3%', memory: '142.5 MB', disk: '0.1 MB/s', network: '0 Mbps', responsive: true, icon: '‚öôÔ∏è' },
  { name: 'Registry', status: 'Running', cpu: '0.1%', memory: '12.8 MB', disk: '0 MB/s', network: '0 Mbps', responsive: true, icon: 'üóÑÔ∏è' },
  { name: 'Memory Compression', status: 'Running', cpu: '0.8%', memory: '45.3 MB', disk: '0 MB/s', network: '0 Mbps', responsive: true, icon: 'üíæ' },
  { name: 'Windows Explorer', status: 'Running', cpu: '0.5%', memory: '62.4 MB', disk: '0 MB/s', network: '0 Mbps', responsive: true, icon: 'üìÅ' },
  { name: 'Desktop Window Manager', status: 'Running', cpu: '1.2%', memory: '89.6 MB', disk: '0 MB/s', network: '0 Mbps', responsive: true, icon: 'üñ•Ô∏è' },
  { name: 'Client Server Runtime Process', status: 'Running', cpu: '0.2%', memory: '18.7 MB', disk: '0 MB/s', network: '0 Mbps', responsive: true, icon: 'üîß' },
  { name: 'Microsoft Edge', status: 'Running', cpu: '3.5%', memory: '324.8 MB', disk: '0.2 MB/s', network: '1.4 Mbps', responsive: true, icon: 'üåê' },
  { name: 'Antimalware Service Executable', status: 'Running', cpu: '0.9%', memory: '156.3 MB', disk: '0.3 MB/s', network: '0 Mbps', responsive: true, icon: 'üõ°Ô∏è' },
  { name: 'Windows Security Health Service', status: 'Running', cpu: '0.3%', memory: '34.2 MB', disk: '0 MB/s', network: '0 Mbps', responsive: true, icon: 'üîí' },
  { name: 'Runtime Broker', status: 'Running', cpu: '0.4%', memory: '45.8 MB', disk: '0 MB/s', network: '0 Mbps', responsive: true, icon: 'üèÉ' },
  { name: 'PhotoViewer.exe', status: 'Not responding', cpu: '95.8%', memory: '512.3 MB', disk: '15.2 MB/s', network: '0 Mbps', responsive: false, icon: 'üñºÔ∏è' },
  { name: 'SearchHost.exe', status: 'Running', cpu: '0.6%', memory: '76.3 MB', disk: '0.1 MB/s', network: '0.1 Mbps', responsive: true, icon: 'üîç' },
  { name: 'StartMenuExperienceHost', status: 'Running', cpu: '0.2%', memory: '32.1 MB', disk: '0 MB/s', network: '0 Mbps', responsive: true, icon: 'üè†' },
  { name: 'TextInputHost', status: 'Running', cpu: '0.1%', memory: '18.9 MB', disk: '0 MB/s', network: '0 Mbps', responsive: true, icon: '‚å®Ô∏è' },
  { name: 'Service Host: Local System', status: 'Running', cpu: '0.7%', memory: '65.4 MB', disk: '0.2 MB/s', network: '0 Mbps', responsive: true, icon: 'üîÑ' },
  { name: 'Widgets', status: 'Running', cpu: '0.4%', memory: '54.2 MB', disk: '0 MB/s', network: '0.3 Mbps', responsive: true, icon: 'üìä' },
  { name: 'Microsoft Photos', status: 'Suspended', cpu: '0%', memory: '12.4 MB', disk: '0 MB/s', network: '0 Mbps', responsive: true, icon: 'üñºÔ∏è' }
];

// ========== TOAST NOTIFICATION ==========
function showToast(message, duration = 2500) {
  const toast = $('#toast');
  toast.textContent = message;
  toast.style.display = 'block';
  
  setTimeout(() => {
    toast.style.display = 'none';
  }, duration);
}

// ========== TIME UPDATES ==========
function updateTime() {
  const now = new Date();
  
  // Update taskbar time
  $('#currentTime').textContent = now.toLocaleTimeString([], { 
    hour: '2-digit', 
    minute: '2-digit' 
  });
  
  $('#currentDate').textContent = now.toLocaleDateString([], { 
    day: 'numeric', 
    month: 'short' 
  });
  
  // Update big clock in calendar if visible
  const bigClock = $('#bigClock');
  if (bigClock) {
    bigClock.textContent = now.toLocaleTimeString([], { 
      hour: '2-digit', 
      minute: '2-digit' 
    });
  }
  
  // Update small date in calendar
  const smallDate = $('#smallDate');
  if (smallDate) {
    smallDate.textContent = now.toLocaleDateString([], { 
      weekday: 'long', 
      day: 'numeric', 
      month: 'long', 
      year: 'numeric' 
    });
  }
}

// Initialize time
updateTime();
setInterval(updateTime, 1000);

// ========== WINDOW DRAGGING ==========
function initWindowDragging() {
  $$('.window-header').forEach(header => {
    header.addEventListener('mousedown', startDrag);
  });
  
  // Also allow dragging from the unresponsive window's body
  $('#photoViewerWindow .window-body').addEventListener('mousedown', startDrag);
}

function startDrag(e) {
  if (e.target.closest('.window-control')) return;
  
  dragElement = e.target.closest('.window, .unresponsive-window');
  if (!dragElement) return;
  
  const rect = dragElement.getBoundingClientRect();
  dragOffset.x = e.clientX - rect.left;
  dragOffset.y = e.clientY - rect.top;
  isDragging = true;
  
  // Bring to front
  $$('.window, .unresponsive-window').forEach(win => {
    win.style.zIndex = '100';
  });
  dragElement.style.zIndex = '200';
  
  document.addEventListener('mousemove', onDrag);
  document.addEventListener('mouseup', stopDrag);
}

function onDrag(e) {
  if (!dragElement || !isDragging) return;
  
  e.preventDefault();
  
  const x = e.clientX - dragOffset.x;
  const y = e.clientY - dragOffset.y;
  
  // Boundary check
  const maxX = window.innerWidth - dragElement.offsetWidth;
  const maxY = window.innerHeight - 48 - dragElement.offsetHeight; // Account for taskbar
  
  dragElement.style.left = `${Math.max(0, Math.min(x, maxX))}px`;
  dragElement.style.top = `${Math.max(0, Math.min(y, maxY))}px`;
}

function stopDrag() {
  isDragging = false;
  dragElement = null;
  document.removeEventListener('mousemove', onDrag);
  document.removeEventListener('mouseup', stopDrag);
}

// ========== WINDOW CONTROLS ==========
function initWindowControls() {
  // Close buttons
  $$('.window-control.close').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const window = btn.closest('.window');
      window.style.display = 'none';
      
      if (window.id === 'taskManagerWindow') {
        showToast('Task Manager closed');
      }
    });
  });
  
  // Minimize buttons
  $$('.window-control.minimize').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const window = btn.closest('.window');
      window.style.display = 'none';
      showToast(`${$('.window-title', window).textContent} minimized`);
    });
  });
  
  // Maximize buttons
  $$('.window-control.maximize').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const window = btn.closest('.window');
      
      if (window.style.width === '100%') {
        // Restore
        if (window.id === 'instructionsWindow') {
          window.style = 'left: 80px; top: 80px; width: 520px; height: 420px;';
        } else if (window.id === 'taskManagerWindow') {
          window.style = 'left: 250px; top: 100px; width: 900px; height: 600px;';
        } else if (window.id === 'photoViewerWindow') {
          window.style = 'left: 450px; top: 120px; width: 500px; height: 380px;';
        }
      } else {
        // Maximize
        window.dataset.previousStyle = window.getAttribute('style');
        window.style = 'left: 0; top: 0; width: 100%; height: calc(100% - 48px); border-radius: 0;';
      }
    });
  });
}

// ========== TASKBAR INTERACTIONS ==========
function initTaskbar() {
  const startButton = $('#startButton');
  const startMenu = $('#startMenu');
  const startContext = $('#startContext');
  const trayTimeChip = $('#trayTimeChip');
  const calendarPopover = $('#calendarPopover');
  
  // Start button click - toggle start menu
  startButton.addEventListener('click', (e) => {
    e.stopPropagation();
    const isVisible = startMenu.style.display === 'block';
    
    // Hide other popups
    startContext.style.display = 'none';
    calendarPopover.style.display = 'none';
    
    startMenu.style.display = isVisible ? 'none' : 'block';
    
    // Position start menu
    if (!isVisible) {
      const rect = startButton.getBoundingClientRect();
      startMenu.style.left = '50%';
      startMenu.style.transform = 'translateX(-50%)';
      startMenu.style.bottom = '56px';
    }
  });
  
  // Start button right-click - show context menu
  startButton.addEventListener('contextmenu', (e) => {
    e.preventDefault();
    e.stopPropagation();
    
    // Hide other popups
    startMenu.style.display = 'none';
    calendarPopover.style.display = 'none';
    
    // Position context menu
    const rect = startButton.getBoundingClientRect();
    startContext.style.left = `${rect.left}px`;
    startContext.style.bottom = '56px';
    startContext.style.display = 'block';
  });
  
  // Time chip click - show calendar
  trayTimeChip.addEventListener('click', (e) => {
    e.stopPropagation();
    
    // Hide other popups
    startMenu.style.display = 'none';
    startContext.style.display = 'none';
    
    // Position calendar
    const rect = trayTimeChip.getBoundingClientRect();
    calendarPopover.style.right = '12px';
    calendarPopover.style.bottom = '56px';
    calendarPopover.style.display = 'block';
    
    // Update calendar
    updateCalendar();
  });
  
  // Close popups when clicking elsewhere
  document.addEventListener('click', (e) => {
    if (!startMenu.contains(e.target) && e.target !== startButton) {
      startMenu.style.display = 'none';
    }
    if (!startContext.contains(e.target) && e.target !== startButton) {
      startContext.style.display = 'none';
    }
    if (!calendarPopover.contains(e.target) && !trayTimeChip.contains(e.target)) {
      calendarPopover.style.display = 'none';
    }
  });
  
  // Start menu app clicks
  $$('.pinned-tile').forEach(tile => {
    tile.addEventListener('click', () => {
      startMenu.style.display = 'none';
      showToast(`${tile.textContent.trim()} opened`);
    });
  });
  
  // Context menu items
  $$('#startContext .context-menu-item').forEach(item => {
    item.addEventListener('click', () => {
      const action = item.dataset.action;
      startContext.style.display = 'none';
      
      if (action === 'taskmgr') {
        openTaskManager();
      } else {
        showToast(`${item.textContent.trim()} selected`);
      }
    });
  });
}

// ========== TASK MANAGER ==========
function openTaskManager() {
  const taskManagerWindow = $('#taskManagerWindow');
  const loading = $('#taskManagerLoading');
  
  // Show loading state
  taskManagerWindow.style.display = 'flex';
  loading.style.display = 'flex';
  
  // Simulate loading delay
  setTimeout(() => {
    loading.style.display = 'none';
    populateProcessList();
    showToast('Task Manager opened');
  }, 1200);
}

function populateProcessList() {
  const tbody = $('#processTbody');
  tbody.innerHTML = '';
  
  processData.forEach(process => {
    const tr = document.createElement('tr');
    
    if (!process.responsive) {
      tr.classList.add('unresponsive');
      tr.id = 'unresponsiveProcess';
    }
    
    tr.innerHTML = `
      <td>
        <div style="display: flex; align-items: center; gap: 8px;">
          <span style="font-size: 14px;">${process.icon}</span>
          ${process.name}
        </div>
      </td>
      <td>${process.status}</td>
      <td>${process.cpu}</td>
      <td>${process.memory}</td>
      <td>${process.disk}</td>
      <td>${process.network}</td>
    `;
    
    tr.addEventListener('click', () => {
      // Deselect all rows
      $$('#processTbody tr').forEach(row => {
        row.classList.remove('selected');
      });
      
      // Select this row
      tr.classList.add('selected');
      selectedProcess = tr;
      
      // Enable end task button
      const endTaskBtn = $('#endTaskBtn');
      endTaskBtn.disabled = false;
      endTaskBtn.innerHTML = `<span class="icon">‚ö∞Ô∏è</span> End task`;
      
      // Show process name in button if it's the unresponsive one
      if (!process.responsive) {
        endTaskBtn.innerHTML = `<span class="icon">‚ö∞Ô∏è</span> End task - ${process.name}`;
      }
    });
    
    tbody.appendChild(tr);
  });
  
  // Update process count
  $('#processCount').textContent = processData.length;
}

function initTaskManager() {
  const endTaskBtn = $('#endTaskBtn');
  
  endTaskBtn.addEventListener('click', () => {
    if (!selectedProcess || endTaskBtn.disabled) return;
    
    // Add termination animation
    selectedProcess.classList.add('process-terminating');
    
    setTimeout(() => {
      // Check if it's the unresponsive process
      if (selectedProcess.id === 'unresponsiveProcess') {
        // Remove the process from the list
        selectedProcess.remove();
        
        // Hide the photo viewer window
        $('#photoViewerWindow').style.display = 'none';
        
        // Show success messages
        showToast('PhotoViewer.exe has been terminated');
        
        setTimeout(() => {
          showToast('‚úÖ Lab completed successfully! The unresponsive app has been terminated.', 3000);
        }, 800);
      } else {
        // Remove regular process
        selectedProcess.remove();
        showToast('Process ended successfully');
      }
      
      // Update process count
      const remainingProcesses = $$('#processTbody tr').length;
      $('#processCount').textContent = remainingProcesses;
      
      // Reset selection
      selectedProcess = null;
      endTaskBtn.disabled = true;
      endTaskBtn.innerHTML = `<span class="icon">‚ö∞Ô∏è</span> End task`;
      
    }, 600);
  });
  
  // Task manager tabs
  $$('.task-manager-tab').forEach((tab, index) => {
    tab.addEventListener('click', () => {
      // Remove active class from all tabs
      $$('.task-manager-tab').forEach(t => t.classList.remove('active'));
      
      // Add active class to clicked tab
      tab.classList.add('active');
      
      // Show appropriate content (simplified for this lab)
      if (index === 0) {
        showToast('Processes tab selected');
      } else {
        showToast(`${tab.textContent} tab selected - Simulated only`);
      }
    });
  });
}

// ========== CALENDAR ==========
function updateCalendar() {
  const now = new Date();
  const monthLabel = $('#monthLabel');
  const calGrid = $('#calGrid');
  
  // Remove existing day elements (keep day of week headers)
  $$('#calGrid .day').forEach(day => day.remove());
  
  // Set month label
  monthLabel.textContent = now.toLocaleDateString([], { 
    month: 'long', 
    year: 'numeric' 
  });
  
  // Get first day of month and number of days
  const year = now.getFullYear();
  const month = now.getMonth();
  const firstDay = new Date(year, month, 1);
  const lastDay = new Date(year, month + 1, 0);
  const daysInMonth = lastDay.getDate();
  const startingDay = firstDay.getDay();
  
  // Add empty cells for days before the first day of month
  for (let i = 0; i < startingDay; i++) {
    const emptyCell = document.createElement('div');
    emptyCell.className = 'day other';
    emptyCell.textContent = '';
    calGrid.appendChild(emptyCell);
  }
  
  // Add days of the month
  for (let day = 1; day <= daysInMonth; day++) {
    const dayCell = document.createElement('div');
    dayCell.className = 'day';
    dayCell.textContent = day;
    
    // Highlight today
    if (day === now.getDate() && month === now.getMonth() && year === now.getFullYear()) {
      dayCell.classList.add('today');
    }
    
    calGrid.appendChild(dayCell);
  }
  
  // Calendar navigation
  $('#prevMonth').addEventListener('click', (e) => {
    e.stopPropagation();
    now.setMonth(now.getMonth() - 1);
    updateCalendar();
  });
  
  $('#nextMonth').addEventListener('click', (e) => {
    e.stopPropagation();
    now.setMonth(now.getMonth() + 1);
    updateCalendar();
  });
}

// ========== DESKTOP ICONS ==========
function initDesktopIcons() {
  $$('.desktop-icon').forEach(icon => {
    icon.addEventListener('dblclick', () => {
      const iconType = icon.dataset.icon;
      showToast(`${$('.label', icon).textContent} opened`);
    });
    
    icon.addEventListener('contextmenu', (e) => {
      e.preventDefault();
      showToast(`${$('.label', icon).textContent} context menu - Simulated`);
    });
  });
}

// ========== LAB CONTROLS ==========
function initLabControls() {
  // Reset Lab button
  $('#resetLab').addEventListener('click', () => {
    // Reload the page
    location.reload();
  });
  
  // Close Lab button
  $('#closeBrowser').addEventListener('click', () => {
    showToast('Closing lab simulation...');
    
    // Simulate closing
    setTimeout(() => {
      document.body.innerHTML = `
        <div style="display: flex; align-items: center; justify-content: center; height: 100vh; background: linear-gradient(135deg, #1A1F35 0%, #2A2F45 100%); color: white;">
          <div style="text-align: center; padding: 40px;">
            <div style="font-size: 48px; margin-bottom: 20px;">üñ•Ô∏è</div>
            <h1 style="margin-bottom: 16px;">Lab Completed</h1>
            <p style="margin-bottom: 24px; opacity: 0.8;">You have successfully terminated the unresponsive application.</p>
            <button onclick="location.reload()" style="background: var(--win-accent); color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer;">
              Restart Lab
            </button>
          </div>
        </div>
      `;
    }, 1000);
  });
}

// ========== INITIALIZATION ==========
function init() {
  // Initialize all components
  initWindowDragging();
  initWindowControls();
  initTaskbar();
  initTaskManager();
  initDesktopIcons();
  initLabControls();
  
  // Show initial instructions
  showToast('Right-click the Start button and select Task Manager to begin the lab', 4000);
  
  // Make sure instructions window is visible
  $('#instructionsWindow').style.display = 'flex';
  
  // Update calendar initially
  updateCalendar();
}

// Start everything when page loads
document.addEventListener('DOMContentLoaded', init);

// Prevent context menu on the whole page (except where needed)
document.addEventListener('contextmenu', (e) => {
  // Allow context menu on start button and desktop icons
  if (!e.target.closest('#startButton') && !e.target.closest('.desktop-icon')) {
    e.preventDefault();
  }
});

// Handle escape key to close windows
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    // Close start menu
    $('#startMenu').style.display = 'none';
    $('#startContext').style.display = 'none';
    $('#calendarPopover').style.display = 'none';
  }
});
</script>
</body>
</html>