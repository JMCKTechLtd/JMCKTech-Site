<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Lab 13 – Run as Administrator</title>
<style>
/* ==== Desktop background (match template aesthetic) ==== */
html,body{height:100%;margin:0;font-family:Segoe UI, Roboto, Arial, Helvetica, sans-serif;}
body{background:linear-gradient(120deg,#1976d2,#0d47a1);color:#111;overflow:hidden;}
#desktop{position:absolute;inset:0 0 48px 0;padding:14px;}

/* ==== Windows (simulation windows) ==== */
.window{
  position:absolute;background:#fff;border:1px solid #c9c9c9;border-radius:10px;
  box-shadow:0 14px 40px rgba(0,0,0,.35);display:none;flex-direction:column;overflow:hidden;
}
.window-header{
  background:#e9e9e9;padding:8px 10px;display:flex;align-items:center;gap:8px;cursor:move;
  border-bottom:1px solid #cfcfcf;user-select:none;
}
.window-title{font-weight:600;flex:1}
.window-controls{display:flex;gap:6px}
.window-control{width:24px;height:24px;border-radius:6px;background:#dcdcdc;display:grid;place-items:center;cursor:pointer}
.window-control:hover{background:#cfcfcf}
.window-body{padding:10px;overflow:auto;background:#fff;flex:1}

/* Instructions content */
.window-body ol{margin:0 0 8px 18px}
.window-body button{border:1px solid #c9c9c9;background:#efefef;padding:6px 10px;border-radius:6px;cursor:pointer}
.window-body button:hover{background:#e6e6e6}

/* ==== Taskbar + refined tray (from template) ==== */
.taskbar {
  position: absolute; bottom: 0; width: 100%; height: 48px;
  background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(20px);
  display: flex; align-items: center; padding: 0 12px; z-index: 100;
  border-top: 1px solid rgba(255,255,255,0.1);
}
.start-button {
  color: white; font-weight: 600; display: flex; align-items: center; gap: 8px;
  padding: 6px 10px; border-radius: 8px; transition: all 0.2s ease; font-size: 14px;
  background: rgba(255,255,255,0.22); border: 1px solid rgba(255,255,255,0.35); cursor:pointer;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,0.06);
}
.start-button:hover { background-color: rgba(255,255,255,0.32); border-color: rgba(255,255,255,0.5); }
.windows-logo { width: 20px; height: 20px; margin-right: 2px; display:inline-block; }

/* Pinned apps (left of tray) – none required for this lab */
.taskbar-icons { display: flex; gap: 8px; margin-left: 10px; }

/* System Tray – time only */
.system-tray { display: flex; align-items: center; color: white; font-size: 13px; padding: 0 6px; white-space: nowrap; gap: 6px; margin-left:auto; }
.tray-chip {
  display:inline-flex; align-items:center; gap:8px; height:32px; padding:0 10px;
  background: rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.2);
  border-radius:10px; cursor:pointer; user-select:none;
  box-shadow: 0 2px 8px rgba(0,0,0,0.25), inset 0 0 0 1px rgba(255,255,255,0.06);
  transition: transform .12s ease, background .15s ease, border-color .15s ease;
}
.tray-chip:hover { background: rgba(255,255,255,0.16); border-color: rgba(255,255,255,0.35); transform: translateY(-1px); }
.tray-time { min-width: 92px; justify-content:center; font-variant-numeric: tabular-nums; }

/* Start Menu (template style) */
.start-menu {
  position: absolute; bottom: 52px; left: 12px; width: 520px; height: 380px;
  background: rgba(30,30,30,0.97); color: white; border: 1px solid rgba(255,255,255,0.12);
  border-radius: 12px; box-shadow: 0 12px 40px rgba(0,0,0,0.4); backdrop-filter: blur(16px);
  display: none; overflow: hidden; z-index: 200;
}
.start-menu-header { padding: 16px 20px; background: rgba(255,255,255,0.06); border-bottom: 1px solid rgba(255,255,255,0.1); font-weight: 600; font-size: 16px; }
.start-menu-body { display: grid; grid-template-columns: 1fr 1fr; height: calc(100% - 60px); }
.start-menu-left { padding: 16px; background: rgba(255,255,255,0.02); border-right: 1px solid rgba(255,255,255,0.08); }
.start-menu-right { padding: 16px; }
.app-list { max-height: 100%; overflow-y: auto; }
.app-item { display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: 8px; cursor: pointer; transition: background 0.2s ease; margin-bottom: 8px; }
.app-item:hover { background: rgba(255,255,255,0.08); }
.app-item .icon { width: 32px; height: 32px; border-radius: 6px; background: #0078d4; display: flex; align-items: center; justify-content: center; font-size: 16px; }
.instructions-icon { background: linear-gradient(45deg, #ff6b35, #f7931e) !important; }

/* Context menu for Command Prompt item */
.context-menu{position:absolute;display:none;background:rgba(30,30,30,0.97);color:#fff;border:1px solid rgba(255,255,255,0.12);border-radius:10px;box-shadow:0 12px 40px rgba(0,0,0,0.4);z-index:400;overflow:hidden;backdrop-filter:blur(16px);min-width:220px;}
.context-menu-item{padding:12px 16px;cursor:pointer;display:flex;align-items:center;color:white;font-size:14px;transition:all .2s ease;border-bottom:1px solid rgba(255,255,255,0.05);user-select:none;}
.context-menu-item:last-child{border-bottom:none;}
.context-menu-item:hover{background:rgba(255,255,255,0.08);}

/* UAC Modal */
.uac-modal {
  position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
  width: 520px; background: linear-gradient(135deg, #1b365d, #0d1b2a); color: #fff;
  border: 1px solid rgba(255,255,255,0.15); border-radius: 12px; box-shadow: 0 20px 60px rgba(0,0,0,0.5);
  display: none; z-index: 500; overflow: hidden;
}
.uac-header { padding: 14px 16px; background: rgba(255,255,255,0.06); font-weight: 600; }
.uac-body { padding: 16px; font-size: 14px; line-height: 1.4; }
.uac-footer { padding: 12px 16px; display: flex; justify-content: flex-end; gap: 10px; background: rgba(255,255,255,0.06); }
.uac-btn { padding: 8px 14px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.25); cursor: pointer; user-select: none; background: rgba(255,255,255,0.08); color: #fff; }
.uac-btn.primary { background: #0078d4; border-color: #0078d4; }

/* Toast */
#toast{position:fixed;bottom:60px;left:50%;transform:translateX(-50%);background:#333;color:#fff;padding:10px 14px;border-radius:10px;display:none;z-index:600}

/* === Tray Popover + Calendar (ported from template) === */
.tray-popover {
  position: absolute; display: none; min-width: 300px;
  background: rgba(30,30,30,0.97); color: white;
  border: 1px solid rgba(255,255,255,0.12); border-radius: 12px;
  box-shadow: 0 12px 40px rgba(0,0,0,0.4); z-index: 400; overflow: hidden; backdrop-filter: blur(16px);
}
.tray-popover .pop-header { padding: 12px 16px; background: rgba(255,255,255,0.06); border-bottom: 1px solid rgba(255,255,255,0.1); font-weight: 600; font-size: 13px; }
.tray-popover .pop-body { padding: 14px 16px; font-size: 13px; max-height: 380px; overflow:auto; }
.row { display:flex; align-items:center; gap:10px; }
.muted { opacity:0.85; }

.calendar{ width:100%; user-select:none; }
.calendar .big-clock{ font-size:28px; font-weight:700; margin-bottom:6px; }
.calendar .small-date{ opacity:.9; margin-bottom:10px; }
.calendar .cal-header{ display:flex; justify-content:space-between; align-items:center; margin-bottom:6px; }
.calendar .month{ font-weight:600; }
.calendar .grid{ display:grid; grid-template-columns:repeat(7,1fr); gap:4px; font-size:12px; }
.calendar .dow{ text-align:center; opacity:.8; padding:4px 0; }
.calendar .day{ text-align:center; padding:6px 0; border-radius:6px; }
.calendar .day.today{ background:#1976d2; color:#fff; }
.calendar .day.other{ opacity:.35; }

</style>
</head>
<body>
  <div id="desktop">
    <!-- Instructions window (visible by default) -->
    <div class="window" id="instructionsWindow" style="left:20px;top:20px;width:420px;height:340px;display:flex;">
      <div class="window-header">
        <div class="window-title">Lab 13: Run as Administrator – Instructions</div>
        <div class="window-controls">
          <div class="window-control" data-minimize title="Minimize">−</div>
          <div class="window-control" data-maximize title="Maximize">⬜</div>
          <div class="window-control" data-close title="Close">✕</div>
        </div>
      </div>
      <div class="window-body">
        <p><strong>Goal:</strong> Launch <em>Command Prompt</em> with elevated (administrator) privileges.</p>
        <ol>
          <li>Click <strong>Start</strong> to open the menu.</li>
          <li>Right‑click <strong>Command Prompt</strong> and choose <strong>Run as administrator</strong>.</li>
          <li>Approve the UAC prompt by clicking <strong>Yes</strong>.</li>
          <li>Verify the window title shows <strong>Administrator: Command Prompt</strong>.</li>
        </ol>
        <div style="margin-top:10px;display:flex;gap:8px">
          <button id="resetLab">Reset Lab</button>
          <button id="closeBrowser">Close Lab</button>
        </div>
      </div>
    </div>

    <!-- Command Prompt (standard) -->
    <div class="window" id="cmdWindow" style="left:260px;top:100px;width:740px;height:420px;">
      <div class="window-header">
        <div class="window-title">Command Prompt</div>
        <div class="window-controls">
          <div class="window-control" data-minimize title="Minimize">−</div>
          <div class="window-control" data-maximize title="Maximize">⬜</div>
          <div class="window-control" data-close title="Close">✕</div>
        </div>
      </div>
      <div class="window-body" style="background:#111;color:#0f0;font-family:Consolas, 'Courier New', monospace;">
        Microsoft Windows [Version 10.0.19045.####]<br/>
        (c) Microsoft Corporation. All rights reserved.<br/><br/>
        C:\Users\Student&gt;
      </div>
    </div>

    <!-- Command Prompt (administrator) -->
    <div class="window" id="cmdAdminWindow" style="left:220px;top:70px;width:780px;height:450px;">
      <div class="window-header">
        <div class="window-title">Administrator: Command Prompt</div>
        <div class="window-controls">
          <div class="window-control" data-minimize title="Minimize">−</div>
          <div class="window-control" data-maximize title="Maximize">⬜</div>
          <div class="window-control" data-close title="Close">✕</div>
        </div>
      </div>
      <div class="window-body" style="background:#0b0b0b;color:#9cff9c;font-family:Consolas, 'Courier New', monospace;">
        Microsoft Windows [Version 10.0.19045.####]<br/>
        (c) Microsoft Corporation. All rights reserved.<br/><br/>
        C:\Windows\system32&gt;
      </div>
    </div>

    <!-- UAC Modal -->
    <div class="uac-modal" id="uacModal" role="dialog" aria-modal="true" aria-labelledby="uacTitle">
      <div class="uac-header" id="uacTitle">User Account Control</div>
      <div class="uac-body">
        <div style="display:flex; align-items:flex-start; gap:10px;">
          <div style="font-size:22px">🛡️</div>
          <div>
            <p>Do you want to allow this app to make changes to your device?</p>
            <p><strong>Program name:</strong> Windows Command Processor</p>
            <p><strong>Verified publisher:</strong> Microsoft Windows</p>
            <p><strong>File origin:</strong> Hard drive on this computer</p>
          </div>
        </div>
      </div>
      <div class="uac-footer">
        <button class="uac-btn" id="uacNo">No</button>
        <button class="uac-btn primary" id="uacYes">Yes</button>
      </div>
    </div>
  </div>

  <!-- Taskbar -->
  <div class="taskbar">
    <div class="start-button" id="startButton" title="Start">
      <span class="windows-logo">
        <!-- 4 blue squares (template style) -->
        <svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
          <rect x="1" y="1" width="8" height="8" fill="#00BCF9"/>
          <rect x="11" y="1" width="8" height="8" fill="#00BCF9"/>
          <rect x="1" y="11" width="8" height="8" fill="#00BCF9"/>
          <rect x="11" y="11" width="8" height="8" fill="#00BCF9"/>
        </svg>
      </span>
      Start
    </div>

    <div class="taskbar-icons"><!-- intentionally empty --></div>

    <div class="system-tray" id="systemTray">
      <div class="tray-chip tray-time" id="trayTimeChip" title="Date and time">
        <span id="trayTime">--:--</span>
      </div>
    </div>
  </div>

  <!-- Start Menu (only Instructions + Command Prompt) -->
  <div class="start-menu" id="startMenu">
    <div class="start-menu-header">Start</div>
    <div class="start-menu-body">
      <div class="start-menu-left">
        <div class="app-item" data-app="instructions">
          <div class="icon instructions-icon">📋</div>
          <span>Instructions</span>
        </div>
      </div>
      <div class="start-menu-right">
        <div class="app-list">
          <div class="app-item" id="cmdItem" data-app="cmd">
            <div class="icon">&gt;_</div>
            <span>Command Prompt</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Context menu for Command Prompt item -->
  <div class="context-menu" id="cmdContextMenu">
    <div class="context-menu-item" data-cmd-action="open">Open</div>
    <div class="context-menu-item" data-cmd-action="runas">Run as administrator</div>
    <div class="context-menu-item" data-cmd-action="pin">Pin to Start</div>
  </div>

  <div id="toast"></div>

<script>
/* ===== Utilities ===== */
const $ = (sel, root=document) => root.querySelector(sel);
const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
function flashToast(msg){ const t=$('#toast'); t.textContent=msg; t.style.display='block'; setTimeout(()=>t.style.display='none',1400); }

/* ===== Elements ===== */
const startButton = $('#startButton');
const startMenu = $('#startMenu');
const instructionsWindow = $('#instructionsWindow');
const cmdWindow = $('#cmdWindow');
const cmdAdminWindow = $('#cmdAdminWindow');
const cmdItem = $('#cmdItem');
const cmdContextMenu = $('#cmdContextMenu');
const uacModal = $('#uacModal');
const uacYes = $('#uacYes');
const uacNo = $('#uacNo');
const resetLab = $('#resetLab');
const closeBrowser = $('#closeBrowser');
const trayTime = $('#trayTime');
const trayTimeChip = $('#trayTimeChip');

/* ===== Start Menu behavior ===== */
startButton.addEventListener('click', (e)=>{
  e.stopPropagation();
  startMenu.style.display = (startMenu.style.display==='block')?'none':'block';
  cmdContextMenu.style.display='none';
});

// Close menus when clicking elsewhere
document.addEventListener('click', (e)=>{
  if(!startMenu.contains(e.target) && e.target!==startButton) startMenu.style.display='none';
  if(!cmdContextMenu.contains(e.target)) cmdContextMenu.style.display='none';
});

/* ===== Command Prompt item interactions ===== */
// Left click – open normal cmd
cmdItem.addEventListener('click', ()=>{
  startMenu.style.display='none';
  openWindow(cmdWindow);
});

// Right click – show context menu (Open / Run as administrator)
cmdItem.addEventListener('contextmenu', (e)=>{
  e.preventDefault(); e.stopPropagation();
  const rect = document.body.getBoundingClientRect();
  const menuW = 220, menuH = 140, margin = 8;
  let x = e.clientX, y = e.clientY;
  x = Math.max(margin, Math.min(x, rect.width - menuW - margin));
  y = Math.max(margin, Math.min(y, rect.height - 48 - menuH - margin));
  cmdContextMenu.style.left = x+'px';
  cmdContextMenu.style.top = y+'px';
  cmdContextMenu.style.display = 'block';
});

cmdContextMenu.addEventListener('click', (e)=>{
  const action = e.target.closest('.context-menu-item')?.dataset.cmdAction;
  if(!action) return;
  cmdContextMenu.style.display='none';
  startMenu.style.display='none';
  if(action==='open') openWindow(cmdWindow);
  if(action==='runas') showUAC();
  if(action==='pin') flashToast('Pinned to Start');
});

/* ===== UAC flow ===== */
function showUAC(){ uacModal.style.display='block'; }
function hideUAC(){ uacModal.style.display='none'; }

uacYes.addEventListener('click', ()=>{ hideUAC(); openWindow(cmdAdminWindow); flashToast('Launched with administrator privileges'); });
uacNo.addEventListener('click', ()=>{ hideUAC(); flashToast('Action cancelled'); });

/* ===== Windows open/controls/dragging ===== */
function openWindow(w){
  // Hide other app windows (keep instructions as user may want it)
  ['cmdWindow','cmdAdminWindow'].forEach(id=>{ if('#'+id!==('#'+w.id)) $('#'+id).style.display='none'; });
  w.style.display='flex';
}

// Controls
$$('[data-close]').forEach(btn=>btn.addEventListener('click', (e)=>{ e.stopPropagation(); btn.closest('.window').style.display='none'; }));
$$('[data-minimize]').forEach(btn=>btn.addEventListener('click', (e)=>{ e.stopPropagation(); btn.closest('.window').style.display='none'; }));
$$('[data-maximize]').forEach(btn=>btn.addEventListener('click', (e)=>{
  e.stopPropagation(); const w = btn.closest('.window');
  if(w.style.width==='100%'){
    // restore default sizes
    if(w.id==='instructionsWindow'){ w.style.width='420px'; w.style.height='340px'; w.style.left='20px'; w.style.top='20px'; }
    if(w.id==='cmdWindow'){ w.style.width='740px'; w.style.height='420px'; w.style.left='260px'; w.style.top='100px'; }
    if(w.id==='cmdAdminWindow'){ w.style.width='780px'; w.style.height='450px'; w.style.left='220px'; w.style.top='70px'; }
  } else {
    w.style.width='100%'; w.style.height='calc(100% - 48px)'; w.style.left='0'; w.style.top='0';
  }
}));

// Dragging
let dragWin=null, sx=0, sy=0, ix=0, iy=0, dragging=false;
$$('.window-header').forEach(h=>{
  h.addEventListener('mousedown', e=>{
    if(e.target.closest('.window-control')) return;
    e.preventDefault();
    dragWin = h.closest('.window'); dragging=true;
    sx=e.clientX; sy=e.clientY;
    ix=parseInt(dragWin.style.left || getComputedStyle(dragWin).left);
    iy=parseInt(dragWin.style.top  || getComputedStyle(dragWin).top);
    document.addEventListener('mousemove', onDrag);
    document.addEventListener('mouseup', stopDrag);
  });
});
function onDrag(e){ if(!dragging||!dragWin) return; dragWin.style.left=(ix + (e.clientX-sx))+'px'; dragWin.style.top=(iy + (e.clientY-sy))+'px'; }
function stopDrag(){ dragging=false; dragWin=null; document.removeEventListener('mousemove', onDrag); document.removeEventListener('mouseup', stopDrag); }

/* ===== Time/Date (tray) ===== */
function updateTime(){
  const now = new Date();
  const hh = String(now.getHours()).padStart(2,'0');
  const mm = String(now.getMinutes()).padStart(2,'0');
  trayTime.textContent = `${hh}:${mm}`;
}
updateTime();
setInterval(updateTime, 1000*30);

/* ===== Reset & Close Lab ===== */
resetLab.addEventListener('click', ()=>{
  // Close both cmd windows
  cmdWindow.style.display='none';
  cmdAdminWindow.style.display='none';
  // Hide menus/modals
  startMenu.style.display='none';
  cmdContextMenu.style.display='none';
  uacModal.style.display='none';
  // Restore instructions window position/size
  instructionsWindow.style.display='flex';
  instructionsWindow.style.width='420px';
  instructionsWindow.style.height='340px';
  instructionsWindow.style.left='20px';
  instructionsWindow.style.top='20px';
  flashToast('Lab reset to initial state');
});

closeBrowser.addEventListener('click', ()=>{
  flashToast('Closing lab...');
  window.close();
  setTimeout(()=>{ window.location.href='about:blank'; }, 300);
});


/* ==== Tray/Popover helpers (ported from template) ==== */
const systemTray = document.getElementById('systemTray');
// reuse existing trayTimeChip constant if present; otherwise define:
const trayTimeChipExisting = typeof trayTimeChip !== 'undefined' ? trayTimeChip : document.getElementById('trayTimeChip');

function makePopover(html){
  const el = document.createElement('div');
  el.className = 'tray-popover';
  el.innerHTML = html;
  document.body.appendChild(el);
  return el;
}
function togglePopover(popover, anchor){
  const r = anchor.getBoundingClientRect();
  popover.style.right  = (window.innerWidth - r.right) + 'px';
  popover.style.bottom = (window.innerHeight - r.top + 8) + 'px';
  const open = popover.style.display === 'block';
  document.querySelectorAll('.tray-popover').forEach(p=>p.style.display='none');
  if (!open) popover.style.display='block';
}

/* ==== Time / Calendar popover ==== */
const timePopover = makePopover(`
  <div class="pop-header">Date & time</div>
  <div class="pop-body">
    <div class="calendar">
      <div class="big-clock" id="bigClock">--:--</div>
      <div class="small-date" id="smallDate">-- ---, ----</div>
      <div class="cal-header">
        <span id="prevMonth" style="cursor:pointer">‹</span>
        <span class="month" id="monthLabel">Month Year</span>
        <span id="nextMonth" style="cursor:pointer">›</span>
      </div>
      <div class="grid" id="calGrid">
        <div class="dow">Su</div><div class="dow">Mo</div><div class="dow">Tu</div>
        <div class="dow">We</div><div class="dow">Th</div><div class="dow">Fr</div><div class="dow">Sa</div>
      </div>
    </div>
  </div>
`);

/* Click binding for tray time chip */
if (trayTimeChipExisting) {
  trayTimeChipExisting.addEventListener('click', (e)=>{
    e.stopPropagation();
    updateClockAndDate();
    ensureCalendarRendered();
    togglePopover(timePopover, trayTimeChipExisting);
  });
}

/* Click-away hide for popovers */
document.addEventListener('click', (e)=>{
  if (!systemTray.contains(e.target) && !e.target.closest('.tray-popover')) {
    document.querySelectorAll('.tray-popover').forEach(p=>p.style.display='none');
  }
});
document.querySelectorAll('.tray-popover').forEach(p => p.addEventListener('click', e => e.stopPropagation()));

/* ==== Big clock + calendar rendering ==== */
function updateClockAndDate(){
  const now = new Date();
  const hh = String(now.getHours()).padStart(2,'0');
  const mm = String(now.getMinutes()).padStart(2,'0');
  const bigClock = document.getElementById('bigClock');
  const smallDate = document.getElementById('smallDate');
  if (bigClock) bigClock.textContent = `${hh}:${mm}`;
  if (smallDate) smallDate.textContent = now.toLocaleDateString(undefined, { weekday:'short', day:'2-digit', month:'short', year:'numeric' });
}

/* Calendar state + renderer */
let calRef = new Date(); // current month
function ensureCalendarRendered(){ renderCalendar(calRef); }
function renderCalendar(refDate){
  const monthLabel = document.getElementById('monthLabel');
  const grid = document.getElementById('calGrid');
  if (!monthLabel || !grid) return;

  // wipe previous days
  Array.from(grid.querySelectorAll('.day')).forEach(d=>d.remove());

  const y = refDate.getFullYear(), m = refDate.getMonth();
  monthLabel.textContent = new Date(y, m, 1).toLocaleString(undefined, {month:'long', year:'numeric'});

  const first    = new Date(y, m, 1);
  const startDow = first.getDay();
  const daysIn   = new Date(y, m+1, 0).getDate();
  const prevDays = new Date(y, m, 0).getDate();

  // leading days
  for(let i=startDow-1; i>=0; i--){
    const el=document.createElement('div'); el.className='day other'; el.textContent=(prevDays - i); grid.appendChild(el);
  }

  // current month days with "today" highlight
  const today = new Date();
  const highlight = (today.getFullYear()===y && today.getMonth()===m) ? today.getDate() : -1;
  for(let d=1; d<=daysIn; d++){
    const el=document.createElement('div'); el.className='day'; el.textContent=d;
    if(d===highlight) el.classList.add('today');
    grid.appendChild(el);
  }

  // trailing days to complete the last week
  const totalCells = grid.querySelectorAll('.dow').length + grid.querySelectorAll('.day').length;
  const rem = totalCells % 7;
  if (rem !== 0){
    const need = 7 - rem;
    for(let d=1; d<=need; d++){
      const el=document.createElement('div'); el.className='day other'; el.textContent=d; grid.appendChild(el);
    }
  }
}

// month navigation
document.addEventListener('click', (e)=>{
  if (e.target && e.target.id === 'prevMonth'){ e.stopPropagation(); calRef = new Date(calRef.getFullYear(), calRef.getMonth()-1, 1); ensureCalendarRendered(); }
  if (e.target && e.target.id === 'nextMonth'){ e.stopPropagation(); calRef = new Date(calRef.getFullYear(), calRef.getMonth()+1, 1); ensureCalendarRendered(); }
});

</script>
</body>
</html>
