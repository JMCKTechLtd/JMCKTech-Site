<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>RHCSA Lab 4.3 - File Attributes (chattr, lsattr)</title>
    <style>
        :root {
            --redhat-red: #cc0000;
            --redhat-dark: #1e1e1e;
            --redhat-light: #f0f0f0;
            --redhat-accent: #4CAF50;
            --redhat-blue: #007ACC;
        }
        body {
            font-family: 'Red Hat Text', 'Overpass', sans-serif;
            background-color: var(--redhat-dark);
            color: var(--redhat-light);
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }
        .lab-container {
            max-width: 900px;
            margin: 20px auto;
            background: #252525;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            border-top: 4px solid var(--redhat-red);
        }
        .header {
            background: linear-gradient(to right, #1e1e1e, #333);
            padding: 15px 20px;
            color: white;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #444;
        }
        .header img {
            height: 30px;
            margin-right: 15px;
        }
        .header h1 {
            margin: 0;
            font-size: 1.5em;
            font-weight: normal;
        }
        .terminal-container {
            display: flex;
            flex-direction: column;
            height: 600px;
        }
        .guide {
            padding: 20px;
            background: #2d2d2d;
            flex: 1;
            overflow-y: auto;
        }
        .guide h2 {
            margin-top: 0;
            color: var(--redhat-accent);
            border-bottom: 1px solid #444;
            padding-bottom: 10px;
        }
        .guide-step {
            margin-bottom: 15px;
            padding: 15px;
            background: #333;
            border-left: 4px solid var(--redhat-accent);
            display: none;
        }
        .active-step {
            display: block;
        }
        .terminal {
            background: #000;
            padding: 15px;
            height: 250px;
            overflow-y: auto;
            font-family: 'Red Hat Mono', monospace;
            border-top: 1px solid #444;
        }
        .prompt {
            color: var(--redhat-accent);
        }
        .command-line {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #333;
            border-top: 1px solid #444;
        }
        #command-input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--redhat-light);
            font-family: 'Red Hat Mono', monospace;
            font-size: 16px;
            outline: none;
            padding: 8px;
        }
        .success {
            color: var(--redhat-accent);
            font-weight: bold;
        }
        .error {
            color: #FF5252;
        }
        .completion {
            color: #FFD700;
            font-weight: bold;
        }
        .concept {
            background: #2a2a2a;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            border-left: 4px solid var(--redhat-blue);
        }
        .concept h4 {
            margin-top: 0;
            color: var(--redhat-blue);
            border-bottom: 1px solid #444;
            padding-bottom: 5px;
        }
        .concept-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }
        .concept-item {
            background: #252525;
            padding: 10px;
            border-radius: 5px;
            border-left: 2px solid var(--redhat-red);
        }
        .concept-item strong {
            color: var(--redhat-red);
            display: block;
            margin-bottom: 5px;
        }
        code {
            background: #1e1e1e;
            padding: 2px 5px;
            border-radius: 3px;
            color: var(--redhat-accent);
            font-family: 'Red Hat Mono', monospace;
        }
        kbd {
            background: #444;
            padding: 2px 5px;
            border-radius: 3px;
            color: white;
            font-family: 'Red Hat Mono', monospace;
        }
        .required-command {
            background: rgba(76, 175, 80, 0.1);
            padding: 5px;
            border-radius: 3px;
            border-left: 3px solid var(--redhat-accent);
        }
        .trophy {
            display: inline-block;
            margin-left: 5px;
        }
        .syntax-error {
            color: #FF5252;
            font-weight: bold;
        }
        .warning {
            color: #FFD700;
            font-weight: bold;
        }
        .strict-feedback {
            background: rgba(204, 0, 0, 0.1);
            padding: 10px;
            border-radius: 5px;
            border-left: 3px solid var(--redhat-red);
            margin-top: 10px;
        }
        .attr-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        .attr-table th, .attr-table td {
            border: 1px solid #444;
            padding: 8px;
            text-align: left;
        }
        .attr-table th {
            background-color: #333;
            color: var(--redhat-accent);
        }
        .attr-table tr:nth-child(even) {
            background-color: #252525;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Red+Hat+Text:wght@400;700&amp;family=Red+Hat+Mono&amp;display=swap" rel="stylesheet"/>
</head>
<body>
<div class="lab-container">
    <div class="header">
        <img alt="Red Hat Logo" src="https://www.redhat.com/profiles/rh/themes/redhatdotcom/img/logo.svg"/>
        <h1>RHCSA Lab 4.3: Work with File Attributes (chattr, lsattr)</h1>
    </div>
    <div class="terminal-container">
        <div class="guide">
            <h2>Lab Instructions</h2>
            <div class="guide-step active-step" id="step1">
                <h3>Step 1: Understanding File Attributes</h3>
                <p class="required-command">Type exactly: <code>lsattr /etc/passwd</code></p>

                <div class="concept">
                    <h4>File Attributes in Linux</h4>
                    <div class="concept-grid">
                        <div class="concept-item">
                            <strong>What</strong>
                            Extended attributes beyond standard permissions
                        </div>
                        <div class="concept-item">
                            <strong>Why</strong>
                            Provide additional file security and behavior control
                        </div>
                        <div class="concept-item">
                            <strong>Where</strong>
                            On ext2/3/4 and other supported filesystems
                        </div>
                        <div class="concept-item">
                            <strong>When</strong>
                            When you need to protect files from accidental changes
                        </div>
                    </div>
                    <p><strong>How it works:</strong> <code>lsattr</code> lists attributes while <code>chattr</code> changes them. Attributes are filesystem-specific and provide low-level control over file behavior.</p>
                    
                    <table class="attr-table">
                        <tr>
                            <th>Attribute</th>
                            <th>Description</th>
                        </tr>
                        <tr>
                            <td>a (append only)</td>
                            <td>File can only be opened in append mode for writing</td>
                        </tr>
                        <tr>
                            <td>i (immutable)</td>
                            <td>File cannot be modified, deleted, or renamed</td>
                        </tr>
                        <tr>
                            <td>A (no atime updates)</td>
                            <td>Access time is not modified when file is read</td>
                        </tr>
                        <tr>
                            <td>c (compressed)</td>
                            <td>File is compressed on disk (transparently)</td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="guide-step" id="step2">
                <h3>Step 2: Making a File Immutable</h3>
                <p class="required-command">Create a test file: <code>touch testfile</code></p>
                <p class="required-command">Make it immutable: <code>sudo chattr +i testfile</code></p>
                <p class="required-command">Verify: <code>lsattr testfile</code></p>

                <div class="concept">
                    <h4>Immutable Files</h4>
                    <div class="concept-grid">
                        <div class="concept-item">
                            <strong>What</strong>
                            Files that cannot be modified or deleted
                        </div>
                        <div class="concept-item">
                            <strong>Why</strong>
                            Protect critical files from accidental changes
                        </div>
                        <div class="concept-item">
                            <strong>Where</strong>
                            On any file or directory
                        </div>
                        <div class="concept-item">
                            <strong>When</strong>
                            For configuration files or system binaries
                        </div>
                    </div>
                    <p><strong>How it works:</strong> The <code>+i</code> attribute makes a file immutable. Even root cannot modify or delete it until the attribute is removed. This is useful for protecting critical system files.</p>
                    <div class="strict-feedback">
                        <strong>Security Note:</strong> Immutable files provide protection against accidental changes but aren't a security feature. A user with root access can remove the attribute.
                    </div>
                </div>
            </div>
            <div class="guide-step" id="step3">
                <h3>Step 3: Append-Only Files</h3>
                <p class="required-command">Create a log file: <code>touch audit.log</code></p>
                <p class="required-command">Set append-only: <code>sudo chattr +a audit.log</code></p>
                <p class="required-command">Verify: <code>lsattr audit.log</code></p>

                <div class="concept">
                    <h4>Append-Only Files</h4>
                    <div class="concept-grid">
                        <div class="concept-item">
                            <strong>What</strong>
                            Files that can only be appended to
                        </div>
                        <div class="concept-item">
                            <strong>Why</strong>
                            Protect log files from tampering
                        </div>
                        <div class="concept-item">
                            <strong>Where</strong>
                            On log files or audit trails
                        </div>
                        <div class="concept-item">
                            <strong>When</strong>
                            When you need to preserve existing content
                        </div>
                    </div>
                    <p><strong>How it works:</strong> The <code>+a</code> attribute allows data to be appended but prevents modifying existing content. Useful for log files where you want to ensure data isn't altered after writing.</p>
                </div>
            </div>
            <div class="guide-step" id="step4">
                <h3>Step 4: Removing Attributes</h3>
                <p class="required-command">Remove immutable: <code>sudo chattr -i testfile</code></p>
                <p class="required-command">Remove append-only: <code>sudo chattr -a audit.log</code></p>
                <p class="required-command">Verify: <code>lsattr testfile audit.log</code></p>

                <div class="concept">
                    <h4>Managing Attributes</h4>
                    <div class="concept-grid">
                        <div class="concept-item">
                            <strong>What</strong>
                            Adding/removing file attributes
                        </div>
                        <div class="concept-item">
                            <strong>Why</strong>
                            Temporarily change file protection
                        </div>
                        <div class="concept-item">
                            <strong>Where</strong>
                            On any file with attributes
                        </div>
                        <div class="concept-item">
                            <strong>When</strong>
                            When you need to modify protected files
                        </div>
                    </div>
                    <p><strong>How it works:</strong> Use <code>chattr -</code> to remove attributes. You can combine operations like <code>chattr -i+a file</code> to remove immutable and add append-only in one command.</p>
                    <div class="warning">
                        <strong>Warning:</strong> Some attributes (like 'c' for compression) cannot be removed after being set. Be certain before applying attributes.
                    </div>
                </div>
            </div>
        </div>
        <div class="command-line">
            <span class="prompt">[user@lab ~]$</span>
            <input autofocus="" id="command-input" placeholder="Type a command..." type="text"/>
        </div>
        <div class="terminal" id="terminal-output">
            <div>[user@lab ~]$ <span class="prompt">Welcome to RHCSA Lab 4.3: File Attributes!</span></div>
            <div>[user@lab ~]$ <span class="prompt">Type commands exactly as shown to proceed.</span></div>
            <div>[user@lab ~]$ <span class="prompt">Note: Some commands require sudo privileges.</span></div>
        </div>
    </div>
</div>
<script>
    const commandInput = document.getElementById('command-input');
    const terminalOutput = document.getElementById('terminal-output');
    const steps = document.querySelectorAll('.guide-step');
    let currentStep = 0;
    let commandHistory = [];
    let historyIndex = -1;

    const requiredCommands = [
        { command: 'lsattr /etc/passwd', step: 0, feedback: 'Type exactly: lsattr /etc/passwd' },
        { command: 'touch testfile', step: 1, feedback: 'Type exactly: touch testfile' },
        { command: 'sudo chattr +i testfile', step: 1, feedback: 'Type exactly: sudo chattr +i testfile' },
        { command: 'lsattr testfile', step: 1, feedback: 'Type exactly: lsattr testfile' },
        { command: 'touch audit.log', step: 2, feedback: 'Type exactly: touch audit.log' },
        { command: 'sudo chattr +a audit.log', step: 2, feedback: 'Type exactly: sudo chattr +a audit.log' },
        { command: 'lsattr audit.log', step: 2, feedback: 'Type exactly: lsattr audit.log' },
        { command: 'sudo chattr -i testfile', step: 3, feedback: 'Type exactly: sudo chattr -i testfile' },
        { command: 'sudo chattr -a audit.log', step: 3, feedback: 'Type exactly: sudo chattr -a audit.log' },
        { command: 'lsattr testfile audit.log', step: 3, feedback: 'Type exactly: lsattr testfile audit.log' }
    ];

    let completedCommands = new Array(requiredCommands.length).fill(false);

    const commands = {
        'lsattr': (args) => {
            if (args.length === 0) {
                return 'lsattr: No such file or directory while trying to stat .';
            }
            if (args[0] === '/etc/passwd') {
                return '-------------e-- /etc/passwd';
            }
            if (args.includes('testfile')) {
                if (completedCommands[3]) { // After +i was set
                    return '----i--------- testfile';
                } else if (completedCommands[8]) { // After -i was set
                    return '------------- testfile';
                }
                return '------------- testfile';
            }
            if (args.includes('audit.log')) {
                if (completedCommands[6]) { // After +a was set
                    return '-----a-------- audit.log';
                } else if (completedCommands[9]) { // After -a was set
                    return '------------- audit.log';
                }
                return '------------- audit.log';
            }
            if (args.includes('testfile') && args.includes('audit.log')) {
                let output = '';
                if (completedCommands[8]) { // After -i was set
                    output += '------------- testfile\n';
                } else if (completedCommands[3]) { // After +i was set
                    output += '----i--------- testfile\n';
                } else {
                    output += '------------- testfile\n';
                }
                
                if (completedCommands[9]) { // After -a was set
                    output += '------------- audit.log';
                } else if (completedCommands[6]) { // After +a was set
                    output += '-----a-------- audit.log';
                } else {
                    output += '------------- audit.log';
                }
                return output;
            }
            return `lsattr: No such file or directory while trying to stat ${args[0]}`;
        },
        'chattr': (args) => {
            if (args.includes('+i') && args.includes('testfile')) {
                return '';
            }
            if (args.includes('+a') && args.includes('audit.log')) {
                return '';
            }
            if (args.includes('-i') && args.includes('testfile')) {
                return '';
            }
            if (args.includes('-a') && args.includes('audit.log')) {
                return '';
            }
            return 'Usage: chattr [-RVf] [-+=aAcCdDeijPsStTu] [-v version] files...';
        },
        'sudo': (args) => {
            if (args[0] === 'chattr') {
                return commands.chattr(args.slice(1));
            }
            return 'sudo: only chattr commands are simulated in this lab';
        },
        'touch': (args) => {
            if (args.length === 0) {
                return 'touch: missing file operand';
            }
            return `Created file: ${args[0]}`;
        },
        'clear': () => {
            terminalOutput.innerHTML = '<div>[user@lab ~]$ <span class="prompt">Terminal cleared</span></div>';
            return '';
        },
        'help': () => 'Available commands: lsattr, chattr, sudo, touch, clear, help',
    };

    commandInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            const commandText = commandInput.value.trim();
            if (commandText) {
                commandHistory.push(commandText);
                historyIndex = commandHistory.length;
                processCommand(commandText);
            }
            commandInput.value = '';
        } else if (e.key === 'ArrowUp') {
            if (historyIndex > 0) {
                historyIndex--;
                commandInput.value = commandHistory[historyIndex];
            }
        } else if (e.key === 'ArrowDown') {
            if (historyIndex < commandHistory.length - 1) {
                historyIndex++;
                commandInput.value = commandHistory[historyIndex];
            } else {
                historyIndex = commandHistory.length;
                commandInput.value = '';
            }
        }
    });

    function processCommand(commandText) {
        const parts = commandText.trim().split(/\s+/);
        const cmd = parts[0];
        const args = parts.slice(1);

        let output;
        if (commands[cmd]) {
            output = commands[cmd](args);
            if (output) {
                terminalOutput.innerHTML += `<div>[user@lab ~]$ ${commandText}</div><div>${output}</div>`;
            } else {
                terminalOutput.innerHTML += `<div>[user@lab ~]$ ${commandText}</div>`;
            }
        } else {
            terminalOutput.innerHTML += `<div>[user@lab ~]$ ${commandText}</div><div class="error">Command not found: ${cmd}. Type 'help' for available commands.</div>`;
        }

        let commandMatched = false;
        requiredCommands.forEach((req, index) => {
            if (req.step === currentStep && req.command === commandText.trim()) {
                commandMatched = true;
                if (!completedCommands[index]) {
                    completedCommands[index] = true;
                    terminalOutput.innerHTML += `<div class="completion">‚úÖ Correct syntax! Command mastered: ${req.command}</div>`;
                }
            }
        });

        const currentStepCommands = requiredCommands.filter(req => req.step === currentStep);
        const isRequiredCommand = currentStepCommands.some(req => req.command.split(' ')[0] === cmd);

        if (isRequiredCommand && !commandMatched) {
            const reqCmd = currentStepCommands.find(req => req.command.split(' ')[0] === cmd);
            terminalOutput.innerHTML += `<div class="syntax-error">‚ö†Ô∏è Incorrect syntax: ${reqCmd.feedback}</div>`;
        }

        terminalOutput.scrollTop = terminalOutput.scrollHeight;
        checkStepCompletion();
    }

    function checkStepCompletion() {
        const currentStepCommands = requiredCommands.filter(req => req.step === currentStep);
        const allCompleted = currentStepCommands.every(req =>
            completedCommands[requiredCommands.findIndex(c => c.command === req.command)]
        );
        if (allCompleted) {
            setTimeout(() => {
                nextStep();
            }, 1000);
        }
    }

    function nextStep() {
        steps[currentStep].classList.remove('active-step');
        currentStep++;
        if (currentStep < steps.length) {
            steps[currentStep].classList.add('active-step');
            steps[currentStep].scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            terminalOutput.innerHTML += `<div class="success">Moving to next step...</div>`;
        } else {
            terminalOutput.innerHTML += `<div class="success">Lab completed! üèÜ All commands executed correctly!</div>`;
        }
    }
</script>
</body>
</html>