<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RedHat – Linux </title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/blockly/blockly.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
  <style>
    :root {
      --primary-color: #CC0000;
      --text-color: #2c3e50;
      --light-bg: #f8f9fa;
      --border-color: #eaecef;
    }

    html, body {
      height: 100%;
      margin: 0;
      overflow: hidden;
      background: linear-gradient(to bottom, var(--light-bg), #eef1f5);
      font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
      color: var(--text-color);
    }

    #app-container {
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    header {
      padding: 20px;
      background-color: white;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      z-index: 10;
      text-align: center;
      border-bottom: 1px solid rgba(204, 0, 0, 0.1);
    }

    h1 {
      margin: 0;
      font-weight: 700;
      color: var(--primary-color);
      font-size: 28px;
      letter-spacing: -0.5px;
      line-height: 1.2;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      position: relative;
      display: inline-block;
    }

    h1::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, var(--primary-color), #990000);
      border-radius: 2px;
    }

    .subtitle {
      font-size: 16px;
      color: #666;
      margin-top: 8px;
      font-weight: 400;
      letter-spacing: 0.5px;
    }

    #blockly-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    #blocklyDiv {
      height: calc(100% - 60px);
      width: 100%;
      overflow: hidden;
    }

    #buttons {
      padding: 10px 20px;
      display: flex;
      gap: 10px;
      background-color: white;
      border-bottom: 1px solid var(--border-color);
    }

    button {
      padding: 10px 16px;
      font-size: 14px;
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    button:hover {
      background-color: #990000;
      transform: translateY(-1px);
      box-shadow: 0 2px 5px rgba(204, 0, 0, 0.3);
    }

    button.danger {
      background-color: #d13438;
    }

    button.danger:hover {
      background-color: #b32d30;
    }

    .blocklyToolboxDiv {
      border-right: 1px solid var(--border-color) !important;
    }

    .blocklyMainBackground {
      stroke-width: 0;
    }

    .blocklyFlyoutBackground {
      fill: var(--light-bg);
    }

    .modal {
      position: fixed;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-content {
      background-color: white;
      padding: 30px;
      border-radius: 8px;
      width: 80%;
      max-width: 800px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .modal-title {
      margin: 0;
      color: var(--text-color);
      font-size: 20px;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #666;
    }

    .code-block {
      background-color: var(--light-bg);
      border: 1px solid var(--border-color);
      border-radius: 4px;
      padding: 15px;
      overflow-x: auto;
      font-family: Consolas, Monaco, "Andale Mono", monospace;
      font-size: 14px;
      line-height: 1.5;
      margin-bottom: 15px;
    }

    .notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #333;
      color: white;
      padding: 12px 20px;
      border-radius: 4px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
      transition: opacity 0.5s ease-in-out;
      opacity: 0;
      z-index: 1000;
    }

    .zoom-controls {
      position: absolute;
      bottom: 20px;
      right: 20px;
      background-color: white;
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      z-index: 50;
      display: flex;
      flex-direction: column;
    }

    .zoom-btn {
      padding: 8px 12px;
      background: none;
      border: none;
      cursor: pointer;
      color: var(--text-color);
    }

    .zoom-btn:hover {
      background-color: var(--light-bg);
    }

    .zoom-btn:first-child {
      border-bottom: 1px solid var(--border-color);
    }
  </style>
</head>
<body>
  <div id="app-container">
    <header>
      <h1>RedHat – Linux</h1>
      <div class="subtitle">BlockShell - The Visual Script Builder</div>
    </header>

    <div id="blockly-container">
      <div id="buttons">
        <button onclick="simulate()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9 10 4 15 9 20"></polyline>
            <path d="M20 4v7a4 4 0 0 1-4 4H4"></path>
          </svg>
          Show Script
        </button>
        <button onclick="download()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
          Download Script
        </button>
        <button class="danger" onclick="clearWorkspace()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 6h18"></path>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          </svg>
          Clear Workspace
        </button>
      </div>
      <div id="blocklyDiv"></div>
      <div class="zoom-controls">
        <button class="zoom-btn" id="zoom-in" title="Zoom in">+</button>
        <button class="zoom-btn" id="zoom-out" title="Zoom out">−</button>
      </div>
    </div>
  </div>

  <xml id="toolbox" style="display:none">
    <category name="User &amp; Group" colour="180">
      <block type="add_user">
        <tooltip>Create a new user with specified home directory and shell. Bash: useradd</tooltip>
      </block>
      <block type="add_group">
        <tooltip>Create a new group with optional GID and system group flag. Bash: groupadd</tooltip>
      </block>
      <block type="modify_user">
        <tooltip>Modify user properties including username and home directory. Bash: usermod</tooltip>
      </block>
      <block type="lock_account">
        <tooltip>Lock or unlock a user account. Bash: passwd -l/-u</tooltip>
      </block>
      <block type="set_password_policy">
        <tooltip>Configure password aging policy. Bash: chage</tooltip>
      </block>
      <block type="add_user_to_group">
        <tooltip>Add user to group with option to set as primary group. Bash: usermod</tooltip>
      </block>
      <block type="remove_user_from_group">
        <tooltip>Remove a user from a group. Bash: gpasswd</tooltip>
      </block>
      <block type="list_users">
        <tooltip>List users with filtering options. Bash: getent passwd</tooltip>
      </block>
      <block type="list_groups">
        <tooltip>List groups with filtering options. Bash: getent group</tooltip>
      </block>
    </category>

    <category name="File System &amp; Storage" colour="210">
      <block type="create_filesystem">
        <tooltip>Format a partition with a specific filesystem type. Bash: mkfs</tooltip>
      </block>
      <block type="mount_filesystem">
        <tooltip>Mount a filesystem and optionally add to /etc/fstab. Bash: mount</tooltip>
      </block>
      <block type="resize_filesystem">
        <tooltip>Grow or shrink an existing filesystem. Bash: resize2fs/xfs_growfs</tooltip>
      </block>
      <block type="list_block_devices">
        <tooltip>Show block device information. Bash: lsblk</tooltip>
      </block>
      <block type="parted_disk">
        <tooltip>Partition a disk with parted. Bash: parted</tooltip>
      </block>
      <block type="create_lvm">
        <tooltip>Create a physical volume and volume group. Bash: pvcreate/vgcreate</tooltip>
      </block>
      <block type="extend_lvm">
        <tooltip>Extend a volume group with a new physical volume. Bash: vgextend</tooltip>
      </block>
      <block type="create_symlink">
        <tooltip>Create a symbolic link. Bash: ln -s</tooltip>
      </block>
      <block type="analyze_disk">
        <tooltip>Analyze disk usage with specified depth. Bash: du</tooltip>
      </block>
      <block type="backup_files">
        <tooltip>Backup files using various methods. Bash: rsync/tar/dd</tooltip>
      </block>
    </category>

    <category name="Package Management" colour="160">
      <block type="install_package">
        <tooltip>Install a package with optional version. Bash: dnf install</tooltip>
      </block>
      <block type="remove_package">
        <tooltip>Remove a package. Bash: dnf remove</tooltip>
      </block>
      <block type="update_system">
        <tooltip>Update or upgrade packages. Bash: dnf upgrade</tooltip>
      </block>
      <block type="search_package">
        <tooltip>Search for a package in repositories. Bash: dnf search</tooltip>
      </block>
      <block type="add_repository">
        <tooltip>Add a repository via .repo or subscription-manager. Bash: dnf config-manager</tooltip>
      </block>
      <block type="list_installed">
        <tooltip>List installed or upgradable packages. Bash: dnf list</tooltip>
      </block>
      <block type="clean_packages">
        <tooltip>Clean package metadata or old kernels. Bash: dnf clean</tooltip>
      </block>
      <block type="hold_package">
        <tooltip>Prevent or allow package upgrades. Bash: dnf versionlock</tooltip>
      </block>
    </category>

    <category name="Services &amp; Processes" colour="230">
      <block type="service_action">
        <tooltip>Manage systemd services. Bash: systemctl</tooltip>
      </block>
      <block type="create_service">
        <tooltip>Create a new systemd service unit. Bash: systemd unit file</tooltip>
      </block>
      <block type="schedule_task">
        <tooltip>Schedule a cron job. Bash: crontab</tooltip>
      </block>
      <block type="check_resources">
        <tooltip>Check system resource usage. Bash: mpstat/free/df</tooltip>
      </block>
      <block type="monitor_processes">
        <tooltip>Monitor running processes. Bash: ps</tooltip>
      </block>
      <block type="kill_process">
        <tooltip>Send signal to a process. Bash: kill</tooltip>
      </block>
    </category>

    <category name="Networking &amp; Firewall" colour="290">
      <block type="configure_network">
        <tooltip>Configure a network interface using nmcli. Bash: nmcli</tooltip>
      </block>
      <block type="configure_firewall">
        <tooltip>Manage firewall rules with firewall-cmd. Bash: firewall-cmd</tooltip>
      </block>
      <block type="list_network_interfaces">
        <tooltip>Show all network interfaces. Bash: ip</tooltip>
      </block>
      <block type="test_connectivity">
        <tooltip>Ping a host to test connectivity. Bash: ping</tooltip>
      </block>
    </category>

    <category name="SELinux" colour="130">
      <block type="set_selinux_mode">
        <tooltip>Change the SELinux runtime mode. Bash: setenforce</tooltip>
      </block>
      <block type="manage_fcontext">
        <tooltip>Manage SELinux file context entries. Bash: semanage</tooltip>
      </block>
      <block type="restore_con">
        <tooltip>Restore SELinux file contexts. Bash: restorecon</tooltip>
      </block>
      <block type="view_selinux_status">
        <tooltip>Check current SELinux status. Bash: getenforce</tooltip>
      </block>
    </category>

    <category name="Security &amp; SSH" colour="290">
      <block type="configure_sshd">
        <tooltip>Modify SSHD configuration. Bash: sshd_config</tooltip>
      </block>
      <block type="enable_2fa">
        <tooltip>Enable two-factor authentication. Bash: Google Authenticator/Duo</tooltip>
      </block>
      <block type="set_sudoers">
        <tooltip>Configure sudo permissions. Bash: visudo</tooltip>
      </block>
      <block type="audit_system">
        <tooltip>Run a basic or full audit. Bash: ausearch</tooltip>
      </block>
    </category>

    <category name="System Info" colour="65">
      <block type="system_info">
        <tooltip>Retrieve system information. Bash: uname/hostnamectl</tooltip>
      </block>
    </category>
  </xml>

  <script>
    // Declare workspace variable at the top level
    let workspace;

    document.addEventListener('DOMContentLoaded', function () {
      // Initialize Blockly workspace
      workspace = Blockly.inject('blocklyDiv', {
        toolbox: document.getElementById('toolbox'),
        scrollbars: true,
        trashcan: true,
        grid: {
          spacing: 25,
          length: 3,
          colour: '#e0e0e0',
          snap: true
        },
        zoom: {
          controls: true,
          wheel: true,
          startScale: 1.0,
          maxScale: 3,
          minScale: 0.3,
          scaleSpeed: 1.2
        },
        theme: {
          'blockStyles': {
            'colour_blocks': { 'colourPrimary': '#CC0000', 'colourSecondary': '#990000', 'colourTertiary': '#660000' },
            'list_blocks': { 'colourPrimary': '#9966FF', 'colourSecondary': '#855CD6', 'colourTertiary': '#774DCB' },
            'logic_blocks': { 'colourPrimary': '#4C97FF', 'colourSecondary': '#4280D7', 'colourTertiary': '#3373CC' },
            'loop_blocks': { 'colourPrimary': '#0fBD8C', 'colourSecondary': '#0DA57A', 'colourTertiary': '#0B8E69' },
            'math_blocks': { 'colourPrimary': '#59C059', 'colourSecondary': '#46B946', 'colourTertiary': '#389438' },
            'procedure_blocks': { 'colourPrimary': '#FF6680', 'colourSecondary': '#FF4D6A', 'colourTertiary': '#FF3355' },
            'text_blocks': { 'colourPrimary': '#FFBF00', 'colourSecondary': '#E6AC00', 'colourTertiary': '#CC9900' },
            'variable_blocks': { 'colourPrimary': '#FF8C1A', 'colourSecondary': '#FF8000', 'colourTertiary': '#DB6E00' },
            'variable_dynamic_blocks': { 'colourPrimary': '#FF8C1A', 'colourSecondary': '#FF8000', 'colourTertiary': '#DB6E00' }
          },
          'componentStyles': {
            'workspaceBackgroundColour': '#F9FAFB',
            'toolboxBackgroundColour': '#FFFFFF',
            'toolboxForegroundColour': '#1E293B',
            'flyoutBackgroundColour': '#F1F5F9',
            'flyoutForegroundColour': '#1E293B',
            'flyoutOpacity': 0.9,
            'scrollbarColour': '#CCCCCC',
            'scrollbarOpacity': 0.6
          }
        }
      });

      // Define all blocks with enhanced tooltips
      Blockly.defineBlocksWithJsonArray([
        {
          "type": "add_user",
          "message0": "Add User %1 Home: %2 Shell: %3",
          "args0": [
            { "type": "field_input", "name": "USERNAME", "text": "newuser" },
            { "type": "field_input", "name": "HOME", "text": "/home/newuser" },
            {
              "type": "field_dropdown",
              "name": "SHELL",
              "options": [
                ["/bin/bash", "/bin/bash"],
                ["/bin/sh", "/bin/sh"],
                ["/bin/zsh", "/bin/zsh"],
                ["/sbin/nologin", "/sbin/nologin"]
              ]
            }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 180,
          "tooltip": "Create a new user with specified home directory and shell.\n\nBash: useradd -m -d \"path\" -s \"shell\" username",
          "helpUrl": ""
        },
        {
          "type": "add_group",
          "message0": "Add Group %1 GID: %2 System Group: %3",
          "args0": [
            { "type": "field_input", "name": "GROUP", "text": "newgroup" },
            { "type": "field_number", "name": "GID", "value": 1001 },
            { "type": "field_checkbox", "name": "SYSTEM", "checked": false }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 180,
          "tooltip": "Create a new group with optional GID and system group flag.\n\nBash: groupadd -g GID -r groupname",
          "helpUrl": ""
        },
        {
          "type": "modify_user",
          "message0": "Modify User %1 New Name: %2 Move Home: %3",
          "args0": [
            { "type": "field_input", "name": "USERNAME", "text": "user" },
            { "type": "field_input", "name": "NEWNAME", "text": "newname" },
            { "type": "field_checkbox", "name": "MOVEHOME", "checked": false }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 180,
          "tooltip": "Modify user properties including username and home directory.\n\nBash: usermod -l newname -m username",
          "helpUrl": ""
        },
        {
          "type": "lock_account",
          "message0": "Lock/Unlock Account %1 Action: %2",
          "args0": [
            { "type": "field_input", "name": "USERNAME", "text": "user" },
            {
              "type": "field_dropdown",
              "name": "ACTION",
              "options": [
                ["Lock", "LOCK"],
                ["Unlock", "UNLOCK"]
              ]
            }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 180,
          "tooltip": "Lock or unlock a user account.\n\nBash: passwd -l/-u username",
          "helpUrl": ""
        },
        {
          "type": "set_password_policy",
          "message0": "Set Password Policy Min: %1 Max: %2 Warn: %3",
          "args0": [
            { "type": "field_number", "name": "MIN", "value": 7 },
            { "type": "field_number", "name": "MAX", "value": 90 },
            { "type": "field_number", "name": "WARN", "value": 7 }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 180,
          "tooltip": "Configure password aging policy.\n\nBash: chage -m min -M max -W warn username",
          "helpUrl": ""
        },
        {
          "type": "add_user_to_group",
          "message0": "Add User %1 to Group %2 Primary: %3",
          "args0": [
            { "type": "field_input", "name": "USERNAME", "text": "user" },
            { "type": "field_input", "name": "GROUP", "text": "group" },
            { "type": "field_checkbox", "name": "PRIMARY", "checked": false }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 180,
          "tooltip": "Add user to group with option to set as primary group.\n\nBash: usermod -g/-aG group username",
          "helpUrl": ""
        },
        {
          "type": "remove_user_from_group",
          "message0": "Remove User %1 from Group %2",
          "args0": [
            { "type": "field_input", "name": "USERNAME", "text": "user" },
            { "type": "field_input", "name": "GROUP", "text": "group" }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 180,
          "tooltip": "Remove a user from a group.\n\nBash: gpasswd -d username group",
          "helpUrl": ""
        },
        {
          "type": "list_users",
          "message0": "List Users Filter: %1",
          "args0": [
            {
              "type": "field_dropdown",
              "name": "FILTER",
              "options": [
                ["All", "ALL"],
                ["System", "SYSTEM"],
                ["Regular", "REGULAR"]
              ]
            }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 180,
          "tooltip": "List users with filtering options.\n\nBash: getent passwd with filters",
          "helpUrl": ""
        },
        {
          "type": "list_groups",
          "message0": "List Groups Filter: %1",
          "args0": [
            {
              "type": "field_dropdown",
              "name": "FILTER",
              "options": [
                ["All", "ALL"],
                ["System", "SYSTEM"],
                ["Regular", "REGULAR"]
              ]
            }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 180,
          "tooltip": "List groups with filtering options.\n\nBash: getent group with filters",
          "helpUrl": ""
        },
        {
          "type": "create_filesystem",
          "message0": "Create Filesystem on %1 Type: %2 Label: %3",
          "args0": [
            { "type": "field_input", "name": "DEVICE", "text": "/dev/sdb1" },
            {
              "type": "field_dropdown",
              "name": "FSTYPE",
              "options": [
                ["ext4", "ext4"],
                ["xfs", "xfs"],
                ["vfat", "vfat"]
              ]
            },
            { "type": "field_input", "name": "LABEL", "text": "DATA" }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 210,
          "tooltip": "Format a partition with a specific filesystem type.\n\nBash: mkfs -t type -L label device",
          "helpUrl": ""
        },
        {
          "type": "mount_filesystem",
          "message0": "Mount %1 To: %2 Type: %3 Options: %4 Persist: %5",
          "args0": [
            { "type": "field_input", "name": "DEVICE", "text": "/dev/sdb1" },
            { "type": "field_input", "name": "MOUNTPOINT", "text": "/mnt/data" },
            { "type": "field_input", "name": "FSTYPE", "text": "ext4" },
            { "type": "field_input", "name": "OPTIONS", "text": "defaults" },
            { "type": "field_checkbox", "name": "PERSIST", "checked": false }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 210,
          "tooltip": "Mount a filesystem and optionally add to /etc/fstab.\n\nBash: mount -t type -o options device mountpoint",
          "helpUrl": ""
        },
        {
          "type": "resize_filesystem",
          "message0": "Resize Filesystem %1 Type: %2",
          "args0": [
            { "type": "field_input", "name": "MOUNTPOINT", "text": "/mnt/data" },
            {
              "type": "field_dropdown",
              "name": "FSTYPE",
              "options": [
                ["ext4", "ext4"],
                ["xfs", "xfs"]
              ]
            }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 210,
          "tooltip": "Grow or shrink an existing filesystem.\n\nBash: resize2fs (ext4) or xfs_growfs (xfs)",
          "helpUrl": ""
        },
        {
          "type": "list_block_devices",
          "message0": "List Block Devices",
          "previousStatement": null,
          "nextStatement": null,
          "colour": 210,
          "tooltip": "Show block device information.\n\nBash: lsblk -f",
          "helpUrl": ""
        },
        {
          "type": "parted_disk",
          "message0": "Partition Disk %1 Use: %2",
          "args0": [
            { "type": "field_input", "name": "DEVICE", "text": "/dev/sdb" },
            {
              "type": "field_dropdown",
              "name": "USAGE",
              "options": [
                ["Linux filesystem", "primary"],
                ["LVM", "lvm"],
                ["EFI System", "esp"]
              ]
            }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 210,
          "tooltip": "Partition a disk with parted.\n\nBash: parted -s device mklabel gpt mkpart primary type 1MiB 100%",
          "helpUrl": ""
        },
        {
          "type": "create_lvm",
          "message0": "Create LVM PV: %1 VG: %2 PVs: %3",
          "args0": [
            { "type": "field_input", "name": "PV", "text": "/dev/sdc1" },
            { "type": "field_input", "name": "VG", "text": "vg_data" },
            { "type": "field_input", "name": "PVS", "text": "/dev/sdd1,/dev/sde1" }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 210,
          "tooltip": "Create a physical volume and volume group.\n\nBash: pvcreate device; vgcreate vgname devices",
          "helpUrl": ""
        },
        {
          "type": "extend_lvm",
          "message0": "Extend VG: %1 Add PV: %2",
          "args0": [
            { "type": "field_input", "name": "VG", "text": "vg_data" },
            { "type": "field_input", "name": "NEWPV", "text": "/dev/sdf1" }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 210,
          "tooltip": "Extend a volume group with a new physical volume.\n\nBash: pvcreate device; vgextend vgname device",
          "helpUrl": ""
        },
        {
          "type": "create_symlink",
          "message0": "Create Symlink %1 Target: %2",
          "args0": [
            { "type": "field_input", "name": "SYMLINK", "text": "/path/to/link" },
            { "type": "field_input", "name": "TARGET", "text": "/target/path" }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 210,
          "tooltip": "Create a symbolic link.\n\nBash: ln -s target link",
          "helpUrl": ""
        },
        {
          "type": "analyze_disk",
          "message0": "Analyze Disk Usage Path: %1 Depth: %2",
          "args0": [
            { "type": "field_input", "name": "PATH", "text": "/" },
            { "type": "field_number", "name": "DEPTH", "value": 1 }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 210,
          "tooltip": "Analyze disk usage with specified depth.\n\nBash: du -h --max-depth=N path",
          "helpUrl": ""
        },
        {
          "type": "backup_files",
          "message0": "Backup %1 To: %2 Method: %3",
          "args0": [
            { "type": "field_input", "name": "SOURCE", "text": "/important/data" },
            { "type": "field_input", "name": "DEST", "text": "/backup/location" },
            {
              "type": "field_dropdown",
              "name": "METHOD",
              "options": [
                ["rsync", "rsync"],
                ["tar", "tar"],
                ["dd", "dd"]
              ]
            }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 210,
          "tooltip": "Backup files using various methods.\n\nBash: rsync/tar/dd commands",
          "helpUrl": ""
        },
        {
          "type": "install_package",
          "message0": "Install Package %1 Version: %2",
          "args0": [
            { "type": "field_input", "name": "PACKAGE", "text": "package" },
            { "type": "field_input", "name": "VERSION", "text": "" }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 160,
          "tooltip": "Install a package with optional version.\n\nBash: dnf install package-version",
          "helpUrl": ""
        },
        {
          "type": "remove_package",
          "message0": "Remove Package %1",
          "args0": [
            { "type": "field_input", "name": "PACKAGE", "text": "package" }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 160,
          "tooltip": "Remove a package.\n\nBash: dnf remove package",
          "helpUrl": ""
        },
        {
          "type": "update_system",
          "message0": "Update System Type: %1",
          "args0": [
            {
              "type": "field_dropdown",
              "name": "TYPE",
              "options": [
                ["Refresh repos", "REFRESH"],
                ["Upgrade all packages", "UPGRADE"],
                ["Kernel update", "KERNEL"]
              ]
            }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 160,
          "tooltip": "Update or upgrade packages.\n\nBash: dnf upgrade/makecache/install kernel",
          "helpUrl": ""
        },
        {
          "type": "search_package",
          "message0": "Search Package %1",
          "args0": [
            { "type": "field_input", "name": "PACKAGE", "text": "package" }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 160,
          "tooltip": "Search for a package in repositories.\n\nBash: dnf search package",
          "helpUrl": ""
        },
        {
          "type": "add_repository",
          "message0": "Add Repo %1 URL: %2 GPG Key: %3",
          "args0": [
            {
              "type": "field_dropdown",
              "name": "REPOTYPE",
              "options": [
                ["Custom .repo file", "FILE"],
                ["Use subscription-manager", "SUB"]
              ]
            },
            { "type": "field_input", "name": "URL", "text": "" },
            { "type": "field_input", "name": "GPG", "text": "" }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 160,
          "tooltip": "Add a repository via .repo or subscription-manager.\n\nBash: dnf config-manager --add-repo URL or subscription-manager repos --enable",
          "helpUrl": ""
        },
        {
          "type": "list_installed",
          "message0": "List Installed Packages Filter: %1",
          "args0": [
            {
              "type": "field_dropdown",
              "name": "FILTER",
              "options": [
                ["All", "ALL"],
                ["Upgradable", "UPGRADABLE"],
                ["Installed from Repo", "REPO"]
              ]
            }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 160,
          "tooltip": "List installed or upgradable packages.\n\nBash: dnf list installed/check-update/repoquery",
          "helpUrl": ""
        },
        {
          "type": "clean_packages",
          "message0": "Clean Packages Type: %1",
          "args0": [
            {
              "type": "field_dropdown",
              "name": "TYPE",
              "options": [
                ["Metadata", "METADATA"],
                ["Old kernels", "KERNELS"],
                ["Dependency cache", "CACHE"]
              ]
            }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 160,
          "tooltip": "Clean package metadata or old kernels.\n\nBash: dnf clean metadata/all or remove old kernels",
          "helpUrl": ""
        },
        {
          "type": "hold_package",
          "message0": "Hold/Unhold Package %1 Action: %2",
          "args0": [
            { "type": "field_input", "name": "PACKAGE", "text": "package" },
            {
              "type": "field_dropdown",
              "name": "ACTION",
              "options": [
                ["Hold", "HOLD"],
                ["Unhold", "UNHOLD"]
              ]
            }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 160,
          "tooltip": "Prevent or allow package upgrades.\n\nBash: dnf versionlock add/delete package",
          "helpUrl": ""
        },
        {
          "type": "service_action",
          "message0": "Service %1 Action: %2",
          "args0": [
            { "type": "field_input", "name": "SERVICE", "text": "httpd" },
            {
              "type": "field_dropdown",
              "name": "ACTION",
              "options": [
                ["Start", "start"],
                ["Stop", "stop"],
                ["Restart", "restart"],
                ["Reload", "reload"],
                ["Enable", "enable"],
                ["Disable", "disable"],
                ["Status", "status"]
              ]
            }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 230,
          "tooltip": "Manage systemd services.\n\nBash: systemctl action service",
          "helpUrl": ""
        },
        {
          "type": "create_service",
          "message0": "Create Service %1 Exec: %2 User: %3",
          "args0": [
            { "type": "field_input", "name": "NAME", "text": "myservice" },
            { "type": "field_input", "name": "EXEC", "text": "/usr/bin/myservice" },
            { "type": "field_input", "name": "USER", "text": "root" }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 230,
          "tooltip": "Create a new systemd service unit.\n\nBash: Create /etc/systemd/system/name.service file",
          "helpUrl": ""
        },
        {
          "type": "schedule_task",
          "message0": "Schedule Task %1 Command: %2 Schedule: %3",
          "args0": [
            { "type": "field_input", "name": "NAME", "text": "mytask" },
            { "type": "field_input", "name": "COMMAND", "text": "/path/to/script.sh" },
            { "type": "field_input", "name": "SCHEDULE", "text": "0 2 * * *" }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 230,
          "tooltip": "Schedule a cron job.\n\nBash: crontab -e with schedule command",
          "helpUrl": ""
        },
        {
          "type": "check_resources",
          "message0": "Check Resources Type: %1",
          "args0": [
            {
              "type": "field_dropdown",
              "name": "TYPE",
              "options": [
                ["CPU", "cpu"],
                ["Memory", "memory"],
                ["Disk", "disk"],
                ["All", "all"]
              ]
            }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 230,
          "tooltip": "Check system resource usage.\n\nBash: mpstat/free/df commands",
          "helpUrl": ""
        },
        {
          "type": "monitor_processes",
          "message0": "Monitor Processes Filter: %1",
          "args0": [
            { "type": "field_input", "name": "FILTER", "text": "" }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 230,
          "tooltip": "Monitor running processes.\n\nBash: ps aux with optional filter",
          "helpUrl": ""
        },
        {
          "type": "kill_process",
          "message0": "Kill Process %1 Signal: %2",
          "args0": [
            { "type": "field_input", "name": "PID", "text": "1234" },
            {
              "type": "field_dropdown",
              "name": "SIGNAL",
              "options": [
                ["TERM (15)", "15"],
                ["KILL (9)", "9"],
                ["HUP (1)", "1"],
                ["INT (2)", "2"]
              ]
            }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 230,
          "tooltip": "Send signal to a process.\n\nBash: kill -signal pid",
          "helpUrl": ""
        },
        {
          "type": "configure_network",
          "message0": "Configure Interface %1 IP: %2 Prefix: %3 Gateway: %4",
          "args0": [
            { "type": "field_input", "name": "IFACE", "text": "eth0" },
            { "type": "field_input", "name": "IP", "text": "192.168.1.100" },
            { "type": "field_number", "name": "PREFIX", "value": 24 },
            { "type": "field_input", "name": "GATEWAY", "text": "192.168.1.1" }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 290,
          "tooltip": "Configure a network interface using nmcli.\n\nBash: nmcli connection modify iface ipv4.addresses ip/prefix ipv4.gateway gateway",
          "helpUrl": ""
        },
        {
          "type": "configure_firewall",
          "message0": "Firewall Action: %1 Port: %2 Protocol: %3",
          "args0": [
            {
              "type": "field_dropdown",
              "name": "ACTION",
              "options": [
                ["Add", "add"],
                ["Remove", "remove"],
                ["Reload", "reload"]
              ]
            },
            { "type": "field_input", "name": "PORT", "text": "80" },
            {
              "type": "field_dropdown",
              "name": "PROTO",
              "options": [
                ["tcp", "tcp"],
                ["udp", "udp"]
              ]
            }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 290,
          "tooltip": "Manage firewall rules with firewall-cmd.\n\nBash: firewall-cmd --permanent --add-port=port/proto",
          "helpUrl": ""
        },
        {
          "type": "list_network_interfaces",
          "message0": "List Network Interfaces",
          "previousStatement": null,
          "nextStatement": null,
          "colour": 290,
          "tooltip": "Show all network interfaces.\n\nBash: ip -br addr show",
          "helpUrl": ""
        },
        {
          "type": "test_connectivity",
          "message0": "Test Connectivity to %1 Count: %2",
          "args0": [
            { "type": "field_input", "name": "TARGET", "text": "8.8.8.8" },
            { "type": "field_number", "name": "COUNT", "value": 4 }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 290,
          "tooltip": "Ping a host to test connectivity.\n\nBash: ping -c count target",
          "helpUrl": ""
        },
        {
          "type": "set_selinux_mode",
          "message0": "Set SELinux Mode: %1",
          "args0": [
            {
              "type": "field_dropdown",
              "name": "MODE",
              "options": [
                ["enforcing", "enforcing"],
                ["permissive", "permissive"],
                ["disabled", "disabled"]
              ]
            }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 130,
          "tooltip": "Change the SELinux runtime mode.\n\nBash: setenforce mode and modify /etc/selinux/config",
          "helpUrl": ""
        },
        {
          "type": "manage_fcontext",
          "message0": "Manage File Context %1 Path: %2 Context: %3",
          "args0": [
            {
              "type": "field_dropdown",
              "name": "ACTION",
              "options": [
                ["Add", "add"],
                ["Remove", "remove"]
              ]
            },
            { "type": "field_input", "name": "PATH", "text": "/var/www/html" },
            { "type": "field_input", "name": "CONTEXT", "text": "httpd_sys_content_t" }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 130,
          "tooltip": "Manage SELinux file context entries.\n\nBash: semanage fcontext -a/-d -t context path",
          "helpUrl": ""
        },
        {
          "type": "restore_con",
          "message0": "Restore Context on %1 Recursive: %2",
          "args0": [
            { "type": "field_input", "name": "PATH", "text": "/var/www/html" },
            { "type": "field_checkbox", "name": "RECURSIVE", "checked": true }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 130,
          "tooltip": "Restore SELinux file contexts.\n\nBash: restorecon -R path",
          "helpUrl": ""
        },
        {
          "type": "view_selinux_status",
          "message0": "View SELinux Status",
          "previousStatement": null,
          "nextStatement": null,
          "colour": 130,
          "tooltip": "Check current SELinux status.\n\nBash: getenforce && sestatus",
          "helpUrl": ""
        },
        {
          "type": "configure_sshd",
          "message0": "Configure SSHD %1 Value: %2",
          "args0": [
            {
              "type": "field_dropdown",
              "name": "OPTION",
              "options": [
                ["Port", "Port"],
                ["PermitRootLogin", "PermitRootLogin"],
                ["PasswordAuthentication", "PasswordAuthentication"]
              ]
            },
            { "type": "field_input", "name": "VALUE", "text": "yes" }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 290,
          "tooltip": "Modify SSHD configuration.\n\nBash: Edit /etc/ssh/sshd_config and restart sshd",
          "helpUrl": ""
        },
        {
          "type": "enable_2fa",
          "message0": "Enable 2FA for User %1 Method: %2",
          "args0": [
            { "type": "field_input", "name": "USER", "text": "user" },
            {
              "type": "field_dropdown",
              "name": "METHOD",
              "options": [
                ["Google Authenticator", "google"],
                ["Duo", "duo"]
              ]
            }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 290,
          "tooltip": "Enable two-factor authentication.\n\nBash: Install and configure Google Authenticator or Duo",
          "helpUrl": ""
        },
        {
          "type": "set_sudoers",
          "message0": "Set Sudoers %1 User: %2 Commands: %3",
          "args0": [
            {
              "type": "field_dropdown",
              "name": "ACTION",
              "options": [
                ["Add", "add"],
                ["Remove", "remove"]
              ]
            },
            { "type": "field_input", "name": "USER", "text": "user" },
            { "type": "field_input", "name": "COMMANDS", "text": "ALL" }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 290,
          "tooltip": "Configure sudo permissions.\n\nBash: Add/remove entry in /etc/sudoers.d/",
          "helpUrl": ""
        },
        {
          "type": "audit_system",
          "message0": "Audit System Type: %1",
          "args0": [
            {
              "type": "field_dropdown",
              "name": "TYPE",
              "options": [
                ["Basic", "basic"],
                ["Security", "security"],
                ["All", "all"]
              ]
            }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 290,
          "tooltip": "Run a basic or full audit.\n\nBash: ausearch/aureport commands",
          "helpUrl": ""
        },
        {
          "type": "system_info",
          "message0": "Get System Info Type: %1",
          "args0": [
            {
              "type": "field_dropdown",
              "name": "TYPE",
              "options": [
                ["OS Release", "os"],
                ["Kernel", "kernel"],
                ["Hostname", "hostname"],
                ["Uptime", "uptime"],
                ["All", "all"]
              ]
            }
          ],
          "previousStatement": null,
          "nextStatement": null,
          "colour": 65,
          "tooltip": "Retrieve system information.\n\nBash: uname/hostnamectl/uptime commands",
          "helpUrl": ""
        }
      ]);

      // Setup event listeners
      document.getElementById('zoom-in').addEventListener('click', function() {
        workspace.zoomCenter(1.2);
      });

      document.getElementById('zoom-out').addEventListener('click', function() {
        workspace.zoomCenter(0.8);
      });

      window.clearWorkspace = function() {
        if (confirm('Are you sure you want to clear the workspace? All blocks will be deleted.')) {
          workspace.clear();
          showNotification('Workspace cleared');
        }
      };

      function generateBashCode() {
        const blocks = workspace.getTopBlocks(true);
        let code = "#!/bin/bash\n\n# Generated by BlockShell RHCSA Tool\n# Date: " + new Date().toISOString() + "\n# Set strict mode for better error handling\nset -euo pipefail\n\n";
        
        // Generate code from blocks
        for (const block of blocks) {
          code += generateBlockCodeRecursive(block);
        }
        
        return code.trim();
      }

      function generateBlockCodeRecursive(block) {
        if (!block) return "";
        let code = "";

        switch (block.type) {
          case "add_user":
            code += `# Create user\nsudo useradd -m -d "${block.getFieldValue('HOME')}" -s "${block.getFieldValue('SHELL')}" "${block.getFieldValue('USERNAME')}"\n`;
            break;
          case "add_group":
            const gidOpt = block.getFieldValue('GID') ? `-g ${block.getFieldValue('GID')}` : "";
            const sysOpt = block.getFieldValue('SYSTEM') === 'TRUE' ? "-r" : "";
            code += `# Create group\nsudo groupadd ${sysOpt} ${gidOpt} "${block.getFieldValue('GROUP')}"\n`;
            break;
          case "modify_user":
            const moveOpt = block.getFieldValue('MOVEHOME') === 'TRUE' ? "-m" : "";
            code += `# Modify user\nsudo usermod -l "${block.getFieldValue('NEWNAME')}" ${moveOpt} "${block.getFieldValue('USERNAME')}"\n`;
            break;
          case "lock_account":
            const lockCmd = block.getFieldValue('ACTION') === 'LOCK' ? "-L" : "-U";
            code += `# ${block.getFieldValue('ACTION')} account\nsudo passwd ${lockCmd} "${block.getFieldValue('USERNAME')}"\n`;
            break;
          case "set_password_policy":
            code += `# Set password policy\nsudo chage -m ${block.getFieldValue('MIN')} -M ${block.getFieldValue('MAX')} -W ${block.getFieldValue('WARN')} "${block.getFieldValue('USERNAME')}"\n`;
            break;
          case "add_user_to_group":
            const primOpt = block.getFieldValue('PRIMARY') === 'TRUE' ? "-g" : "-aG";
            code += `# Add user to group\nsudo usermod ${primOpt} "${block.getFieldValue('GROUP')}" "${block.getFieldValue('USERNAME')}"\n`;
            break;
          case "remove_user_from_group":
            code += `# Remove user from group\nsudo gpasswd -d "${block.getFieldValue('USERNAME')}" "${block.getFieldValue('GROUP')}"\n`;
            break;
          case "list_users":
            let listUsersCmd = "getent passwd";
            if (block.getFieldValue('FILTER') === 'SYSTEM') {
              listUsersCmd += " | awk -F: '$3 < 1000 {print $1}'";
            } else if (block.getFieldValue('FILTER') === 'REGULAR') {
              listUsersCmd += " | awk -F: '$3 >= 1000 {print $1}'";
            }
            code += `# List users\n${listUsersCmd}\n`;
            break;
          case "list_groups":
            let listGroupsCmd = "getent group";
            if (block.getFieldValue('FILTER') === 'SYSTEM') {
              listGroupsCmd += " | awk -F: '$3 < 1000 {print $1}'";
            } else if (block.getFieldValue('FILTER') === 'REGULAR') {
              listGroupsCmd += " | awk -F: '$3 >= 1000 {print $1}'";
            }
            code += `# List groups\n${listGroupsCmd}\n`;
            break;
          case "create_filesystem":
            code += `# Create filesystem\nsudo mkfs -t ${block.getFieldValue('FSTYPE')} -L "${block.getFieldValue('LABEL')}" "${block.getFieldValue('DEVICE')}"\n`;
            break;
          case "mount_filesystem":
            const persistOpt = block.getFieldValue('PERSIST') === 'TRUE';
            code += `# Mount filesystem\nsudo mkdir -p "${block.getFieldValue('MOUNTPOINT')}"\n`;
            code += `sudo mount -t ${block.getFieldValue('FSTYPE')} -o ${block.getFieldValue('OPTIONS')} "${block.getFieldValue('DEVICE')}" "${block.getFieldValue('MOUNTPOINT')}"\n`;
            if (persistOpt) {
              code += `# Make mount permanent\necho "${block.getFieldValue('DEVICE')}   ${block.getFieldValue('MOUNTPOINT')}   ${block.getFieldValue('FSTYPE')}   ${block.getFieldValue('OPTIONS')}   0 0" | sudo tee -a /etc/fstab\n`;
            }
            break;
          case "resize_filesystem":
            if (block.getFieldValue('FSTYPE') === 'xfs') {
              code += `# Resize XFS filesystem\nsudo xfs_growfs "${block.getFieldValue('MOUNTPOINT')}"\n`;
            } else {
              code += `# Resize ext4 filesystem\nsudo resize2fs "${block.getFieldValue('MOUNTPOINT')}"\n`;
            }
            break;
          case "list_block_devices":
            code += `# List block devices\nlsblk -f\n`;
            break;
          case "parted_disk":
            code += `# Partition disk with parted\nsudo parted -s "${block.getFieldValue('DEVICE')}" mklabel gpt mkpart primary ${block.getFieldValue('USAGE')} 1MiB 100%\n`;
            break;
          case "create_lvm":
            const pvs = block.getFieldValue('PVS').split(',').map(p => p.trim()).join(' ');
            code += `# Create LVM PV and VG\nsudo pvcreate "${block.getFieldValue('PV')}"\n`;
            for (const extra of pvs.split(' ')) {
              code += `sudo pvcreate "${extra}"\n`;
            }
            code += `sudo vgcreate "${block.getFieldValue('VG')}" "${block.getFieldValue('PV')}" ${pvs}\n`;
            break;
          case "extend_lvm":
            code += `# Extend VG with new PV\nsudo pvcreate "${block.getFieldValue('NEWPV')}"\n`;
            code += `sudo vgextend "${block.getFieldValue('VG')}" "${block.getFieldValue('NEWPV')}"\n`;
            break;
          case "create_symlink":
            code += `# Create symlink\nsudo ln -s "${block.getFieldValue('TARGET')}" "${block.getFieldValue('SYMLINK')}"\n`;
            break;
          case "analyze_disk":
            code += `# Analyze disk usage\ndu -h --max-depth=${block.getFieldValue('DEPTH')} "${block.getFieldValue('PATH')}" | sort -h\n`;
            break;
          case "backup_files":
            let backupCmd;
            switch (block.getFieldValue('METHOD')) {
              case 'rsync':
                backupCmd = `rsync -a --delete "${block.getFieldValue('SOURCE')}" "${block.getFieldValue('DEST')}"`;
                break;
              case 'tar':
                backupCmd = `tar -cvzf "${block.getFieldValue('DEST')}/backup-$(date +%F).tar.gz" "${block.getFieldValue('SOURCE')}"`;
                break;
              case 'dd':
                backupCmd = `dd if="${block.getFieldValue('SOURCE')}" of="${block.getFieldValue('DEST')}/backup.img" bs=4M status=progress`;
                break;
            }
            code += `# Backup files\n${backupCmd}\n`;
            break;
          case "install_package":
            const versionOpt = block.getFieldValue('VERSION') ? `-${block.getFieldValue('VERSION')}` : "";
            code += `# Install package\nsudo dnf install -y "${block.getFieldValue('PACKAGE')}${versionOpt}"\n`;
            break;
          case "remove_package":
            code += `# Remove package\nsudo dnf remove -y "${block.getFieldValue('PACKAGE')}"\n`;
            break;
          case "update_system":
            switch (block.getFieldValue('TYPE')) {
              case 'REFRESH':
                code += `# Refresh repository metadata\nsudo dnf makecache --refresh\n`;
                break;
              case 'UPGRADE':
                code += `# Upgrade all packages\nsudo dnf upgrade -y\n`;
                break;
              case 'KERNEL':
                code += `# Update kernel package\nsudo dnf install -y kernel \n`;
                break;
            }
            break;
          case "search_package":
            code += `# Search for package\ndnf search "${block.getFieldValue('PACKAGE')}"\n`;
            break;
          case "add_repository":
            if (block.getFieldValue('REPOTYPE') === 'FILE') {
              code += `# Add custom .repo file\nsudo tee /etc/yum.repos.d/custom.repo <<EOF\n[custom]\nname=Custom Repository\nbaseurl=${block.getFieldValue('URL')}\nenabled=1\ngpgcheck=1\ngpgkey=${block.getFieldValue('GPG')}\nEOF\n`;
            } else {
              code += `# Use subscription-manager to enable repo\nsudo subscription-manager repos --enable="${block.getFieldValue('URL')}"\n`;
            }
            break;
          case "list_installed":
            if (block.getFieldValue('FILTER') === 'ALL') {
              code += `# List all installed packages\ndnf list installed\n`;
            } else if (block.getFieldValue('FILTER') === 'UPGRADABLE') {
              code += `# List upgradable packages\ndnf check-update\n`;
            } else if (block.getFieldValue('FILTER') === 'REPO') {
              code += `# List packages from repository\ndnf repoquery --list'\n`;
            }
            break;
          case "clean_packages":
            switch (block.getFieldValue('TYPE')) {
              case 'METADATA':
                code += `# Clean repository metadata\nsudo dnf clean metadata\n`;
                break;
              case 'KERNELS':
                code += `# Remove old kernels\nsudo dnf remove -y $(dnf repoquery --installonly --latest-limit=-1 -q)\n`;
                break;
              case 'CACHE':
                code += `# Clean all cached data\nsudo dnf clean all\n`;
                break;
            }
            break;
          case "hold_package":
            if (block.getFieldValue('ACTION') === 'HOLD') {
              code += `# Hold package from updates\nsudo dnf versionlock add "${block.getFieldValue('PACKAGE')}"\n`;
            } else {
              code += `# Unhold package\nsudo dnf versionlock delete "${block.getFieldValue('PACKAGE')}"\n`;
            }
            break;
          case "service_action":
            code += `# Service action\nsudo systemctl ${block.getFieldValue('ACTION')} ${block.getFieldValue('SERVICE')}\n`;
            break;
          case "create_service":
            code += `# Create systemd service\ncat <<EOF | sudo tee /etc/systemd/system/${block.getFieldValue('NAME')}.service\n`;
            code += `[Unit]\nDescription=${block.getFieldValue('NAME')} Service\nAfter=network.target\n\n`;
            code += `[Service]\nUser=${block.getFieldValue('USER')}\nExecStart=${block.getFieldValue('EXEC')}\nRestart=always\n\n`;
            code += `[Install]\nWantedBy=multi-user.target\nEOF\n`;
            code += `sudo systemctl daemon-reload\nsudo systemctl enable ${block.getFieldValue('NAME')}\n`;
            break;
          case "schedule_task":
            code += `# Schedule cron job\n(crontab -l 2>/dev/null; echo "${block.getFieldValue('SCHEDULE')} ${block.getFieldValue('COMMAND')}") | crontab -\n`;
            break;
          case "check_resources":
            switch (block.getFieldValue('TYPE')) {
              case 'cpu':
                code += `# Check CPU usage\nmpstat 1 1 | awk '/all/ {print "CPU Usage: " 100-$12 "%"}'\n`;
                break;
              case 'memory':
                code += `# Check memory usage\nfree -m | awk 'NR==2{printf "Memory Usage: %.2f%%", $3*100/$2 }'\n`;
                break;
              case 'disk':
                code += `# Check disk usage\ndf -h | awk '$NF=="/"{printf "Disk Usage: %s", $5}'\n`;
                break;
              case 'all':
                code += `# Check all resources\necho "CPU: $(mpstat 1 1 | awk '/all/ {printf "%.2f%%", 100-$12}')" \n`;
                code += `echo "Memory: $(free -m | awk 'NR==2{printf "%.2f%%", $3*100/$2 }')" \n`;
                code += `echo "Disk: $(df -h | awk '$NF=="/"{printf "%s", $5}')" \n`;
                break;
            }
            break;
          case "monitor_processes":
            const filter = block.getFieldValue('FILTER') ? ` | grep ${block.getFieldValue('FILTER')}` : "";
            code += `# Monitor processes\nps aux${filter}\n`;
            break;
          case "kill_process":
            code += `# Kill process\nsudo kill -${block.getFieldValue('SIGNAL')} ${block.getFieldValue('PID')}\n`;
            break;
          case "configure_network":
            code += `# Configure network using nmcli\nsudo nmcli connection modify "${block.getFieldValue('IFACE')}" ipv4.addresses ${block.getFieldValue('IP')}/${block.getFieldValue('PREFIX')} ipv4.gateway ${block.getFieldValue('GATEWAY')} ipv4.method manual\n`;
            code += `sudo nmcli connection up "${block.getFieldValue('IFACE')}"\n`;
            break;
          case "configure_firewall":
            if (block.getFieldValue('ACTION') === 'add') {
              code += `# Add firewall rule\nsudo firewall-cmd --permanent --add-port=${block.getFieldValue('PORT')}/${block.getFieldValue('PROTO')}\nsudo firewall-cmd --reload\n`;
            } else if (block.getFieldValue('ACTION') === 'remove') {
              code += `# Remove firewall rule\nsudo firewall-cmd --permanent --remove-port=${block.getFieldValue('PORT')}/${block.getFieldValue('PROTO')}\nsudo firewall-cmd --reload\n`;
            } else {
              code += `# Reload firewall rules\nsudo firewall-cmd --reload\n`;
            }
            break;
          case "list_network_interfaces":
            code += `# List network interfaces\nip -br addr show\n`;
            break;
          case "test_connectivity":
            code += `# Ping test\nping -c ${block.getFieldValue('COUNT')} ${block.getFieldValue('TARGET')}\n`;
            break;
          case "set_selinux_mode":
            code += `# Change SELinux mode\nsudo setenforce ${block.getFieldValue('MODE')}\n`;
            if (block.getFieldValue('MODE') === 'disabled') {
              code += `sudo sed -i 's/^SELINUX=.*/SELINUX=disabled/' /etc/selinux/config\n`;
            } else {
              code += `sudo sed -i 's/^SELINUX=.*/SELINUX=${block.getFieldValue('MODE')}/' /etc/selinux/config\n`;
            }
            break;
          case "manage_fcontext":
            if (block.getFieldValue('ACTION') === 'add') {
              code += `# Add file context\nsudo semanage fcontext -a -t ${block.getFieldValue('CONTEXT')} "${block.getFieldValue('PATH')}(.*)?"\n`;
            } else {
              code += `# Remove file context\nsudo semanage fcontext -d "${block.getFieldValue('PATH')}"\n`;
            }
            break;
          case "restore_con":
            const recOpt = block.getFieldValue('RECURSIVE') === 'TRUE' ? "-R" : "";
            code += `# Restore SELinux context\nsudo restorecon ${recOpt} "${block.getFieldValue('PATH')}"\n`;
            break;
          case "view_selinux_status":
            code += `# View SELinux status\ngetenforce && sestatus\n`;
            break;
          case "configure_sshd":
            code += `# Configure SSHD\nsudo sed -i 's/^${block.getFieldValue('OPTION')}.*/${block.getFieldValue('OPTION')} ${block.getFieldValue('VALUE')}/' /etc/ssh/sshd_config\n`;
            code += `sudo systemctl restart sshd\n`;
            break;
          case "enable_2fa":
            if (block.getFieldValue('METHOD') === 'google') {
              code += `# Enable Google Authenticator\nsudo dnf install -y google-authenticator\n`;
              code += `sudo sed -i 's/^#ChallengeResponseAuthentication.*/ChallengeResponseAuthentication yes/' /etc/ssh/sshd_config\n`;
              code += `sudo sed -i 's/^#AuthenticationMethods.*/AuthenticationMethods publickey,keyboard-interactive/' /etc/ssh/sshd_config\n`;
              code += `sudo systemctl restart sshd\n`;
              code += `sudo -u ${block.getFieldValue('USER')} google-authenticator -t -d -f -r 3 -R 30 -W\n`;
            } else {
              code += `# Enable Duo (requires Duo Unix installed)\nsudo dnf install -y duo_unix\n`;
              code += `echo "auth required pam_duo.so" | sudo tee -a /etc/pam.d/sshd\n`;
              code += `sudo sed -i 's/^#ChallengeResponseAuthentication.*/ChallengeResponseAuthentication yes/' /etc/ssh/sshd_config\n`;
              code += `sudo systemctl restart sshd\n`;
            }
            break;
          case "set_sudoers":
            if (block.getFieldValue('ACTION') === 'add') {
              code += `# Add sudoers entry\necho "${block.getFieldValue('USER')} ALL=(ALL) NOPASSWD:${block.getFieldValue('COMMANDS')}" | sudo tee /etc/sudoers.d/${block.getFieldValue('USER')}\n`;
            } else {
              code += `# Remove sudoers entry\nsudo rm -f /etc/sudoers.d/${block.getFieldValue('USER')}\n`;
            }
            break;
          case "audit_system":
            if (block.getFieldValue('TYPE') === 'basic') {
              code += `# Basic audit\nsudo ausearch -m USER_LOGIN\n`;
            } else if (block.getFieldValue('TYPE') === 'security') {
              code += `# Security audit\nsudo ausearch -m MAC_CHECK\n`;
            } else {
              code += `# Full audit\nsudo aureport -a\n`;
            }
            break;
          case "system_info":
            switch (block.getFieldValue('TYPE')) {
              case 'os':
                code += `# Get OS info\ncat /etc/redhat-release\n`;
                break;
              case 'kernel':
                code += `# Get kernel version\nuname -r\n`;
                break;
              case 'hostname':
                code += `# Get hostname\nhostnamectl --static\n`;
                break;
              case 'uptime':
                code += `# Get uptime\nuptime -p\n`;
                break;
              case 'all':
                code += `# All system info\necho "OS: $(cat /etc/redhat-release)"\n`;
                code += `echo "Kernel: $(uname -r)"\n`;
                code += `echo "Hostname: $(hostnamectl --static)"\n`;
                code += `echo "Uptime: $(uptime -p)"\n`;
                break;
            }
            break;
        }

        const nextBlock = block.getNextBlock();
        if (nextBlock) {
          code += generateBlockCodeRecursive(nextBlock);
        }
        return code;
      }

      function createModal(title) {
        const modal = document.createElement('div');
        modal.className = 'modal';
        
        const content = document.createElement('div');
        content.className = 'modal-content';
        
        const header = document.createElement('div');
        header.className = 'modal-header';
        
        const titleElement = document.createElement('h3');
        titleElement.className = 'modal-title';
        titleElement.textContent = title;
        
        const closeBtn = document.createElement('button');
        closeBtn.className = 'close-btn';
        closeBtn.innerHTML = '&times;';
        closeBtn.onclick = function() {
          document.body.removeChild(modal);
        };
        
        header.appendChild(titleElement);
        header.appendChild(closeBtn);
        content.appendChild(header);
        modal.appendChild(content);
        
        return modal;
      }

      window.simulate = function simulate() {
        const code = generateBashCode();
        if (!code) {
          showNotification("No script to show. Please add some blocks first.");
          return;
        }
        
        const modal = createModal('Generated Bash Script');
        
        const codeBlock = document.createElement('div');
        codeBlock.className = 'code-block';
        const pre = document.createElement('pre');
        pre.textContent = code;
        hljs.highlightElement(pre);
        codeBlock.appendChild(pre);
        
        const copyBtn = document.createElement('button');
        copyBtn.textContent = 'Copy to Clipboard';
        copyBtn.style.marginTop = '15px';
        copyBtn.onclick = function() {
          navigator.clipboard.writeText(code).then(() => {
            copyBtn.textContent = 'Copied!';
            setTimeout(() => {
              copyBtn.textContent = 'Copy to Clipboard';
            }, 2000);
          });
        };
        
        modal.querySelector('.modal-content').appendChild(codeBlock);
        modal.querySelector('.modal-content').appendChild(copyBtn);
        
        document.body.appendChild(modal);
      };

      window.download = function download() {
        const code = generateBashCode();
        if (!code) {
          showNotification("Nothing to download. Please add some blocks first.");
          return;
        }
        
        const blob = new Blob([code], { type: 'text/plain;charset=utf-8' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'rhcsa_script.sh';
        link.click();
        
        showNotification("Script downloaded successfully!");
      };
      
      function showNotification(message) {
        const notification = document.createElement('div');
        notification.className = 'notification';
        notification.textContent = message;
        
        document.body.appendChild(notification);
        
        // Animate in
        setTimeout(() => {
          notification.style.opacity = '1';
        }, 10);
        
        // Animate out after 3 seconds
        setTimeout(() => {
          notification.style.opacity = '0';
          setTimeout(() => {
            document.body.removeChild(notification);
          }, 500);
        }, 3000);
      }
    });
  </script>
</body>
</html>