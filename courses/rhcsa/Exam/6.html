<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>RHCSA Exam Lab 6: File Filtering and Output Redirection</title>
    <style>
        :root {
            --redhat-red: #cc0000;
            --redhat-dark: #1e1e1e;
            --redhat-light: #f0f0f0;
            --redhat-accent: #4CAF50;
            --redhat-blue: #007ACC;
            --panel-bg: #252525;
            --terminal-bg: #000;
            --border-color: #444;
            --current-step: #3a3a3a;
        }
        
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Red Hat Text', 'Overpass', sans-serif;
            background-color: var(--redhat-dark);
            color: var(--redhat-light);
            margin: 0;
            padding: 0;
            line-height: 1.6;
            height: 100vh;
            overflow: hidden;
        }
        
        .lab-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 100%;
            margin: 0;
            background: var(--redhat-dark);
        }
        
        .header {
            background: linear-gradient(to right, #1e1e1e, #333);
            padding: 15px 20px;
            color: white;
            display: flex;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }
        
        .header img {
            height: 30px;
            margin-right: 15px;
        }
        
        .header h1 {
            margin: 0;
            font-size: 1.5em;
            font-weight: normal;
        }
        
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        .guide-panel {
            width: 50%;
            padding: 20px;
            background: var(--panel-bg);
            overflow-y: auto;
            border-right: 1px solid var(--border-color);
        }
        
        .terminal-panel {
            width: 50%;
            display: flex;
            flex-direction: column;
            background: var(--panel-bg);
            position: relative;
        }
        
        .guide h2 {
            margin-top: 0;
            color: var(--redhat-accent);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }
        
        .lab-intro {
            background: rgba(76, 175, 80, 0.1);
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid var(--redhat-accent);
        }
        
        .lab-intro h3 {
            margin-top: 0;
            color: var(--redhat-accent);
        }
        
        .requirements-panel {
            background: #2a2a2a;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            border-left: 4px solid var(--redhat-red);
        }
        
        .requirements-panel h4 {
            margin-top: 0;
            color: var(--redhat-red);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
        }
        
        .requirement-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            padding: 8px;
            background: #252525;
            border-radius: 3px;
        }
        
        .requirement-item.completed {
            border-left: 3px solid var(--redhat-accent);
        }
        
        .requirement-item.partial {
            border-left: 3px solid #FFD700;
        }
        
        .requirement-checkbox {
            margin-right: 10px;
            color: var(--redhat-accent);
            min-width: 20px;
            text-align: center;
        }
        
        .requirement-label {
            flex: 1;
        }
        
        .guide-step {
            margin-bottom: 15px;
            padding: 15px;
            background: #333;
            border-left: 4px solid var(--redhat-blue);
            position: relative;
        }
        
        .guide-step.current {
            background: var(--current-step);
            border-left: 4px solid var(--redhat-accent);
        }
        
        .guide-step.completed {
            opacity: 0.7;
            border-left: 4px solid #666;
        }
        
        .guide-step h3 {
            margin-top: 0;
            color: var(--redhat-accent);
            display: flex;
            align-items: center;
        }
        
        .step-number {
            background: var(--redhat-accent);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-size: 0.8em;
        }
        
        .step-status {
            margin-left: auto;
            font-size: 0.8em;
            padding: 3px 8px;
            border-radius: 3px;
        }
        
        .status-pending {
            background: #555;
            color: #ccc;
        }
        
        .status-current {
            background: var(--redhat-blue);
            color: white;
        }
        
        .status-completed {
            background: var(--redhat-accent);
            color: white;
        }
        
        .required-command {
            background: rgba(76, 175, 80, 0.1);
            padding: 10px;
            border-radius: 3px;
            margin: 10px 0;
            border-left: 3px solid var(--redhat-accent);
        }
        
        .command-hint {
            background: #2a2a2a;
            padding: 10px;
            border-radius: 3px;
            margin: 10px 0;
            border-left: 3px solid var(--redhat-blue);
            font-family: 'Red Hat Mono', monospace;
        }
        
        .concept {
            background: #2a2a2a;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            border-left: 4px solid var(--redhat-blue);
        }
        
        .concept h4 {
            margin-top: 0;
            color: var(--redhat-blue);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
        }
        
        .concept-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .concept-item {
            background: #252525;
            padding: 10px;
            border-radius: 5px;
            border-left: 2px solid var(--redhat-red);
        }
        
        .concept-item strong {
            color: var(--redhat-red);
            display: block;
            margin-bottom: 5px;
        }
        
        .terminal {
            background: var(--terminal-bg);
            padding: 15px;
            flex: 1;
            overflow-y: auto;
            font-family: 'Red Hat Mono', monospace;
        }
        
        .command-line {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #333;
            border-top: 1px solid var(--border-color);
            margin-top: auto;
            flex-shrink: 0;
            position: relative;
        }
        
        #command-input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--redhat-light);
            font-family: 'Red Hat Mono', monospace;
            font-size: 16px;
            outline: none;
            padding: 8px;
        }
        
        .prompt {
            color: var(--redhat-accent);
            white-space: nowrap;
            margin-right: 5px;
        }
        
        .file-content {
            background: #1e1e1e;
            padding: 10px;
            border-radius: 3px;
            font-family: 'Red Hat Mono', monospace;
            white-space: pre;
            overflow-x: auto;
            margin: 10px 0;
        }
        
        .file-path {
            color: var(--redhat-blue);
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        code {
            background: #1e1e1e;
            padding: 2px 5px;
            border-radius: 3px;
            color: var(--redhat-accent);
            font-family: 'Red Hat Mono', monospace;
        }
        
        .success {
            color: var(--redhat-accent);
            font-weight: bold;
        }
        
        .error {
            color: #FF5252;
        }
        
        .warning {
            color: #FFD700;
            font-weight: bold;
        }
        
        .completion-message {
            background: rgba(76, 175, 80, 0.2);
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            margin: 20px 0;
            border: 1px solid var(--redhat-accent);
        }
        
        .progress-bar {
            height: 5px;
            background: #333;
            border-radius: 3px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--redhat-accent);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .hint-box {
            background: rgba(255, 215, 0, 0.1);
            border-left: 4px solid #FFD700;
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
        }
        
        .tab-completion {
            position: absolute;
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 3px;
            max-height: 150px;
            overflow-y: auto;
            z-index: 100;
            font-family: 'Red Hat Mono', monospace;
            font-size: 14px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            bottom: 100%;
            left: 0;
            right: 0;
            margin-bottom: 5px;
        }
        
        .tab-completion-item {
            padding: 5px 10px;
            cursor: pointer;
        }
        
        .tab-completion-item:hover, .tab-completion-item.selected {
            background: #007ACC;
            color: white;
        }
        
        .vim-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .vim-container {
            display: flex;
            width: 90%;
            height: 80%;
            gap: 20px;
        }
        
        .vim-instructions {
            width: 30%;
            background: #2a2a2a;
            padding: 15px;
            border-radius: 5px;
            overflow-y: auto;
        }
        
        .vim-instructions h3 {
            margin-top: 0;
            color: var(--redhat-accent);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }
        
        .vim-editor {
            width: 70%;
            background: #1e1e1e;
            border: 1px solid #444;
            display: flex;
            flex-direction: column;
            font-family: 'Red Hat Mono', monospace;
        }
        
        .vim-header {
            background: #333;
            padding: 5px 10px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .vim-content {
            flex: 1;
            padding: 10px;
            overflow: auto;
            white-space: pre;
            color: #ccc;
            position: relative;
        }
        
        .vim-command-line {
            display: flex;
            background: #333;
            padding: 5px;
            border-top: 1px solid #444;
        }
        
        .vim-prompt {
            color: #4CAF50;
            padding: 0 5px;
        }
        
        .vim-input {
            flex: 1;
            background: transparent;
            border: none;
            color: white;
            font-family: 'Red Hat Mono', monospace;
            outline: none;
        }
        
        .vim-status {
            background: #333;
            padding: 3px 10px;
            color: #ccc;
            font-size: 0.9em;
            border-top: 1px solid #444;
            display: flex;
            justify-content: space-between;
        }
        
        .vim-mode-indicator {
            color: #FFD700;
        }
        
        .vim-cursor {
            display: inline-block;
            width: 8px;
            height: 16px;
            background: #ccc;
            animation: blink 1s infinite;
            vertical-align: middle;
        }
        
        .vim-esc-button {
            background: #555;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            margin-left: 10px;
        }
        
        .vim-esc-button:hover {
            background: #666;
        }
        
        .vim-command-buttons {
            display: flex;
            gap: 10px;
        }
        
        .vim-command-button {
            background: #444;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
        }
        
        .vim-command-button:hover {
            background: #555;
        }
        
        .vim-mode-indicator.command-mode {
            color: #FFD700;
        }
        
        .vim-mode-indicator.insert-mode {
            color: #4CAF50;
        }
        
        .vim-textarea {
            position: absolute;
            top: 10px;
            left: 10px;
            width: calc(100% - 20px);
            height: calc(100% - 20px);
            background: transparent;
            border: none;
            color: #ccc;
            font-family: 'Red Hat Mono', monospace;
            resize: none;
            outline: none;
            white-space: pre;
            overflow: auto;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        @media (max-width: 992px) {
            .main-content {
                flex-direction: column;
            }
            
            .guide-panel, .terminal-panel {
                width: 100%;
                height: 50%;
            }
            
            .vim-container {
                width: 95%;
                height: 90%;
                flex-direction: column;
            }
            
            .vim-instructions, .vim-editor {
                width: 100%;
            }
            
            .vim-instructions {
                height: 30%;
            }
            
            .vim-editor {
                height: 70%;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Red+Hat+Text:wght@400;700&family=Red+Hat+Mono&display=swap" rel="stylesheet"/>
</head>
<body>
<div class="lab-container">
    <div class="header">
        <img alt="Red Hat Logo" src="https://www.redhat.com/profiles/rh/themes/redhatdotcom/img/logo.svg"/>
        <h1>RHCSA Exam Lab 6: File Filtering and Output Redirection</h1>
    </div>
    
    <div class="main-content">
        <div class="guide-panel">
            <h2>Lab Instructions</h2>
            
            <div class="lab-intro">
                <h3>Lab Objective</h3>
                <p>Use grep to find lines containing "abcde" in /etc/testfile, redirect the output to /tmp/testfile while preserving the original line order, and verify the results.</p>
                <p><strong>Time Estimate:</strong> 10-15 minutes</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div id="progress-text">0% Complete</div>
            </div>

            <div class="requirements-panel">
                <h4>File Filtering Requirements</h4>
                <div class="requirement-item" id="req-grep-command">
                    <span class="requirement-checkbox">‚òê</span>
                    <span class="requirement-label">Use <code>grep</code> to find lines containing "abcde" in <code>/etc/testfile</code></span>
                </div>
                <div class="requirement-item" id="req-output-redirection">
                    <span class="requirement-checkbox">‚òê</span>
                    <span class="requirement-label">Redirect the output to <code>/tmp/testfile</code></span>
                </div>
                <div class="requirement-item" id="req-preserve-order">
                    <span class="requirement-checkbox">‚òê</span>
                    <span class="requirement-label">Preserve the original line order from <code>/etc/testfile</code></span>
                </div>
                <div class="requirement-item" id="req-verify-result">
                    <span class="requirement-checkbox">‚òê</span>
                    <span class="requirement-label">Verify the contents of <code>/tmp/testfile</code></span>
                </div>
            </div>

            <div class="guide-step completed" id="step0">
                <h3>
                    <span class="step-number">0</span>
                    Lab Introduction
                    <span class="step-status status-completed">Completed</span>
                </h3>
                <p>Welcome to the RHCSA File Filtering Lab. In this lab, you will practice using grep to filter file contents and redirect output while preserving the original line order.</p>
                <p>Follow the steps in order. You must complete each step before moving to the next one.</p>
            </div>

            <div class="guide-step current" id="step1">
                <h3>
                    <span class="step-number">1</span>
                    Find Lines Containing "abcde"
                    <span class="step-status status-current">Current Step</span>
                </h3>
                <p>Use grep to search for the pattern "abcde" in /etc/testfile:</p>
                
                <div class="hint-box">
                    <strong>Type this command exactly:</strong>
                </div>
                
                <div class="command-hint">
                    grep 'abcde' /etc/testfile
                </div>
                
                <p>This will display all lines containing "abcde" while preserving the original order.</p>

                <div class="concept">
                    <h4>Understanding grep</h4>
                    <p>The grep command searches for patterns in files. Key points:</p>
                    <ul>
                        <li>By default, grep is case-sensitive (use <code>-i</code> for case-insensitive)</li>
                        <li>Use quotes around the pattern to prevent shell interpretation</li>
                        <li>grep preserves the original line order from the input file</li>
                        <li>Exit status is 0 if matches found, 1 if no matches, 2 for errors</li>
                    </ul>
                </div>
            </div>

            <div class="guide-step" id="step2">
                <h3>
                    <span class="step-number">2</span>
                    Redirect Output to /tmp/testfile
                    <span class="step-status status-pending">Pending</span>
                </h3>
                <p>Redirect the grep output to save it in /tmp/testfile:</p>
                
                <div class="hint-box">
                    <strong>Method 1: Simple redirection</strong>
                </div>
                
                <div class="command-hint">
                    grep 'abcde' /etc/testfile > /tmp/testfile
                </div>
                
                <div class="hint-box">
                    <strong>Method 2: Using tee (displays and saves)</strong>
                </div>
                
                <div class="command-hint">
                    grep 'abcde' /etc/testfile | tee /tmp/testfile
                </div>

                <div class="concept">
                    <h4>Understanding Output Redirection</h4>
                    <p>Linux provides several ways to redirect command output:</p>
                    <ul>
                        <li><code>> file</code>: Overwrites file with output</li>
                        <li><code>>> file</code>: Appends output to file</li>
                        <li><code>| tee file</code>: Displays output and saves to file</li>
                        <li><code>| tee -a file</code>: Displays output and appends to file</li>
                    </ul>
                </div>
            </div>

            <div class="guide-step" id="step3">
                <h3>
                    <span class="step-number">3</span>
                    Verify the Results
                    <span class="step-status status-pending">Pending</span>
                </h3>
                <p>Check that the operation was successful:</p>
                
                <div class="hint-box">
                    <strong>Type these commands one by one:</strong>
                </div>
                
                <div class="command-hint">
                    cat /tmp/testfile
                </div>
                <p>Should show all lines containing "abcde" in original order</p>
                
                <div class="command-hint">
                    wc -l /tmp/testfile
                </div>
                <p>Should show the number of matching lines</p>
                
                <div class="command-hint">
                    grep -n 'abcde' /etc/testfile
                </div>
                <p>Shows line numbers to verify order preservation</p>

                <div class="concept">
                    <h4>Verification Techniques</h4>
                    <p>Always verify your file operations:</p>
                    <ul>
                        <li><code>cat</code> shows the complete file contents</li>
                        <li><code>wc -l</code> counts lines to ensure all matches were captured</li>
                        <li><code>grep -n</code> shows line numbers to verify order preservation</li>
                        <li><code>diff</code> can compare filtered output with expected results</li>
                    </ul>
                </div>
            </div>
            
            <div class="concept">
                <h4>File Filtering Methods</h4>
                <div class="concept-grid">
                    <div class="concept-item">
                        <strong>grep Command</strong>
                        <code>grep 'pattern' file</code> searches for lines matching the pattern<br>
                        Basic syntax: <code>grep [options] pattern [file...]</code>
                    </div>
                    <div class="concept-item">
                        <strong>Output Redirection</strong>
                        <code>> file</code> overwrites output to file<br>
                        <code>>> file</code> appends output to file<br>
                        <code>| tee file</code> displays and saves output
                    </div>
                    <div class="concept-item">
                        <strong>Preserving Order</strong>
                        Simple grep preserves original order<br>
                        For complex filtering, use while loops to process line by line
                    </div>
                    <div class="concept-item">
                        <strong>Verification</strong>
                        Use <code>cat</code> to view file contents<br>
                        <code>diff</code> to compare files<br>
                        <code>wc -l</code> to count matching lines
                    </div>
                </div>
            </div>
            
            <div id="completion-message" class="completion-message" style="display: none;">
                <h3>üéâ Lab Completed Successfully!</h3>
                <p>All file filtering requirements have been met.</p>
                <p>You have successfully:</p>
                <ul style="text-align: left; display: inline-block;">
                    <li>Used grep to find lines containing "abcde" in /etc/testfile</li>
                    <li>Redirected the output to /tmp/testfile</li>
                    <li>Preserved the original line order</li>
                    <li>Verified the results</li>
                </ul>
                <p>You can now proceed to the next lab.</p>
            </div>
        </div>
        
        <div class="terminal-panel">
            <div class="terminal" id="terminal-output">
                <div><span class="prompt">[root@station ~]#</span> Welcome to RHCSA Lab 6: File Filtering and Output Redirection</div>
                <div><span class="prompt">[root@station ~]#</span> This is a guided lab. Follow the instructions on the left.</div>
                <div><span class="prompt">[root@station ~]#</span> You must complete each step in order.</div>
                <div><span class="prompt">[root@station ~]#</span> Current step: Find Lines Containing "abcde"</div>
                <div><span class="prompt">[root@station ~]#</span> Type: <code>grep 'abcde' /etc/testfile</code></div>
                <div><span class="prompt">[root@station ~]#</span> <span class="success">Tip:</span> Press <code>Tab</code> for command and path completion</div>
            </div>
            <div class="command-line">
                <span class="prompt">[root@station ~]#</span>
                <input autofocus id="command-input" placeholder="Type the command shown in the current step..." type="text"/>
                <div id="tab-completion" class="tab-completion" style="display: none;"></div>
            </div>
        </div>
    </div>
</div>

<script>
    const commandInput = document.getElementById('command-input');
    const terminalOutput = document.getElementById('terminal-output');
    const requirementItems = document.querySelectorAll('.requirement-item');
    const progressFill = document.getElementById('progress-fill');
    const progressText = document.getElementById('progress-text');
    const completionMessage = document.getElementById('completion-message');
    const steps = document.querySelectorAll('.guide-step');
    const tabCompletion = document.getElementById('tab-completion');
    
    let commandHistory = [];
    let historyIndex = -1;
    let currentStep = 1;
    let tabCompletionIndex = -1;
    let tabCompletionItems = [];
    let lastTabInput = '';
    
    // Available commands for tab completion
    const availableCommands = [
        'grep', 'cat', 'wc', 'tee', 'diff', 'clear', 'help'
    ];
    
    // Available file paths for tab completion
    const filePaths = {
        '/etc/': ['testfile'],
        '/tmp/': ['testfile']
    };
    
    // Track configuration state
    const configState = {
        grepCommand: false,
        outputRedirection: false,
        preserveOrder: false,
        verifyResult: false
    };
    
    // Expected commands for each step
    const stepCommands = {
        1: ['grep \'abcde\' /etc/testfile'],
        2: ['grep \'abcde\' /etc/testfile > /tmp/testfile', 'grep \'abcde\' /etc/testfile | tee /tmp/testfile'],
        3: ['cat /tmp/testfile', 'wc -l /tmp/testfile', 'grep -n \'abcde\' /etc/testfile']
    };
    
    // Simulated file contents
    const testFileContent = `This is a test file with multiple lines
Some lines contain abcde and some don't
abcde should be found in these lines
Another line with abcde in the middle
Final line without the pattern`;
    
    let tmpTestFileContent = "";
    
    const commands = {
        'cat': (args) => {
            if (args[0] === "/etc/testfile") {
                return testFileContent;
            } else if (args[0] === "/tmp/testfile") {
                if (tmpTestFileContent) {
                    if (currentStep === 3 || currentStep > 3) {
                        configState.verifyResult = true;
                        updateRequirements();
                        completeStep(3);
                    }
                    return tmpTestFileContent;
                }
                return `cat: ${args[0]}: No such file or directory`;
            }
            return `cat: ${args[0]}: No such file or directory`;
        },
        
        'grep': (args) => {
            if (args.includes("/etc/testfile")) {
                if (currentStep === 1 || currentStep > 1) {
                    configState.grepCommand = true;
                    updateRequirements();
                    
                    // Check if output is being redirected
                    const outputIndex = args.indexOf(">");
                    const teeIndex = args.indexOf("|");
                    
                    if (outputIndex !== -1 || teeIndex !== -1) {
                        if (currentStep === 2 || currentStep > 2) {
                            configState.outputRedirection = true;
                            
                            // Check if order is preserved (not using sort or other order-changing commands)
                            if (!args.includes("sort") && !args.includes("awk") && !args.includes("cut")) {
                                configState.preserveOrder = true;
                            }
                            
                            // Simulate the output file creation
                            const pattern = args[0].replace(/'/g, '');
                            const matches = testFileContent.split('\n').filter(line => line.includes(pattern));
                            tmpTestFileContent = matches.join('\n');
                            
                            updateRequirements();
                            completeStep(2);
                            return ""; // No output when redirecting
                        } else {
                            return "Please complete the previous steps first.";
                        }
                    }
                    
                    // Just display matches if no redirection
                    completeStep(1);
                    const pattern = args[0].replace(/'/g, '');
                    return testFileContent.split('\n').filter(line => line.includes(pattern)).join('\n');
                } else {
                    return "Please complete the previous steps first.";
                }
            }
            return `grep: ${args.join(' ')}: No such file or directory`;
        },
        
        'wc': (args) => {
            if (args[0] === "-l" && args[1] === "/tmp/testfile") {
                if (tmpTestFileContent) {
                    if (currentStep === 3 || currentStep > 3) {
                        configState.verifyResult = true;
                        updateRequirements();
                        completeStep(3);
                    }
                    return `${tmpTestFileContent.split('\n').length} /tmp/testfile`;
                }
                return `wc: ${args[1]}: No such file or directory`;
            }
            return `wc: invalid option -- '${args[0]}'`;
        },
        
        'tee': (args) => {
            if (args.includes("/tmp/testfile")) {
                if (currentStep === 2 || currentStep > 2) {
                    configState.outputRedirection = true;
                    configState.preserveOrder = true;
                    
                    // Simulate the output file creation
                    const pattern = 'abcde';
                    const matches = testFileContent.split('\n').filter(line => line.includes(pattern));
                    tmpTestFileContent = matches.join('\n');
                    
                    updateRequirements();
                    completeStep(2);
                    return matches.join('\n'); // tee shows output and saves to file
                } else {
                    return "Please complete the previous steps first.";
                }
            }
            return `tee: ${args.join(' ')}: No such file or directory`;
        },
        
        'diff': (args) => {
            if (args.includes("/etc/testfile") && args.includes("/tmp/testfile")) {
                return "Files differ - /tmp/testfile contains only matching lines";
            }
            return `diff: ${args.join(' ')}: No such file or directory`;
        },
        
        'clear': () => {
            terminalOutput.innerHTML = '';
            return '';
        },
        
        'help': () => {
            return "Available commands: grep, cat, wc, tee, diff, clear, help";
        }
    };
    
    // Function to update requirements display
    function updateRequirements() {
        if (configState.grepCommand) {
            document.getElementById('req-grep-command').classList.add('completed');
            document.getElementById('req-grep-command').querySelector('.requirement-checkbox').textContent = '‚úì';
        }
        
        if (configState.outputRedirection) {
            document.getElementById('req-output-redirection').classList.add('completed');
            document.getElementById('req-output-redirection').querySelector('.requirement-checkbox').textContent = '‚úì';
        }
        
        if (configState.preserveOrder) {
            document.getElementById('req-preserve-order').classList.add('completed');
            document.getElementById('req-preserve-order').querySelector('.requirement-checkbox').textContent = '‚úì';
        }
        
        if (configState.verifyResult) {
            document.getElementById('req-verify-result').classList.add('completed');
            document.getElementById('req-verify-result').querySelector('.requirement-checkbox').textContent = '‚úì';
        }
        
        // Update progress
        const completedCount = Object.values(configState).filter(v => v).length;
        const progressPercent = (completedCount / Object.keys(configState).length) * 100;
        progressFill.style.width = `${progressPercent}%`;
        progressText.textContent = `${Math.round(progressPercent)}% Complete`;
        
        // Show completion message if all requirements are met
        if (completedCount === Object.keys(configState).length) {
            completionMessage.style.display = 'block';
            addTerminalOutput(`<span class="prompt">[root@station ~]#</span> <span class="success">üéâ Lab completed successfully! All requirements have been met.</span>`);
            addTerminalOutput(`<span class="prompt">[root@station ~]#</span> <span class="success">You can now proceed to the next lab.</span>`);
        }
    }
    
    // Function to complete a step
    function completeStep(step) {
        if (step === currentStep) {
            steps[step].classList.remove('current');
            steps[step].classList.add('completed');
            steps[step].querySelector('.step-status').textContent = 'Completed';
            steps[step].querySelector('.step-status').className = 'step-status status-completed';
            
            currentStep++;
            
            if (currentStep < steps.length) {
                steps[currentStep].classList.add('current');
                steps[currentStep].querySelector('.step-status').textContent = 'Current Step';
                steps[currentStep].querySelector('.step-status').className = 'step-status status-current';
                
                // Update terminal with next step info
                addTerminalOutput(`[root@station ~]# <span class="success">Step ${step} completed successfully.</span>`);
                
                // Show the command for the next step if available
                if (stepCommands[currentStep]) {
                    addTerminalOutput(`[root@station ~]# Next step: ${stepCommands[currentStep][0]}`);
                }
            } else {
                // All steps completed
                addTerminalOutput(`[root@station ~]# <span class="success">All steps completed! Lab finished successfully.</span>`);
            }
        }
    }
    
    // Function to add output to the terminal
    function addTerminalOutput(text) {
        const newLine = document.createElement('div');
        newLine.innerHTML = text;
        terminalOutput.appendChild(newLine);
        terminalOutput.scrollTop = terminalOutput.scrollHeight;
    }
    
    // Function to handle command execution
    function executeCommand(input) {
        const trimmedInput = input.trim();
        if (!trimmedInput) return;
        
        // Add to command history
        commandHistory.push(trimmedInput);
        historyIndex = commandHistory.length;
        
        // Display the command in terminal
        addTerminalOutput(`<span class="prompt">[root@station ~]#</span> ${trimmedInput}`);
        
        // Parse command and arguments
        const parts = trimmedInput.split(' ');
        const command = parts[0];
        const args = parts.slice(1);
        
        // Execute command if it exists
        if (commands.hasOwnProperty(command)) {
            const result = commands[command](args);
            if (result) {
                addTerminalOutput(result);
            }
        } else {
            addTerminalOutput(`bash: ${command}: command not found`);
            addTerminalOutput('Type "help" for available commands');
        }
    }
    
    // Function to handle tab completion
    function handleTabCompletion() {
        const input = commandInput.value;
        
        // If this is a consecutive tab press with no change in input, cycle through options
        if (input === lastTabInput && tabCompletionItems.length > 1) {
            tabCompletionIndex = (tabCompletionIndex + 1) % tabCompletionItems.length;
            showTabCompletion(tabCompletionItems, tabCompletionIndex);
            return;
        }
        
        lastTabInput = input;
        const parts = input.split(' ');
        const lastPart = parts[parts.length - 1];
        
        // Reset tab completion state for new input
        tabCompletionIndex = 0;
        
        // If no input, show all available commands
        if (parts.length === 1 && lastPart === '') {
            tabCompletionItems = availableCommands;
            showTabCompletion(tabCompletionItems, 0);
            return;
        }
        
        // If it's a command completion
        if (parts.length === 1) {
            tabCompletionItems = availableCommands.filter(cmd => 
                cmd.startsWith(lastPart)
            );
            
            if (tabCompletionItems.length > 0) {
                showTabCompletion(tabCompletionItems, 0);
            } else {
                hideTabCompletion();
            }
            return;
        }
        
        // If it's a path completion
        const pathParts = lastPart.split('/');
        let basePath = pathParts.slice(0, -1).join('/') || '/';
        const partialName = pathParts[pathParts.length - 1];
        
        // Normalize base path
        if (!basePath.endsWith('/') && basePath !== '/') {
            basePath += '/';
        }
        
        // Get available completions for this path
        const availablePaths = filePaths[basePath] || [];
        tabCompletionItems = availablePaths.filter(path => 
            path.startsWith(partialName)
        );
        
        if (tabCompletionItems.length > 0) {
            showTabCompletion(tabCompletionItems, 0);
        } else {
            hideTabCompletion();
        }
    }
    
    // Function to show tab completion suggestions
    function showTabCompletion(items, selectedIndex) {
        if (items.length === 0) {
            hideTabCompletion();
            return;
        }
        
        // If only one item, auto-complete
        if (items.length === 1) {
            completeWithSuggestion(items[0]);
            hideTabCompletion();
            return;
        }
        
        // Create completion items
        tabCompletion.innerHTML = '';
        items.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = `tab-completion-item ${index === selectedIndex ? 'selected' : ''}`;
            div.textContent = item;
            div.addEventListener('click', () => {
                completeWithSuggestion(item);
                hideTabCompletion();
            });
            tabCompletion.appendChild(div);
        });
        
        // Show the completion box
        tabCompletion.style.display = 'block';
        
        tabCompletionIndex = selectedIndex;
        tabCompletionItems = items;
    }
    
    // Function to hide tab completion
    function hideTabCompletion() {
        tabCompletion.style.display = 'none';
        tabCompletionItems = [];
        tabCompletionIndex = -1;
    }
    
    // Function to complete the input with a suggestion
    function completeWithSuggestion(suggestion) {
        const input = commandInput.value;
        const parts = input.split(' ');
        const lastPart = parts[parts.length - 1];
        
        if (parts.length === 1) {
            // Command completion
            commandInput.value = suggestion + ' ';
        } else {
            // Path completion
            const pathParts = lastPart.split('/');
            const basePath = pathParts.slice(0, -1).join('/');
            
            if (basePath) {
                parts[parts.length - 1] = basePath + '/' + suggestion;
            } else {
                parts[parts.length - 1] = suggestion;
            }
            
            commandInput.value = parts.join(' ') + (suggestion.endsWith('/') ? '' : ' ');
        }
        
        // Move cursor to end
        commandInput.selectionStart = commandInput.selectionEnd = commandInput.value.length;
        lastTabInput = commandInput.value;
    }
    
    // Event listeners
    commandInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            executeCommand(commandInput.value);
            commandInput.value = '';
            hideTabCompletion();
            lastTabInput = '';
        } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            if (commandHistory.length > 0) {
                if (historyIndex > 0) {
                    historyIndex--;
                }
                commandInput.value = commandHistory[historyIndex] || '';
            }
            hideTabCompletion();
        } else if (e.key === 'ArrowDown') {
            e.preventDefault();
            if (historyIndex < commandHistory.length - 1) {
                historyIndex++;
                commandInput.value = commandHistory[historyIndex];
            } else {
                historyIndex = commandHistory.length;
                commandInput.value = '';
            }
            hideTabCompletion();
        } else if (e.key === 'Tab') {
            e.preventDefault();
            handleTabCompletion();
        } else if (e.key === 'Escape') {
            hideTabCompletion();
        } else {
            // Hide tab completion on other key presses if input changes
            setTimeout(() => {
                if (commandInput.value !== lastTabInput) {
                    hideTabCompletion();
                }
            }, 0);
        }
    });
    
    // Hide tab completion when clicking outside
    document.addEventListener('click', (e) => {
        if (!tabCompletion.contains(e.target) && e.target !== commandInput) {
            hideTabCompletion();
        }
    });
    
    // Initialize the lab
    updateRequirements();
</script>
</body>
</html>