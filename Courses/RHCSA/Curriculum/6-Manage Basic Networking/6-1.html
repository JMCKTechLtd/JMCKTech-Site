<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>RHCSA Lab 6.1 - Configure IPv4/IPv6 Networking</title>
    <style>
        :root {
            --redhat-red: #cc0000;
            --redhat-dark: #1e1e1e;
            --redhat-light: #f0f0f0;
            --redhat-accent: #4CAF50;
            --redhat-blue: #007ACC;
            --panel-bg: #252525;
            --terminal-bg: #000;
            --border-color: #444;
            --current-step: #3a3a3a;
        }
        
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Red Hat Text', 'Overpass', sans-serif;
            background-color: var(--redhat-dark);
            color: var(--redhat-light);
            margin: 0;
            padding: 0;
            line-height: 1.6;
            height: 100vh;
            overflow: hidden;
        }
        
        .lab-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 100%;
            margin: 0;
            background: var(--redhat-dark);
        }
        
        .header {
            background: linear-gradient(to right, #1e1e1e, #333);
            padding: 15px 20px;
            color: white;
            display: flex;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }
        
        .header img {
            height: 30px;
            margin-right: 15px;
        }
        
        .header h1 {
            margin: 0;
            font-size: 1.5em;
            font-weight: normal;
        }
        
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        .guide-panel {
            width: 50%;
            padding: 20px;
            background: var(--panel-bg);
            overflow-y: auto;
            border-right: 1px solid var(--border-color);
        }
        
        .terminal-panel {
            width: 50%;
            display: flex;
            flex-direction: column;
            background: var(--panel-bg);
            position: relative;
        }
        
        .guide h2 {
            margin-top: 0;
            color: var(--redhat-accent);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }
        
        .lab-intro {
            background: rgba(76, 175, 80, 0.1);
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid var(--redhat-accent);
        }
        
        .lab-intro h3 {
            margin-top: 0;
            color: var(--redhat-accent);
        }
        
        .requirements-panel {
            background: #2a2a2a;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            border-left: 4px solid var(--redhat-red);
        }
        
        .requirements-panel h4 {
            margin-top: 0;
            color: var(--redhat-red);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
        }
        
        .requirement-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            padding: 8px;
            background: #252525;
            border-radius: 3px;
        }
        
        .requirement-item.completed {
            border-left: 3px solid var(--redhat-accent);
        }
        
        .requirement-item.partial {
            border-left: 3px solid #FFD700;
        }
        
        .requirement-checkbox {
            margin-right: 10px;
            color: var(--redhat-accent);
            min-width: 20px;
            text-align: center;
        }
        
        .requirement-label {
            flex: 1;
        }
        
        .guide-step {
            margin-bottom: 15px;
            padding: 15px;
            background: #333;
            border-left: 4px solid var(--redhat-blue);
            position: relative;
        }
        
        .guide-step.current {
            background: var(--current-step);
            border-left: 4px solid var(--redhat-accent);
        }
        
        .guide-step.completed {
            opacity: 0.7;
            border-left: 4px solid #666;
        }
        
        .guide-step h3 {
            margin-top: 0;
            color: var(--redhat-accent);
            display: flex;
            align-items: center;
        }
        
        .step-number {
            background: var(--redhat-accent);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-size: 0.8em;
        }
        
        .step-status {
            margin-left: auto;
            font-size: 0.8em;
            padding: 3px 8px;
            border-radius: 3px;
        }
        
        .status-pending {
            background: #555;
            color: #ccc;
        }
        
        .status-current {
            background: var(--redhat-blue);
            color: white;
        }
        
        .status-completed {
            background: var(--redhat-accent);
            color: white;
        }
        
        .required-command {
            background: rgba(76, 175, 80, 0.1);
            padding: 10px;
            border-radius: 3px;
            margin: 10px 0;
            border-left: 3px solid var(--redhat-accent);
        }
        
        .command-hint {
            background: #2a2a2a;
            padding: 10px;
            border-radius: 3px;
            margin: 10px 0;
            border-left: 3px solid var(--redhat-blue);
            font-family: 'Red Hat Mono', monospace;
        }
        
        .concept {
            background: #2a2a2a;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            border-left: 4px solid var(--redhat-blue);
        }
        
        .concept h4 {
            margin-top: 0;
            color: var(--redhat-blue);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
        }
        
        .concept-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .concept-item {
            background: #252525;
            padding: 10px;
            border-radius: 5px;
            border-left: 2px solid var(--redhat-red);
        }
        
        .concept-item strong {
            color: var(--redhat-red);
            display: block;
            margin-bottom: 5px;
        }
        
        .terminal {
            background: var(--terminal-bg);
            padding: 15px;
            flex: 1;
            overflow-y: auto;
            font-family: 'Red Hat Mono', monospace;
        }
        
        .command-line {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #333;
            border-top: 1px solid var(--border-color);
            margin-top: auto;
            flex-shrink: 0;
            position: relative;
        }
        
        #command-input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--redhat-light);
            font-family: 'Red Hat Mono', monospace;
            font-size: 16px;
            outline: none;
            padding: 8px;
        }
        
        .prompt {
            color: var(--redhat-accent);
            white-space: nowrap;
            margin-right: 5px;
        }
        
        .file-content {
            background: #1e1e1e;
            padding: 10px;
            border-radius: 3px;
            font-family: 'Red Hat Mono', monospace;
            white-space: pre;
            overflow-x: auto;
            margin: 10px 0;
        }
        
        .file-path {
            color: var(--redhat-blue);
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        code {
            background: #1e1e1e;
            padding: 2px 5px;
            border-radius: 3px;
            color: var(--redhat-accent);
            font-family: 'Red Hat Mono', monospace;
        }
        
        .success {
            color: var(--redhat-accent);
            font-weight: bold;
        }
        
        .error {
            color: #FF5252;
        }
        
        .warning {
            color: #FFD700;
            font-weight: bold;
        }
        
        .completion-message {
            background: rgba(76, 175, 80, 0.2);
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            margin: 20px 0;
            border: 1px solid var(--redhat-accent);
        }
        
        .progress-bar {
            height: 5px;
            background: #333;
            border-radius: 3px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--redhat-accent);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .hint-box {
            background: rgba(255, 215, 0, 0.1);
            border-left: 4px solid #FFD700;
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
        }
        
        .tab-completion {
            position: absolute;
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 3px;
            max-height: 150px;
            overflow-y: auto;
            z-index: 100;
            font-family: 'Red Hat Mono', monospace;
            font-size: 14px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            bottom: 100%;
            left: 0;
            right: 0;
            margin-bottom: 5px;
        }
        
        .tab-completion-item {
            padding: 5px 10px;
            cursor: pointer;
        }
        
        .tab-completion-item:hover, .tab-completion-item.selected {
            background: #007ACC;
            color: white;
        }
        
        .ipv4 {
            color: #4CAF50;
        }
        
        .ipv6 {
            color: #2196F3;
        }
        
        @media (max-width: 992px) {
            .main-content {
                flex-direction: column;
            }
            
            .guide-panel, .terminal-panel {
                width: 100%;
                height: 50%;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Red+Hat+Text:wght@400;700&family=Red+Hat+Mono&display=swap" rel="stylesheet"/>
</head>
<body>
<div class="lab-container">
    <div class="header">
        <img alt="Red Hat Logo" src="https://www.redhat.com/profiles/rh/themes/redhatdotcom/img/logo.svg"/>
        <h1>RHCSA Lab 6.1: Configure IPv4/IPv6 Networking</h1>
    </div>
    
    <div class="main-content">
        <div class="guide-panel">
            <h2>Lab Instructions</h2>
            
            <div class="lab-intro">
                <h3>Lab Objective</h3>
                <p>Configure IPv4 and IPv6 networking on your system using NetworkManager. You will need to configure network interfaces, set IP addresses, configure gateways, and set up DNS servers for both IPv4 and IPv6.</p>
                <p><strong>Time Estimate:</strong> 15-20 minutes</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div id="progress-text">0% Complete</div>
            </div>

            <div class="requirements-panel">
                <h4>IPv4/IPv6 Configuration Requirements</h4>
                <div class="requirement-item" id="req-interface-check">
                    <span class="requirement-checkbox">‚òê</span>
                    <span class="requirement-label">Check network interfaces with <code>ip addr show</code></span>
                </div>
                <div class="requirement-item" id="req-ipv4-address">
                    <span class="requirement-checkbox">‚òê</span>
                    <span class="requirement-label">Configure IPv4 address: <code>192.168.1.100/24</code></span>
                </div>
                <div class="requirement-item" id="req-ipv6-address">
                    <span class="requirement-checkbox">‚òê</span>
                    <span class="requirement-label">Configure IPv6 address: <code>2001:db8::100/64</code></span>
                </div>
                <div class="requirement-item" id="req-ipv4-gateway">
                    <span class="requirement-checkbox">‚òê</span>
                    <span class="requirement-label">Configure IPv4 gateway: <code>192.168.1.1</code></span>
                </div>
                <div class="requirement-item" id="req-ipv6-gateway">
                    <span class="requirement-checkbox">‚òê</span>
                    <span class="requirement-label">Configure IPv6 gateway: <code>2001:db8::1</code></span>
                </div>
                <div class="requirement-item" id="req-ipv4-dns">
                    <span class="requirement-checkbox">‚òê</span>
                    <span class="requirement-label">Configure IPv4 DNS: <code>8.8.8.8 8.8.4.4</code></span>
                </div>
                <div class="requirement-item" id="req-ipv6-dns">
                    <span class="requirement-checkbox">‚òê</span>
                    <span class="requirement-label">Configure IPv6 DNS: <code>2001:4860:4860::8888 2001:4860:4860::8844</code></span>
                </div>
            </div>

            <div class="guide-step completed" id="step0">
                <h3>
                    <span class="step-number">0</span>
                    Lab Introduction
                    <span class="step-status status-completed">Completed</span>
                </h3>
                <p>Welcome to the RHCSA IPv4/IPv6 Networking Lab. In this lab, you will configure dual-stack networking (both IPv4 and IPv6) on a Red Hat Enterprise Linux system using NetworkManager.</p>
                <p>Follow the steps in order. You must complete each step before moving to the next one.</p>
            </div>

            <div class="guide-step current" id="step1">
                <h3>
                    <span class="step-number">1</span>
                    Check Network Interfaces
                    <span class="step-status status-current">Current Step</span>
                </h3>
                <p>First, let's check the current network interfaces and their configuration.</p>
                
                <div class="hint-box">
                    <strong>Type this command exactly:</strong>
                </div>
                
                <div class="command-hint">
                    ip addr show
                </div>

                <div class="concept">
                    <h4>Understanding Network Interfaces</h4>
                    <div class="concept-grid">
                        <div class="concept-item">
                            <strong>What</strong>
                            Physical and virtual network interfaces
                        </div>
                        <div class="concept-item">
                            <strong>Why</strong>
                            Identify available interfaces for configuration
                        </div>
                        <div class="concept-item">
                            <strong>Where</strong>
                            System-wide network configuration
                        </div>
                        <div class="concept-item">
                            <strong>When</strong>
                            Before configuring network settings
                        </div>
                    </div>
                    <p><strong>How it works:</strong> The <code>ip addr show</code> command displays all network interfaces with their current IP addresses (both <span class="ipv4">IPv4</span> and <span class="ipv6">IPv6</span>), MAC addresses, and state.</p>
                </div>
            </div>

            <div class="guide-step" id="step2">
                <h3>
                    <span class="step-number">2</span>
                    Configure IPv4 Address
                    <span class="step-status status-pending">Pending</span>
                </h3>
                <p>Now let's configure a static IPv4 address for the network interface.</p>
                
                <div class="hint-box">
                    <strong>Type these commands exactly:</strong>
                </div>
                
                <div class="command-hint">
                    sudo nmcli connection modify "Wired connection 1" ipv4.addresses 192.168.1.100/24
                </div>
                
                <div class="command-hint">
                    sudo nmcli connection up "Wired connection 1"
                </div>

                <div class="concept">
                    <h4>Understanding IPv4 Configuration</h4>
                    <div class="concept-grid">
                        <div class="concept-item">
                            <strong>What</strong>
                            <span class="ipv4">IPv4</span> address assignment
                        </div>
                        <div class="concept-item">
                            <strong>Why</strong>
                            Enable network communication using IPv4
                        </div>
                        <div class="concept-item">
                            <strong>Where</strong>
                            NetworkManager connection profiles
                        </div>
                        <div class="concept-item">
                            <strong>When</strong>
                            Setting up static IPv4 addressing
                        </div>
                    </div>
                    <p><strong>How it works:</strong> <code>nmcli</code> modifies NetworkManager connections. The <code>ipv4.addresses</code> parameter sets a static <span class="ipv4">IPv4</span> address with netmask (CIDR notation). The <code>up</code> command activates the changes.</p>
                </div>
            </div>

            <div class="guide-step" id="step3">
                <h3>
                    <span class="step-number">3</span>
                    Configure IPv6 Address
                    <span class="step-status status-pending">Pending</span>
                </h3>
                <p>Now let's configure a static IPv6 address for the network interface.</p>
                
                <div class="hint-box">
                    <strong>Type these commands exactly:</strong>
                </div>
                
                <div class="command-hint">
                    sudo nmcli connection modify "Wired connection 1" ipv6.addresses 2001:db8::100/64
                </div>
                
                <div class="command-hint">
                    sudo nmcli connection up "Wired connection 1"
                </div>

                <div class="concept">
                    <h4>Understanding IPv6 Configuration</h4>
                    <div class="concept-grid">
                        <div class="concept-item">
                            <strong>What</strong>
                            <span class="ipv6">IPv6</span> address assignment
                        </div>
                        <div class="concept-item">
                            <strong>Why</strong>
                            Enable network communication using IPv6
                        </div>
                        <div class="concept-item">
                            <strong>Where</strong>
                            NetworkManager connection profiles
                        </div>
                        <div class="concept-item">
                            <strong>When</strong>
                            Setting up static IPv6 addressing
                        </div>
                    </div>
                    <p><strong>How it works:</strong> Similar to <span class="ipv4">IPv4</span>, the <code>ipv6.addresses</code> parameter sets a static <span class="ipv6">IPv6</span> address with prefix length. The <code>up</code> command activates the changes.</p>
                </div>
            </div>

            <div class="guide-step" id="step4">
                <h3>
                    <span class="step-number">4</span>
                    Set Default Gateway
                    <span class="step-status status-pending">Pending</span>
                </h3>
                <p>Now let's configure the default gateways for both IPv4 and IPv6.</p>
                
                <div class="hint-box">
                    <strong>Type these commands exactly:</strong>
                </div>
                
                <div class="command-hint">
                    sudo nmcli connection modify "Wired connection 1" ipv4.gateway 192.168.1.1
                </div>
                
                <div class="command-hint">
                    sudo nmcli connection modify "Wired connection 1" ipv6.gateway 2001:db8::1
                </div>
                
                <div class="command-hint">
                    sudo nmcli connection up "Wired connection 1"
                </div>

                <div class="concept">
                    <h4>Understanding Gateways</h4>
                    <div class="concept-grid">
                        <div class="concept-item">
                            <strong>What</strong>
                            Default route for network traffic
                        </div>
                        <div class="concept-item">
                            <strong>Why</strong>
                            Allows communication beyond local network
                        </div>
                        <div class="concept-item">
                            <strong>Where</strong>
                            NetworkManager connection profiles
                        </div>
                        <div class="concept-item">
                            <strong>When</strong>
                            Configuring routing for networks
                        </div>
                    </div>
                    <p><strong>How it works:</strong> The gateway parameters (<code>ipv4.gateway</code> and <code>ipv6.gateway</code>) define the default route for each protocol. This is typically your router's address.</p>
                </div>
            </div>

            <div class="guide-step" id="step5">
                <h3>
                    <span class="step-number">5</span>
                    Configure DNS
                    <span class="step-status status-pending">Pending</span>
                </h3>
                <p>Finally, let's configure DNS servers for both IPv4 and IPv6.</p>
                
                <div class="hint-box">
                    <strong>Type these commands exactly:</strong>
                </div>
                
                <div class="command-hint">
                    sudo nmcli connection modify "Wired connection 1" ipv4.dns "8.8.8.8 8.8.4.4"
                </div>
                
                <div class="command-hint">
                    sudo nmcli connection modify "Wired connection 1" ipv6.dns "2001:4860:4860::8888 2001:4860:4860::8844"
                </div>
                
                <div class="command-hint">
                    sudo nmcli connection up "Wired connection 1"
                </div>

                <div class="concept">
                    <h4>Understanding DNS Configuration</h4>
                    <div class="concept-grid">
                        <div class="concept-item">
                            <strong>What</strong>
                            Domain Name System servers
                        </div>
                        <div class="concept-item">
                            <strong>Why</strong>
                            Resolve hostnames to IP addresses
                        </div>
                        <div class="concept-item">
                            <strong>Where</strong>
                            NetworkManager connection profiles
                        </div>
                        <div class="concept-item">
                            <strong>When</strong>
                            Setting up name resolution
                        </div>
                    </div>
                    <p><strong>How it works:</strong> DNS servers (<code>ipv4.dns</code> and <code>ipv6.dns</code>) are specified as space-separated lists. These are used for hostname resolution.</p>
                </div>
            </div>
            
            <div id="completion-message" class="completion-message" style="display: none;">
                <h3>üéâ Lab Completed Successfully!</h3>
                <p>All IPv4/IPv6 networking configuration requirements have been met.</p>
                <p>You can now proceed to the next lab.</p>
            </div>
        </div>
        
        <div class="terminal-panel">
            <div class="terminal" id="terminal-output">
                <div><span class="prompt">[user@lab ~]$</span> Welcome to RHCSA Lab 6.1: Configure IPv4/IPv6 Networking!</div>
                <div><span class="prompt">[user@lab ~]$</span> This is a guided lab. Follow the instructions on the left.</div>
                <div><span class="prompt">[user@lab ~]$</span> You must complete each step in order.</div>
                <div><span class="prompt">[user@lab ~]$</span> Current step: Check Network Interfaces</div>
                <div><span class="prompt">[user@lab ~]$</span> Type: <code>ip addr show</code></div>
                <div><span class="prompt">[user@lab ~]$</span> <span class="success">Tip:</span> Press <code>Tab</code> for command and path completion</div>
            </div>
            <div class="command-line">
                <span class="prompt">[user@lab ~]$</span>
                <input autofocus id="command-input" placeholder="Type the command shown in the current step..." type="text"/>
                <div id="tab-completion" class="tab-completion" style="display: none;"></div>
            </div>
        </div>
    </div>
</div>

<script>
    const commandInput = document.getElementById('command-input');
    const terminalOutput = document.getElementById('terminal-output');
    const requirementItems = document.querySelectorAll('.requirement-item');
    const progressFill = document.getElementById('progress-fill');
    const progressText = document.getElementById('progress-text');
    const completionMessage = document.getElementById('completion-message');
    const steps = document.querySelectorAll('.guide-step');
    const tabCompletion = document.getElementById('tab-completion');
    
    let commandHistory = [];
    let historyIndex = -1;
    let currentStep = 1;
    let tabCompletionIndex = -1;
    let tabCompletionItems = [];
    let lastTabInput = '';
    
    // Available commands for tab completion
    const availableCommands = [
        'ip', 'sudo', 'nmcli', 'clear', 'help'
    ];
    
    // Track configuration state
    const configState = {
        interfaceCheck: false,
        ipv4Address: false,
        ipv6Address: false,
        ipv4Gateway: false,
        ipv6Gateway: false,
        ipv4Dns: false,
        ipv6Dns: false
    };
    
    // Track completed commands for each step
    const stepCompletedCommands = {
        1: [],
        2: [],
        3: [],
        4: [],
        5: []
    };
    
    // Required commands for each step
    const requiredCommands = [
        { command: 'ip addr show', step: 1, feedback: 'Type exactly: ip addr show' },
        { command: 'sudo nmcli connection modify "Wired connection 1" ipv4.addresses 192.168.1.100/24', step: 2, feedback: 'Type exactly: sudo nmcli connection modify "Wired connection 1" ipv4.addresses 192.168.1.100/24' },
        { command: 'sudo nmcli connection up "Wired connection 1"', step: 2, feedback: 'Type exactly: sudo nmcli connection up "Wired connection 1"' },
        { command: 'sudo nmcli connection modify "Wired connection 1" ipv6.addresses 2001:db8::100/64', step: 3, feedback: 'Type exactly: sudo nmcli connection modify "Wired connection 1" ipv6.addresses 2001:db8::100/64' },
        { command: 'sudo nmcli connection up "Wired connection 1"', step: 3, feedback: 'Type exactly: sudo nmcli connection up "Wired connection 1"' },
        { command: 'sudo nmcli connection modify "Wired connection 1" ipv4.gateway 192.168.1.1', step: 4, feedback: 'Type exactly: sudo nmcli connection modify "Wired connection 1" ipv4.gateway 192.168.1.1' },
        { command: 'sudo nmcli connection modify "Wired connection 1" ipv6.gateway 2001:db8::1', step: 4, feedback: 'Type exactly: sudo nmcli connection modify "Wired connection 1" ipv6.gateway 2001:db8::1' },
        { command: 'sudo nmcli connection up "Wired connection 1"', step: 4, feedback: 'Type exactly: sudo nmcli connection up "Wired connection 1"' },
        { command: 'sudo nmcli connection modify "Wired connection 1" ipv4.dns "8.8.8.8 8.8.4.4"', step: 5, feedback: 'Type exactly: sudo nmcli connection modify "Wired connection 1" ipv4.dns "8.8.8.8 8.8.4.4"' },
        { command: 'sudo nmcli connection modify "Wired connection 1" ipv6.dns "2001:4860:4860::8888 2001:4860:4860::8844"', step: 5, feedback: 'Type exactly: sudo nmcli connection modify "Wired connection 1" ipv6.dns "2001:4860:4860::8888 2001:4860:4860::8844"' },
        { command: 'sudo nmcli connection up "Wired connection 1"', step: 5, feedback: 'Type exactly: sudo nmcli connection up "Wired connection 1"' }
    ];
    
    // Track which commands have been completed
    const completedCommands = {};
    requiredCommands.forEach((cmd, index) => {
        completedCommands[index] = false;
    });
    
    const commands = {
        'ip': (args) => {
            if (args[0] === 'addr' && args[1] === 'show') {
                configState.interfaceCheck = true;
                updateRequirements();
                return '1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000\n    link/ether 52:54:00:12:34:56 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.1.100/24 brd 192.168.1.255 scope global noprefixroute eth0\n       valid_lft forever preferred_lft forever\n    inet6 2001:db8::100/64 scope global noprefixroute \n       valid_lft forever preferred_lft forever\n    inet6 fe80::5054:ff:fe12:3456/64 scope link noprefixroute \n       valid_lft forever preferred_lft forever';
            }
            return 'Invalid ip command. Try: ip addr show';
        },
        
        'sudo': (args) => {
            if (args[0] === 'nmcli') {
                if (args[1] === 'connection') {
                    if (args[2] === 'modify') {
                        const conn = args[3];
                        const param = args[4];
                        const value = args.slice(5).join(' ');
                        
                        if (param === 'ipv4.addresses' && value === '192.168.1.100/24') {
                            configState.ipv4Address = true;
                            updateRequirements();
                            return 'Successfully modified connection "Wired connection 1" (IPv4 address set to 192.168.1.100/24)';
                        }
                        if (param === 'ipv6.addresses' && value === '2001:db8::100/64') {
                            configState.ipv6Address = true;
                            updateRequirements();
                            return 'Successfully modified connection "Wired connection 1" (IPv6 address set to 2001:db8::100/64)';
                        }
                        if (param === 'ipv4.gateway' && value === '192.168.1.1') {
                            configState.ipv4Gateway = true;
                            updateRequirements();
                            return 'Successfully modified connection "Wired connection 1" (IPv4 gateway set to 192.168.1.1)';
                        }
                        if (param === 'ipv6.gateway' && value === '2001:db8::1') {
                            configState.ipv6Gateway = true;
                            updateRequirements();
                            return 'Successfully modified connection "Wired connection 1" (IPv6 gateway set to 2001:db8::1)';
                        }
                        if (param === 'ipv4.dns' && value === '8.8.8.8 8.8.4.4') {
                            configState.ipv4Dns = true;
                            updateRequirements();
                            return 'Successfully modified connection "Wired connection 1" (IPv4 DNS set to 8.8.8.8,8.8.4.4)';
                        }
                        if (param === 'ipv6.dns' && value === '2001:4860:4860::8888 2001:4860:4860::8844') {
                            configState.ipv6Dns = true;
                            updateRequirements();
                            return 'Successfully modified connection "Wired connection 1" (IPv6 DNS set to 2001:4860:4860::8888,2001:4860:4860::8844)';
                        }
                    }
                    if (args[2] === 'up' && args[3] === '"Wired connection 1"') {
                        return 'Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/1)';
                    }
                }
            }
            return 'Invalid sudo command. Try: sudo nmcli connection modify "Wired connection 1" ...';
        },
        
        'clear': () => {
            terminalOutput.innerHTML = '';
            return '';
        },
        
        'help': () => {
            return "Available commands: ip, sudo nmcli, clear, help";
        }
    };
    
    // Function to update requirements display
    function updateRequirements() {
        if (configState.interfaceCheck) {
            document.getElementById('req-interface-check').classList.add('completed');
            document.getElementById('req-interface-check').querySelector('.requirement-checkbox').textContent = '‚úì';
        }
        
        if (configState.ipv4Address) {
            document.getElementById('req-ipv4-address').classList.add('completed');
            document.getElementById('req-ipv4-address').querySelector('.requirement-checkbox').textContent = '‚úì';
        }
        
        if (configState.ipv6Address) {
            document.getElementById('req-ipv6-address').classList.add('completed');
            document.getElementById('req-ipv6-address').querySelector('.requirement-checkbox').textContent = '‚úì';
        }
        
        if (configState.ipv4Gateway) {
            document.getElementById('req-ipv4-gateway').classList.add('completed');
            document.getElementById('req-ipv4-gateway').querySelector('.requirement-checkbox').textContent = '‚úì';
        }
        
        if (configState.ipv6Gateway) {
            document.getElementById('req-ipv6-gateway').classList.add('completed');
            document.getElementById('req-ipv6-gateway').querySelector('.requirement-checkbox').textContent = '‚úì';
        }
        
        if (configState.ipv4Dns) {
            document.getElementById('req-ipv4-dns').classList.add('completed');
            document.getElementById('req-ipv4-dns').querySelector('.requirement-checkbox').textContent = '‚úì';
        }
        
        if (configState.ipv6Dns) {
            document.getElementById('req-ipv6-dns').classList.add('completed');
            document.getElementById('req-ipv6-dns').querySelector('.requirement-checkbox').textContent = '‚úì';
        }
        
        // Update progress
        const completedCount = Object.values(configState).filter(v => v).length;
        const progressPercent = (completedCount / Object.keys(configState).length) * 100;
        progressFill.style.width = `${progressPercent}%`;
        progressText.textContent = `${Math.round(progressPercent)}% Complete`;
        
        // Show completion message if all requirements are met
        if (completedCount === Object.keys(configState).length) {
            completionMessage.style.display = 'block';
        }
    }
    
    // Function to complete a step
    function completeStep(step) {
        if (step === currentStep) {
            steps[step].classList.remove('current');
            steps[step].classList.add('completed');
            steps[step].querySelector('.step-status').textContent = 'Completed';
            steps[step].querySelector('.step-status').className = 'step-status status-completed';
            
            currentStep++;
            
            if (currentStep < steps.length) {
                steps[currentStep].classList.add('current');
                steps[currentStep].querySelector('.step-status').textContent = 'Current Step';
                steps[currentStep].querySelector('.step-status').className = 'step-status status-current';
                
                // Update terminal with next step info
                addTerminalOutput(`<div class="success">[user@lab ~]$ Step ${step} completed. Moving to step ${currentStep}.</div>`);
                
                // Show the command for the next step if available
                const nextStepCommands = requiredCommands.filter(cmd => cmd.step === currentStep);
                if (nextStepCommands.length > 0) {
                    addTerminalOutput(`[user@lab ~]$ Next command: ${nextStepCommands[0].command}`);
                }
            } else {
                // All steps completed - show final completion message
                addTerminalOutput(`<div class="success">[user@lab ~]$ Step ${step} completed. All steps finished!</div>`);
                addTerminalOutput(`<div class="success">üéâ Lab Completed Successfully! All networking commands executed correctly!</div>`);
                
                // Force update requirements to show completion message
                updateRequirements();
                completionMessage.style.display = 'block';
            }
        }
    }
    
    // Function to add output to the terminal
    function addTerminalOutput(text) {
        const newLine = document.createElement('div');
        newLine.innerHTML = text;
        terminalOutput.appendChild(newLine);
        terminalOutput.scrollTop = terminalOutput.scrollHeight;
    }
    
    // Function to handle command execution
    function executeCommand(input) {
        const trimmedInput = input.trim();
        if (!trimmedInput) return;
        
        // Add to command history
        commandHistory.push(trimmedInput);
        historyIndex = commandHistory.length;
        
        // Display the command in terminal
        addTerminalOutput(`<span class="prompt">[user@lab ~]$</span> ${trimmedInput}`);
        
        // Check if this is a required command for the CURRENT step
        let commandMatched = false;
        let matchedCommandIndex = -1;
        
        // First, check if it's a required command for the current step
        requiredCommands.forEach((req, index) => {
            if (req.step === currentStep && req.command === trimmedInput) {
                commandMatched = true;
                matchedCommandIndex = index;
                
                if (!completedCommands[index]) {
                    completedCommands[index] = true;
                    addTerminalOutput(`<div class="success">‚úÖ Correct command for step ${currentStep}</div>`);
                    
                    // Execute the command logic
                    const parts = trimmedInput.split(' ');
                    const command = parts[0];
                    const args = parts.slice(1);
                    
                    if (commands.hasOwnProperty(command)) {
                        const result = commands[command](args);
                        if (result) {
                            addTerminalOutput(result);
                        }
                    }
                    
                    // Check if current step is now completed
                    checkStepCompletion();
                } else {
                    addTerminalOutput(`<div class="warning">Command already executed for this step</div>`);
                }
                return;
            }
        });
        
        // If not a required command for current step, handle other cases
        if (!commandMatched) {
            const parts = trimmedInput.split(' ');
            const command = parts[0];
            
            // Check if it's a valid command but for wrong step
            const isCommandForOtherStep = requiredCommands.some(req => 
                req.command === trimmedInput && req.step !== currentStep
            );
            
            if (isCommandForOtherStep) {
                addTerminalOutput(`<div class="error">‚ö†Ô∏è This command belongs to a different step. Complete step ${currentStep} first.</div>`);
            } 
            // Check if it's a required command type but wrong syntax
            else if (requiredCommands.some(req => 
                req.step === currentStep && req.command.split(' ')[0] === command
            )) {
                const currentStepCmd = requiredCommands.find(req => 
                    req.step === currentStep && req.command.split(' ')[0] === command
                );
                addTerminalOutput(`<div class="error">‚ö†Ô∏è Incorrect syntax. Required: ${currentStepCmd.command}</div>`);
            }
            // Handle other valid commands
            else if (commands.hasOwnProperty(command)) {
                const result = commands[command](parts.slice(1));
                if (result) {
                    addTerminalOutput(result);
                }
            } else {
                addTerminalOutput(`bash: ${command}: command not found`);
                addTerminalOutput('Type "help" for available commands');
            }
        }
    }
    
    // Function to check if current step is completed
    function checkStepCompletion() {
        const currentStepCommands = requiredCommands.filter(req => req.step === currentStep);
        
        // Check if ALL commands for the current step are completed
        const allCompleted = currentStepCommands.every(reqCmd => {
            const cmdIndex = requiredCommands.findIndex(cmd => 
                cmd.command === reqCmd.command && cmd.step === reqCmd.step
            );
            return completedCommands[cmdIndex] === true;
        });
        
        if (allCompleted && currentStepCommands.length > 0) {
            setTimeout(() => {
                completeStep(currentStep);
            }, 1000);
        }
    }
    
    // Function to handle tab completion
    function handleTabCompletion() {
        const input = commandInput.value;
        
        // If this is a consecutive tab press with no change in input, cycle through options
        if (input === lastTabInput && tabCompletionItems.length > 1) {
            tabCompletionIndex = (tabCompletionIndex + 1) % tabCompletionItems.length;
            showTabCompletion(tabCompletionItems, tabCompletionIndex);
            return;
        }
        
        lastTabInput = input;
        const parts = input.split(' ');
        const lastPart = parts[parts.length - 1];
        
        // Reset tab completion state for new input
        tabCompletionIndex = 0;
        
        // If no input, show all available commands
        if (parts.length === 1 && lastPart === '') {
            tabCompletionItems = availableCommands;
            showTabCompletion(tabCompletionItems, 0);
            return;
        }
        
        // If it's a command completion
        if (parts.length === 1) {
            tabCompletionItems = availableCommands.filter(cmd => 
                cmd.startsWith(lastPart)
            );
            
            if (tabCompletionItems.length > 0) {
                showTabCompletion(tabCompletionItems, 0);
            } else {
                hideTabCompletion();
            }
            return;
        }
        
        // No path completion for this lab
        hideTabCompletion();
    }
    
    // Function to show tab completion suggestions
    function showTabCompletion(items, selectedIndex) {
        if (items.length === 0) {
            hideTabCompletion();
            return;
        }
        
        // If only one item, auto-complete
        if (items.length === 1) {
            completeWithSuggestion(items[0]);
            hideTabCompletion();
            return;
        }
        
        // Create completion items
        tabCompletion.innerHTML = '';
        items.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = `tab-completion-item ${index === selectedIndex ? 'selected' : ''}`;
            div.textContent = item;
            div.addEventListener('click', () => {
                completeWithSuggestion(item);
                hideTabCompletion();
            });
            tabCompletion.appendChild(div);
        });
        
        // Show the completion box
        tabCompletion.style.display = 'block';
        
        tabCompletionIndex = selectedIndex;
        tabCompletionItems = items;
    }
    
    // Function to hide tab completion
    function hideTabCompletion() {
        tabCompletion.style.display = 'none';
        tabCompletionItems = [];
        tabCompletionIndex = -1;
    }
    
    // Function to complete the input with a suggestion
    function completeWithSuggestion(suggestion) {
        const input = commandInput.value;
        const parts = input.split(' ');
        const lastPart = parts[parts.length - 1];
        
        if (parts.length === 1) {
            // Command completion
            commandInput.value = suggestion + ' ';
        }
        
        // Move cursor to end
        commandInput.selectionStart = commandInput.selectionEnd = commandInput.value.length;
        lastTabInput = commandInput.value;
    }
    
    // Event listeners
    commandInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            executeCommand(commandInput.value);
            commandInput.value = '';
            hideTabCompletion();
            lastTabInput = '';
        } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            if (commandHistory.length > 0) {
                if (historyIndex > 0) {
                    historyIndex--;
                }
                commandInput.value = commandHistory[historyIndex] || '';
            }
            hideTabCompletion();
        } else if (e.key === 'ArrowDown') {
            e.preventDefault();
            if (historyIndex < commandHistory.length - 1) {
                historyIndex++;
                commandInput.value = commandHistory[historyIndex];
            } else {
                historyIndex = commandHistory.length;
                commandInput.value = '';
            }
            hideTabCompletion();
        } else if (e.key === 'Tab') {
            e.preventDefault();
            handleTabCompletion();
        } else if (e.key === 'Escape') {
            hideTabCompletion();
        } else {
            // Hide tab completion on other key presses if input changes
            setTimeout(() => {
                if (commandInput.value !== lastTabInput) {
                    hideTabCompletion();
                }
            }, 0);
        }
    });
    
    // Hide tab completion when clicking outside
    document.addEventListener('click', (e) => {
        if (!tabCompletion.contains(e.target) && e.target !== commandInput) {
            hideTabCompletion();
        }
    });
    
    // Initialize the lab
    updateRequirements();
</script>
</body>
</html>