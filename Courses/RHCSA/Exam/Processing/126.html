<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>RHCSA Exam Lab 126: Running Containers with systemd (logserver)</title>
    <style>
        :root {
            --redhat-red: #cc0000;
            --redhat-dark: #1e1e1e;
            --redhat-light: #f0f0f0;
            --redhat-accent: #4CAF50;
            --redhat-blue: #007ACC;
            --panel-bg: #252525;
            --terminal-bg: #000;
            --border-color: #444;
            --current-step-bg: #3a3a3a;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Red Hat Text', 'Overpass', sans-serif;
            background-color: var(--redhat-dark);
            color: var(--redhat-light);
            margin: 0;
            padding: 0;
            line-height: 1.6;
            height: 100vh;
            overflow: hidden;
        }

        .lab-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background: var(--redhat-dark);
        }

        .header {
            background: linear-gradient(to right, #1e1e1e, #333);
            padding: 15px 20px;
            color: white;
            display: flex;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }

        .header img {
            height: 30px;
            margin-right: 15px;
        }

        .header h1 {
            margin: 0;
            font-size: 1.4em;
            font-weight: normal;
        }

        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .guide-panel {
            width: 50%;
            padding: 20px;
            background: var(--panel-bg);
            overflow-y: auto;
            border-right: 1px solid var(--border-color);
        }

        .terminal-panel {
            width: 50%;
            display: flex;
            flex-direction: column;
            background: var(--panel-bg);
        }

        h2 {
            margin-top: 0;
            color: var(--redhat-accent);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .lab-intro {
            background: rgba(76, 175, 80, 0.1);
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid var(--redhat-accent);
        }

        .lab-intro h3 {
            margin-top: 0;
            color: var(--redhat-accent);
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #333;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            width: 0%;
            background: var(--redhat-accent);
            transition: width 0.3s ease;
        }

        #progress-text {
            font-size: 0.9em;
            margin-top: 5px;
            color: #ccc;
        }

        .requirements-panel {
            background: #2a2a2a;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            border-left: 4px solid var(--redhat-red);
        }

        .requirements-panel h4 {
            margin-top: 0;
            color: var(--redhat-red);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
        }

        .requirement-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .requirement-checkbox {
            width: 18px;
            height: 18px;
            border-radius: 3px;
            border: 1px solid #666;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
            font-size: 0.8em;
        }

        .requirement-item.completed {
            color: var(--redhat-accent);
        }

        .requirement-item.completed .requirement-checkbox {
            background: var(--redhat-accent);
            border-color: var(--redhat-accent);
            color: #fff;
        }

        .requirement-label {
            flex: 1;
        }

        .guide-step {
            background: #2c2c2c;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
            border-left: 4px solid #555;
        }

        .guide-step.current {
            background: var(--current-step-bg);
            border-left-color: var(--redhat-blue);
        }

        .guide-step.completed {
            border-left-color: var(--redhat-accent);
            opacity: 0.9;
        }

        .guide-step h3 {
            margin-top: 0;
            display: flex;
            align-items: center;
        }

        .step-number {
            background: #444;
            color: #fff;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-size: 0.8em;
        }

        .step-status {
            margin-left: auto;
            font-size: 0.8em;
            padding: 3px 8px;
            border-radius: 3px;
        }

        .status-pending {
            background: #555;
            color: #ccc;
        }

        .status-current {
            background: var(--redhat-blue);
            color: white;
        }

        .status-completed {
            background: var(--redhat-accent);
            color: white;
        }

        .hint-box {
            background: rgba(0, 122, 204, 0.1);
            padding: 8px 10px;
            border-radius: 3px;
            border-left: 3px solid var(--redhat-blue);
            font-size: 0.9em;
            margin: 10px 0;
        }

        .command-hint {
            background: #2a2a2a;
            padding: 10px;
            border-radius: 3px;
            margin: 10px 0;
            border-left: 3px solid var(--redhat-blue);
            font-family: 'Red Hat Mono', monospace;
        }

        .file-content {
            background: #1f1f1f;
            padding: 10px;
            border-radius: 3px;
            font-family: 'Red Hat Mono', monospace;
            white-space: pre;
            margin: 10px 0;
            border-left: 3px solid var(--redhat-accent);
        }

        .concept {
            background: #2a2a2a;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            border-left: 4px solid var(--redhat-blue);
        }

        .concept h4 {
            margin-top: 0;
            color: var(--redhat-blue);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
        }

        .completion-message {
            background: rgba(76, 175, 80, 0.15);
            border-left: 4px solid var(--redhat-accent);
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }

        .completion-message h3 {
            margin-top: 0;
            color: var(--redhat-accent);
        }

        .warning {
            color: #ffcc00;
            font-size: 0.9em;
        }

        .terminal {
            background: var(--terminal-bg);
            padding: 15px;
            flex: 1;
            overflow-y: auto;
            font-family: 'Red Hat Mono', monospace;
            font-size: 14px;
        }

        .command-line {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #333;
            border-top: 1px solid var(--border-color);
            margin-top: auto;
            flex-shrink: 0;
        }

        #command-input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--redhat-light);
            font-family: 'Red Hat Mono', monospace;
            font-size: 16px;
            outline: none;
            padding: 8px;
        }

        .prompt {
            color: var(--redhat-accent);
            white-space: nowrap;
            margin-right: 5px;
        }

        .success {
            color: var(--redhat-accent);
        }

        .error {
            color: #ff6b6b;
        }

        @media (max-width: 992px) {
            .main-content {
                flex-direction: column;
            }

            .guide-panel,
            .terminal-panel {
                width: 100%;
                height: 50%;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Red+Hat+Text:wght@400;700&family=Red+Hat+Mono&display=swap" rel="stylesheet"/>
</head>
<body>
<div class="lab-container">
    <div class="header">
        <img alt="Red Hat Logo" src="https://www.redhat.com/profiles/rh/themes/redhatdotcom/img/logo.svg"/>
        <h1>RHCSA Exam Lab 126: Running Containers with systemd (logserver)</h1>
    </div>

    <div class="main-content">
        <div class="guide-panel">
            <h2>Lab Instructions</h2>

            <div class="lab-intro">
                <h3>Lab Objective</h3>
                <p>
                    Create a container named <code>logserver</code> with the image
                    <code>rhel8/rsyslog</code> from the registry
                    <code>registry.domain15.example.com:5000</code>.
                </p>
                <p>
                    The container must run as the <strong>rootless</strong> user
                    <code>shangrila</code> (use <code>redhat</code> as the sudo password),
                    and be managed by a user systemd service named
                    <code>container-logserver</code> so that it is persistent across reboot.
                </p>
                <p>
                    When authenticating to the image registry, use:
                    <strong>username</strong> <code>admin</code> and
                    <strong>password</strong> <code>admin123</code>.
                </p>
                <p><strong>Time Estimate:</strong> 15‚Äì20 minutes</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div id="progress-text">0% Complete</div>
            </div>

            <div class="requirements-panel">
                <h4>Configuration Requirements</h4>
                <div class="requirement-item" id="req-registry-login">
                    <span class="requirement-checkbox">‚òê</span>
                    <span class="requirement-label">
                        Logged in to <code>registry.domain15.example.com:5000</code> as
                        <code>admin/admin123</code> using <code>podman login</code>
                    </span>
                </div>
                <div class="requirement-item" id="req-image-pulled">
                    <span class="requirement-checkbox">‚òê</span>
                    <span class="requirement-label">
                        Image <code>registry.domain15.example.com:5000/rhel8/rsyslog</code> pulled
                    </span>
                </div>
                <div class="requirement-item" id="req-container-created">
                    <span class="requirement-checkbox">‚òê</span>
                    <span class="requirement-label">
                        Container <code>logserver</code> created from the rsyslog image
                    </span>
                </div>
                <div class="requirement-item" id="req-service-installed">
                    <span class="requirement-checkbox">‚òê</span>
                    <span class="requirement-label">
                        systemd user unit <code>container-logserver.service</code> created under
                        <code>~/.config/systemd/user/</code>
                    </span>
                </div>
                <div class="requirement-item" id="req-service-enabled">
                    <span class="requirement-checkbox">‚òê</span>
                    <span class="requirement-label">
                        <code>container-logserver.service</code> enabled and started via
                        <code>systemctl --user enable --now</code>
                    </span>
                </div>
                <div class="requirement-item" id="req-container-running">
                    <span class="requirement-checkbox">‚òê</span>
                    <span class="requirement-label">
                        <code>podman ps</code> shows <code>logserver</code> running from
                        <code>registry.domain15.example.com:5000/rhel8/rsyslog</code>
                    </span>
                </div>
            </div>

            <div class="guide-step completed" id="step0">
                <h3>
                    <span class="step-number">0</span>
                    Lab Introduction
                    <span class="step-status status-completed">Completed</span>
                </h3>
                <p>
                    In this lab you will use <code>podman</code>, a private registry,
                    and user-level systemd units to run a rootless container that
                    automatically starts via <code>container-logserver.service</code>.
                </p>
                <p>
                    All commands are run as the user <code>shangrila</code> on
                    <code>node1.domain15.example.com</code>.
                </p>
            </div>

            <div class="guide-step current" id="step1">
                <h3>
                    <span class="step-number">1</span>
                    Log in to the image registry
                    <span class="step-status status-current">Current Step</span>
                </h3>
                <p>
                    First, authenticate to the private registry as instructed:
                </p>
                <div class="hint-box">
                    <strong>Type this command exactly:</strong>
                </div>
                <div class="command-hint">
                    podman login registry.domain15.example.com:5000
                </div>
                <p>
                    When prompted (in the real exam), use:
                </p>
                <div class="file-content">
Username: admin
Password: admin123
                </div>
                <div class="concept">
                    <h4>Why registry login?</h4>
                    <p>
                        You must authenticate before pulling from a protected registry.
                        Without a successful <code>podman login</code>, pulls will fail.
                    </p>
                </div>
            </div>

            <div class="guide-step" id="step2">
                <h3>
                    <span class="step-number">2</span>
                    Pull the rhel8/rsyslog image
                    <span class="step-status status-pending">Pending</span>
                </h3>
                <p>
                    Pull the rsyslog image from the registry so it is available locally:
                </p>
                <div class="command-hint">
                    podman pull registry.domain15.example.com:5000/rhel8/rsyslog
                </div>
            </div>

            <div class="guide-step" id="step3">
                <h3>
                    <span class="step-number">3</span>
                    Run the logserver container (rootless)
                    <span class="step-status status-pending">Pending</span>
                </h3>
                <p>
                    Start a rootless container named <code>logserver</code> from the image:
                </p>
                <div class="command-hint">
                    podman run -d --name logserver registry.domain15.example.com:5000/rhel8/rsyslog
                </div>
                <div class="concept">
                    <h4>Rootless Podman</h4>
                    <p>
                        Running as user <code>shangrila</code> means the container is
                        rootless (no full root privileges on the host), which is what the
                        exam task requires.
                    </p>
                </div>
            </div>

            <div class="guide-step" id="step4">
                <h3>
                    <span class="step-number">4</span>
                    Generate a systemd unit for logserver
                    <span class="step-status status-pending">Pending</span>
                </h3>
                <p>
                    Generate a user systemd unit for the <code>logserver</code> container:
                </p>
                <div class="command-hint">
                    podman generate systemd --user --name logserver --files --new
                </div>
                <p>
                    This will create <code>container-logserver.service</code> in the
                    current directory.
                </p>
            </div>

            <div class="guide-step" id="step5">
                <h3>
                    <span class="step-number">5</span>
                    Install the systemd unit into user config
                    <span class="step-status status-pending">Pending</span>
                </h3>
                <p>
                    Create the user systemd directory (if needed) and move the unit file:
                </p>
                <div class="command-hint">
                    mkdir -p ~/.config/systemd/user && mv container-logserver.service ~/.config/systemd/user/
                </div>
                <p class="warning">
                    In the real exam, ensure you are in the home directory of
                    <code>shangrila</code> when running this command.
                </p>
            </div>

            <div class="guide-step" id="step6">
                <h3>
                    <span class="step-number">6</span>
                    Enable and start container-logserver
                    <span class="step-status status-pending">Pending</span>
                </h3>
                <p>
                    Enable and start the service so that it runs now and on reboot:
                </p>
                <div class="command-hint">
                    systemctl --user enable --now container-logserver.service
                </div>
                <div class="concept">
                    <h4>Persistence across reboot</h4>
                    <p>
                        A user service enabled with <code>--now</code> and linger
                        configured will be restarted automatically when the system
                        reboots, satisfying ‚Äúpersistent across reboot‚Äù.
                    </p>
                </div>
            </div>

            <div class="guide-step" id="step7">
                <h3>
                    <span class="step-number">7</span>
                    Verify the container is running via systemd
                    <span class="step-status status-pending">Pending</span>
                </h3>
                <p>
                    Finally, confirm that <code>logserver</code> is running under podman:
                </p>
                <div class="command-hint">
                    podman ps
                </div>
                <p>
                    You should see <code>logserver</code> using the image
                    <code>registry.domain15.example.com:5000/rhel8/rsyslog:latest</code>.
                </p>
            </div>

            <div id="completion-message" class="completion-message" style="display: none;">
                <h3>üéâ Lab Completed Successfully!</h3>
                <p>
                    You have:
                </p>
                <ul>
                    <li>Logged in to <code>registry.domain15.example.com:5000</code> as <code>admin</code></li>
                    <li>Pulled <code>rhel8/rsyslog</code> from the registry</li>
                    <li>Created a rootless container <code>logserver</code></li>
                    <li>Generated <code>container-logserver.service</code> with <code>podman generate systemd</code></li>
                    <li>Installed and enabled the unit with <code>systemctl --user enable --now</code></li>
                    <li>Verified the container is running via <code>podman ps</code></li>
                </ul>
                <p>
                    This matches the RHCSA-style task:
                    <em>Task 15 [Running Containers] ‚Äì Configure a rootless container managed by user systemd.</em>
                </p>
                <p>You can now move on to the next lab.</p>
            </div>
        </div>

        <div class="terminal-panel">
            <div class="terminal" id="terminal-output">
                <div><span class="prompt">[shangrila@node1 ~]$</span> Welcome to RHCSA Lab 126: Running Containers with systemd (logserver)</div>
                <div><span class="prompt">[shangrila@node1 ~]$</span> Follow the steps on the left. Commands are simulated for this lab.</div>
                <div><span class="prompt">[shangrila@node1 ~]$</span> Current step: log in to the registry</div>
                <div><span class="prompt">[shangrila@node1 ~]$</span> Type: <code>podman login registry.domain15.example.com:5000</code></div>
            </div>
            <div class="command-line">
                <span class="prompt">[shangrila@node1 ~]$</span>
                <input id="command-input" type="text" placeholder="Type the command shown in the current step." autofocus/>
            </div>
        </div>
    </div>
</div>

<script>
    const commandInput = document.getElementById('command-input');
    const terminalOutput = document.getElementById('terminal-output');
    const progressFill = document.getElementById('progress-fill');
    const progressText = document.getElementById('progress-text');
    const completionMessage = document.getElementById('completion-message');

    let commandHistory = [];
    let historyIndex = -1;
    let currentStep = 1;

    // Lab state
    const configState = {
        registryLogin: false,
        imagePulled: false,
        containerCreated: false,
        serviceInstalled: false,
        serviceEnabled: false,
        containerRunning: false
    };

    let loggedIntoRegistry = false;
    let imageAvailable = false;
    let containerExists = false;
    let serviceFileGenerated = false;
    let serviceInstalled = false;
    let serviceActive = false;

    const stepCommands = {
        1: ['podman login registry.domain15.example.com:5000'],
        2: ['podman pull registry.domain15.example.com:5000/rhel8/rsyslog'],
        3: ['podman run -d --name logserver registry.domain15.example.com:5000/rhel8/rsyslog'],
        4: ['podman generate systemd --user --name logserver --files --new'],
        5: ['mkdir -p ~/.config/systemd/user && mv container-logserver.service ~/.config/systemd/user/'],
        6: ['systemctl --user enable --now container-logserver.service'],
        7: ['podman ps']
    };

    function addTerminalOutput(text) {
        const line = document.createElement('div');
        line.innerHTML = text;
        terminalOutput.appendChild(line);
        terminalOutput.scrollTop = terminalOutput.scrollHeight;
    }

    function updateRequirements() {
        if (configState.registryLogin) {
            const item = document.getElementById('req-registry-login');
            item.classList.add('completed');
            item.querySelector('.requirement-checkbox').textContent = '‚úì';
        }
        if (configState.imagePulled) {
            const item = document.getElementById('req-image-pulled');
            item.classList.add('completed');
            item.querySelector('.requirement-checkbox').textContent = '‚úì';
        }
        if (configState.containerCreated) {
            const item = document.getElementById('req-container-created');
            item.classList.add('completed');
            item.querySelector('.requirement-checkbox').textContent = '‚úì';
        }
        if (configState.serviceInstalled) {
            const item = document.getElementById('req-service-installed');
            item.classList.add('completed');
            item.querySelector('.requirement-checkbox').textContent = '‚úì';
        }
        if (configState.serviceEnabled) {
            const item = document.getElementById('req-service-enabled');
            item.classList.add('completed');
            item.querySelector('.requirement-checkbox').textContent = '‚úì';
        }
        if (configState.containerRunning) {
            const item = document.getElementById('req-container-running');
            item.classList.add('completed');
            item.querySelector('.requirement-checkbox').textContent = '‚úì';
        }

        const completedCount = Object.values(configState).filter(Boolean).length;
        const total = Object.keys(configState).length;
        const percent = (completedCount / total) * 100;
        progressFill.style.width = percent + '%';
        progressText.textContent = Math.round(percent) + '% Complete';

        if (completedCount === total) {
            completionMessage.style.display = 'block';
        }
    }

    function completeStep(step) {
        if (step !== currentStep) return;

        const stepElement = document.getElementById('step' + step);
        if (!stepElement) return;

        stepElement.classList.remove('current');
        stepElement.classList.add('completed');
        const statusSpan = stepElement.querySelector('.step-status');
        statusSpan.textContent = 'Completed';
        statusSpan.className = 'step-status status-completed';

        currentStep++;
        const nextStep = document.getElementById('step' + currentStep);
        if (nextStep) {
            nextStep.classList.add('current');
            const nextStatus = nextStep.querySelector('.step-status');
            nextStatus.textContent = 'Current Step';
            nextStatus.className = 'step-status status-current';
            addTerminalOutput(
                `<span class="prompt">[shangrila@node1 ~]$</span> Step ${step} completed. Moving to step ${currentStep}.`
            );
            const hint = stepCommands[currentStep] && stepCommands[currentStep][0];
            if (hint) {
                addTerminalOutput(
                    `<span class="prompt">[shangrila@node1 ~]$</span> Next: <code>${hint}</code>`
                );
            }
        } else {
            addTerminalOutput(
                `<span class="prompt">[shangrila@node1 ~]$</span> All steps completed. Review the summary on the left.`
            );
        }
    }

    const commands = {
        podman: (args) => {
            const full = ['podman'].concat(args).join(' ');

            // Step 1: login
            if (full === stepCommands[1][0]) {
                if (currentStep !== 1) {
                    return '<span class="error">This command belongs to Step 1. Follow the steps in order.</span>';
                }
                loggedIntoRegistry = true;
                configState.registryLogin = true;
                updateRequirements();
                completeStep(1);
                return `Username: admin
Password: 
Login Succeeded!`;
            }

            // Step 2: pull
            if (full === stepCommands[2][0]) {
                if (currentStep < 2) {
                    return '<span class="error">Log in to the registry before pulling the image.</span>';
                }
                imageAvailable = true;
                configState.imagePulled = true;
                updateRequirements();
                completeStep(2);
                return `Trying to pull registry.domain15.example.com:5000/rhel8/rsyslog...
Getting image source signatures
Copying blob ... done
Copying config ... done
Writing manifest to image destination
Storing signatures`;
            }

            // Step 3: run container
            if (full === stepCommands[3][0]) {
                if (currentStep < 3) {
                    return '<span class="error">Pull the image before running the container.</span>';
                }
                if (!imageAvailable) {
                    return '<span class="error">Image not available. Make sure you pulled it from the registry first.</span>';
                }
                containerExists = true;
                configState.containerCreated = true;
                updateRequirements();
                completeStep(3);
                return '7d9f7a8a4d63e0d3d4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9'; // simulated container ID
            }

            // Step 4: generate systemd unit
            if (full === stepCommands[4][0]) {
                if (currentStep < 4) {
                    return '<span class="error">Create the container before generating a systemd unit.</span>';
                }
                if (!containerExists) {
                    return '<span class="error">Container "logserver" does not exist yet.</span>';
                }
                serviceFileGenerated = true;
                // Don't mark requirement yet; we only mark after install
                completeStep(4);
                return `# container-logserver.service
# This file is generated by podman generate systemd

[Unit]
Description=Podman container-logserver.service
After=network.target

[Service]
Restart=always
ExecStart=/usr/bin/podman run --name logserver registry.domain15.example.com:5000/rhel8/rsyslog
ExecStop=/usr/bin/podman stop -t 10 logserver
ExecStopPost=/usr/bin/podman rm -f logserver

[Install]
WantedBy=default.target`;
            }

            // Step 7: verify with podman ps
            if (full === stepCommands[7][0]) {
                if (currentStep < 7) {
                    return '<span class="error">Enable and start the container-logserver.service before verifying with podman ps.</span>';
                }
                if (!containerExists || !serviceActive) {
                    return '<span class="error">logserver is not yet running as a systemd-managed container.</span>';
                }
                configState.containerRunning = true;
                updateRequirements();
                completeStep(7);
                return `CONTAINER ID  IMAGE                                                     COMMAND             CREATED          STATUS          PORTS  NAMES
7d9f7a8a4d63  registry.domain15.example.com:5000/rhel8/rsyslog:latest  /bin/rsyslog.sh     2 seconds ago    Up 2 seconds           logserver`;
            }

            return 'For this lab, use the podman commands shown in each step.';
        },

        mkdir: (args) => {
            const full = ['mkdir'].concat(args).join(' ');
            if (full === 'mkdir -p ~/.config/systemd/user && mv container-logserver.service ~/.config/systemd/user/') {
                // unlikely, because "&&" splits, but handle anyway
                return commands.combo([full]);
            }
            return 'For this lab, use the combined command:<br><code>mkdir -p ~/.config/systemd/user && mv container-logserver.service ~/.config/systemd/user/</code>';
        },

        systemctl: (args) => {
            const full = ['systemctl'].concat(args).join(' ');
            if (full === stepCommands[6][0]) {
                if (currentStep < 6) {
                    return '<span class="error">Install the systemd unit file under ~/.config/systemd/user/ before enabling it.</span>';
                }
                if (!serviceInstalled) {
                    return '<span class="error">container-logserver.service is not installed yet. Complete the previous step.</span>';
                }
                configState.serviceEnabled = true;
                serviceActive = true;
                updateRequirements();
                completeStep(6);
                return '';
            }
            return 'For this lab, use: <code>systemctl --user enable --now container-logserver.service</code>';
        },

        clear: () => {
            terminalOutput.innerHTML = '';
            return '';
        },

        help: () => {
            return `Available commands in this lab:
- podman login registry.domain15.example.com:5000
- podman pull registry.domain15.example.com:5000/rhel8/rsyslog
- podman run -d --name logserver registry.domain15.example.com:5000/rhel8/rsyslog
- podman generate systemd --user --name logserver --files --new
- mkdir -p ~/.config/systemd/user && mv container-logserver.service ~/.config/systemd/user/
- systemctl --user enable --now container-logserver.service
- podman ps
- clear
- help`;
        },

        combo: (lines) => {
            // Handle the combined mkdir+mv command explicitly
            const cmd = lines[0];
            if (cmd === stepCommands[5][0]) {
                if (currentStep < 5) {
                    return '<span class="error">Generate the systemd unit file before installing it.</span>';
                }
                if (!serviceFileGenerated) {
                    return '<span class="error">container-logserver.service has not been generated yet.</span>';
                }
                serviceInstalled = true;
                configState.serviceInstalled = true;
                updateRequirements();
                completeStep(5);
                return '';
            }
            return '';
        }
    };

    function executeCommand(input) {
        const trimmed = input.trim();
        if (!trimmed) return;

        commandHistory.push(trimmed);
        historyIndex = commandHistory.length;

        addTerminalOutput(`<span class="prompt">[shangrila@node1 ~]$</span> ${trimmed}`);

        // Special-case the combined mkdir+mv command as a single unit
        if (trimmed === stepCommands[5][0]) {
            const result = commands.combo([trimmed]);
            if (result) addTerminalOutput(result);
            return;
        }

        const parts = trimmed.split(/\s+/);
        const cmd = parts[0];
        const args = parts.slice(1);

        if (commands[cmd]) {
            const result = commands[cmd](args);
            if (result) {
                addTerminalOutput(result);
            }
        } else {
            addTerminalOutput(`bash: ${cmd}: command not found`);
            addTerminalOutput('Type "help" to see the simulated commands available in this lab.');
        }
    }

    commandInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            executeCommand(commandInput.value);
            commandInput.value = '';
        } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            if (commandHistory.length > 0) {
                if (historyIndex > 0) historyIndex--;
                commandInput.value = commandHistory[historyIndex] || '';
            }
        } else if (e.key === 'ArrowDown') {
            e.preventDefault();
            if (historyIndex < commandHistory.length - 1) {
                historyIndex++;
                commandInput.value = commandHistory[historyIndex] || '';
            } else {
                historyIndex = commandHistory.length;
                commandInput.value = '';
            }
        }
    });

    // Init progress UI
    updateRequirements();
</script>
</body>
</html>
