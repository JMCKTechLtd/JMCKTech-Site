<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Windows 11 Beginner Lab 1 ‚Äî Desktop Basics (Simulation)</title>
  <style>
    :root{
      --bg:#0066B3;         /* softer Windows blue backdrop */
      --taskbar:#111318cc;
      --panel:#1a1d24f2;
      --panel2:#0f1218f2;
      --text:#eef2ff;
      --muted:#b9c3d9;
      --accent:#7dd3fc;
      --ok:#22c55e;
      --warn:#f59e0b;
      --danger:#ef4444;
      --shadow: 0 18px 45px rgba(0,0,0,.35);
      --glass: blur(10px);
      --border: 1px solid rgba(255,255,255,.12);
      --radius: 14px;
      --radius2: 12px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    html,body{height:100%; margin:0; font-family:var(--font); color:var(--text); overflow:hidden;}
    body{
      background: var(--bg); /* plain blue, no gradients */
    }

    /* ===== Loading Screen ===== */
    .loading-screen {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: #000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 99999;
      opacity: 1;
      transition: opacity 0.5s ease;
    }
    .loading-screen.fade-out {
      opacity: 0;
      pointer-events: none;
    }
    .loading-logo {
      width: 80px;
      height: 80px;
      margin-bottom: 30px;
      animation: pulse-glow 2s ease-in-out infinite;
    }
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(255,255,255,0.1);
      border-top-color: #0078d4;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    @keyframes pulse-glow {
      0%, 100% { opacity: 0.6; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.05); }
    }

    /* ===== Desktop ===== */
    .desktop{
      position:relative;
      height:100%;
      width:100%;
      padding:18px 18px 70px 18px; /* leave room for taskbar */
      user-select:none;
    }

    .desktop-icons{
      display:grid;
      grid-template-columns: repeat(1, 92px);
      grid-auto-rows: 96px;
      gap:10px;
      align-content:start;
      justify-content:start;
      width:92px;
    }

    .icon{
      width:92px;
      padding:10px 8px;
      border-radius:12px;
      text-align:center;
      cursor:pointer;
      transition: transform .08s ease, background .12s ease;
    }
    .icon:hover{background:rgba(255,255,255,.12)}
    .icon:active{transform:scale(.98)}
    .icon.shake {
      animation: shake 0.5s ease;
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-4px); }
      75% { transform: translateX(4px); }
    }
    .icon svg{width:34px;height:34px; display:block; margin:0 auto 8px auto; filter: drop-shadow(0 6px 10px rgba(0,0,0,.25));}
    .icon .label{
      font-size:12px;
      line-height:1.1;
      color:rgba(255,255,255,.95);
      text-shadow:0 2px 10px rgba(0,0,0,.25);
      word-break:break-word;
    }

    /* ===== Taskbar ===== */
    .taskbar{
      position:absolute;
      left:0; right:0; bottom:0;
      height:56px;
      background: var(--taskbar);
      backdrop-filter: var(--glass);
      border-top: var(--border);
      display:flex;
      align-items:center;
      padding:0 10px;
      gap:10px;
    }
    .tb-left, .tb-center, .tb-right{display:flex; align-items:center; gap:10px;}
    .tb-left{
      flex: 1;
      justify-content: flex-start;
      transition: flex 0.3s ease;
    }
    .taskbar.left-align .tb-left{
      flex: 0;
      min-width: 0;
    }
    .tb-center{
      flex: 0;
      justify-content: center;
      gap:10px;
      transition: all 0.3s ease;
    }
    .taskbar.left-align .tb-center{
      justify-content: flex-start;
      margin-left: 10px;
      flex: 0;
    }
    .tb-right{
      flex: 1;
      min-width:230px;
      justify-content:flex-end;
      gap:10px;
    }

    .tb-btn{
      height:40px;
      min-width:40px;
      padding:0 10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.06);
      color:var(--text);
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      cursor:pointer;
      transition: background .12s ease, transform .08s ease;
      position: relative;
    }
    .tb-btn:hover{background:rgba(255,255,255,.10)}
    .tb-btn:active{transform:scale(.98)}
    .tb-btn svg{width:18px;height:18px}
    .tb-pill{
      height:40px;
      padding:0 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.06);
      display:flex;
      align-items:center;
      gap:10px;
      min-width:220px;
      width: min(340px, 38vw);
      max-width: 420px;
      cursor:pointer;
      transition: all 0.3s ease;
    }
    .taskbar.left-align .tb-pill{
      min-width: 260px;
    }
    .tb-pill input{
      width:100%;
      border:0;
      outline:none;
      background:transparent;
      color:var(--text);
      font-size:13px;
    }
    .tb-time{
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      line-height:1.05;
      font-size:12px;
      color:var(--text);
      padding-right:6px;
      opacity:.95;
    }
    .tb-tray{
      display:flex;
      align-items:center;
      gap:8px;
    }
    .tray-dot{width:6px;height:6px;border-radius:99px;background:rgba(255,255,255,.65)}
    .badge{
      position:absolute;
      top:-6px; right:-6px;
      font-size:11px;
      background:var(--danger);
      color:white;
      border-radius:999px;
      padding:2px 6px;
      border:1px solid rgba(0,0,0,.25);
      box-shadow:0 10px 25px rgba(0,0,0,.35);
    }

    /* ===== Panels (Start/Search/Notifications/Quick Settings) ===== */
    .panel{
      position:absolute;
      bottom:66px;
      background:var(--panel);
      border:var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      backdrop-filter:var(--glass);
      padding:14px;
      width:360px;
      max-height:560px;
      overflow:auto;
      display:none;
      animation: panelSlideUp 0.2s ease-out;
    }
    @keyframes panelSlideUp {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .panel.show{display:block}
    .panel h3{
      margin:0 0 10px 0;
      font-size:14px;
      letter-spacing:.2px;
      color:rgba(255,255,255,.95);
    }
    .panel .sub{
      margin:0 0 12px 0;
      font-size:12px;
      color:var(--muted);
    }
    .panel .row{
      display:flex;
      gap:10px;
      align-items:center;
      margin:10px 0;
    }
    .chips{
      display:flex; flex-wrap:wrap; gap:8px;
    }
    .chip{
      padding:8px 10px;
      border-radius:999px;
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.10);
      cursor:pointer;
      font-size:12px;
      color:rgba(255,255,255,.92);
      display:inline-flex; align-items:center; gap:8px;
      transition: all 0.15s ease;
    }
    .chip:hover{background:rgba(255,255,255,.12); transform: translateY(-1px);}
    .chip svg{width:16px;height:16px}
    .divider{height:1px; background:rgba(255,255,255,.10); margin:12px 0;}

    /* Start panel */
    #startPanel{left:50%; transform:translateX(-50%);}
    .start-grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
    }
    .start-app{
      border-radius:12px;
      padding:10px 10px;
      background:rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.10);
      cursor:pointer;
      display:flex;
      gap:10px;
      align-items:center;
      min-height:54px;
      transition: all 0.15s ease;
    }
    .start-app:hover{background:rgba(255,255,255,.10); transform: translateY(-1px);}
    .start-app .name{font-size:12px; line-height:1.1}
    .start-app small{color:var(--muted); display:block; margin-top:3px}
    .start-app svg{width:22px;height:22px; flex:0 0 auto}
    .start-footer{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-top:12px;
      gap:10px;
    }
    .powerbtn{
      padding:8px 10px;
      border-radius:12px;
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.10);
      cursor:pointer;
      display:inline-flex;
      gap:6px;
      align-items:center;
      font-size:12px;
    }
    .powerbtn:hover{background:rgba(255,255,255,.12)}
    .powerbtn svg{width:16px;height:16px}

    /* Search panel */
    #searchPanel{left:50%; transform:translateX(-50%); width:400px}
    .search-res{
      border-radius:12px;
      padding:10px;
      background:rgba(255,255,255,.07);
      cursor:pointer;
      display:flex;
      gap:10px;
      align-items:center;
      margin:8px 0;
      border:1px solid rgba(255,255,255,.10);
      transition: all 0.15s ease;
    }
    .search-res:hover{background:rgba(255,255,255,.10); transform: translateX(3px);}
    .search-res svg{width:20px;height:20px}
    .search-res .txt{flex:1}
    .search-res .txt strong{display:block;font-size:13px;margin-bottom:2px}
    .search-res .txt small{font-size:11px;color:var(--muted)}

    /* Notifications panel */
    #notifPanel{right:10px}
    .notif-item{
      background:rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.10);
      border-radius:12px;
      padding:10px;
      margin:8px 0;
      display:flex;
      gap:10px;
      align-items:flex-start;
    }
    .notif-item svg{width:20px;height:20px;flex:0 0 auto}
    .notif-content{flex:1}
    .notif-content .title{font-size:12px;font-weight:600;margin-bottom:3px}
    .notif-content .body{font-size:11px;color:var(--muted);line-height:1.3}
    .notif-content .time{font-size:10px;color:var(--muted);margin-top:4px}
    .dismiss-btn{
      background:transparent;
      border:1px solid rgba(255,255,255,.20);
      border-radius:8px;
      padding:4px 8px;
      cursor:pointer;
      color:var(--text);
      font-size:11px;
    }
    .dismiss-btn:hover{background:rgba(255,255,255,.10)}

    /* Quick Settings */
    #quickPanel{right:10px}
    .quick-toggles{
      display:grid;
      grid-template-columns:repeat(2,1fr);
      gap:10px;
    }
    .quick-toggle{
      border-radius:12px;
      padding:10px;
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.10);
      cursor:pointer;
      display:flex;
      flex-direction:column;
      gap:6px;
      transition: all 0.15s ease;
    }
    .quick-toggle:hover{background:rgba(255,255,255,.12)}
    .quick-toggle.active{background:var(--accent);color:#000}
    .quick-toggle .icon-row{display:flex;align-items:center;gap:8px}
    .quick-toggle svg{width:18px;height:18px}
    .quick-toggle .label{font-size:12px;font-weight:500}
    .slider-row{display:flex;align-items:center;gap:10px;margin:8px 0}
    .slider-row svg{width:18px;height:18px}
    .slider-row input[type="range"]{flex:1}

    /* ===== Windows ===== */
    .window{
      position:absolute;
      background:var(--panel);
      border:var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      backdrop-filter:var(--glass);
      width:520px;
      height:360px;
      display:none;
      flex-direction:column;
      z-index:5;
    }
    .window.show{display:flex; animation: windowAppear 0.2s ease-out;}
    @keyframes windowAppear {
      from {
        opacity: 0;
        transform: scale(0.95);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }
    .win-titlebar{
      height:36px;
      border-bottom:var(--border);
      background:var(--panel2);
      border-radius:var(--radius) var(--radius) 0 0;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0 10px;
      cursor:grab;
      user-select:none;
    }
    .win-titlebar:active{cursor:grabbing}
    .win-title{display:flex; gap:8px; align-items:center; font-size:13px}
    .win-title svg{width:16px;height:16px}
    .win-btns{display:flex;gap:6px}
    .win-btn{
      width:32px; height:28px;
      border-radius:8px;
      border:0;
      background:transparent;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      transition: background .12s ease;
    }
    .win-btn:hover{background:rgba(255,255,255,.10)}
    .win-btn.close:hover{background:var(--danger)}
    .win-btn svg{width:12px;height:12px;stroke:var(--text)}
    .win-content{flex:1;overflow:auto;padding:14px;}

    /* Settings window specific */
    .setting-card{
      background:rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.10);
      border-radius:12px;
      padding:12px;
      margin:10px 0;
    }
    .setting-card h4{margin:0 0 6px 0;font-size:13px}
    .setting-card p{margin:0 0 10px 0;font-size:11px;color:var(--muted);line-height:1.3}
    .alignment-option{
      padding:8px 10px;
      border-radius:8px;
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.10);
      cursor:pointer;
      margin:6px 0;
      font-size:12px;
      display:flex;
      align-items:center;
      gap:10px;
      transition: all 0.15s ease;
    }
    .alignment-option:hover{background:rgba(255,255,255,.12)}
    .alignment-option.selected{
      background:var(--accent);
      color:#000;
      border-color:var(--accent);
    }
    .alignment-option svg{width:16px;height:16px}

    /* ===== Toast / Coach ===== */
    .toast{
      position:fixed;
      bottom:90px;
      left:50%;
      transform:translateX(-50%);
      background:var(--panel);
      border:var(--border);
      border-radius:var(--radius2);
      padding:14px 18px;
      box-shadow:var(--shadow);
      max-width:420px;
      z-index:9999;
      opacity:0;
      pointer-events:none;
      transition: opacity .25s ease, transform .25s ease;
      animation: toastSlideUp 0.3s ease-out;
    }
    @keyframes toastSlideUp {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }
    .toast.show{opacity:1; pointer-events:auto}
    .toast .heading{font-size:13px;font-weight:600;margin-bottom:4px}
    .toast .msg{font-size:12px;color:var(--muted);line-height:1.3}

    .coach-panel{
      position:fixed;
      bottom:90px;
      right:20px;
      background:var(--panel);
      border:var(--border);
      border-radius:var(--radius);
      padding:14px;
      box-shadow:var(--shadow);
      width:320px;
      z-index:100;
    }

    /* Prevent right-side panels from covering the lab instructions */
    body.right-panel-open .coach-panel{
      right: 420px; /* panel width (360) + margins */
    }
    @media (max-width: 920px){
      body.right-panel-open .coach-panel{ display:none; }
    }

    .coach-panel h3{
      margin:0 0 10px 0;
      font-size:14px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .coach-panel .step{
      font-size:12px;
      padding:8px;
      border-radius:8px;
      margin:6px 0;
      display:flex;
      align-items:center;
      gap:8px;
      background:rgba(255,255,255,.05);
    }
    .coach-panel .step.done{color:var(--ok);background:rgba(34,197,94,.12)}
    .coach-panel .step.current{background:rgba(125,211,252,.12);border:1px solid rgba(125,211,252,.3)}
    .coach-panel .step svg{width:16px;height:16px;flex:0 0 auto}
    .coach-btns{display:flex;gap:8px;margin-top:12px}
    .coach-btns button{
      flex:1;
      padding:8px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,.20);
      background:rgba(255,255,255,.08);
      color:var(--text);
      cursor:pointer;
      font-size:12px;
      transition: all 0.15s ease;
    }
    .coach-btns button:hover{background:rgba(255,255,255,.15); transform: translateY(-1px);}

    /* Pulse effect */
    @keyframes pulse{
      0%,100%{ box-shadow: 0 0 0 0 rgba(125,211,252,.6); }
      50%{ box-shadow: 0 0 0 10px rgba(125,211,252,0); }
    }
    .pulse{
      animation: pulse 1.8s infinite;
    }

    /* ===== Completion Celebration ===== */
    .celebration-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 99998;
      animation: fadeIn 0.3s ease;
    }
    .celebration-overlay.show {
      display: flex;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .celebration-card {
      background: var(--panel);
      border: var(--border);
      border-radius: var(--radius);
      padding: 40px;
      text-align: center;
      max-width: 500px;
      box-shadow: 0 25px 60px rgba(0,0,0,.5);
      animation: celebrationBounce 0.5s ease-out;
    }
    @keyframes celebrationBounce {
      0% { transform: scale(0.8); opacity: 0; }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); opacity: 1; }
    }
    .celebration-card h2 {
      font-size: 32px;
      margin: 0 0 10px 0;
      color: var(--ok);
    }
    .celebration-card .trophy {
      font-size: 80px;
      margin: 20px 0;
      animation: trophySpin 1s ease-out;
    }
    @keyframes trophySpin {
      from { transform: rotate(-180deg) scale(0); }
      to { transform: rotate(0) scale(1); }
    }
    .celebration-card p {
      font-size: 16px;
      color: var(--muted);
      margin-bottom: 25px;
      line-height: 1.5;
    }
    .celebration-card button {
      padding: 12px 30px;
      border-radius: 12px;
      border: none;
      background: var(--ok);
      color: white;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .celebration-card button:hover {
      background: #16a34a;
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(34,197,94,.3);
    }

    /* Confetti */
    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      background: var(--accent);
      opacity: 0;
      animation: confettiFall 3s ease-out forwards;
    }
    @keyframes confettiFall {
      0% { opacity: 1; transform: translateY(-100vh) rotate(0deg); }
      100% { opacity: 0; transform: translateY(100vh) rotate(720deg); }
    }

  </style>
</head>
<body>

  <!-- Loading Screen -->
  <div class="loading-screen" id="loadingScreen">
    <svg class="loading-logo" viewBox="0 0 88 88" fill="none" xmlns="http://www.w3.org/2000/svg">
      <rect width="40" height="40" fill="#0078d4"/>
      <rect x="48" width="40" height="40" fill="#0078d4"/>
      <rect y="48" width="40" height="40" fill="#0078d4"/>
      <rect x="48" y="48" width="40" height="40" fill="#0078d4"/>
    </svg>
    <div class="loading-spinner"></div>
  </div>

  <!-- Desktop -->
  <div class="desktop">
    <!-- Desktop icons -->
    <div class="desktop-icons" id="desktopIcons">
      <div class="icon" data-open="recycle" tabindex="0" role="button" aria-label="Recycle Bin">
        <svg viewBox="0 0 64 64" fill="currentColor"><path fill="#0078d4" d="M22 8l-2 8H10v4h2l4 36h32l4-36h2v-4H44l-2-8H22zm4 8h12l1 4H25l1-4z"/></svg>
        <div class="label">Recycle Bin</div>
      </div>
<div class="icon" data-open="settings" tabindex="0" role="button" aria-label="Settings">
        <svg viewBox="0 0 64 64" fill="currentColor"><circle cx="32" cy="32" r="8" fill="#7dd3fc"/><path fill="#0284c7" d="M32 14a4 4 0 014-4h0a4 4 0 014 4v2a4 4 0 01-4 4h0a4 4 0 01-4-4v-2zM48 26.5a4 4 0 012-6.93h0a4 4 0 014 6.93l-1 1.73a4 4 0 01-6.93 0h0a4 4 0 01 0-4l1-1.73z"/></svg>
        <div class="label">Settings</div>
      </div>
    </div>

    <!-- Windows -->
    <!-- Settings Window -->
    <div class="window" id="win-settings" style="left:160px;top:120px" role="dialog" aria-label="Settings">
      <div class="win-titlebar" data-drag>
        <div class="win-title">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6m8.66-15.66l-4.24 4.24m-4.84 4.84l-4.24 4.24M23 12h-6m-6 0H1m20.66 8.66l-4.24-4.24m-4.84-4.84l-4.24-4.24"/></svg>
          Settings
        </div>
        <div class="win-btns">
          <button class="win-btn" data-min aria-label="Minimize"><svg viewBox="0 0 12 1"><rect width="12" height="1"/></svg></button>
          <button class="win-btn" data-max aria-label="Maximize"><svg viewBox="0 0 10 10"><rect x="0" y="0" width="10" height="10" fill="none" stroke="currentColor" stroke-width="1"/></svg></button>
          <button class="win-btn close" data-close aria-label="Close"><svg viewBox="0 0 12 12"><path d="M1 1l10 10M11 1L1 11" stroke="currentColor" stroke-width="1.5"/></svg></button>
        </div>
      </div>
      <div class="win-content">
        <h3 style="margin:0 0 14px 0">Personalization</h3>
        <div class="setting-card" id="taskbarAlignmentCard">
          <h4>Taskbar Alignment</h4>
          <p>Choose where app icons appear on your taskbar.</p>
          <div class="alignment-option selected" data-align="center">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="20" width="18" height="2"/><rect x="8" y="16" width="2" height="2"/><rect x="11" y="16" width="2" height="2"/><rect x="14" y="16" width="2" height="2"/></svg>
            Center (default)
          </div>
          <div class="alignment-option" data-align="left">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="20" width="18" height="2"/><rect x="3" y="16" width="2" height="2"/><rect x="6" y="16" width="2" height="2"/><rect x="9" y="16" width="2" height="2"/></svg>
            Left
          </div>
        </div>
        <div class="setting-card">
          <h4>Theme</h4>
          <p>Choose your Windows theme preference.</p>
          <div class="alignment-option selected">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
            Dark (simulation)
          </div>
        </div>
      </div>
    </div>

    <!-- File Explorer Window -->
    <div class="window" id="win-explorer" style="left:200px;top:100px" role="dialog" aria-label="File Explorer">
      <div class="win-titlebar" data-drag>
        <div class="win-title">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/></svg>
          This PC
        </div>
        <div class="win-btns">
          <button class="win-btn" data-min aria-label="Minimize"><svg viewBox="0 0 12 1"><rect width="12" height="1"/></svg></button>
          <button class="win-btn" data-max aria-label="Maximize"><svg viewBox="0 0 10 10"><rect x="0" y="0" width="10" height="10" fill="none" stroke="currentColor" stroke-width="1"/></svg></button>
          <button class="win-btn close" data-close aria-label="Close"><svg viewBox="0 0 12 12"><path d="M1 1l10 10M11 1L1 11" stroke="currentColor" stroke-width="1.5"/></svg></button>
        </div>
      </div>
      <div class="win-content">
        <div class="setting-card">
          <h4>üìÅ Documents</h4>
          <p style="margin-bottom:0">Your personal documents folder (simulation).</p>
        </div>
        <div class="setting-card">
          <h4>üìÅ Downloads</h4>
          <p style="margin-bottom:0">Files you've downloaded (simulation).</p>
        </div>
        <div class="setting-card">
          <h4>üíø Local Disk (C:)</h4>
          <p style="margin-bottom:0">Your main storage drive (simulation).</p>
        </div>
      </div>
    </div>

    <!-- Recycle Bin Window -->
    <div class="window" id="win-recycle" style="left:180px;top:140px" role="dialog" aria-label="Recycle Bin">
      <div class="win-titlebar" data-drag>
        <div class="win-title">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
          Recycle Bin
        </div>
        <div class="win-btns">
          <button class="win-btn" data-min aria-label="Minimize"><svg viewBox="0 0 12 1"><rect width="12" height="1"/></svg></button>
          <button class="win-btn" data-max aria-label="Maximize"><svg viewBox="0 0 10 10"><rect x="0" y="0" width="10" height="10" fill="none" stroke="currentColor" stroke-width="1"/></svg></button>
          <button class="win-btn close" data-close aria-label="Close"><svg viewBox="0 0 12 12"><path d="M1 1l10 10M11 1L1 11" stroke="currentColor" stroke-width="1.5"/></svg></button>
        </div>
      </div>
      <div class="win-content">
        <div class="setting-card">
          <h4>Empty</h4>
          <p style="margin-bottom:0">No items in the Recycle Bin (simulation).</p>
        </div>
      </div>
    </div>

    <!-- Edge Window -->
    <div class="window" id="win-edge" style="left:220px;top:80px;width:680px;height:480px" role="dialog" aria-label="Microsoft Edge">
      <div class="win-titlebar" data-drag>
        <div class="win-title">
          <svg viewBox="0 0 24 24" fill="#0078d4"><path d="M12 2C6.477 2 2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.879V14.89h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.989C18.343 21.129 22 16.99 22 12c0-5.523-4.477-10-10-10z"/></svg>
          New Tab - Microsoft Edge
        </div>
        <div class="win-btns">
          <button class="win-btn" data-min aria-label="Minimize"><svg viewBox="0 0 12 1"><rect width="12" height="1"/></svg></button>
          <button class="win-btn" data-max aria-label="Maximize"><svg viewBox="0 0 10 10"><rect x="0" y="0" width="10" height="10" fill="none" stroke="currentColor" stroke-width="1"/></svg></button>
          <button class="win-btn close" data-close aria-label="Close"><svg viewBox="0 0 12 12"><path d="M1 1l10 10M11 1L1 11" stroke="currentColor" stroke-width="1.5"/></svg></button>
        </div>
      </div>
      <div class="win-content" style="display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center">
        <svg viewBox="0 0 24 24" width="64" height="64" fill="#0078d4"><path d="M12 2C6.477 2 2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.879V14.89h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.989C18.343 21.129 22 16.99 22 12c0-5.523-4.477-10-10-10z"/></svg>
        <h3 style="margin:20px 0 8px 0">Microsoft Edge</h3>
        <p style="color:var(--muted);margin:0">Browser simulation - navigate to any site you'd like (in the real Windows).</p>
      </div>
    </div>

    <!-- About This PC Window -->
    <div class="window" id="win-about" style="left:240px;top:160px" role="dialog" aria-label="About This PC">
      <div class="win-titlebar" data-drag>
        <div class="win-title">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
          About This PC
        </div>
        <div class="win-btns">
          <button class="win-btn" data-min aria-label="Minimize"><svg viewBox="0 0 12 1"><rect width="12" height="1"/></svg></button>
          <button class="win-btn" data-max aria-label="Maximize"><svg viewBox="0 0 10 10"><rect x="0" y="0" width="10" height="10" fill="none" stroke="currentColor" stroke-width="1"/></svg></button>
          <button class="win-btn close" data-close aria-label="Close"><svg viewBox="0 0 12 12"><path d="M1 1l10 10M11 1L1 11" stroke="currentColor" stroke-width="1.5"/></svg></button>
        </div>
      </div>
      <div class="win-content">
        <div class="setting-card">
          <h4>Windows 11 Pro</h4>
          <p>Version 23H2 (Simulation)</p>
        </div>
        <div class="setting-card">
          <h4>Device</h4>
          <p style="margin-bottom:0">Training Lab PC (Simulation)</p>
        </div>
      </div>
    </div>

    <!-- Windows Tips Window -->
    <div class="window" id="win-tips" style="left:190px;top:110px;width:560px" role="dialog" aria-label="Windows Tips">
      <div class="win-titlebar" data-drag>
        <div class="win-title">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
          Windows Tips
        </div>
        <div class="win-btns">
          <button class="win-btn" data-min aria-label="Minimize"><svg viewBox="0 0 12 1"><rect width="12" height="1"/></svg></button>
          <button class="win-btn" data-max aria-label="Maximize"><svg viewBox="0 0 10 10"><rect x="0" y="0" width="10" height="10" fill="none" stroke="currentColor" stroke-width="1"/></svg></button>
          <button class="win-btn close" data-close aria-label="Close"><svg viewBox="0 0 12 12"><path d="M1 1l10 10M11 1L1 11" stroke="currentColor" stroke-width="1.5"/></svg></button>
        </div>
      </div>
      <div class="win-content">
        <h3 style="margin:0 0 14px 0">Getting Started with Windows 11</h3>
        <div class="setting-card">
          <h4>üí° Tip: Snap Windows</h4>
          <p>Hover over the maximize button to snap windows side-by-side for multitasking.</p>
        </div>
        <div class="setting-card">
          <h4>üí° Tip: Virtual Desktops</h4>
          <p>Press Win+Tab to create multiple desktops for different tasks.</p>
        </div>
        <div class="setting-card">
          <h4>üí° Tip: Quick Settings</h4>
          <p style="margin-bottom:0">Click the Wi-Fi/volume icons to access Quick Settings for common toggles.</p>
        </div>
      </div>
    </div>

  </div>

  <!-- Taskbar -->
  <div class="taskbar" id="taskbar">
    <div class="tb-left"></div>

    <div class="tb-center">
      <!-- Windows button -->
      <div class="tb-btn" id="winBtn" tabindex="0" role="button" aria-label="Start menu">
        <svg width="18" height="18" viewBox="0 0 88 88" fill="currentColor">
          <rect width="40" height="40" fill="currentColor"/>
          <rect x="48" width="40" height="40" fill="currentColor"/>
          <rect y="48" width="40" height="40" fill="currentColor"/>
          <rect x="48" y="48" width="40" height="40" fill="currentColor"/>
        </svg>
      </div>

      <!-- Search pill (must stay with Start in center/left cluster) -->
      <div class="tb-pill" id="tbSearchPill" tabindex="0" role="button" aria-label="Search">
        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="8" cy="8" r="5"/>
          <line x1="12" y1="12" x2="15" y2="15"/>
        </svg>
        <input type="text" id="searchInput" placeholder="Type to search..." aria-label="Search input"/>
      </div>
    </div>

    <div class="tb-right">
      <!-- System tray -->
      <div class="tb-tray" aria-label="System tray">
        <div class="tray-dot"></div>
        <div class="tray-dot"></div>
      </div>

      <div class="tb-btn" id="quickBtn" tabindex="0" role="button" aria-label="Quick Settings">
        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M1 6h6M11 6h6M1 12h6M11 12h6M1 18h6M11 18h6"/>
          <circle cx="8" cy="6" r="2"/>
          <circle cx="8" cy="12" r="2"/>
          <circle cx="8" cy="18" r="2"/>
        </svg>
      </div>

      <div class="tb-btn" id="notifBtn" style="position:relative" tabindex="0" role="button" aria-label="Notifications">
        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 01-3.46 0"/>
        </svg>
        <span class="badge" id="notifBadge">2</span>
      </div>

      <div class="tb-time" id="tbTime" tabindex="0" role="button" aria-label="Date and time">
        <div id="timeNow">12:00</div>
        <div id="dateNow">Mon Dec 28</div>
      </div>
    </div>
  </div>

  <!-- Start Panel -->
  <div class="panel" id="startPanel" role="menu" aria-label="Start menu">
    <h3>Pinned</h3>
    <div class="start-grid">
      <div class="start-app" data-open="settings" tabindex="0" role="menuitem">
        <svg viewBox="0 0 24 24" fill="none" stroke="#0284c7" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6m8.66-15.66l-4.24 4.24m-4.84 4.84l-4.24 4.24M23 12h-6m-6 0H1m20.66 8.66l-4.24-4.24m-4.84-4.84l-4.24-4.24"/></svg>
        <div><div class="name">Settings</div></div>
      </div>

      <div class="start-app" data-open="about" tabindex="0" role="menuitem">
        <svg viewBox="0 0 24 24" fill="none" stroke="#0078d4" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
        <div><div class="name">About</div></div>
      </div>

      <div class="start-app" data-open="tips" tabindex="0" role="menuitem">
        <svg viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
        <div><div class="name">Tips</div></div>
      </div>
    </div>

    <div class="divider"></div>
    <div class="start-footer">
      <div style="flex:1;font-size:12px;color:var(--muted)">User Account</div>
      <div class="powerbtn" tabindex="0" role="button" aria-label="Power options">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18.36 6.64a9 9 0 11-12.73 0"/><line x1="12" y1="2" x2="12" y2="12"/></svg>
        Power
      </div>
    </div>
  </div>

  <!-- Search Panel -->
  <div class="panel" id="searchPanel" role="menu" aria-label="Search results">
    <h3>Search Results</h3>
    <div id="searchResults"></div>
  </div>

  <!-- Notifications Panel -->
  <div class="panel" id="notifPanel" role="menu" aria-label="Notifications">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
      <h3 style="margin:0">Notifications</h3>
      <button id="clearAllBtn" style="padding:6px 10px;border-radius:8px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.08);color:var(--text);cursor:pointer;font-size:11px" aria-label="Clear all notifications">Clear all</button>
    </div>
    <div id="notifList"></div>
    <div class="divider"></div>
    <button id="newNotifBtn" style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.08);color:var(--text);cursor:pointer;font-size:12px" aria-label="Create test notification">Create test notification</button>
  </div>

  <!-- Quick Settings Panel -->
  <div class="panel" id="quickPanel" role="menu" aria-label="Quick Settings">
    <h3>Quick Settings</h3>
    <div class="quick-toggles" id="quickToggles"></div>
    <div class="divider"></div>
    
    <!-- Volume Slider -->
    <div class="slider-row">
      <svg fill="currentColor" width="18" height="18" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.7-1-3.2-2.5-4v8c1.5-.8 2.5-2.3 2.5-4zm-2.5-8v2c2.9.9 5 3.5 5 6.5s-2.1 5.6-5 6.5v2c4-.9 7-4.5 7-8.5s-3-7.6-7-8.5z"/></svg>
      <input type="range" min="0" max="100" value="40" id="volSlider"/>
      <span id="volVal">40%</span>
    </div>
  </div>

  <!-- Toast (temporary message) -->
  <div class="toast" id="toast" role="alert" aria-live="polite">
    <div class="heading" id="toastHead"></div>
    <div class="msg" id="toastMsg"></div>
  </div>

  <!-- Coach panel (track progress) -->
  <div class="coach-panel">
    <h3>
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
      Lab Progress
    </h3>
    <div id="coachSteps"></div>
    <div class="coach-btns">
      <button id="hintBtn" aria-label="Show hint">üí° Hint</button>
      <button id="resetBtn" aria-label="Reset progress">üîÑ Reset</button>
    </div>
  </div>

  <!-- Completion Celebration -->
  <div class="celebration-overlay" id="celebrationOverlay">
    <div class="celebration-card">
      <div class="trophy">üèÜ</div>
      <h2>Congratulations!</h2>
      <p>You've successfully completed Lab 1: Getting Started with the Windows 11 Desktop!<br><br>You've learned the fundamentals of navigating Windows 11, including the Start menu, Search, Settings, and Notifications.</p>
      <button id="celebrationClose">Continue Learning</button>
    </div>
  </div>

  <script>
    // =====================
    // State & localStorage
    // =====================
    const LS_KEY = "win11lab1_v1";
    const state = {
      steps: {
        start: false,
        search: false,
        openSettings: false,
        taskbarAlign: false,
        notif: false,
        clearNotif: false
      },
      pinnedSettings: false,
      notifs: [
        { title:"Windows Tips", body:"Welcome to Lab 1. Open Start to begin.", time:"Just now" },
        { title:"Updates", body:"(Simulation) Updates are available. You can check this in Settings.", time:"2m ago" }
      ],
      toggles: { wifi:true, bt:false, air:false, night:false },
      taskbarAlignment: "center",
      z: 100,
      soundEnabled: true,
      completionShown: false
    };

    function saveProgress(){
      localStorage.setItem(LS_KEY, JSON.stringify(state));
    }

    function loadProgress(){
      const stored = localStorage.getItem(LS_KEY);
      if(stored){
        try{
          const data = JSON.parse(stored);
          Object.assign(state, data);
        }catch(e){}
      }
    }

    // =====================
    // Sound System
    // =====================
    const sounds = {
      click: () => playTone(800, 0.05, 0.1),
      open: () => playTone(600, 0.1, 0.15),
      close: () => playTone(400, 0.1, 0.15),
      success: () => {
        playTone(523, 0.1, 0.1);
        setTimeout(() => playTone(659, 0.1, 0.1), 100);
        setTimeout(() => playTone(784, 0.1, 0.2), 200);
      },
      notification: () => {
        playTone(880, 0.05, 0.1);
        setTimeout(() => playTone(1047, 0.05, 0.15), 80);
      },
      error: () => playTone(200, 0.2, 0.2)
    };

    function playTone(frequency, duration, volume = 0.1) {
      if (!state.soundEnabled) return;
      
      try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.value = frequency;
        oscillator.type = 'sine';
        
        gainNode.gain.setValueAtTime(volume, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + duration);
      } catch (e) {
        // Silently fail if audio not supported
      }
    }

    // Sound toggle button
    // Removed - now controlled by volume slider
    
    // Volume slider now controls sound enable/disable
    // Initialize sound based on saved state
    if (state.soundEnabled === undefined) {
      state.soundEnabled = true;
    }

    // =====================
    // Confetti Effect
    // =====================
    function createConfetti() {
      const colors = ['#7dd3fc', '#22c55e', '#f59e0b', '#ef4444', '#a855f7'];
      const confettiCount = 50;
      
      for (let i = 0; i < confettiCount; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = Math.random() * 100 + '%';
        confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.animationDelay = Math.random() * 0.5 + 's';
        confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
        document.body.appendChild(confetti);
        
        setTimeout(() => confetti.remove(), 3500);
      }
    }

    // =====================
    // Utilities
    // =====================
    const $ = (s) => document.querySelector(s);
    const $$ = (s) => document.querySelectorAll(s);

    function setStepDone(step){
      if(state.steps[step]) return;
      state.steps[step] = true;
      saveProgress();
      renderCoach();
      sounds.success();
      
      // Check if all steps complete
      const allDone = Object.values(state.steps).every(v => v);
      if (allDone && !state.completionShown) {
        state.completionShown = true;
        saveProgress();
        setTimeout(showCelebration, 800);
      }
    }

    function showCelebration() {
      sounds.success();
      setTimeout(() => sounds.success(), 200);
      createConfetti();
      $("#celebrationOverlay").classList.add("show");
    }

    $("#celebrationClose").addEventListener("click", () => {
      $("#celebrationOverlay").classList.remove("show");
      sounds.click();
    });

    // =====================
    // Toast
    // =====================
    let toastTimeout;
    function toast(heading, msg){
      clearTimeout(toastTimeout);
      $("#toastHead").textContent = heading;
      $("#toastMsg").innerHTML = msg;
      $("#toast").classList.add("show");
      sounds.notification();
      toastTimeout = setTimeout(() => {
        $("#toast").classList.remove("show");
      }, 4500);
    }

    // =====================
    // Coach panel
    // =====================
    function renderCoach(){
      const steps = [
        { key:"start", text:"Open the Start menu" },
        { key:"search", text:"Use Search to find Settings" },
        { key:"openSettings", text:"Open Settings app" },
        { key:"taskbarAlign", text:"Change taskbar to left" },
        { key:"notif", text:"Open Notifications" },
        { key:"clearNotif", text:"Clear all notifications" }
      ];

      let html = "";
      steps.forEach(s => {
        const done = state.steps[s.key];
        const icon = done 
          ? `<svg viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>`
          : `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/></svg>`;
        const cls = done ? "step done" : "step";
        html += `<div class="${cls}">${icon} ${s.text}</div>`;
      });

      $("#coachSteps").innerHTML = html;
    }

    // =====================
    // Panels
    // =====================
    function closeAllPanels(){
      $$(".panel").forEach(p => p.classList.remove("show"));
      $$(".pulse").forEach(el => el.classList.remove("pulse"));
      document.body.classList.remove("right-panel-open");
    }

    function togglePanel(id){
      const panel = $(id);
      const isOpen = panel.classList.contains("show");
      closeAllPanels();

      if(!isOpen){
        panel.classList.add("show");
        // If a right-side flyout is open, shift (or hide) the coach so it doesn't get covered.
        if(id === "#notifPanel" || id === "#quickPanel"){
          document.body.classList.add("right-panel-open");
        }
        sounds.open();
      } else {
        sounds.close();
      }
    }

    // Start
    $("#winBtn").addEventListener("click", ()=>{
      togglePanel("#startPanel");
      setStepDone("start");
    });

    // Search
    $("#tbSearchPill").addEventListener("click", ()=>{
      togglePanel("#searchPanel");
      $("#searchInput").focus();
    });

    $("#searchInput").addEventListener("input", (e)=>{
      const val = e.target.value.trim().toLowerCase();
      renderSearchResults(val);
      
      // Complete search step when Settings appears in results (when "set" is typed)
      if(val.includes("set")){
        setStepDone("search");
      }
    });

    function renderSearchResults(query){
      const results = [
        { name:"Settings", desc:"System settings", icon:"settings", keywords:["set","settings","config"] }
      ];

      let html = "";
      if(!query){
        html = `<div style="color:var(--muted);font-size:12px;padding:10px;text-align:center">Type to search apps, settings, and files...</div>`;
      } else {
        const matches = results.filter(r => r.keywords.some(k => k.includes(query)));
        if(matches.length){
          matches.forEach(m => {
            const ico = m.icon === "settings" 
              ? `<svg viewBox="0 0 24 24" fill="none" stroke="#0284c7" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6"/></svg>`
              : m.icon === "explorer"
              ? `<svg viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2"><path d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/></svg>`
              : `<svg viewBox="0 0 24 24" fill="#0078d4"><path d="M12 2C6.477 2 2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.879V14.89h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.989C18.343 21.129 22 16.99 22 12c0-5.523-4.477-10-10-10z"/></svg>`;
            html += `<div class="search-res" data-open="${m.icon}">
              ${ico}
              <div class="txt">
                <strong>${m.name}</strong>
                <small>${m.desc}</small>
              </div>
            </div>`;
          });
        } else {
          html = `<div style="color:var(--muted);font-size:12px;padding:10px;text-align:center">No results found for "${query}"</div>`;
        }
      }
      $("#searchResults").innerHTML = html;
    }

    $("#searchResults").addEventListener("click", (e)=>{
      const res = e.target.closest("[data-open]");
      if(!res) return;
      sounds.click();
      openApp(res.getAttribute("data-open"));
      // Clear search input when clicking a result
      $("#searchInput").value = "";
      renderSearchResults("");
      closeAllPanels();
    });

    // Notifications
    function renderNotifs(){
      let html = "";
      state.notifs.forEach((n,i)=>{
        html += `<div class="notif-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
          <div class="notif-content">
            <div class="title">${n.title}</div>
            <div class="body">${n.body}</div>
            <div class="time">${n.time}</div>
          </div>
          <button class="dismiss-btn" data-dismiss="${i}">√ó</button>
        </div>`;
      });
      if(!state.notifs.length){
        html = `<div style="color:var(--muted);font-size:12px;padding:20px;text-align:center">No new notifications</div>`;
      }
      $("#notifList").innerHTML = html;
      $("#notifBadge").textContent = state.notifs.length;
      $("#notifBadge").style.display = state.notifs.length ? "block" : "none";
    }

    $("#notifBtn").addEventListener("click", ()=>{
      togglePanel("#notifPanel");
      setStepDone("notif");
    });

    $("#clearAllBtn").addEventListener("click", ()=>{
      state.notifs = [];
      renderNotifs();
      setStepDone("clearNotif");
      toast("Notifications", "All cleared.");
      sounds.click();
    });

    $("#newNotifBtn").addEventListener("click", ()=>{
      const t = new Date();
      state.notifs.unshift({
        title:"Test notification",
        body:"Nice. You triggered a test notification in the sim.",
        time: t.toLocaleTimeString([], {hour:"2-digit", minute:"2-digit"})
      });
      renderNotifs();
      toast("Notification received", "Open the bell icon to view it.");
      sounds.notification();
    });

    $("#notifList").addEventListener("click", (e)=>{
      const btn = e.target.closest("[data-dismiss]");
      if(!btn) return;
      const idx = Number(btn.getAttribute("data-dismiss"));
      state.notifs.splice(idx, 1);
      renderNotifs();
      toast("Notifications", "Dismissed.");
      sounds.click();
    });

    // Quick Settings
    function renderQuick(){
      const toggles = [
        { key:"wifi", icon:`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12.55a11 11 0 0114.08 0M1.42 9a16 16 0 0121.16 0M8.53 16.11a6 6 0 016.95 0M12 20h.01"/></svg>`, label:"Wi-Fi" },
        { key:"bt", icon:`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6.5 6.5l11 11L12 23V1l5.5 5.5-11 11"/></svg>`, label:"Bluetooth" },
        { key:"air", icon:`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>`, label:"Airplane" },
        { key:"night", icon:`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>`, label:"Night light" }
      ];

      let html = "";
      toggles.forEach(t => {
        const active = state.toggles[t.key] ? "active" : "";
        html += `<div class="quick-toggle ${active}" data-toggle="${t.key}">
          <div class="icon-row">${t.icon}</div>
          <div class="label">${t.label}</div>
        </div>`;
      });
      $("#quickToggles").innerHTML = html;
    }

    $("#quickBtn").addEventListener("click", ()=>{
      togglePanel("#quickPanel");
    });

    $("#quickToggles").addEventListener("click", (e)=>{
      const tog = e.target.closest("[data-toggle]");
      if(!tog) return;
      const key = tog.getAttribute("data-toggle");
      state.toggles[key] = !state.toggles[key];
      sounds.click();
      renderQuick();
      saveProgress();
    });

    // Volume slider
    $("#volSlider").addEventListener("input", (e)=>{
      const volume = Number(e.target.value);
      $("#volVal").textContent = volume + "%";
      
      // Enable/disable sound based on volume level
      state.soundEnabled = volume > 0;
      saveProgress();
    });

    // Taskbar alignment
    function updateTaskbarAlignment(){
      const tb = $("#taskbar");
      if(state.taskbarAlignment === "left"){
        tb.classList.add("left-align");
        $$("#taskbarAlignmentCard .alignment-option").forEach(opt => {
          opt.classList.toggle("selected", opt.getAttribute("data-align") === "left");
        });
        setStepDone("taskbarAlign");
      } else {
        tb.classList.remove("left-align");
        $$("#taskbarAlignmentCard .alignment-option").forEach(opt => {
          opt.classList.toggle("selected", opt.getAttribute("data-align") === "center");
        });
      }
    }

    // =====================
    // Windows & Apps
    // =====================
    const appToWin = {
      settings: "#win-settings",
      explorer: "#win-explorer",
      edge: "#win-edge",
      recycle: "#win-recycle",
      about: "#win-about",
      tips: "#win-tips"
    };

    function openApp(app){
      const sel = appToWin[app];
      if(!sel) return;
      const win = $(sel);
      win.style.zIndex = (++state.z);
      win.classList.add("show");
      sounds.open();

      // position slightly staggered
      const baseLeft = 140 + (state.z % 5)*22;
      const baseTop  = 110 + (state.z % 4)*18;
      win.style.left = baseLeft + "px";
      win.style.top  = baseTop  + "px";

      if(app === "settings"){
        setStepDone("openSettings");
        
        // Set up taskbar alignment options in Settings window
        setTimeout(() => {
          $$("#taskbarAlignmentCard .alignment-option").forEach(opt => {
            opt.addEventListener("click", () => {
              const align = opt.getAttribute("data-align");
              state.taskbarAlignment = align;
              sounds.click();
              saveProgress();
              updateTaskbarAlignment();
            });
          });
          updateTaskbarAlignment();
        }, 50);
      }
    }

    // Desktop icons
    $$("#desktopIcons .icon").forEach(ic=>{
      ic.addEventListener("dblclick", ()=>{
        openApp(ic.getAttribute("data-open"));
      });
      ic.addEventListener("click", ()=>{
        // single click shows hint
        const name = ic.querySelector(".label")?.textContent || "icon";
        toast("Desktop", `Double-click <b>${name}</b> to open it.`);
        sounds.click();
      });
    });

    // Start panel apps
    $$("#startPanel .start-app").forEach(a=>{
      a.addEventListener("click", ()=>{
        openApp(a.getAttribute("data-open"));
      });
    });

    // Taskbar app buttons
    $$(".tb-btn[data-open]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        sounds.click();
        openApp(btn.getAttribute("data-open"));
      });
    });

    // Window controls
    $$(".window").forEach(win=>{
      const closeBtn = win.querySelector("[data-close]");
      const minBtn = win.querySelector("[data-min]");
      const maxBtn = win.querySelector("[data-max]");
      const titlebar = win.querySelector("[data-drag]");

      if(closeBtn) closeBtn.addEventListener("click", ()=> {
        win.classList.remove("show");
        sounds.close();
      });
      
      if(minBtn) minBtn.addEventListener("click", ()=>{
        win.classList.remove("show");
        sounds.close();
        toast("Minimised", "Window minimised (simulation). Open it again from Start or the desktop icon.");
      });

      if(maxBtn) maxBtn.addEventListener("click", ()=>{
        const isMax = win.dataset.maxed === "1";
        sounds.click();
        if(!isMax){
          win.dataset.prev = JSON.stringify({left:win.style.left, top:win.style.top, width:win.style.width, height:win.style.height});
          win.style.left = "18px";
          win.style.top = "18px";
          win.style.width = "calc(100% - 36px)";
          win.style.height = "calc(100% - 92px)";
          win.dataset.maxed = "1";
        } else {
          try{
            const p = JSON.parse(win.dataset.prev || "{}");
            win.style.left = p.left || "160px";
            win.style.top = p.top || "120px";
            win.style.width = p.width || "520px";
            win.style.height = p.height || "360px";
          }catch(e){}
          win.dataset.maxed = "0";
        }
        win.style.zIndex = (++state.z);
      });

      // bring to front on click
      win.addEventListener("mousedown", ()=> {
        win.style.zIndex = (++state.z);
        sounds.click();
      });

      // Drag
      let dragging = false, ox=0, oy=0;
      titlebar?.addEventListener("mousedown", (e)=>{
        if(win.dataset.maxed === "1") return;
        dragging = true;
        const rect = win.getBoundingClientRect();
        ox = e.clientX - rect.left;
        oy = e.clientY - rect.top;
        win.style.zIndex = (++state.z);
      });
      document.addEventListener("mousemove", (e)=>{
        if(!dragging) return;
        const x = Math.max(8, Math.min(window.innerWidth - win.offsetWidth - 8, e.clientX - ox));
        const y = Math.max(8, Math.min(window.innerHeight - win.offsetHeight - 74, e.clientY - oy));
        win.style.left = x + "px";
        win.style.top = y + "px";
      });
      document.addEventListener("mouseup", ()=> dragging=false);
    });

    // =====================
    // Hints & Reset
    // =====================
    function nextUndone(){
      const order = ["start","search","openSettings","taskbarAlign","notif","clearNotif"];
      return order.find(k => !state.steps[k]) || null;
    }

    function showHint(){
      const next = nextUndone();
      if(!next){
        toast("Completed ‚úÖ", "All steps complete. Nice work!");
        sounds.success();
        return;
      }
      closeAllPanels();

      if(next === "start"){
        $("#winBtn").classList.add("pulse");
        toast("Next step", "Click the <b>Windows</b> button to open Start.");
        return;
      }
      if(next === "search"){
        $("#tbSearchPill").classList.add("pulse");
        toast("Next step", "Click the <b>Search</b> box and type <b>set</b> or <b>settings</b>.");
        return;
      }
      if(next === "openSettings"){
        toast("Next step", "Open <b>Settings</b> from a search result or the desktop icon.");
        return;
      }
      if(next === "taskbarAlign"){
        toast("Next step", "In <b>Settings</b>, change taskbar alignment from <b>Center</b> to <b>Left</b>.");
        return;
      }
      if(next === "notif"){
        $("#notifBtn").classList.add("pulse");
        toast("Next step", "Click the <b>bell</b> icon to open Notifications.");
        return;
      }
      if(next === "clearNotif"){
        toast("Next step", "In Notifications, click <b>Clear all</b>.");
        return;
      }
    }

    $("#hintBtn").addEventListener("click", () => {
      sounds.click();
      showHint();
    });

    $("#resetBtn").addEventListener("click", ()=>{
      if (!confirm("Reset all progress? This will clear your saved progress and reload the lab from the beginning.")) return;
      
      localStorage.removeItem(LS_KEY);
      // Reload the page to start fresh with loading screen
      location.reload();
    });

    // =====================
    // Keyboard shortcuts
    // =====================
    document.addEventListener("keydown", (e)=>{
      if(e.key === "F1"){
        e.preventDefault();
        showHint();
      }
    });

    // =====================
    // Desktop click handler - close panels when clicking blank desktop
    // =====================
    $(".desktop").addEventListener("click", (e)=>{
      // Only close panels if clicking directly on desktop (not on icons, windows, etc)
      if(e.target === $(".desktop") || e.target === $("#desktopIcons")){
        closeAllPanels();
        // Clear search input when closing search panel
        if($("#searchPanel").classList.contains("show")){
          $("#searchInput").value = "";
          renderSearchResults("");
        }
      }
    });

    // =====================
    // Clock
    // =====================
    function tick(){
      const d = new Date();
      $("#timeNow").textContent = d.toLocaleTimeString([], {hour:"2-digit", minute:"2-digit"});
      $("#dateNow").textContent = d.toLocaleDateString([], {weekday:"short", month:"short", day:"2-digit"});
    }

    // =====================
    // Accessibility: Keyboard navigation
    // =====================
    document.addEventListener("keydown", (e) => {
      const focused = document.activeElement;
      
      // Enter key activates buttons and clickable elements
      if (e.key === "Enter" && focused.hasAttribute("tabindex")) {
        e.preventDefault();
        focused.click();
      }
    });

    // =====================
    // Loading Screen
    // =====================
    window.addEventListener("load", () => {
      setTimeout(() => {
        $("#loadingScreen").classList.add("fade-out");
        setTimeout(() => {
          $("#loadingScreen").style.display = "none";
        }, 500);
      }, 1200);
    });

    // =====================
    // Init
    // =====================
    loadProgress();
    renderCoach();
    renderNotifs();
    renderSearchResults("");
    renderQuick();
    updateTaskbarAlignment();
    tick();
    setInterval(tick, 1000);

    // Starter cue if not begun
    if(!state.steps.start){
      setTimeout(()=>{
        toast("Lab 1", "Click the <b>Windows</b> button to open Start and begin.");
        sounds.notification();
      }, 1500);
      setTimeout(()=>$("#winBtn").classList.add("pulse"), 1900);
    }
  </script>
</body>
</html>