<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DP-900 Lab 1: Azure Portal Fundamentals</title>
    <style>
        :root {
            --azure-blue: #0078d4;
            --azure-dark-blue: #005a9e;
            --azure-light-blue: #e6f2ff;
            --azure-gray: #f3f2f1;
            --success-green: #107c10;
            --warning-yellow: #ffb900;
            --error-red: #d13438;
            --shell-dark: #1e1e1e;
            --shell-green: #16c60c;
            --shell-yellow: #f9f1a5;
            --shell-blue: #9cdcfe;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 8px 30px rgba(0, 0, 0, 0.15);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            min-height: 100vh;
            color: #323130;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header */
        .header {
            background: white;
            border-radius: 12px;
            padding: 25px 35px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            border-left: 5px solid var(--azure-blue);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--azure-blue), var(--azure-dark-blue));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 24px;
        }
        
        .title h1 {
            color: var(--azure-dark-blue);
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        .title p {
            color: #605e5c;
            font-size: 16px;
        }
        
        /* Main Layout */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 25px;
        }
        
        /* Simulation Area */
        .simulation-area {
            background: white;
            border-radius: 12px;
            padding: 0;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            min-height: 700px;
            display: flex;
            flex-direction: column;
        }
        
        .simulation-header {
            background: linear-gradient(135deg, var(--azure-blue), var(--azure-dark-blue));
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .simulation-title {
            font-size: 20px;
            font-weight: 600;
        }
        
        .simulation-controls {
            display: flex;
            gap: 10px;
        }
        
        .simulator {
            flex: 1;
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        /* Browser Window */
        .browser-window {
            border: 1px solid #d2d0ce;
            border-radius: 8px;
            overflow: hidden;
            background: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        .browser-header {
            background: #f3f2f1;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid #d2d0ce;
        }
        
        .browser-buttons {
            display: flex;
            gap: 8px;
        }
        
        .browser-button {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .browser-button.close { background: #ff5f57; }
        .browser-button.minimize { background: #ffbd2e; }
        .browser-button.maximize { background: #28ca42; }
        
        .browser-url-bar {
            flex: 1;
            background: white;
            border: 1px solid #d2d0ce;
            border-radius: 4px;
            padding: 6px 12px;
            font-size: 14px;
            color: #323130;
            font-family: 'Consolas', monospace;
        }
        
        .browser-content {
            padding: 30px;
            min-height: 500px;
        }
        
        /* Azure Portal Simulation */
        .azure-portal {
            display: none;
        }
        
        .portal-header {
            background: #00188f;
            color: white;
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .portal-nav {
            display: flex;
            gap: 25px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #edebe9;
        }
        
        .portal-nav-item {
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            color: #323130;
            font-weight: 500;
        }
        
        .portal-nav-item.active {
            background: var(--azure-light-blue);
            color: var(--azure-blue);
        }
        
        .portal-nav-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .portal-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .portal-tile {
            background: #faf9f8;
            border: 1px solid #edebe9;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .portal-tile:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
            border-color: var(--azure-blue);
        }
        
        .portal-tile.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .portal-tile.disabled:hover {
            transform: none;
            box-shadow: none;
            border-color: #edebe9;
        }
        
        .tile-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .tile-icon {
            width: 40px;
            height: 40px;
            background: var(--azure-light-blue);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--azure-blue);
            font-size: 20px;
        }
        
        .tile-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #323130;
        }
        
        .tile-desc {
            color: #605e5c;
            font-size: 14px;
            line-height: 1.5;
        }
        
        /* Cloud Shell Styles */
        .cloud-shell-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .cloud-shell-window {
            background: var(--shell-dark);
            border-radius: 8px;
            overflow: hidden;
            width: 100%;
            max-width: 800px;
            height: 500px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            animation: shellAppear 0.3s ease;
        }
        
        @keyframes shellAppear {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .shell-header {
            background: #323130;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #444;
        }
        
        .shell-title {
            color: white;
            font-weight: 600;
            font-size: 16px;
        }
        
        .shell-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .shell-mode {
            display: flex;
            gap: 5px;
        }
        
        .shell-mode-btn {
            background: #444;
            color: #ccc;
            border: none;
            padding: 6px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            font-family: 'Consolas', monospace;
        }
        
        .shell-mode-btn.active {
            background: var(--azure-blue);
            color: white;
        }
        
        .shell-close {
            background: none;
            border: none;
            color: #ccc;
            font-size: 20px;
            cursor: pointer;
            padding: 0 5px;
        }
        
        .shell-close:hover {
            color: white;
        }
        
        .shell-terminal {
            flex: 1;
            padding: 20px;
            font-family: 'Consolas', 'Courier New', monospace;
            color: #ccc;
            font-size: 14px;
            line-height: 1.5;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        .shell-line {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
            min-height: 20px;
        }
        
        .shell-prompt {
            color: var(--shell-green);
            white-space: nowrap;
            margin-right: 8px;
        }
        
        .shell-command {
            color: var(--shell-yellow);
            flex: 1;
        }
        
        .shell-output {
            margin-bottom: 15px;
            white-space: pre-wrap;
            color: var(--shell-blue);
        }
        
        .shell-error {
            color: #f48771;
        }
        
        .shell-success {
            color: #4ec9b0;
        }
        
        .shell-input-wrapper {
            display: flex;
            align-items: center;
            margin-top: auto;
            position: relative;
        }
        
        .shell-input-line {
            display: flex;
            align-items: center;
            flex: 1;
        }
        
        .shell-input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--shell-yellow);
            font-family: 'Consolas', monospace;
            font-size: 14px;
            outline: none;
            caret-color: var(--shell-green);
            min-width: 20px;
        }
        
        .shell-cursor {
            display: inline-block;
            width: 8px;
            height: 16px;
            background: var(--shell-green);
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        
        /* Lab Instructions Panel */
        .instructions-panel {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--shadow);
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        
        .step-indicator {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #edebe9;
        }
        
        .step {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f3f2f1;
            color: #605e5c;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .step.active {
            background: var(--azure-blue);
            color: white;
            transform: scale(1.1);
        }
        
        .step.completed {
            background: var(--success-green);
            color: white;
        }
        
        .step.locked {
            background: #e1dfdd;
            color: #a19f9d;
            cursor: not-allowed;
        }
        
        .step-content {
            display: none;
        }
        
        .step-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .step-title {
            font-size: 20px;
            color: var(--azure-dark-blue);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--azure-light-blue);
        }
        
        .step-description {
            color: #605e5c;
            line-height: 1.6;
            margin-bottom: 25px;
        }
        
        .step-actions {
            margin-top: 25px;
            display: flex;
            gap: 15px;
        }
        
        .btn {
            padding: 12px 24px;
            border-radius: 6px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }
        
        .btn-primary {
            background: var(--azure-blue);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--azure-dark-blue);
            transform: translateY(-1px);
        }
        
        .btn-primary:disabled {
            background: #e1dfdd;
            color: #a19f9d;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: #f3f2f1;
            color: #323130;
        }
        
        .btn-secondary:hover {
            background: #e1dfdd;
        }
        
        .btn-secondary:disabled {
            background: #f3f2f1;
            color: #a19f9d;
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .btn-success {
            background: var(--success-green);
            color: white;
        }
        
        .btn-success:hover {
            background: #0a5a0a;
        }
        
        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #323130;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #d2d0ce;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.2s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--azure-blue);
            box-shadow: 0 0 0 2px rgba(0, 120, 212, 0.2);
        }
        
        /* Resource Group Creation */
        .resource-group-form {
            background: #faf9f8;
            border: 1px solid #edebe9;
            border-radius: 8px;
            padding: 25px;
            margin-top: 20px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        /* Confirmation Dialog */
        .confirmation-dialog {
            background: white;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            animation: dialogAppear 0.3s ease;
        }
        
        @keyframes dialogAppear {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .confirmation-icon {
            width: 80px;
            height: 80px;
            background: var(--success-green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 25px;
            font-size: 36px;
            color: white;
        }
        
        .confirmation-title {
            font-size: 24px;
            color: var(--success-green);
            margin-bottom: 15px;
        }
        
        .confirmation-message {
            color: #605e5c;
            margin-bottom: 25px;
            line-height: 1.6;
        }
        
        /* Progress Bar */
        .progress-container {
            margin: 30px 0;
        }
        
        .progress-bar {
            height: 8px;
            background: #f3f2f1;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--azure-blue), var(--success-green));
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: #605e5c;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 15px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
            border-left: 4px solid var(--azure-blue);
        }
        
        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .notification-icon {
            width: 40px;
            height: 40px;
            background: var(--azure-light-blue);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--azure-blue);
            font-size: 20px;
        }
        
        /* Responsive */
        @media (max-width: 1100px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .instructions-panel {
                position: static;
            }
            
            .cloud-shell-window {
                height: 500px;
            }
        }
        
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .cloud-shell-window {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">‚òÅ</div>
                <div class="title">
                    <h1>DP-900: Azure Data Fundamentals</h1>
                    <p>Lab 1: Azure Portal Navigation & Resource Management</p>
                </div>
            </div>
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text">
                    <span>Lab Progress</span>
                    <span id="progressPercent">0%</span>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Simulation Area -->
            <div class="simulation-area">
                <div class="simulation-header">
                    <div class="simulation-title" id="simulationTitle">Azure Portal Simulator</div>
                    <div class="simulation-controls">
                        <button class="btn btn-secondary" onclick="resetSimulation()">Reset Lab</button>
                    </div>
                </div>
                
                <div class="simulator">
                    <!-- Browser Window -->
                    <div class="browser-window" id="browserWindow">
                        <div class="browser-header">
                            <div class="browser-buttons">
                                <div class="browser-button close"></div>
                                <div class="browser-button minimize"></div>
                                <div class="browser-button maximize"></div>
                            </div>
                            <div class="browser-url-bar" id="urlBar">https://portal.azure.com</div>
                        </div>
                        <div class="browser-content" id="browserContent">
                            <!-- Content will be dynamically loaded here -->
                            <div id="step1Content">
                                <h2 style="color: var(--azure-blue); margin-bottom: 20px;">Welcome to Azure</h2>
                                <p style="margin-bottom: 25px; color: #605e5c;">Sign in to access your Azure resources and services.</p>
                                
                                <div style="max-width: 400px; margin: 40px auto;">
                                    <div class="form-group">
                                        <label class="form-label">Email or phone</label>
                                        <input type="text" class="form-input" id="emailInput" placeholder="Enter your Microsoft account" value="student@learnazure.com">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Password</label>
                                        <input type="password" class="form-input" id="passwordInput" placeholder="Enter your password" value="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                                    </div>
                                    
                                    <button id="signInButton" class="btn btn-primary" style="width: 100%; margin-top: 20px;">Sign In</button>
                                    
                                    <div style="margin-top: 25px; padding: 20px; background: #f3f2f1; border-radius: 6px;">
                                        <h4 style="margin-bottom: 10px; color: #323130;">Demo Credentials</h4>
                                        <p style="font-size: 14px; color: #605e5c;">For this simulation, use the pre-filled credentials above.</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Azure Portal Dashboard (hidden initially) -->
                            <div id="azurePortal" class="azure-portal">
                                <div class="portal-header">
                                    <div style="font-size: 20px; font-weight: 600;">Microsoft Azure</div>
                                    <div style="display: flex; align-items: center; gap: 15px;">
                                        <div style="background: rgba(255,255,255,0.1); padding: 6px 12px; border-radius: 4px;">
                                            Student Environment
                                        </div>
                                        <button class="btn btn-secondary" style="padding: 8px 16px;" onclick="openCloudShell()" id="cloudShellButton">
                                            <span style="margin-right: 8px;">üñ•Ô∏è</span> Cloud Shell
                                        </button>
                                        <div>‚òÅ</div>
                                    </div>
                                </div>
                                
                                <div class="portal-nav">
                                    <div class="portal-nav-item active" onclick="showDashboard()">Dashboard</div>
                                    <div class="portal-nav-item" onclick="showAllServices()">All services</div>
                                    <div class="portal-nav-item" onclick="showResourceGroups()">Resource groups</div>
                                    <div class="portal-nav-item" onclick="showSubscriptions()">Subscriptions</div>
                                </div>
                                
                                <div class="portal-dashboard" id="portalDashboard">
                                    <!-- Tiles will be populated by JavaScript -->
                                </div>
                                
                                <!-- Resource Group Creation Form -->
                                <div id="resourceGroupForm" style="display: none;">
                                    <h2 style="color: var(--azure-blue); margin-bottom: 20px;">Create a resource group</h2>
                                    <p style="margin-bottom: 25px; color: #605e5c;">Resource groups are containers that hold related resources for an Azure solution.</p>
                                    
                                    <div class="resource-group-form">
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label class="form-label">Subscription</label>
                                                <input type="text" class="form-input" value="Azure Student Environment" readonly>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Resource group name</label>
                                                <input type="text" class="form-input" id="rgNameInput" placeholder="DP900-Lab1-Resources">
                                            </div>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label class="form-label">Region</label>
                                            <select class="form-input" id="regionSelect">
                                                <option value="eastus">(US) East US</option>
                                                <option value="westeurope">(Europe) West Europe</option>
                                                <option value="southeastasia">(Asia) Southeast Asia</option>
                                            </select>
                                        </div>
                                        
                                        <div class="step-actions">
                                            <button class="btn btn-secondary" onclick="showDashboard()">Cancel</button>
                                            <button class="btn btn-primary" onclick="createResourceGroup()" id="createRgButton">Review + create</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Resource Group Created Confirmation -->
                                <div id="resourceGroupCreated" style="display: none;">
                                    <div class="confirmation-dialog">
                                        <div class="confirmation-icon">‚úì</div>
                                        <div class="confirmation-title">Resource group created successfully!</div>
                                        <div class="confirmation-message">
                                            Your resource group <strong id="createdRgName">DP900-Lab1-Resources</strong> has been created in the <strong id="createdRegion">East US</strong> region.
                                        </div>
                                        <div style="background: #1e1e1e; color: #d4d4d4; font-family: 'Consolas'; padding: 15px; border-radius: 4px; margin-top: 20px; font-size: 13px;">
                                            <div>[INFO] Creating resource group: DP900-Lab1-Resources</div>
                                            <div style="color: #4ec9b0;">[SUCCESS] Resource group created successfully</div>
                                            <div>[INFO] Location: East US</div>
                                            <div>[INFO] Subscription: Azure Student Environment</div>
                                        </div>
                                        <div class="step-actions" style="margin-top: 30px;">
                                            <button class="btn btn-success" onclick="completeStep(3)">Continue to Step 4</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- All Services View -->
                                <div id="allServicesView" style="display: none;">
                                    <h2 style="color: var(--azure-blue); margin-bottom: 20px;">All Services</h2>
                                    <p style="margin-bottom: 25px; color: #605e5c;">Browse Azure services by category</p>
                                    <div id="servicesGrid" class="portal-dashboard"></div>
                                </div>
                                
                                <!-- Subscriptions View -->
                                <div id="subscriptionsView" style="display: none;">
                                    <h2 style="color: var(--azure-blue); margin-bottom: 20px;">Subscriptions</h2>
                                    <div style="background: #faf9f8; border: 1px solid #edebe9; border-radius: 8px; padding: 25px;">
                                        <div style="margin-bottom: 20px;">
                                            <h3 style="color: #323130; margin-bottom: 10px;">Azure Student Environment</h3>
                                            <p style="color: #605e5c; margin-bottom: 15px;">Active subscription for learning purposes</p>
                                        </div>
                                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                                            <div>
                                                <div style="font-size: 12px; color: #605e5c;">Subscription ID</div>
                                                <div style="font-family: 'Consolas'; font-size: 14px;">a1b2c3d4-e5f6-g7h8-i9j0-k1l2m3n4o5p6</div>
                                            </div>
                                            <div>
                                                <div style="font-size: 12px; color: #605e5c;">Status</div>
                                                <div style="color: var(--success-green); font-weight: 600;">Active</div>
                                            </div>
                                            <div>
                                                <div style="font-size: 12px; color: #605e5c;">Spending Limit</div>
                                                <div style="color: var(--success-green); font-weight: 600;">Enabled</div>
                                            </div>
                                            <div>
                                                <div style="font-size: 12px; color: #605e5c;">Credits Remaining</div>
                                                <div style="color: var(--success-green); font-weight: 600;">$200.00</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Instructions Panel -->
            <div class="instructions-panel">
                <div class="step-indicator">
                    <div class="step active" data-step="1">1</div>
                    <div class="step locked" data-step="2">2</div>
                    <div class="step locked" data-step="3">3</div>
                    <div class="step locked" data-step="4">4</div>
                    <div class="step locked" data-step="5">5</div>
                    <div class="step locked" data-step="6">6</div>
                </div>
                
                <!-- Step 1 -->
                <div class="step-content active" id="step1Instructions">
                    <div class="step-title">Step 1: Sign In to Azure</div>
                    <div class="step-description">
                        <p>Sign in to the Azure Portal using your Microsoft account. In this simulation, you'll use the demo credentials provided.</p>
                        <p><strong>Objective:</strong> Access the Azure Portal interface to begin exploring Azure services.</p>
                    </div>
                    <div class="step-actions">
                        <button class="btn btn-primary" id="step1SignInButton">Sign In to Azure</button>
                    </div>
                </div>
                
                <!-- Step 2 -->
                <div class="step-content" id="step2Instructions">
                    <div class="step-title">Step 2: Explore Azure Portal</div>
                    <div class="step-description">
                        <p>Navigate through the Azure Portal interface. Explore the dashboard, navigation menu, and service tiles.</p>
                        <p><strong>Try these actions:</strong></p>
                        <ul style="padding-left: 20px; margin-top: 10px; color: #605e5c;">
                            <li>Click on different service tiles</li>
                            <li>Use the search bar to find services</li>
                            <li>Navigate through the left menu</li>
                        </ul>
                    </div>
                    <div class="step-actions">
                        <button class="btn btn-secondary" onclick="goToStep(1)">Previous</button>
                        <button class="btn btn-primary" onclick="completeStep(2)" id="completeStep2Button" disabled>I've Explored the Portal</button>
                    </div>
                </div>
                
                <!-- Step 3 -->
                <div class="step-content" id="step3Instructions">
                    <div class="step-title">Step 3: Create Resource Group</div>
                    <div class="step-description">
                        <p>Resource groups are containers that hold related Azure resources. Create a resource group for this lab.</p>
                        <p><strong>Requirements:</strong></p>
                        <ul style="padding-left: 20px; margin-top: 10px; color: #605e5c;">
                            <li>Name: <code>DP900-Lab1-Resources</code></li>
                            <li>Select a region close to you</li>
                            <li>Use the Azure Student Environment subscription</li>
                        </ul>
                    </div>
                    <div class="step-actions">
                        <button class="btn btn-secondary" onclick="goToStep(2)">Previous</button>
                        <button class="btn btn-primary" onclick="showResourceGroupForm()" id="createRgStepButton" disabled>Create Resource Group</button>
                    </div>
                </div>
                
                <!-- Step 4 -->
                <div class="step-content" id="step4Instructions">
                    <div class="step-title">Step 4: Explore Data Services</div>
                    <div class="step-description">
                        <p>Search for and explore key Azure data services you'll use in the DP-900 course.</p>
                        <p><strong>Find these services:</strong></p>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
                            <div style="padding: 10px; background: var(--azure-light-blue); border-radius: 4px; text-align: center;">
                                Azure SQL Database
                            </div>
                            <div style="padding: 10px; background: var(--azure-light-blue); border-radius: 4px; text-align: center;">
                                Azure Cosmos DB
                            </div>
                            <div style="padding: 10px; background: var(--azure-light-blue); border-radius: 4px; text-align: center;">
                                Azure Storage
                            </div>
                            <div style="padding: 10px; background: var(--azure-light-blue); border-radius: 4px; text-align: center;">
                                Azure Synapse
                            </div>
                        </div>
                    </div>
                    <div class="step-actions">
                        <button class="btn btn-secondary" onclick="goToStep(3)">Previous</button>
                        <button class="btn btn-primary" onclick="exploreDataServices()" id="exploreServicesButton" disabled>Search for Services</button>
                    </div>
                </div>
                
                <!-- Step 5: Cloud Shell -->
                <div class="step-content" id="step5Instructions">
                    <div class="step-title">Step 5: Explore Azure Cloud Shell</div>
                    <div class="step-description">
                        <p>Azure Cloud Shell is an interactive, browser-accessible shell for managing Azure resources.</p>
                        <p><strong>Key Features:</strong></p>
                        <ul style="padding-left: 20px; margin-top: 10px; color: #605e5c;">
                            <li>Browser-based Bash or PowerShell</li>
                            <li>5GB persistent storage</li>
                            <li>Pre-installed Azure CLI and PowerShell</li>
                            <li>Access from anywhere</li>
                        </ul>
                        <p><strong>In this step:</strong> Open Cloud Shell and run basic commands to explore your Azure environment.</p>
                        <p><strong>Try:</strong> Type <code>az account show</code> or <code>help</code> to see available commands.</p>
                    </div>
                    <div class="step-actions">
                        <button class="btn btn-secondary" onclick="goToStep(4)">Previous</button>
                        <button class="btn btn-primary" onclick="openCloudShell()" id="openCloudShellButton" disabled>Open Cloud Shell</button>
                    </div>
                </div>
                
                <!-- Step 6 -->
                <div class="step-content" id="step6Instructions">
                    <div class="step-title">Step 6: Lab Completion</div>
                    <div class="step-description">
                        <p><strong>Congratulations!</strong> You've successfully completed Lab 1.</p>
                        <p><strong>What you've accomplished:</strong></p>
                        <ul style="padding-left: 20px; margin-top: 10px; color: #605e5c;">
                            <li>Signed into Azure Portal</li>
                            <li>Explored the Azure interface</li>
                            <li>Created a resource group</li>
                            <li>Explored key data services</li>
                            <li>Used Azure Cloud Shell</li>
                        </ul>
                        <p style="margin-top: 20px; padding: 15px; background: #f0f9f0; border-radius: 6px; border-left: 4px solid var(--success-green);">
                            <strong>Ready for Lab 2:</strong> You can now proceed to learn about core data concepts.
                        </p>
                    </div>
                    <div class="step-actions">
                        <button class="btn btn-secondary" onclick="goToStep(5)">Previous</button>
                        <button class="btn btn-success" onclick="completeLab()" id="completeLabButton" disabled>Complete Lab</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Cloud Shell Window -->
    <div class="cloud-shell-container" id="cloudShellContainer">
        <div class="cloud-shell-window">
            <div class="shell-header">
                <div class="shell-title">Azure Cloud Shell</div>
                <div class="shell-controls">
                    <div class="shell-mode">
                        <button class="shell-mode-btn active" id="bashMode">Bash</button>
                        <button class="shell-mode-btn" id="powershellMode">PowerShell</button>
                    </div>
                    <button class="shell-close" onclick="closeCloudShell()">‚úï</button>
                </div>
            </div>
            <div class="shell-terminal" id="shellTerminal">
                <!-- Terminal content will be added by JavaScript -->
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification">
        <div class="notification-icon">‚úì</div>
        <div>
            <div style="font-weight: 600; color: #323130;" id="notificationTitle">Step Completed</div>
            <div style="font-size: 14px; color: #605e5c;" id="notificationMessage">You've successfully signed in to Azure.</div>
        </div>
    </div>

    <script>
        // Lab State
        const labState = {
            currentStep: 1,
            completedSteps: [1],
            resourceGroupCreated: false,
            servicesExplored: [],
            cloudShellUsed: false,
            shellMode: 'bash',
            commandHistory: [],
            historyIndex: 0,
            portalExplored: false
        };
        
        // Initialize the simulation
        function initializeSimulation() {
            updateProgress();
            showNotification("Welcome to DP-900 Lab 1", "This is an offline simulation of Azure Portal setup. Follow the steps on the right.");
            
            // Add event listeners for sign-in buttons
            document.getElementById('signInButton').addEventListener('click', simulateSignIn);
            document.getElementById('step1SignInButton').addEventListener('click', simulateSignIn);
            
            // Initialize shell mode buttons
            document.getElementById('bashMode').addEventListener('click', () => setShellMode('bash'));
            document.getElementById('powershellMode').addEventListener('click', () => setShellMode('powershell'));
            
            // Initialize step locking
            updateStepLocking();
            
            // Initialize shell
            initializeShell();
        }
        
        // Update progress bar
        function updateProgress() {
            const progress = (labState.currentStep / 6) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('progressPercent').textContent = `${Math.round(progress)}%`;
        }
        
        // Show notification
        function showNotification(title, message) {
            const notification = document.getElementById('notification');
            document.getElementById('notificationTitle').textContent = title;
            document.getElementById('notificationMessage').textContent = message;
            
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Update step locking based on current state
        function updateStepLocking() {
            const step2Button = document.getElementById('completeStep2Button');
            const step3Button = document.getElementById('createRgStepButton');
            const step4Button = document.getElementById('exploreServicesButton');
            const step5Button = document.getElementById('openCloudShellButton');
            const step6Button = document.getElementById('completeLabButton');
            
            // Step 2: Enable only if step 1 is completed
            step2Button.disabled = !labState.completedSteps.includes(1);
            
            // Step 3: Enable only if step 2 is completed
            step3Button.disabled = !labState.completedSteps.includes(2);
            
            // Step 4: Enable only if step 3 is completed
            step4Button.disabled = !labState.completedSteps.includes(3);
            
            // Step 5: Enable only if step 4 is completed
            step5Button.disabled = !labState.completedSteps.includes(4);
            
            // Step 6: Enable only if step 5 is completed
            step6Button.disabled = !labState.completedSteps.includes(5);
            
            // Update step indicators
            document.querySelectorAll('.step').forEach(step => {
                const stepNum = parseInt(step.dataset.step);
                
                if (labState.completedSteps.includes(stepNum)) {
                    step.classList.remove('active', 'locked');
                    step.classList.add('completed');
                } else if (stepNum === labState.currentStep) {
                    step.classList.remove('completed', 'locked');
                    step.classList.add('active');
                } else if (stepNum <= labState.currentStep) {
                    step.classList.remove('active', 'locked', 'completed');
                } else {
                    step.classList.remove('active', 'completed');
                    step.classList.add('locked');
                }
            });
        }
        
        // Simulate Azure sign in
        function simulateSignIn() {
            document.getElementById('step1Content').style.opacity = '0.5';
            document.getElementById('signInButton').disabled = true;
            document.getElementById('signInButton').textContent = 'Signing in...';
            document.getElementById('step1SignInButton').disabled = true;
            document.getElementById('step1SignInButton').textContent = 'Signing in...';
            
            setTimeout(() => {
                // Hide sign in form
                document.getElementById('step1Content').style.display = 'none';
                
                // Show Azure Portal
                document.getElementById('azurePortal').style.display = 'block';
                
                // Update URL bar
                document.getElementById('urlBar').textContent = 'https://portal.azure.com/#home';
                
                // Load dashboard tiles
                loadDashboardTiles();
                
                // Complete step 1
                completeStep(1);
                
                showNotification("Successfully Signed In", "Welcome to Azure Portal!");
            }, 1500);
        }
        
        // Load dashboard tiles
        function loadDashboardTiles() {
            const tiles = [
                { 
                    title: "All resources", 
                    desc: "View and manage all your Azure resources",
                    icon: "üì¶",
                    id: "all-resources",
                    clickable: true
                },
                { 
                    title: "Resource groups", 
                    desc: "Manage containers for your Azure resources",
                    icon: "üóÇÔ∏è",
                    id: "resource-groups",
                    clickable: true
                },
                { 
                    title: "Azure SQL Database", 
                    desc: "Managed relational SQL database in the cloud",
                    icon: "üóÑÔ∏è",
                    id: "sql-db",
                    clickable: labState.completedSteps.includes(2)
                },
                { 
                    title: "Azure Cosmos DB", 
                    desc: "Globally distributed, multi-model database",
                    icon: "üåê",
                    id: "cosmos-db",
                    clickable: labState.completedSteps.includes(2)
                },
                { 
                    title: "Azure Storage", 
                    desc: "Durable, highly available cloud storage",
                    icon: "üíæ",
                    id: "storage",
                    clickable: labState.completedSteps.includes(2)
                },
                { 
                    title: "Azure Synapse Analytics", 
                    desc: "Unified analytics service",
                    icon: "üìä",
                    id: "synapse",
                    clickable: labState.completedSteps.includes(2)
                }
            ];
            
            const dashboard = document.getElementById('portalDashboard');
            dashboard.innerHTML = '';
            
            tiles.forEach(tile => {
                const tileElement = document.createElement('div');
                tileElement.className = 'portal-tile';
                if (!tile.clickable) {
                    tileElement.classList.add('disabled');
                }
                
                tileElement.innerHTML = `
                    <div class="tile-header">
                        <div class="tile-icon">${tile.icon}</div>
                        <div style="font-size: 12px; color: #605e5c;">${tile.clickable ? 'Click to explore' : 'Complete Step 2 to explore'}</div>
                    </div>
                    <div class="tile-title">${tile.title}</div>
                    <div class="tile-desc">${tile.desc}</div>
                `;
                
                if (tile.clickable) {
                    tileElement.onclick = () => {
                        showNotification(`Exploring ${tile.title}`, tile.desc);
                        if (!labState.servicesExplored.includes(tile.id)) {
                            labState.servicesExplored.push(tile.id);
                            // Mark portal as explored after clicking a few tiles
                            if (labState.servicesExplored.length >= 2 && !labState.portalExplored) {
                                labState.portalExplored = true;
                            }
                        }
                    };
                }
                
                dashboard.appendChild(tileElement);
            });
        }
        
        // Show resource group creation form
        function showResourceGroupForm() {
            // Only allow if step 2 is completed
            if (!labState.completedSteps.includes(2)) {
                showNotification("Step Locked", "Please complete Step 2 first.");
                return;
            }
            
            document.getElementById('portalDashboard').style.display = 'none';
            document.getElementById('allServicesView').style.display = 'none';
            document.getElementById('subscriptionsView').style.display = 'none';
            document.getElementById('resourceGroupForm').style.display = 'block';
            showNotification("Create Resource Group", "Enter details for your new resource group");
        }
        
        // Show all services
        function showAllServices() {
            // Only allow if step 2 is completed
            if (!labState.completedSteps.includes(2)) {
                showNotification("Step Locked", "Please complete Step 2 first.");
                return;
            }
            
            const services = [
                { name: "Virtual Machines", category: "Compute", icon: "üñ•Ô∏è" },
                { name: "App Services", category: "Compute", icon: "üåê" },
                { name: "Azure SQL Database", category: "Databases", icon: "üóÑÔ∏è" },
                { name: "Cosmos DB", category: "Databases", icon: "üåê" },
                { name: "Storage Accounts", category: "Storage", icon: "üíæ" },
                { name: "Azure Data Lake", category: "Storage", icon: "üèûÔ∏è" },
                { name: "Azure Synapse Analytics", category: "Analytics", icon: "üìä" },
                { name: "Azure Databricks", category: "Analytics", icon: "üé®" },
                { name: "Azure Data Factory", category: "Integration", icon: "üè≠" },
                { name: "Event Hubs", category: "Integration", icon: "üì°" }
            ];
            
            const servicesGrid = document.getElementById('servicesGrid');
            servicesGrid.innerHTML = '';
            
            services.forEach(service => {
                const serviceElement = document.createElement('div');
                serviceElement.className = 'portal-tile';
                serviceElement.innerHTML = `
                    <div class="tile-header">
                        <div class="tile-icon">${service.icon}</div>
                        <div style="font-size: 12px; color: #605e5c; background: ${service.category === 'Databases' ? 'rgba(0,120,212,0.1)' : '#f3f2f1'}; padding: 4px 8px; border-radius: 4px;">${service.category}</div>
                    </div>
                    <div class="tile-title">${service.name}</div>
                `;
                
                serviceElement.onclick = () => {
                    showNotification(`${service.name}`, `${service.category} service`);
                };
                
                servicesGrid.appendChild(serviceElement);
            });
            
            document.getElementById('portalDashboard').style.display = 'none';
            document.getElementById('resourceGroupForm').style.display = 'none';
            document.getElementById('resourceGroupCreated').style.display = 'none';
            document.getElementById('subscriptionsView').style.display = 'none';
            document.getElementById('allServicesView').style.display = 'block';
        }
        
        // Show subscriptions
        function showSubscriptions() {
            // Only allow if step 2 is completed
            if (!labState.completedSteps.includes(2)) {
                showNotification("Step Locked", "Please complete Step 2 first.");
                return;
            }
            
            document.getElementById('portalDashboard').style.display = 'none';
            document.getElementById('resourceGroupForm').style.display = 'none';
            document.getElementById('resourceGroupCreated').style.display = 'none';
            document.getElementById('allServicesView').style.display = 'none';
            document.getElementById('subscriptionsView').style.display = 'block';
        }
        
        // Show dashboard
        function showDashboard() {
            document.getElementById('portalDashboard').style.display = 'grid';
            document.getElementById('resourceGroupForm').style.display = 'none';
            document.getElementById('resourceGroupCreated').style.display = 'none';
            document.getElementById('allServicesView').style.display = 'none';
            document.getElementById('subscriptionsView').style.display = 'none';
        }
        
        // Create resource group
        function createResourceGroup() {
            // Only allow if step 2 is completed
            if (!labState.completedSteps.includes(2)) {
                showNotification("Step Locked", "Please complete Step 2 first.");
                return;
            }
            
            const rgName = document.getElementById('rgNameInput').value || 'DP900-Lab1-Resources';
            const region = document.getElementById('regionSelect').options[document.getElementById('regionSelect').selectedIndex].text;
            
            if (!rgName.trim()) {
                showNotification("Validation Error", "Please enter a resource group name");
                return;
            }
            
            // Show creation in progress
            document.getElementById('resourceGroupForm').style.opacity = '0.5';
            document.getElementById('createRgButton').disabled = true;
            document.getElementById('createRgButton').textContent = 'Creating...';
            
            setTimeout(() => {
                document.getElementById('resourceGroupForm').style.display = 'none';
                document.getElementById('resourceGroupCreated').style.display = 'block';
                
                // Update confirmation message
                document.getElementById('createdRgName').textContent = rgName;
                document.getElementById('createdRegion').textContent = region;
                
                labState.resourceGroupCreated = true;
                showNotification("Resource Group Created", `${rgName} created successfully in ${region}`);
                
                // Complete step 3
                completeStep(3);
            }, 2000);
        }
        
        // Explore data services
        function exploreDataServices() {
            // Only allow if step 3 is completed
            if (!labState.completedSteps.includes(3)) {
                showNotification("Step Locked", "Please complete Step 3 first.");
                return;
            }
            
            const searchResults = [
                { name: "Azure SQL Database", type: "Relational Database", status: "Available" },
                { name: "Azure Cosmos DB", type: "NoSQL Database", status: "Available" },
                { name: "Azure Storage Account", type: "Storage Service", status: "Available" },
                { name: "Azure Synapse Analytics", type: "Analytics Service", status: "Available" },
                { name: "Azure Data Factory", type: "Data Integration", status: "Available" },
                { name: "Azure Databricks", type: "Analytics Platform", status: "Available" }
            ];
            
            let resultsHTML = `
                <h2 style="color: var(--azure-blue); margin-bottom: 20px;">Search Results: "data"</h2>
                <p style="margin-bottom: 25px; color: #605e5c;">Found ${searchResults.length} services matching your search</p>
                <div style="display: grid; gap: 15px; margin-top: 20px;">
            `;
            
            searchResults.forEach(service => {
                resultsHTML += `
                    <div style="padding: 20px; border: 1px solid #edebe9; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600; color: #323130;">${service.name}</div>
                            <div style="font-size: 14px; color: #605e5c; margin-top: 5px;">${service.type}</div>
                        </div>
                        <div style="padding: 6px 12px; background: var(--azure-light-blue); color: var(--azure-blue); border-radius: 4px; font-size: 14px;">
                            ${service.status}
                        </div>
                    </div>
                `;
            });
            
            resultsHTML += '</div>';
            
            document.getElementById('portalDashboard').innerHTML = resultsHTML;
            document.getElementById('portalDashboard').style.display = 'block';
            document.getElementById('resourceGroupCreated').style.display = 'none';
            
            showNotification("Services Found", `Found ${searchResults.length} data services`);
            completeStep(4);
        }
        
        // Open Cloud Shell
        function openCloudShell() {
            // Only allow if step 4 is completed
            if (!labState.completedSteps.includes(4)) {
                showNotification("Step Locked", "Please complete Step 4 first.");
                return;
            }
            
            document.getElementById('cloudShellContainer').style.display = 'flex';
            labState.cloudShellUsed = true;
            
            // Clear terminal
            const terminal = document.getElementById('shellTerminal');
            terminal.innerHTML = '';
            
            // Add welcome message
            addShellOutput("Azure Cloud Shell - Version 1.0");
            addShellOutput("Requesting a Cloud Shell... Succeeded.");
            addShellOutput("Connecting terminal...");
            addShellOutput("Welcome to Azure Cloud Shell");
            addShellOutput("");
            addShellOutput("Type 'help' for a list of available commands.");
            addShellOutput("");
            
            // Add initial prompt
            addShellPrompt();
            
            // Complete step 5 when shell opens
            if (!labState.completedSteps.includes(5)) {
                completeStep(5);
            }
        }
        
        // Close Cloud Shell
        function closeCloudShell() {
            document.getElementById('cloudShellContainer').style.display = 'none';
        }
        
        // Set shell mode
        function setShellMode(mode) {
            labState.shellMode = mode;
            
            // Update UI
            document.getElementById('bashMode').classList.toggle('active', mode === 'bash');
            document.getElementById('powershellMode').classList.toggle('active', mode === 'powershell');
            
            // Clear terminal and show mode switch message
            const terminal = document.getElementById('shellTerminal');
            terminal.innerHTML = '';
            
            addShellOutput(`Switching to ${mode}...`);
            addShellOutput(`Azure Cloud Shell (${mode})`);
            addShellOutput("");
            addShellPrompt();
        }
        
        // Initialize shell
        function initializeShell() {
            // Add keyboard event listener for shell
            document.addEventListener('keydown', (e) => {
                const shellContainer = document.getElementById('cloudShellContainer');
                if (shellContainer.style.display !== 'flex') return;
                
                const input = document.getElementById('shellInput');
                if (!input || document.activeElement !== input) return;
                
                if (e.key === 'Enter') {
                    e.preventDefault();
                    executeShellCommand();
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    navigateCommandHistory('up');
                } else if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    navigateCommandHistory('down');
                }
            });
        }
        
        // Add shell output
        function addShellOutput(text, type = 'normal') {
            const terminal = document.getElementById('shellTerminal');
            const output = document.createElement('div');
            output.className = 'shell-output';
            output.textContent = text;
            
            if (type === 'error') {
                output.className = 'shell-error';
            } else if (type === 'success') {
                output.className = 'shell-success';
            }
            
            terminal.appendChild(output);
            terminal.scrollTop = terminal.scrollHeight;
        }
        
        // Add shell prompt
        function addShellPrompt() {
            const terminal = document.getElementById('shellTerminal');
            
            // Create input wrapper
            const inputWrapper = document.createElement('div');
            inputWrapper.className = 'shell-input-wrapper';
            
            // Create input line
            const inputLine = document.createElement('div');
            inputLine.className = 'shell-line shell-input-line';
            
            const prompt = labState.shellMode === 'bash' 
                ? 'user@Azure:~$ ' 
                : 'PS Azure:\\> ';
                
            inputLine.innerHTML = `
                <span class="shell-prompt">${prompt}</span>
                <input type="text" id="shellInput" class="shell-input" autocomplete="off" spellcheck="false">
            `;
            
            // Create cursor element
            const cursor = document.createElement('span');
            cursor.className = 'shell-cursor';
            cursor.id = 'shellCursor';
            
            inputWrapper.appendChild(inputLine);
            inputWrapper.appendChild(cursor);
            terminal.appendChild(inputWrapper);
            
            const input = document.getElementById('shellInput');
            if (input) {
                input.focus();
                
                // Position cursor after input
                input.addEventListener('input', updateCursorPosition);
                input.addEventListener('keydown', updateCursorPosition);
                input.addEventListener('click', updateCursorPosition);
                
                // Initial cursor position
                updateCursorPosition();
            }
        }
        
        // Update cursor position
        function updateCursorPosition() {
            const input = document.getElementById('shellInput');
            const cursor = document.getElementById('shellCursor');
            
            if (!input || !cursor) return;
            
            // Create a temporary span to measure text width
            const tempSpan = document.createElement('span');
            tempSpan.style.visibility = 'hidden';
            tempSpan.style.position = 'absolute';
            tempSpan.style.whiteSpace = 'pre';
            tempSpan.style.fontFamily = "'Consolas', monospace";
            tempSpan.style.fontSize = '14px';
            tempSpan.textContent = input.value.substring(0, input.selectionStart);
            
            document.body.appendChild(tempSpan);
            const textWidth = tempSpan.offsetWidth;
            document.body.removeChild(tempSpan);
            
            // Position cursor relative to input
            cursor.style.position = 'absolute';
            cursor.style.left = `${textWidth + 120}px`; // 120px accounts for prompt width and padding
            cursor.style.top = '0';
        }
        
        // Execute shell command
        function executeShellCommand() {
            const input = document.getElementById('shellInput');
            if (!input) return;
            
            const command = input.value.trim();
            
            if (!command) {
                addShellPrompt();
                return;
            }
            
            // Store in history
            labState.commandHistory.push(command);
            labState.historyIndex = labState.commandHistory.length;
            
            // Show command in output
            const terminal = document.getElementById('shellTerminal');
            const prompt = labState.shellMode === 'bash' 
                ? 'user@Azure:~$ ' 
                : 'PS Azure:\\> ';
                
            const commandLine = document.createElement('div');
            commandLine.className = 'shell-line';
            commandLine.innerHTML = `<span class="shell-prompt">${prompt}</span><span class="shell-command">${command}</span>`;
            terminal.appendChild(commandLine);
            
            // Remove input line
            const inputWrapper = terminal.querySelector('.shell-input-wrapper');
            if (inputWrapper) {
                inputWrapper.remove();
            }
            
            // Process command
            processShellCommand(command);
        }
        
        // Process shell command
        function processShellCommand(command) {
            const commands = {
                'help': () => {
                    addShellOutput("Available commands:");
                    addShellOutput("  help                 - Show this help message");
                    addShellOutput("  clear                - Clear the terminal");
                    addShellOutput("  ls                   - List files");
                    addShellOutput("  pwd                  - Print working directory");
                    addShellOutput("  az account show      - Show Azure subscription");
                    addShellOutput("  az group list        - List resource groups");
                    addShellOutput("  az --version         - Show Azure CLI version");
                    if (labState.shellMode === 'powershell') {
                        addShellOutput("  Get-AzSubscription   - Show subscription (PowerShell)");
                        addShellOutput("  Get-AzResourceGroup  - List resource groups (PowerShell)");
                    }
                    addShellOutput("");
                },
                
                'clear': () => {
                    document.getElementById('shellTerminal').innerHTML = '';
                    return true; // Don't add prompt after clear
                },
                
                'ls': () => {
                    addShellOutput("clouddrive/    README.txt    azure/");
                },
                
                'pwd': () => {
                    addShellOutput("/home/user");
                },
                
                'az account show': () => {
                    addShellOutput("{");
                    addShellOutput('  "environmentName": "AzureCloud",');
                    addShellOutput('  "homeTenantId": "12345678-1234-1234-1234-123456789012",');
                    addShellOutput('  "id": "a1b2c3d4-e5f6-g7h8-i9j0-k1l2m3n4o5p6",');
                    addShellOutput('  "isDefault": true,');
                    addShellOutput('  "managedByTenants": [],');
                    addShellOutput('  "name": "Azure Student Environment",');
                    addShellOutput('  "state": "Enabled",');
                    addShellOutput('  "tenantId": "12345678-1234-1234-1234-123456789012",');
                    addShellOutput('  "user": {');
                    addShellOutput('    "name": "student@learnazure.com",');
                    addShellOutput('    "type": "user"');
                    addShellOutput('  }');
                    addShellOutput("}");
                },
                
                'az group list': () => {
                    if (labState.resourceGroupCreated) {
                        addShellOutput("[");
                        addShellOutput('  {');
                        addShellOutput('    "id": "/subscriptions/a1b2c3d4/resourceGroups/DP900-Lab1-Resources",');
                        addShellOutput('    "location": "eastus",');
                        addShellOutput('    "managedBy": null,');
                        addShellOutput('    "name": "DP900-Lab1-Resources",');
                        addShellOutput('    "properties": {');
                        addShellOutput('      "provisioningState": "Succeeded"');
                        addShellOutput('    },');
                        addShellOutput('    "tags": null,');
                        addShellOutput('    "type": "Microsoft.Resources/resourceGroups"');
                        addShellOutput('  }');
                        addShellOutput("]");
                    } else {
                        addShellOutput("[]");
                    }
                },
                
                'az --version': () => {
                    addShellOutput("azure-cli                          2.40.0");
                    addShellOutput("");
                    addShellOutput("core                               2.40.0");
                    addShellOutput("telemetry                          1.0.8");
                },
                
                'Get-AzSubscription': () => {
                    if (labState.shellMode === 'powershell') {
                        addShellOutput("");
                        addShellOutput("Name              : Azure Student Environment");
                        addShellOutput("Id                : a1b2c3d4-e5f6-g7h8-i9j0-k1l2m3n4o5p6");
                        addShellOutput("TenantId          : 12345678-1234-1234-1234-123456789012");
                        addShellOutput("State             : Enabled");
                        addShellOutput("");
                    } else {
                        addShellOutput(`Command not found: ${command}`, 'error');
                    }
                },
                
                'Get-AzResourceGroup': () => {
                    if (labState.shellMode === 'powershell') {
                        if (labState.resourceGroupCreated) {
                            addShellOutput("");
                            addShellOutput("ResourceGroupName : DP900-Lab1-Resources");
                            addShellOutput("Location          : eastus");
                            addShellOutput("ProvisioningState : Succeeded");
                            addShellOutput("");
                        } else {
                            addShellOutput("");
                            addShellOutput("No resource groups found.");
                            addShellOutput("");
                        }
                    } else {
                        addShellOutput(`Command not found: ${command}`, 'error');
                    }
                }
            };
            
            // Check for exact command match or command that starts with known commands
            let handled = false;
            for (const [cmd, handler] of Object.entries(commands)) {
                if (command === cmd || command.startsWith(cmd + ' ')) {
                    const result = handler();
                    if (result !== true) { // true means don't add prompt (used for clear)
                        addShellPrompt();
                    }
                    handled = true;
                    break;
                }
            }
            
            if (!handled) {
                addShellOutput(`Command not found: ${command}`, 'error');
                addShellOutput("Type 'help' for available commands.");
                addShellPrompt();
            }
        }
        
        // Navigate command history
        function navigateCommandHistory(direction) {
            const input = document.getElementById('shellInput');
            if (!input) return;
            
            if (direction === 'up') {
                if (labState.historyIndex > 0) {
                    labState.historyIndex--;
                    input.value = labState.commandHistory[labState.historyIndex] || '';
                    updateCursorPosition();
                }
            } else if (direction === 'down') {
                if (labState.historyIndex < labState.commandHistory.length - 1) {
                    labState.historyIndex++;
                    input.value = labState.commandHistory[labState.historyIndex] || '';
                } else {
                    labState.historyIndex = labState.commandHistory.length;
                    input.value = '';
                }
                updateCursorPosition();
            }
        }
        
        // Navigate to specific step
        function goToStep(stepNumber) {
            // Only allow going to completed steps or current step
            if (stepNumber > labState.currentStep) {
                showNotification("Step Locked", "Please complete the current step first.");
                return;
            }
            
            // Hide all step contents
            document.querySelectorAll('.step-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Show selected step content
            document.getElementById(`step${stepNumber}Instructions`).classList.add('active');
            
            // Update current step display (but don't change actual current step)
            labState.currentStep = Math.max(labState.currentStep, stepNumber);
            updateStepLocking();
            updateProgress();
            
            // Update simulation title
            const titles = [
                "Sign In to Azure",
                "Explore Azure Portal",
                "Create Resource Group",
                "Explore Data Services",
                "Explore Cloud Shell",
                "Lab Completion"
            ];
            document.getElementById('simulationTitle').textContent = titles[stepNumber - 1];
        }
        
        // Complete a step
        function completeStep(stepNumber) {
            // Only allow completing the current step
            if (stepNumber !== labState.currentStep) {
                showNotification("Step Locked", "Please complete the steps in order.");
                return;
            }
            
            // Special validation for step 2
            if (stepNumber === 2 && !labState.portalExplored) {
                showNotification("Portal Exploration Required", "Please click on at least 2 service tiles in the portal to complete this step.");
                return;
            }
            
            if (!labState.completedSteps.includes(stepNumber)) {
                labState.completedSteps.push(stepNumber);
            }
            
            // Move to next step
            labState.currentStep = stepNumber + 1;
            
            // Update UI
            updateStepLocking();
            updateProgress();
            
            // Show completion message
            const messages = [
                "",
                "Step 1 completed: Signed in to Azure",
                "Step 2 completed: Explored Azure Portal",
                "Step 3 completed: Created resource group",
                "Step 4 completed: Explored data services",
                "Step 5 completed: Used Cloud Shell"
            ];
            
            if (messages[stepNumber]) {
                showNotification("Step Completed", messages[stepNumber]);
            }
            
            // Auto-navigate to next step
            setTimeout(() => {
                goToStep(labState.currentStep);
                
                // Reload dashboard tiles if needed
                if (stepNumber === 1) {
                    loadDashboardTiles();
                }
            }, 1000);
        }
        
        // Complete the entire lab
        function completeLab() {
            // Only allow if all steps are completed
            if (labState.completedSteps.length < 6) {
                showNotification("Lab Incomplete", "Please complete all steps before finishing the lab.");
                return;
            }
            
            // Complete step 6
            completeStep(6);
            
            showNotification("üéâ Lab Completed!", "Congratulations! You've successfully completed Lab 1.");
            
            // Show celebration
            setTimeout(() => {
                document.getElementById('portalDashboard').innerHTML = `
                    <div class="confirmation-dialog" style="grid-column: 1 / -1;">
                        <div class="confirmation-icon" style="background: var(--azure-blue);">üèÜ</div>
                        <div class="confirmation-title" style="color: var(--azure-blue);">Lab 1 Complete!</div>
                        <div class="confirmation-message">
                            <p>You've successfully completed all steps of Lab 1:</p>
                            <ul style="text-align: left; margin-top: 15px;">
                                <li>‚úÖ Azure Portal access</li>
                                <li>‚úÖ Portal navigation</li>
                                <li>‚úÖ Resource group creation</li>
                                <li>‚úÖ Data services exploration</li>
                                <li>‚úÖ Azure Cloud Shell usage</li>
                            </ul>
                            <p style="margin-top: 20px; font-weight: 600;">You're now ready for Lab 2: Core Data Concepts</p>
                        </div>
                        <div style="margin-top: 30px; display: flex; gap: 15px; justify-content: center;">
                            <button class="btn btn-secondary" onclick="resetSimulation()">Restart Lab</button>
                            <button class="btn btn-primary" onclick="printCertificate()">Print Completion Certificate</button>
                        </div>
                    </div>
                `;
            }, 1000);
        }
        
        // Print completion certificate
        function printCertificate() {
            const certificateWindow = window.open('', '_blank');
            certificateWindow.document.write(`
                <html>
                <head>
                    <title>DP-900 Lab 1 Completion Certificate</title>
                    <style>
                        body { font-family: 'Segoe UI', sans-serif; padding: 40px; text-align: center; }
                        .certificate { border: 20px solid #0078d4; padding: 50px; max-width: 800px; margin: 0 auto; }
                        h1 { color: #0078d4; font-size: 36px; margin-bottom: 30px; }
                        h2 { color: #323130; margin: 30px 0; }
                        .details { text-align: left; margin: 30px auto; max-width: 600px; }
                        .signature { margin-top: 50px; }
                        @media print { button { display: none; } }
                    </style>
                </head>
                <body>
                    <div class="certificate">
                        <h1>Certificate of Completion</h1>
                        <h2>DP-900: Microsoft Azure Data Fundamentals</h2>
                        <h3>Lab 1: Azure Portal Navigation & Resource Management</h3>
                        
                        <div class="details">
                            <p>This certifies that the participant has successfully completed:</p>
                            <ul>
                                <li>Azure Portal sign-in and navigation</li>
                                <li>Resource group creation and management</li>
                                <li>Exploration of Azure data services</li>
                                <li>Azure Cloud Shell usage and command execution</li>
                                <li>Understanding of Azure learning environment</li>
                            </ul>
                            <p>Date: ${new Date().toLocaleDateString()}</p>
                        </div>
                        
                        <div class="signature">
                            <p>_________________________</p>
                            <p>Microsoft Learn Platform</p>
                        </div>
                        
                        <button onclick="window.print()" style="margin-top: 30px; padding: 10px 20px; background: #0078d4; color: white; border: none; border-radius: 4px; cursor: pointer;">Print Certificate</button>
                    </div>
                </body>
                </html>
            `);
            certificateWindow.document.close();
        }
        
        // Reset the simulation
        function resetSimulation() {
            if (confirm("Are you sure you want to reset the lab? All progress will be lost.")) {
                // Reset state
                labState.currentStep = 1;
                labState.completedSteps = [1];
                labState.resourceGroupCreated = false;
                labState.servicesExplored = [];
                labState.cloudShellUsed = false;
                labState.commandHistory = [];
                labState.historyIndex = 0;
                labState.portalExplored = false;
                
                // Reset UI
                document.getElementById('step1Content').style.display = 'block';
                document.getElementById('step1Content').style.opacity = '1';
                document.getElementById('azurePortal').style.display = 'none';
                document.getElementById('urlBar').textContent = 'https://portal.azure.com';
                document.getElementById('cloudShellContainer').style.display = 'none';
                
                // Reset buttons
                document.getElementById('signInButton').disabled = false;
                document.getElementById('signInButton').textContent = 'Sign In';
                document.getElementById('step1SignInButton').disabled = false;
                document.getElementById('step1SignInButton').textContent = 'Sign In to Azure';
                
                // Reset forms
                document.getElementById('rgNameInput').value = '';
                document.getElementById('regionSelect').selectedIndex = 0;
                
                // Reset shell
                document.getElementById('shellTerminal').innerHTML = '';
                
                // Go to step 1
                goToStep(1);
                updateProgress();
                
                showNotification("Lab Reset", "The lab has been reset to the beginning.");
            }
        }
        
        // Initialize on load
        window.onload = initializeSimulation;
    </script>
</body>
</html>